---
title: "Question 2- Multivariate Time Series Analysis"
output:
  html_document: default
  pdf_document: default
---

Library creation and setup

```{r setup, include=FALSE}
# install.packages("vars")
# install.packages("greybox")
library(vars)
library(greybox)

```


---
## Question 2.1- VAR per store
### First split


#### Data Load and transformations

First train-test split for data from 2011-2012 for training and 2013 for testing. 

Three data frames are created, one for each store: df_CA_1, df_CA_2 and df_CA_3.


```{r }
# Data load
df = read.csv('/Users/danielroca/Desktop/Forecasting/Projectdata.csv')

# Define the train-test split 703 is 2012-12-31 and 1068 for 2013-12-31
train_sample = 703
test_sample = 1068

# Choose the columns for each store
df_CA_1 = df[c('Hobbies_CA_1','Household_1_CA_1','Household_2_CA_1'
               ,'Foods_1_CA_1','Foods_2_CA_1','Foods_3_CA_1' )]
colnames(df_CA_1) = c('Hobbies','Household_1','Household_2'
                       ,'Foods_1','Foods_2','Foods_3')

df_CA_2 = df[c('Hobbies_CA_2','Household_1_CA_2','Household_2_CA_2'
               ,'Foods_1_CA_2','Foods_2_CA_2','Foods_3_CA_2' )]
colnames(df_CA_2) = c('Hobbies','Household_1','Household_2'
                      ,'Foods_1','Foods_2','Foods_3')

df_CA_3 = df[c('Hobbies_CA_3','Household_1_CA_3','Household_2_CA_3'
               ,'Foods_1_CA_3','Foods_2_CA_3','Foods_3_CA_3' )]
colnames(df_CA_3) = c('Hobbies','Household_1','Household_2'
                      ,'Foods_1','Foods_2','Foods_3')

head(df_CA_1,5)

```

These are the plots for the time series of Store 1 that will be used to train a VAR Model

```{r echo=FALSE}

# plot the VAR time-series and estimates at 1-step 
x = 1:1969
plot(x, df_CA_1$Hobbies, type = "l", frame = FALSE, pch = 19, col = "blue", xlab = "time", ylab = "Hobbies Store 1")
plot(x, df_CA_1$Household_1, type = "l", frame = FALSE, pch = 19, col = "blue", xlab = "time", ylab = "Household1 Store 1")
plot(x, df_CA_1$Household_2, type = "l", frame = FALSE, pch = 19, col = "blue", xlab = "time", ylab = "Household2 Store 1")
plot(x, df_CA_1$Foods_1, type = "l", frame = FALSE, pch = 19, col = "blue", xlab = "time", ylab = "Foods1 Store 1")
plot(x, df_CA_1$Foods_2, type = "l", frame = FALSE, pch = 19, col = "blue", xlab = "time", ylab = "Foods2 Store 1")
plot(x, df_CA_1$Foods_3, type = "l", frame = FALSE, pch = 19, col = "blue", xlab = "time", ylab = "Foods3 Store 1")

```

The dataframes are splitted for each store to have train and test splits

```{r}

# Create train and test samples based on the previous variables
df_CA_1_train = head(df_CA_1, train_sample)
df_CA_1_test  = head(df_CA_1, test_sample)
df_CA_1_test  = tail(df_CA_1_test, test_sample - train_sample)

df_CA_2_train = head(df_CA_2, train_sample)
df_CA_2_test  = head(df_CA_2, test_sample)
df_CA_2_test  = tail(df_CA_2_test, test_sample - train_sample)

df_CA_3_train = head(df_CA_3, train_sample)
df_CA_3_test  = head(df_CA_3, test_sample)
df_CA_3_test  = tail(df_CA_3_test, test_sample - train_sample)

dim(df_CA_1_train)
dim(df_CA_1_test)

```


### Fitting VAR models

With the training data, and setting p = 1, a VAR model is fitted for each
store.

The summary statistics of the first var are shown as ouput.

```{r}

var_CA_1_train = VAR(df_CA_1_train, p=1)
var_CA_2_train = VAR(df_CA_2_train, p=1)
var_CA_3_train = VAR(df_CA_3_train, p=1)

summary(var_CA_1_train)

```

As we can see each variable of the VAR is calculated with respect to the other variables during the previous period.

Now, with the coefficients we forecast the test periods. 

```{r, echo=FALSE}

# Extract the coefficients
dcoef1 = coef(var_CA_1_train)
dcoef2 = coef(var_CA_2_train)
dcoef3 = coef(var_CA_3_train)

# iterate the number of test samples to predict using the var coefficients

length_sample = test_sample - train_sample
for (i in 1:length_sample) {
  if (i==1) {
    df_CA_1_test[i, 7] = dcoef1$Hobbies[1]*df_CA_1_train[train_sample,1] + dcoef1$Hobbies[2]*df_CA_1_train[train_sample,2] + dcoef1$Hobbies[3]*df_CA_1_train[train_sample,3] + dcoef1$Hobbies[4]*df_CA_1_train[train_sample,4] + dcoef1$Hobbies[5]*df_CA_1_train[train_sample,5] + dcoef1$Hobbies[6]*df_CA_1_train[train_sample,6] + dcoef1$Hobbies[7]
    df_CA_1_test[i, 8] = dcoef1$Household_1[1]*df_CA_1_train[train_sample,1] + dcoef1$Household_1[2]*df_CA_1_train[train_sample,2] + dcoef1$Household_1[3]*df_CA_1_train[train_sample,3] + dcoef1$Household_1[4]*df_CA_1_train[train_sample,4] + dcoef1$Household_1[5]*df_CA_1_train[train_sample,5] + dcoef1$Household_1[6]*df_CA_1_train[train_sample,6] + dcoef1$Household_1[7]
    df_CA_1_test[i, 9] = dcoef1$Household_2[1]*df_CA_1_train[train_sample,1] + dcoef1$Household_2[2]*df_CA_1_train[train_sample,2] + dcoef1$Household_2[3]*df_CA_1_train[train_sample,3] + dcoef1$Household_2[4]*df_CA_1_train[train_sample,4] + dcoef1$Household_2[5]*df_CA_1_train[train_sample,5] + dcoef1$Household_2[6]*df_CA_1_train[train_sample,6] + dcoef1$Household_2[7]
    df_CA_1_test[i, 10] = dcoef1$Foods_1[1]*df_CA_1_train[train_sample,1] + dcoef1$Foods_1[2]*df_CA_1_train[train_sample,2] + dcoef1$Foods_1[3]*df_CA_1_train[train_sample,3] + dcoef1$Foods_1[4]*df_CA_1_train[train_sample,4] + dcoef1$Foods_1[5]*df_CA_1_train[train_sample,5] + dcoef1$Foods_1[6]*df_CA_1_train[train_sample,6] + dcoef1$Foods_1[7]
    df_CA_1_test[i, 11] = dcoef1$Foods_2[1]*df_CA_1_train[train_sample,1] + dcoef1$Foods_2[2]*df_CA_1_train[train_sample,2] + dcoef1$Foods_2[3]*df_CA_1_train[train_sample,3] + dcoef1$Foods_2[4]*df_CA_1_train[train_sample,4] + dcoef1$Foods_2[5]*df_CA_1_train[train_sample,5] + dcoef1$Foods_2[6]*df_CA_1_train[train_sample,6] + dcoef1$Foods_2[7]
    df_CA_1_test[i, 12] = dcoef1$Foods_3[1]*df_CA_1_train[train_sample,1] + dcoef1$Foods_3[2]*df_CA_1_train[train_sample,2] + dcoef1$Foods_3[3]*df_CA_1_train[train_sample,3] + dcoef1$Foods_3[4]*df_CA_1_train[train_sample,4] + dcoef1$Foods_3[5]*df_CA_1_train[train_sample,5] + dcoef1$Foods_3[6]*df_CA_1_train[train_sample,6] + dcoef1$Foods_3[7]

    df_CA_2_test[i, 7] = dcoef2$Hobbies[1]*df_CA_2_train[train_sample,1] + dcoef2$Hobbies[2]*df_CA_2_train[train_sample,2] + dcoef2$Hobbies[3]*df_CA_2_train[train_sample,3] + dcoef2$Hobbies[4]*df_CA_2_train[train_sample,4] + dcoef2$Hobbies[5]*df_CA_2_train[train_sample,5] + dcoef2$Hobbies[6]*df_CA_2_train[train_sample,6] + dcoef2$Hobbies[7]
    df_CA_2_test[i, 8] = dcoef2$Household_1[1]*df_CA_2_train[train_sample,1] + dcoef2$Household_1[2]*df_CA_2_train[train_sample,2] + dcoef2$Household_1[3]*df_CA_2_train[train_sample,3] + dcoef2$Household_1[4]*df_CA_2_train[train_sample,4] + dcoef2$Household_1[5]*df_CA_2_train[train_sample,5] + dcoef2$Household_1[6]*df_CA_2_train[train_sample,6] + dcoef2$Household_1[7]
    df_CA_2_test[i, 9] = dcoef2$Household_2[1]*df_CA_2_train[train_sample,1] + dcoef2$Household_2[2]*df_CA_2_train[train_sample,2] + dcoef2$Household_2[3]*df_CA_2_train[train_sample,3] + dcoef2$Household_2[4]*df_CA_2_train[train_sample,4] + dcoef2$Household_2[5]*df_CA_2_train[train_sample,5] + dcoef2$Household_2[6]*df_CA_2_train[train_sample,6] + dcoef2$Household_2[7]
    df_CA_2_test[i, 10] = dcoef2$Foods_1[1]*df_CA_2_train[train_sample,1] + dcoef2$Foods_1[2]*df_CA_2_train[train_sample,2] + dcoef2$Foods_1[3]*df_CA_2_train[train_sample,3] + dcoef2$Foods_1[4]*df_CA_2_train[train_sample,4] + dcoef2$Foods_1[5]*df_CA_2_train[train_sample,5] + dcoef2$Foods_1[6]*df_CA_2_train[train_sample,6] + dcoef2$Foods_1[7]
    df_CA_2_test[i, 11] = dcoef2$Foods_2[1]*df_CA_2_train[train_sample,1] + dcoef2$Foods_2[2]*df_CA_2_train[train_sample,2] + dcoef2$Foods_2[3]*df_CA_2_train[train_sample,3] + dcoef2$Foods_2[4]*df_CA_2_train[train_sample,4] + dcoef2$Foods_2[5]*df_CA_2_train[train_sample,5] + dcoef2$Foods_2[6]*df_CA_2_train[train_sample,6] + dcoef2$Foods_2[7]
    df_CA_2_test[i, 12] = dcoef2$Foods_3[1]*df_CA_2_train[train_sample,1] + dcoef2$Foods_3[2]*df_CA_2_train[train_sample,2] + dcoef2$Foods_3[3]*df_CA_2_train[train_sample,3] + dcoef2$Foods_3[4]*df_CA_2_train[train_sample,4] + dcoef2$Foods_3[5]*df_CA_2_train[train_sample,5] + dcoef2$Foods_3[6]*df_CA_2_train[train_sample,6] + dcoef2$Foods_3[7]

    df_CA_3_test[i, 7] = dcoef3$Hobbies[1]*df_CA_3_train[train_sample,1] + dcoef3$Hobbies[2]*df_CA_3_train[train_sample,2] + dcoef3$Hobbies[3]*df_CA_3_train[train_sample,3] + dcoef3$Hobbies[4]*df_CA_3_train[train_sample,4] + dcoef3$Hobbies[5]*df_CA_3_train[train_sample,5] + dcoef3$Hobbies[6]*df_CA_3_train[train_sample,6] + dcoef3$Hobbies[7]
    df_CA_3_test[i, 8] = dcoef3$Household_1[1]*df_CA_3_train[train_sample,1] + dcoef3$Household_1[2]*df_CA_3_train[train_sample,2] + dcoef3$Household_1[3]*df_CA_3_train[train_sample,3] + dcoef3$Household_1[4]*df_CA_3_train[train_sample,4] + dcoef3$Household_1[5]*df_CA_3_train[train_sample,5] + dcoef3$Household_1[6]*df_CA_3_train[train_sample,6] + dcoef3$Household_1[7]
    df_CA_3_test[i, 9] = dcoef3$Household_2[1]*df_CA_3_train[train_sample,1] + dcoef3$Household_2[2]*df_CA_3_train[train_sample,2] + dcoef3$Household_2[3]*df_CA_3_train[train_sample,3] + dcoef3$Household_2[4]*df_CA_3_train[train_sample,4] + dcoef3$Household_2[5]*df_CA_3_train[train_sample,5] + dcoef3$Household_2[6]*df_CA_3_train[train_sample,6] + dcoef3$Household_2[7]
    df_CA_3_test[i, 10] = dcoef3$Foods_1[1]*df_CA_3_train[train_sample,1] + dcoef3$Foods_1[2]*df_CA_3_train[train_sample,2] + dcoef3$Foods_1[3]*df_CA_3_train[train_sample,3] + dcoef3$Foods_1[4]*df_CA_3_train[train_sample,4] + dcoef3$Foods_1[5]*df_CA_3_train[train_sample,5] + dcoef3$Foods_1[6]*df_CA_3_train[train_sample,6] + dcoef3$Foods_1[7]
    df_CA_3_test[i, 11] = dcoef3$Foods_2[1]*df_CA_3_train[train_sample,1] + dcoef3$Foods_2[2]*df_CA_3_train[train_sample,2] + dcoef3$Foods_2[3]*df_CA_3_train[train_sample,3] + dcoef3$Foods_2[4]*df_CA_3_train[train_sample,4] + dcoef3$Foods_2[5]*df_CA_3_train[train_sample,5] + dcoef3$Foods_2[6]*df_CA_3_train[train_sample,6] + dcoef3$Foods_2[7]
    df_CA_3_test[i, 12] = dcoef3$Foods_3[1]*df_CA_3_train[train_sample,1] + dcoef3$Foods_3[2]*df_CA_3_train[train_sample,2] + dcoef3$Foods_3[3]*df_CA_3_train[train_sample,3] + dcoef3$Foods_3[4]*df_CA_3_train[train_sample,4] + dcoef3$Foods_3[5]*df_CA_3_train[train_sample,5] + dcoef3$Foods_3[6]*df_CA_3_train[train_sample,6] + dcoef3$Foods_3[7]
    
    }
  else {
    df_CA_1_test[i, 7] = dcoef1$Hobbies[1]*df_CA_1_test[i-1,1] + dcoef1$Hobbies[2]*df_CA_1_test[i-1,2] + dcoef1$Hobbies[3]*df_CA_1_test[i-1,3] + dcoef1$Hobbies[4]*df_CA_1_test[i-1,4] + dcoef1$Hobbies[5]*df_CA_1_test[i-1,5] + dcoef1$Hobbies[6]*df_CA_1_test[i-1,6] + dcoef1$Hobbies[7]
    df_CA_1_test[i, 8] = dcoef1$Household_1[1]*df_CA_1_test[i-1,1] + dcoef1$Household_1[2]*df_CA_1_test[i-1,2] + dcoef1$Household_1[3]*df_CA_1_test[i-1,3] + dcoef1$Household_1[4]*df_CA_1_test[i-1,4] + dcoef1$Household_1[5]*df_CA_1_test[i-1,5] + dcoef1$Household_1[6]*df_CA_1_test[i-1,6] + dcoef1$Household_1[7]
    df_CA_1_test[i, 9] = dcoef1$Household_2[1]*df_CA_1_test[i-1,1] + dcoef1$Household_2[2]*df_CA_1_test[i-1,2] + dcoef1$Household_2[3]*df_CA_1_test[i-1,3] + dcoef1$Household_2[4]*df_CA_1_test[i-1,4] + dcoef1$Household_2[5]*df_CA_1_test[i-1,5] + dcoef1$Household_2[6]*df_CA_1_test[i-1,6] + dcoef1$Household_2[7]
    df_CA_1_test[i, 10] = dcoef1$Foods_1[1]*df_CA_1_test[i-1,1] + dcoef1$Foods_1[2]*df_CA_1_test[i-1,2] + dcoef1$Foods_1[3]*df_CA_1_test[i-1,3] + dcoef1$Foods_1[4]*df_CA_1_test[i-1,4] + dcoef1$Foods_1[5]*df_CA_1_test[i-1,5] + dcoef1$Foods_1[6]*df_CA_1_test[i-1,6] + dcoef1$Foods_1[7]
    df_CA_1_test[i, 11] = dcoef1$Foods_2[1]*df_CA_1_test[i-1,1] + dcoef1$Foods_2[2]*df_CA_1_test[i-1,2] + dcoef1$Foods_2[3]*df_CA_1_test[i-1,3] + dcoef1$Foods_2[4]*df_CA_1_test[i-1,4] + dcoef1$Foods_2[5]*df_CA_1_test[i-1,5] + dcoef1$Foods_2[6]*df_CA_1_test[i-1,6] + dcoef1$Foods_2[7]
    df_CA_1_test[i, 12] = dcoef1$Foods_3[1]*df_CA_1_test[i-1,1] + dcoef1$Foods_3[2]*df_CA_1_test[i-1,2] + dcoef1$Foods_3[3]*df_CA_1_test[i-1,3] + dcoef1$Foods_3[4]*df_CA_1_test[i-1,4] + dcoef1$Foods_3[5]*df_CA_1_test[i-1,5] + dcoef1$Foods_3[6]*df_CA_1_test[i-1,6] + dcoef1$Foods_3[7]
    
    df_CA_2_test[i, 7] = dcoef2$Hobbies[1]*df_CA_2_test[i-1,1] + dcoef2$Hobbies[2]*df_CA_2_test[i-1,2] + dcoef2$Hobbies[3]*df_CA_2_test[i-1,3] + dcoef2$Hobbies[4]*df_CA_2_test[i-1,4] + dcoef2$Hobbies[5]*df_CA_2_test[i-1,5] + dcoef2$Hobbies[6]*df_CA_2_test[i-1,6] + dcoef2$Hobbies[7]
    df_CA_2_test[i, 8] = dcoef2$Household_1[1]*df_CA_2_test[i-1,1] + dcoef2$Household_1[2]*df_CA_2_test[i-1,2] + dcoef2$Household_1[3]*df_CA_2_test[i-1,3] + dcoef2$Household_1[4]*df_CA_2_test[i-1,4] + dcoef2$Household_1[5]*df_CA_2_test[i-1,5] + dcoef2$Household_1[6]*df_CA_2_test[i-1,6] + dcoef2$Household_1[7]
    df_CA_2_test[i, 9] = dcoef2$Household_2[1]*df_CA_2_test[i-1,1] + dcoef2$Household_2[2]*df_CA_2_test[i-1,2] + dcoef2$Household_2[3]*df_CA_2_test[i-1,3] + dcoef2$Household_2[4]*df_CA_2_test[i-1,4] + dcoef2$Household_2[5]*df_CA_2_test[i-1,5] + dcoef2$Household_2[6]*df_CA_2_test[i-1,6] + dcoef2$Household_2[7]
    df_CA_2_test[i, 10] = dcoef2$Foods_1[1]*df_CA_2_test[i-1,1] + dcoef2$Foods_1[2]*df_CA_2_test[i-1,2] + dcoef2$Foods_1[3]*df_CA_2_test[i-1,3] + dcoef2$Foods_1[4]*df_CA_2_test[i-1,4] + dcoef2$Foods_1[5]*df_CA_2_test[i-1,5] + dcoef2$Foods_1[6]*df_CA_2_test[i-1,6] + dcoef2$Foods_1[7]
    df_CA_2_test[i, 11] = dcoef2$Foods_2[1]*df_CA_2_test[i-1,1] + dcoef2$Foods_2[2]*df_CA_2_test[i-1,2] + dcoef2$Foods_2[3]*df_CA_2_test[i-1,3] + dcoef2$Foods_2[4]*df_CA_2_test[i-1,4] + dcoef2$Foods_2[5]*df_CA_2_test[i-1,5] + dcoef2$Foods_2[6]*df_CA_2_test[i-1,6] + dcoef2$Foods_2[7]
    df_CA_2_test[i, 12] = dcoef2$Foods_3[1]*df_CA_2_test[i-1,1] + dcoef2$Foods_3[2]*df_CA_2_test[i-1,2] + dcoef2$Foods_3[3]*df_CA_2_test[i-1,3] + dcoef2$Foods_3[4]*df_CA_2_test[i-1,4] + dcoef2$Foods_3[5]*df_CA_2_test[i-1,5] + dcoef2$Foods_3[6]*df_CA_2_test[i-1,6] + dcoef2$Foods_3[7]
    
    df_CA_3_test[i, 7] = dcoef3$Hobbies[1]*df_CA_3_test[i-1,1] + dcoef3$Hobbies[2]*df_CA_3_test[i-1,2] + dcoef3$Hobbies[3]*df_CA_3_test[i-1,3] + dcoef3$Hobbies[4]*df_CA_3_test[i-1,4] + dcoef3$Hobbies[5]*df_CA_3_test[i-1,5] + dcoef3$Hobbies[6]*df_CA_3_test[i-1,6] + dcoef3$Hobbies[7]
    df_CA_3_test[i, 8] = dcoef3$Household_1[1]*df_CA_3_test[i-1,1] + dcoef3$Household_1[2]*df_CA_3_test[i-1,2] + dcoef3$Household_1[3]*df_CA_3_test[i-1,3] + dcoef3$Household_1[4]*df_CA_3_test[i-1,4] + dcoef3$Household_1[5]*df_CA_3_test[i-1,5] + dcoef3$Household_1[6]*df_CA_3_test[i-1,6] + dcoef3$Household_1[7]
    df_CA_3_test[i, 9] = dcoef3$Household_2[1]*df_CA_3_test[i-1,1] + dcoef3$Household_2[2]*df_CA_3_test[i-1,2] + dcoef3$Household_2[3]*df_CA_3_test[i-1,3] + dcoef3$Household_2[4]*df_CA_3_test[i-1,4] + dcoef3$Household_2[5]*df_CA_3_test[i-1,5] + dcoef3$Household_2[6]*df_CA_3_test[i-1,6] + dcoef3$Household_2[7]
    df_CA_3_test[i, 10] = dcoef3$Foods_1[1]*df_CA_3_test[i-1,1] + dcoef3$Foods_1[2]*df_CA_3_test[i-1,2] + dcoef3$Foods_1[3]*df_CA_3_test[i-1,3] + dcoef3$Foods_1[4]*df_CA_3_test[i-1,4] + dcoef3$Foods_1[5]*df_CA_3_test[i-1,5] + dcoef3$Foods_1[6]*df_CA_3_test[i-1,6] + dcoef3$Foods_1[7]
    df_CA_3_test[i, 11] = dcoef3$Foods_2[1]*df_CA_3_test[i-1,1] + dcoef3$Foods_2[2]*df_CA_3_test[i-1,2] + dcoef3$Foods_2[3]*df_CA_3_test[i-1,3] + dcoef3$Foods_2[4]*df_CA_3_test[i-1,4] + dcoef3$Foods_2[5]*df_CA_3_test[i-1,5] + dcoef3$Foods_2[6]*df_CA_3_test[i-1,6] + dcoef3$Foods_2[7]
    df_CA_3_test[i, 12] = dcoef3$Foods_3[1]*df_CA_3_test[i-1,1] + dcoef3$Foods_3[2]*df_CA_3_test[i-1,2] + dcoef3$Foods_3[3]*df_CA_3_test[i-1,3] + dcoef3$Foods_3[4]*df_CA_3_test[i-1,4] + dcoef3$Foods_3[5]*df_CA_3_test[i-1,5] + dcoef3$Foods_3[6]*df_CA_3_test[i-1,6] + dcoef3$Foods_3[7]
    
    
  }
}

colnames(df_CA_1_test) = c('Hobbies','Household_1','Household_2'
                           ,'Foods_1','Foods_2','Foods_3',
                           'Hobbies_pred','Household_1_pred','Household_2_pred'
                           ,'Foods_1_pred','Foods_2_pred','Foods_3_pred')

colnames(df_CA_2_test) = c('Hobbies','Household_1','Household_2'
                           ,'Foods_1','Foods_2','Foods_3',
                           'Hobbies_pred','Household_1_pred','Household_2_pred'
                           ,'Foods_1_pred','Foods_2_pred','Foods_3_pred')

colnames(df_CA_3_test) = c('Hobbies','Household_1','Household_2'
                           ,'Foods_1','Foods_2','Foods_3',
                           'Hobbies_pred','Household_1_pred','Household_2_pred'
                           ,'Foods_1_pred','Foods_2_pred','Foods_3_pred')


```

The output after predicting one-time step is:

```{r}

forecasts_CA_1_21 = df_CA_1_test
forecasts_CA_2_21 = df_CA_2_test
forecasts_CA_3_21 = df_CA_3_test

head(forecasts_CA_1_21, 5)

```

The resulting data frames are used both to plot the real vs predicted time series and also to compute the RMSSE.

```{r}

forecasts_CA_1_21 = df_CA_1_test
forecasts_CA_2_21 = df_CA_2_test
forecasts_CA_3_21 = df_CA_3_test

head(forecasts_CA_1_21, 5)

```

Now with these forecasts we plot the predicted time series (one step ahead) from the VAR model  vs the real time series, also we plot the 95% confidence interval.

### Store 1:

```{r, echo=FALSE}

# plot the VAR time-series and estimates at 1-step 
length_x = test_sample-train_sample
x = 1:length_x

# Plot hobbies real vs predicted forecasts for each store

forecasts_CA_1_21$Hobbies_High = forecasts_CA_1_21$Hobbies_pred + 1.96 * (dcoef1$Hobbies[1,2] + dcoef1$Hobbies[2,2] + dcoef1$Hobbies[3,2] + dcoef1$Hobbies[4,2] + dcoef1$Hobbies[5,2] + dcoef1$Hobbies[6,2] + dcoef1$Hobbies[7,2])

forecasts_CA_1_21$Hobbies_Low = forecasts_CA_1_21$Hobbies_pred - 1.96 * (dcoef1$Hobbies[1,2] + dcoef1$Hobbies[2,2] + dcoef1$Hobbies[3,2] + dcoef1$Hobbies[4,2] + dcoef1$Hobbies[5,2] + dcoef1$Hobbies[6,2] + dcoef1$Hobbies[7,2])

forecasts_CA_1_21$Household_1_High = forecasts_CA_1_21$Household_1_pred + 1.96 * (dcoef1$Household_1[1,2] + dcoef1$Household_1[2,2] + dcoef1$Household_1[3,2] + dcoef1$Household_1[4,2] + dcoef1$Household_1[5,2] + dcoef1$Household_1[6,2] + dcoef1$Household_1[7,2])

forecasts_CA_1_21$Household_1_Low = forecasts_CA_1_21$Household_1_pred - 1.96 * (dcoef1$Household_1[1,2] + dcoef1$Household_1[2,2] + dcoef1$Household_1[3,2] + dcoef1$Household_1[4,2] + dcoef1$Household_1[5,2] + dcoef1$Household_1[6,2] + dcoef1$Household_1[7,2])

forecasts_CA_1_21$Household_2_High = forecasts_CA_1_21$Household_2_pred + 1.96 * (dcoef1$Household_2[1,2] + dcoef1$Household_2[2,2] + dcoef1$Household_2[3,2] + dcoef1$Household_2[4,2] + dcoef1$Household_2[5,2] + dcoef1$Household_2[6,2] + dcoef1$Household_2[7,2])

forecasts_CA_1_21$Household_2_Low = forecasts_CA_1_21$Household_2_pred - 1.96 * (dcoef1$Household_2[1,2] + dcoef1$Household_2[2,2] + dcoef1$Household_2[3,2] + dcoef1$Household_2[4,2] + dcoef1$Household_2[5,2] + dcoef1$Household_2[6,2] + dcoef1$Household_2[7,2])

forecasts_CA_1_21$Foods_1_High = forecasts_CA_1_21$Foods_1_pred + 1.96 * (dcoef1$Foods_1[1,2] + dcoef1$Foods_1[2,2] + dcoef1$Foods_1[3,2] + dcoef1$Foods_1[4,2] + dcoef1$Foods_1[5,2] + dcoef1$Foods_1[6,2] + dcoef1$Foods_1[7,2])

forecasts_CA_1_21$Foods_1_Low = forecasts_CA_1_21$Foods_1_pred - 1.96 * (dcoef1$Foods_1[1,2] + dcoef1$Foods_1[2,2] + dcoef1$Foods_1[3,2] + dcoef1$Foods_1[4,2] + dcoef1$Foods_1[5,2] + dcoef1$Foods_1[6,2] + dcoef1$Foods_1[7,2])

forecasts_CA_1_21$Foods_2_High = forecasts_CA_1_21$Foods_2_pred + 1.96 * (dcoef1$Foods_2[1,2] + dcoef1$Foods_2[2,2] + dcoef1$Foods_2[3,2] + dcoef1$Foods_2[4,2] + dcoef1$Foods_2[5,2] + dcoef1$Foods_2[6,2] + dcoef1$Foods_2[7,2])

forecasts_CA_1_21$Foods_2_Low = forecasts_CA_1_21$Foods_2_pred - 1.96 * (dcoef1$Foods_2[1,2] + dcoef1$Foods_2[2,2] + dcoef1$Foods_2[3,2] + dcoef1$Foods_2[4,2] + dcoef1$Foods_2[5,2] + dcoef1$Foods_2[6,2] + dcoef1$Foods_2[7,2])

forecasts_CA_1_21$Foods_3_High = forecasts_CA_1_21$Foods_3_pred + 1.96 * (dcoef1$Foods_3[1,2] + dcoef1$Foods_3[2,2] + dcoef1$Foods_3[3,2] + dcoef1$Foods_3[4,2] + dcoef1$Foods_3[5,2] + dcoef1$Foods_3[6,2] + dcoef1$Foods_3[7,2])

forecasts_CA_1_21$Foods_3_Low = forecasts_CA_1_21$Foods_3_pred - 1.96 * (dcoef1$Foods_3[1,2] + dcoef1$Foods_3[2,2] + dcoef1$Foods_3[3,2] + dcoef1$Foods_3[4,2] + dcoef1$Foods_3[5,2] + dcoef1$Foods_3[6,2] + dcoef1$Foods_3[7,2])


plot(x, forecasts_CA_1_21$Hobbies, type = "l", frame = FALSE, pch = 19, col = "blue", xlab = "time", ylab = "Hobbies Store 1")
polygon(c(x,rev(x)),c(forecasts_CA_1_21$Hobbies_Low,rev(forecasts_CA_1_21$Hobbies_High)),col="thistle",border=NA)
lines(x, forecasts_CA_1_21$Hobbies, type = "l",  pch = 19, col = "blue")
lines(x, forecasts_CA_1_21$Hobbies_pred, pch = 18, col = "red", type = "l")
legend("bottomright", legend=c("Real", "Predicted", "C.I. 95%"),col=c("blue", "red","thistle"), lty = 1:1, cex=0.8)
title("Hobbies Store 1 - VAR Store 1")

plot(x, forecasts_CA_1_21$Household_1, type = "l", frame = FALSE, pch = 19, col = "blue", xlab = "time", ylab = "Hobbies Store 1")
polygon(c(x,rev(x)),c(forecasts_CA_1_21$Household_1_Low,rev(forecasts_CA_1_21$Household_1_High)),col="thistle",border=NA)
lines(x, forecasts_CA_1_21$Household_1, type = "l",  pch = 19, col = "blue")
lines(x, forecasts_CA_1_21$Household_1_pred, pch = 18, col = "red", type = "l")
legend("bottomright", legend=c("Real", "Predicted", "C.I. 95%"),col=c("blue", "red","thistle"), lty = 1:1, cex=0.8)
title("Household 1 Store 1 - VAR Store 1")

plot(x, forecasts_CA_1_21$Household_2, type = "l", frame = FALSE, pch = 19, col = "blue", xlab = "time", ylab = "Hobbies Store 1")
polygon(c(x,rev(x)),c(forecasts_CA_1_21$Household_2_Low,rev(forecasts_CA_1_21$Household_2_High)),col="thistle",border=NA)
lines(x, forecasts_CA_1_21$Household_2, type = "l",  pch = 19, col = "blue")
lines(x, forecasts_CA_1_21$Household_2_pred, pch = 18, col = "red", type = "l")
legend("bottomright", legend=c("Real", "Predicted", "C.I. 95%"),col=c("blue", "red","thistle"), lty = 1:1, cex=0.8)
title("Household 2 Store 1 - VAR Store 1")

plot(x, forecasts_CA_1_21$Foods_1, type = "l", frame = FALSE, pch = 19, col = "blue", xlab = "time", ylab = "Hobbies Store 1")
polygon(c(x,rev(x)),c(forecasts_CA_1_21$Foods_1_Low,rev(forecasts_CA_1_21$Foods_1_High)),col="thistle",border=NA)
lines(x, forecasts_CA_1_21$Foods_1, type = "l",  pch = 19, col = "blue")
lines(x, forecasts_CA_1_21$Foods_1_pred, pch = 18, col = "red", type = "l")
legend("bottomright", legend=c("Real", "Predicted", "C.I. 95%"),col=c("blue", "red","thistle"), lty = 1:1, cex=0.8)
title("Foods 1 Store 1 - VAR Store 1")

plot(x, forecasts_CA_1_21$Foods_2, type = "l", frame = FALSE, pch = 19, col = "blue", xlab = "time", ylab = "Hobbies Store 1")
polygon(c(x,rev(x)),c(forecasts_CA_1_21$Foods_2_Low,rev(forecasts_CA_1_21$Foods_2_High)),col="thistle",border=NA)
lines(x, forecasts_CA_1_21$Foods_2, type = "l",  pch = 19, col = "blue")
lines(x, forecasts_CA_1_21$Foods_2_pred, pch = 18, col = "red", type = "l")
legend("bottomright", legend=c("Real", "Predicted", "C.I. 95%"),col=c("blue", "red","thistle"), lty = 1:1, cex=0.8)
title("Foods 2 Store 1 - VAR Store 1")

plot(x, forecasts_CA_1_21$Foods_3, type = "l", frame = FALSE, pch = 19, col = "blue", xlab = "time", ylab = "Hobbies Store 1")
polygon(c(x,rev(x)),c(forecasts_CA_1_21$Foods_3_Low,rev(forecasts_CA_1_21$Foods_3_High)),col="thistle",border=NA)
lines(x, forecasts_CA_1_21$Foods_3, type = "l",  pch = 19, col = "blue")
lines(x, forecasts_CA_1_21$Foods_3_pred, pch = 18, col = "red", type = "l")
legend("bottomright", legend=c("Real", "Predicted", "C.I. 95%"),col=c("blue", "red","thistle"), lty = 1:1, cex=0.8)
title("Foods 3 Store 1 - VAR Store 1")

  
```

### Store 2:

```{r, echo=FALSE}

# plot the VAR time-series and estimates at 1-step 
length_x = test_sample-train_sample
x = 1:length_x

# Plot hobbies real vs predicted forecasts for each store

forecasts_CA_2_21$Hobbies_High = forecasts_CA_2_21$Hobbies_pred + 1.96 * (dcoef2$Hobbies[1,2] + dcoef2$Hobbies[2,2] + dcoef2$Hobbies[3,2] + dcoef2$Hobbies[4,2] + dcoef2$Hobbies[5,2] + dcoef2$Hobbies[6,2] + dcoef2$Hobbies[7,2])

forecasts_CA_2_21$Hobbies_Low = forecasts_CA_2_21$Hobbies_pred - 1.96 * (dcoef2$Hobbies[1,2] + dcoef2$Hobbies[2,2] + dcoef2$Hobbies[3,2] + dcoef2$Hobbies[4,2] + dcoef2$Hobbies[5,2] + dcoef2$Hobbies[6,2] + dcoef2$Hobbies[7,2])

forecasts_CA_2_21$Household_1_High = forecasts_CA_2_21$Household_1_pred + 1.96 * (dcoef2$Household_1[1,2] + dcoef2$Household_1[2,2] + dcoef2$Household_1[3,2] + dcoef2$Household_1[4,2] + dcoef2$Household_1[5,2] + dcoef2$Household_1[6,2] + dcoef2$Household_1[7,2])

forecasts_CA_2_21$Household_1_Low = forecasts_CA_2_21$Household_1_pred - 1.96 * (dcoef2$Household_1[1,2] + dcoef2$Household_1[2,2] + dcoef2$Household_1[3,2] + dcoef2$Household_1[4,2] + dcoef2$Household_1[5,2] + dcoef2$Household_1[6,2] + dcoef2$Household_1[7,2])

forecasts_CA_2_21$Household_2_High = forecasts_CA_2_21$Household_2_pred + 1.96 * (dcoef2$Household_2[1,2] + dcoef2$Household_2[2,2] + dcoef2$Household_2[3,2] + dcoef2$Household_2[4,2] + dcoef2$Household_2[5,2] + dcoef2$Household_2[6,2] + dcoef2$Household_2[7,2])

forecasts_CA_2_21$Household_2_Low = forecasts_CA_2_21$Household_2_pred - 1.96 * (dcoef2$Household_2[1,2] + dcoef2$Household_2[2,2] + dcoef2$Household_2[3,2] + dcoef2$Household_2[4,2] + dcoef2$Household_2[5,2] + dcoef2$Household_2[6,2] + dcoef2$Household_2[7,2])

forecasts_CA_2_21$Foods_1_High = forecasts_CA_2_21$Foods_1_pred + 1.96 * (dcoef2$Foods_1[1,2] + dcoef2$Foods_1[2,2] + dcoef2$Foods_1[3,2] + dcoef2$Foods_1[4,2] + dcoef2$Foods_1[5,2] + dcoef2$Foods_1[6,2] + dcoef2$Foods_1[7,2])

forecasts_CA_2_21$Foods_1_Low = forecasts_CA_2_21$Foods_1_pred - 1.96 * (dcoef2$Foods_1[1,2] + dcoef2$Foods_1[2,2] + dcoef2$Foods_1[3,2] + dcoef2$Foods_1[4,2] + dcoef2$Foods_1[5,2] + dcoef2$Foods_1[6,2] + dcoef2$Foods_1[7,2])

forecasts_CA_2_21$Foods_2_High = forecasts_CA_2_21$Foods_2_pred + 1.96 * (dcoef2$Foods_2[1,2] + dcoef2$Foods_2[2,2] + dcoef2$Foods_2[3,2] + dcoef2$Foods_2[4,2] + dcoef2$Foods_2[5,2] + dcoef2$Foods_2[6,2] + dcoef2$Foods_2[7,2])

forecasts_CA_2_21$Foods_2_Low = forecasts_CA_2_21$Foods_2_pred - 1.96 * (dcoef2$Foods_2[1,2] + dcoef2$Foods_2[2,2] + dcoef2$Foods_2[3,2] + dcoef2$Foods_2[4,2] + dcoef2$Foods_2[5,2] + dcoef2$Foods_2[6,2] + dcoef2$Foods_2[7,2])

forecasts_CA_2_21$Foods_3_High = forecasts_CA_2_21$Foods_3_pred + 1.96 * (dcoef2$Foods_3[1,2] + dcoef2$Foods_3[2,2] + dcoef2$Foods_3[3,2] + dcoef2$Foods_3[4,2] + dcoef2$Foods_3[5,2] + dcoef2$Foods_3[6,2] + dcoef2$Foods_3[7,2])

forecasts_CA_2_21$Foods_3_Low = forecasts_CA_2_21$Foods_3_pred - 1.96 * (dcoef2$Foods_3[1,2] + dcoef2$Foods_3[2,2] + dcoef2$Foods_3[3,2] + dcoef2$Foods_3[4,2] + dcoef2$Foods_3[5,2] + dcoef2$Foods_3[6,2] + dcoef2$Foods_3[7,2])


plot(x, forecasts_CA_2_21$Hobbies, type = "l", frame = FALSE, pch = 19, col = "blue", xlab = "time", ylab = "Hobbies Store 1")
polygon(c(x,rev(x)),c(forecasts_CA_2_21$Hobbies_Low,rev(forecasts_CA_2_21$Hobbies_High)),col="thistle",border=NA)
lines(x, forecasts_CA_2_21$Hobbies, type = "l",  pch = 19, col = "blue")
lines(x, forecasts_CA_2_21$Hobbies_pred, pch = 18, col = "red", type = "l")
legend("bottomright", legend=c("Real", "Predicted", "C.I. 95%"),col=c("blue", "red","thistle"), lty = 1:1, cex=0.8)
title("Hobbies Store 2 - VAR Store 2")

plot(x, forecasts_CA_2_21$Household_1, type = "l", frame = FALSE, pch = 19, col = "blue", xlab = "time", ylab = "Hobbies Store 1")
polygon(c(x,rev(x)),c(forecasts_CA_2_21$Household_1_Low,rev(forecasts_CA_2_21$Household_1_High)),col="thistle",border=NA)
lines(x, forecasts_CA_2_21$Household_1, type = "l",  pch = 19, col = "blue")
lines(x, forecasts_CA_2_21$Household_1_pred, pch = 18, col = "red", type = "l")
legend("bottomright", legend=c("Real", "Predicted", "C.I. 95%"),col=c("blue", "red","thistle"), lty = 1:1, cex=0.8)
title("Household 1 Store 2 - VAR Store 2")

plot(x, forecasts_CA_2_21$Household_2, type = "l", frame = FALSE, pch = 19, col = "blue", xlab = "time", ylab = "Hobbies Store 1")
polygon(c(x,rev(x)),c(forecasts_CA_2_21$Household_2_Low,rev(forecasts_CA_2_21$Household_2_High)),col="thistle",border=NA)
lines(x, forecasts_CA_2_21$Household_2, type = "l",  pch = 19, col = "blue")
lines(x, forecasts_CA_2_21$Household_2_pred, pch = 18, col = "red", type = "l")
legend("bottomright", legend=c("Real", "Predicted", "C.I. 95%"),col=c("blue", "red","thistle"), lty = 1:1, cex=0.8)
title("Household 2 Store 2 - VAR Store 2")

plot(x, forecasts_CA_2_21$Foods_1, type = "l", frame = FALSE, pch = 19, col = "blue", xlab = "time", ylab = "Hobbies Store 1")
polygon(c(x,rev(x)),c(forecasts_CA_2_21$Foods_1_Low,rev(forecasts_CA_2_21$Foods_1_High)),col="thistle",border=NA)
lines(x, forecasts_CA_2_21$Foods_1, type = "l",  pch = 19, col = "blue")
lines(x, forecasts_CA_2_21$Foods_1_pred, pch = 18, col = "red", type = "l")
legend("bottomright", legend=c("Real", "Predicted", "C.I. 95%"),col=c("blue", "red","thistle"), lty = 1:1, cex=0.8)
title("Foods 1 Store 2 - VAR Store 2")

plot(x, forecasts_CA_2_21$Foods_2, type = "l", frame = FALSE, pch = 19, col = "blue", xlab = "time", ylab = "Hobbies Store 1")
polygon(c(x,rev(x)),c(forecasts_CA_2_21$Foods_2_Low,rev(forecasts_CA_2_21$Foods_2_High)),col="thistle",border=NA)
lines(x, forecasts_CA_2_21$Foods_2, type = "l",  pch = 19, col = "blue")
lines(x, forecasts_CA_2_21$Foods_2_pred, pch = 18, col = "red", type = "l")
legend("bottomright", legend=c("Real", "Predicted", "C.I. 95%"),col=c("blue", "red","thistle"), lty = 1:1, cex=0.8)
title("Foods 2 Store 2 - VAR Store 2")

plot(x, forecasts_CA_2_21$Foods_3, type = "l", frame = FALSE, pch = 19, col = "blue", xlab = "time", ylab = "Hobbies Store 1")
polygon(c(x,rev(x)),c(forecasts_CA_2_21$Foods_3_Low,rev(forecasts_CA_2_21$Foods_3_High)),col="thistle",border=NA)
lines(x, forecasts_CA_2_21$Foods_3, type = "l",  pch = 19, col = "blue")
lines(x, forecasts_CA_2_21$Foods_3_pred, pch = 18, col = "red", type = "l")
legend("bottomright", legend=c("Real", "Predicted", "C.I. 95%"),col=c("blue", "red","thistle"), lty = 1:1, cex=0.8)
title("Foods 3 Store 2 - VAR Store 2")

  
```


### Store 3:

```{r, echo=FALSE}

# plot the VAR time-series and estimates at 1-step 
length_x = test_sample-train_sample
x = 1:length_x

# Plot hobbies real vs predicted forecasts for each store

forecasts_CA_3_21$Hobbies_High = forecasts_CA_3_21$Hobbies_pred + 1.96 * (dcoef3$Hobbies[1,2] + dcoef3$Hobbies[2,2] + dcoef3$Hobbies[3,2] + dcoef3$Hobbies[4,2] + dcoef3$Hobbies[5,2] + dcoef3$Hobbies[6,2] + dcoef3$Hobbies[7,2])

forecasts_CA_3_21$Hobbies_Low = forecasts_CA_3_21$Hobbies_pred - 1.96 * (dcoef3$Hobbies[1,2] + dcoef3$Hobbies[2,2] + dcoef3$Hobbies[3,2] + dcoef3$Hobbies[4,2] + dcoef3$Hobbies[5,2] + dcoef3$Hobbies[6,2] + dcoef3$Hobbies[7,2])

forecasts_CA_3_21$Household_1_High = forecasts_CA_3_21$Household_1_pred + 1.96 * (dcoef3$Household_1[1,2] + dcoef3$Household_1[2,2] + dcoef3$Household_1[3,2] + dcoef3$Household_1[4,2] + dcoef3$Household_1[5,2] + dcoef3$Household_1[6,2] + dcoef3$Household_1[7,2])

forecasts_CA_3_21$Household_1_Low = forecasts_CA_3_21$Household_1_pred - 1.96 * (dcoef3$Household_1[1,2] + dcoef3$Household_1[2,2] + dcoef3$Household_1[3,2] + dcoef3$Household_1[4,2] + dcoef3$Household_1[5,2] + dcoef3$Household_1[6,2] + dcoef3$Household_1[7,2])

forecasts_CA_3_21$Household_2_High = forecasts_CA_3_21$Household_2_pred + 1.96 * (dcoef3$Household_2[1,2] + dcoef3$Household_2[2,2] + dcoef3$Household_2[3,2] + dcoef3$Household_2[4,2] + dcoef3$Household_2[5,2] + dcoef3$Household_2[6,2] + dcoef3$Household_2[7,2])

forecasts_CA_3_21$Household_2_Low = forecasts_CA_3_21$Household_2_pred - 1.96 * (dcoef3$Household_2[1,2] + dcoef3$Household_2[2,2] + dcoef3$Household_2[3,2] + dcoef3$Household_2[4,2] + dcoef3$Household_2[5,2] + dcoef3$Household_2[6,2] + dcoef3$Household_2[7,2])

forecasts_CA_3_21$Foods_1_High = forecasts_CA_3_21$Foods_1_pred + 1.96 * (dcoef3$Foods_1[1,2] + dcoef3$Foods_1[2,2] + dcoef3$Foods_1[3,2] + dcoef3$Foods_1[4,2] + dcoef3$Foods_1[5,2] + dcoef3$Foods_1[6,2] + dcoef3$Foods_1[7,2])

forecasts_CA_3_21$Foods_1_Low = forecasts_CA_3_21$Foods_1_pred - 1.96 * (dcoef3$Foods_1[1,2] + dcoef3$Foods_1[2,2] + dcoef3$Foods_1[3,2] + dcoef3$Foods_1[4,2] + dcoef3$Foods_1[5,2] + dcoef3$Foods_1[6,2] + dcoef3$Foods_1[7,2])

forecasts_CA_3_21$Foods_2_High = forecasts_CA_3_21$Foods_2_pred + 1.96 * (dcoef3$Foods_2[1,2] + dcoef3$Foods_2[2,2] + dcoef3$Foods_2[3,2] + dcoef3$Foods_2[4,2] + dcoef3$Foods_2[5,2] + dcoef3$Foods_2[6,2] + dcoef3$Foods_2[7,2])

forecasts_CA_3_21$Foods_2_Low = forecasts_CA_3_21$Foods_2_pred - 1.96 * (dcoef3$Foods_2[1,2] + dcoef3$Foods_2[2,2] + dcoef3$Foods_2[3,2] + dcoef3$Foods_2[4,2] + dcoef3$Foods_2[5,2] + dcoef3$Foods_2[6,2] + dcoef3$Foods_2[7,2])

forecasts_CA_3_21$Foods_3_High = forecasts_CA_3_21$Foods_3_pred + 1.96 * (dcoef3$Foods_3[1,2] + dcoef3$Foods_3[2,2] + dcoef3$Foods_3[3,2] + dcoef3$Foods_3[4,2] + dcoef3$Foods_3[5,2] + dcoef3$Foods_3[6,2] + dcoef3$Foods_3[7,2])

forecasts_CA_3_21$Foods_3_Low = forecasts_CA_3_21$Foods_3_pred - 1.96 * (dcoef3$Foods_3[1,2] + dcoef3$Foods_3[2,2] + dcoef3$Foods_3[3,2] + dcoef3$Foods_3[4,2] + dcoef3$Foods_3[5,2] + dcoef3$Foods_3[6,2] + dcoef3$Foods_3[7,2])


plot(x, forecasts_CA_3_21$Hobbies, type = "l", frame = FALSE, pch = 19, col = "blue", xlab = "time", ylab = "Hobbies Store 1")
polygon(c(x,rev(x)),c(forecasts_CA_3_21$Hobbies_Low,rev(forecasts_CA_3_21$Hobbies_High)),col="thistle",border=NA)
lines(x, forecasts_CA_3_21$Hobbies, type = "l",  pch = 19, col = "blue")
lines(x, forecasts_CA_3_21$Hobbies_pred, pch = 18, col = "red", type = "l")
legend("bottomright", legend=c("Real", "Predicted", "C.I. 95%"),col=c("blue", "red","thistle"), lty = 1:1, cex=0.8)
title("Hobbies Store 3 - VAR Store 3")

plot(x, forecasts_CA_3_21$Household_1, type = "l", frame = FALSE, pch = 19, col = "blue", xlab = "time", ylab = "Hobbies Store 1")
polygon(c(x,rev(x)),c(forecasts_CA_3_21$Household_1_Low,rev(forecasts_CA_3_21$Household_1_High)),col="thistle",border=NA)
lines(x, forecasts_CA_3_21$Household_1, type = "l",  pch = 19, col = "blue")
lines(x, forecasts_CA_3_21$Household_1_pred, pch = 18, col = "red", type = "l")
legend("bottomright", legend=c("Real", "Predicted", "C.I. 95%"),col=c("blue", "red","thistle"), lty = 1:1, cex=0.8)
title("Household 1 Store 3 - VAR Store 3")

plot(x, forecasts_CA_3_21$Household_2, type = "l", frame = FALSE, pch = 19, col = "blue", xlab = "time", ylab = "Hobbies Store 1")
polygon(c(x,rev(x)),c(forecasts_CA_3_21$Household_2_Low,rev(forecasts_CA_3_21$Household_2_High)),col="thistle",border=NA)
lines(x, forecasts_CA_3_21$Household_2, type = "l",  pch = 19, col = "blue")
lines(x, forecasts_CA_3_21$Household_2_pred, pch = 18, col = "red", type = "l")
legend("bottomright", legend=c("Real", "Predicted", "C.I. 95%"),col=c("blue", "red","thistle"), lty = 1:1, cex=0.8)
title("Household 2 Store 3 - VAR Store 3")

plot(x, forecasts_CA_3_21$Foods_1, type = "l", frame = FALSE, pch = 19, col = "blue", xlab = "time", ylab = "Hobbies Store 1")
polygon(c(x,rev(x)),c(forecasts_CA_3_21$Foods_1_Low,rev(forecasts_CA_3_21$Foods_1_High)),col="thistle",border=NA)
lines(x, forecasts_CA_3_21$Foods_1, type = "l",  pch = 19, col = "blue")
lines(x, forecasts_CA_3_21$Foods_1_pred, pch = 18, col = "red", type = "l")
legend("bottomright", legend=c("Real", "Predicted", "C.I. 95%"),col=c("blue", "red","thistle"), lty = 1:1, cex=0.8)
title("Foods 1 Store 3 - VAR Store 3")

plot(x, forecasts_CA_3_21$Foods_2, type = "l", frame = FALSE, pch = 19, col = "blue", xlab = "time", ylab = "Hobbies Store 1")
polygon(c(x,rev(x)),c(forecasts_CA_3_21$Foods_2_Low,rev(forecasts_CA_3_21$Foods_2_High)),col="thistle",border=NA)
lines(x, forecasts_CA_3_21$Foods_2, type = "l",  pch = 19, col = "blue")
lines(x, forecasts_CA_3_21$Foods_2_pred, pch = 18, col = "red", type = "l")
legend("bottomright", legend=c("Real", "Predicted", "C.I. 95%"),col=c("blue", "red","thistle"), lty = 1:1, cex=0.8)
title("Foods 2 Store 3 - VAR Store 3")

plot(x, forecasts_CA_3_21$Foods_3, type = "l", frame = FALSE, pch = 19, col = "blue", xlab = "time", ylab = "Hobbies Store 1")
polygon(c(x,rev(x)),c(forecasts_CA_3_21$Foods_3_Low,rev(forecasts_CA_3_21$Foods_3_High)),col="thistle",border=NA)
lines(x, forecasts_CA_3_21$Foods_3, type = "l",  pch = 19, col = "blue")
lines(x, forecasts_CA_3_21$Foods_3_pred, pch = 18, col = "red", type = "l")
legend("bottomright", legend=c("Real", "Predicted", "C.I. 95%"),col=c("blue", "red","thistle"), lty = 1:1, cex=0.8)
title("Foods 3 Store 3 - VAR Store 3")

  
```

Finally this allows us to calculate the RMSSE for each variable. This will be compared at the end with the other two VAR models to conclude which one is best.


```{r}

# Create RMSSE Data frames
df_rmsse_CA_1_2yr = data.frame()
df_rmsse_CA_2_2yr = data.frame()
df_rmsse_CA_3_2yr = data.frame()

# Save the RMSSE Results in a data frame
df_rmsse_CA_1_2yr[1, 1] = RMSSE(forecasts_CA_1_21$Hobbies, forecasts_CA_1_21$Hobbies_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_1_2yr[2, 1] = RMSSE(forecasts_CA_1_21$Household_1, forecasts_CA_1_21$Household_1_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_1_2yr[3, 1] = RMSSE(forecasts_CA_1_21$Household_2, forecasts_CA_1_21$Household_2_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_1_2yr[4, 1] = RMSSE(forecasts_CA_1_21$Foods_1, forecasts_CA_1_21$Foods_1_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_1_2yr[5, 1] = RMSSE(forecasts_CA_1_21$Foods_2, forecasts_CA_1_21$Foods_2_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_1_2yr[6, 1] = RMSSE(forecasts_CA_1_21$Foods_3, forecasts_CA_1_21$Foods_3_pred, scale = 1, na.rm = TRUE)

df_rmsse_CA_2_2yr[1, 1] = RMSSE(forecasts_CA_2_21$Hobbies, forecasts_CA_2_21$Hobbies_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_2_2yr[2, 1] = RMSSE(forecasts_CA_2_21$Household_1, forecasts_CA_2_21$Household_1_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_2_2yr[3, 1] = RMSSE(forecasts_CA_2_21$Household_2, forecasts_CA_2_21$Household_2_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_2_2yr[4, 1] = RMSSE(forecasts_CA_2_21$Foods_1, forecasts_CA_2_21$Foods_1_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_2_2yr[5, 1] = RMSSE(forecasts_CA_2_21$Foods_2, forecasts_CA_2_21$Foods_2_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_2_2yr[6, 1] = RMSSE(forecasts_CA_2_21$Foods_3, forecasts_CA_2_21$Foods_3_pred, scale = 1, na.rm = TRUE)

df_rmsse_CA_3_2yr[1, 1] = RMSSE(forecasts_CA_3_21$Hobbies, forecasts_CA_3_21$Hobbies_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_3_2yr[2, 1] = RMSSE(forecasts_CA_3_21$Household_1, forecasts_CA_3_21$Household_1_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_3_2yr[3, 1] = RMSSE(forecasts_CA_3_21$Household_2, forecasts_CA_3_21$Household_2_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_3_2yr[4, 1] = RMSSE(forecasts_CA_3_21$Foods_1, forecasts_CA_3_21$Foods_1_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_3_2yr[5, 1] = RMSSE(forecasts_CA_3_21$Foods_2, forecasts_CA_3_21$Foods_2_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_3_2yr[6, 1] = RMSSE(forecasts_CA_3_21$Foods_3, forecasts_CA_3_21$Foods_3_pred, scale = 1, na.rm = TRUE)

rownames(df_rmsse_CA_1_2yr) =  c("Hobbies","Household1","Household2","Foods1","Foods2","Foods3")
rownames(df_rmsse_CA_2_2yr) =  c("Hobbies","Household1","Household2","Foods1","Foods2","Foods3")
rownames(df_rmsse_CA_3_2yr) =  c("Hobbies","Household1","Household2","Foods1","Foods2","Foods3")

colnames(df_rmsse_CA_1_2yr) = c("var21")
colnames(df_rmsse_CA_2_2yr) = c("var21")
colnames(df_rmsse_CA_3_2yr) = c("var21")

df_rmsse_CA_1_2yr
df_rmsse_CA_2_2yr
df_rmsse_CA_3_2yr

```

The same exercise will be carried out with other train-test splits to be able to compare results. With these splits, the final result of the RMSSE will be shown:

### Train-test split for data from 2011-2013 for training and 2014 for testing.

```{r, include=FALSE}

# Define the train-test split 703 is 2012-12-31 and 1068 for 2013-12-31
train_sample = 1068
test_sample = 1433

# Choose the columns for each store
df_CA_1 = df[c('Hobbies_CA_1','Household_1_CA_1','Household_2_CA_1'
               ,'Foods_1_CA_1','Foods_2_CA_1','Foods_3_CA_1' )]
colnames(df_CA_1) = c('Hobbies','Household_1','Household_2'
                       ,'Foods_1','Foods_2','Foods_3')

df_CA_2 = df[c('Hobbies_CA_2','Household_1_CA_2','Household_2_CA_2'
               ,'Foods_1_CA_2','Foods_2_CA_2','Foods_3_CA_2' )]
colnames(df_CA_2) = c('Hobbies','Household_1','Household_2'
                      ,'Foods_1','Foods_2','Foods_3')

df_CA_3 = df[c('Hobbies_CA_3','Household_1_CA_3','Household_2_CA_3'
               ,'Foods_1_CA_3','Foods_2_CA_3','Foods_3_CA_3' )]
colnames(df_CA_3) = c('Hobbies','Household_1','Household_2'
                      ,'Foods_1','Foods_2','Foods_3')

df_CA_1_train = head(df_CA_1, train_sample)
df_CA_1_test  = head(df_CA_1, test_sample)
df_CA_1_test  = tail(df_CA_1_test, test_sample - train_sample)

df_CA_2_train = head(df_CA_2, train_sample)
df_CA_2_test  = head(df_CA_2, test_sample)
df_CA_2_test  = tail(df_CA_2_test, test_sample - train_sample)

df_CA_3_train = head(df_CA_3, train_sample)
df_CA_3_test  = head(df_CA_3, test_sample)
df_CA_3_test  = tail(df_CA_3_test, test_sample - train_sample)

var_CA_1_train = VAR(df_CA_1_train, p=1)
var_CA_2_train = VAR(df_CA_2_train, p=1)
var_CA_3_train = VAR(df_CA_3_train, p=1)

dcoef1 = coef(var_CA_1_train)
dcoef2 = coef(var_CA_2_train)
dcoef3 = coef(var_CA_3_train)

# iterate the number of test samples to predict using the var coefficients

length_sample = test_sample - train_sample
for (i in 1:length_sample) {
  if (i==1) {
    df_CA_1_test[i, 7] = dcoef1$Hobbies[1]*df_CA_1_train[train_sample,1] + dcoef1$Hobbies[2]*df_CA_1_train[train_sample,2] + dcoef1$Hobbies[3]*df_CA_1_train[train_sample,3] + dcoef1$Hobbies[4]*df_CA_1_train[train_sample,4] + dcoef1$Hobbies[5]*df_CA_1_train[train_sample,5] + dcoef1$Hobbies[6]*df_CA_1_train[train_sample,6] + dcoef1$Hobbies[7]
    df_CA_1_test[i, 8] = dcoef1$Household_1[1]*df_CA_1_train[train_sample,1] + dcoef1$Household_1[2]*df_CA_1_train[train_sample,2] + dcoef1$Household_1[3]*df_CA_1_train[train_sample,3] + dcoef1$Household_1[4]*df_CA_1_train[train_sample,4] + dcoef1$Household_1[5]*df_CA_1_train[train_sample,5] + dcoef1$Household_1[6]*df_CA_1_train[train_sample,6] + dcoef1$Household_1[7]
    df_CA_1_test[i, 9] = dcoef1$Household_2[1]*df_CA_1_train[train_sample,1] + dcoef1$Household_2[2]*df_CA_1_train[train_sample,2] + dcoef1$Household_2[3]*df_CA_1_train[train_sample,3] + dcoef1$Household_2[4]*df_CA_1_train[train_sample,4] + dcoef1$Household_2[5]*df_CA_1_train[train_sample,5] + dcoef1$Household_2[6]*df_CA_1_train[train_sample,6] + dcoef1$Household_2[7]
    df_CA_1_test[i, 10] = dcoef1$Foods_1[1]*df_CA_1_train[train_sample,1] + dcoef1$Foods_1[2]*df_CA_1_train[train_sample,2] + dcoef1$Foods_1[3]*df_CA_1_train[train_sample,3] + dcoef1$Foods_1[4]*df_CA_1_train[train_sample,4] + dcoef1$Foods_1[5]*df_CA_1_train[train_sample,5] + dcoef1$Foods_1[6]*df_CA_1_train[train_sample,6] + dcoef1$Foods_1[7]
    df_CA_1_test[i, 11] = dcoef1$Foods_2[1]*df_CA_1_train[train_sample,1] + dcoef1$Foods_2[2]*df_CA_1_train[train_sample,2] + dcoef1$Foods_2[3]*df_CA_1_train[train_sample,3] + dcoef1$Foods_2[4]*df_CA_1_train[train_sample,4] + dcoef1$Foods_2[5]*df_CA_1_train[train_sample,5] + dcoef1$Foods_2[6]*df_CA_1_train[train_sample,6] + dcoef1$Foods_2[7]
    df_CA_1_test[i, 12] = dcoef1$Foods_3[1]*df_CA_1_train[train_sample,1] + dcoef1$Foods_3[2]*df_CA_1_train[train_sample,2] + dcoef1$Foods_3[3]*df_CA_1_train[train_sample,3] + dcoef1$Foods_3[4]*df_CA_1_train[train_sample,4] + dcoef1$Foods_3[5]*df_CA_1_train[train_sample,5] + dcoef1$Foods_3[6]*df_CA_1_train[train_sample,6] + dcoef1$Foods_3[7]

    df_CA_2_test[i, 7] = dcoef2$Hobbies[1]*df_CA_2_train[train_sample,1] + dcoef2$Hobbies[2]*df_CA_2_train[train_sample,2] + dcoef2$Hobbies[3]*df_CA_2_train[train_sample,3] + dcoef2$Hobbies[4]*df_CA_2_train[train_sample,4] + dcoef2$Hobbies[5]*df_CA_2_train[train_sample,5] + dcoef2$Hobbies[6]*df_CA_2_train[train_sample,6] + dcoef2$Hobbies[7]
    df_CA_2_test[i, 8] = dcoef2$Household_1[1]*df_CA_2_train[train_sample,1] + dcoef2$Household_1[2]*df_CA_2_train[train_sample,2] + dcoef2$Household_1[3]*df_CA_2_train[train_sample,3] + dcoef2$Household_1[4]*df_CA_2_train[train_sample,4] + dcoef2$Household_1[5]*df_CA_2_train[train_sample,5] + dcoef2$Household_1[6]*df_CA_2_train[train_sample,6] + dcoef2$Household_1[7]
    df_CA_2_test[i, 9] = dcoef2$Household_2[1]*df_CA_2_train[train_sample,1] + dcoef2$Household_2[2]*df_CA_2_train[train_sample,2] + dcoef2$Household_2[3]*df_CA_2_train[train_sample,3] + dcoef2$Household_2[4]*df_CA_2_train[train_sample,4] + dcoef2$Household_2[5]*df_CA_2_train[train_sample,5] + dcoef2$Household_2[6]*df_CA_2_train[train_sample,6] + dcoef2$Household_2[7]
    df_CA_2_test[i, 10] = dcoef2$Foods_1[1]*df_CA_2_train[train_sample,1] + dcoef2$Foods_1[2]*df_CA_2_train[train_sample,2] + dcoef2$Foods_1[3]*df_CA_2_train[train_sample,3] + dcoef2$Foods_1[4]*df_CA_2_train[train_sample,4] + dcoef2$Foods_1[5]*df_CA_2_train[train_sample,5] + dcoef2$Foods_1[6]*df_CA_2_train[train_sample,6] + dcoef2$Foods_1[7]
    df_CA_2_test[i, 11] = dcoef2$Foods_2[1]*df_CA_2_train[train_sample,1] + dcoef2$Foods_2[2]*df_CA_2_train[train_sample,2] + dcoef2$Foods_2[3]*df_CA_2_train[train_sample,3] + dcoef2$Foods_2[4]*df_CA_2_train[train_sample,4] + dcoef2$Foods_2[5]*df_CA_2_train[train_sample,5] + dcoef2$Foods_2[6]*df_CA_2_train[train_sample,6] + dcoef2$Foods_2[7]
    df_CA_2_test[i, 12] = dcoef2$Foods_3[1]*df_CA_2_train[train_sample,1] + dcoef2$Foods_3[2]*df_CA_2_train[train_sample,2] + dcoef2$Foods_3[3]*df_CA_2_train[train_sample,3] + dcoef2$Foods_3[4]*df_CA_2_train[train_sample,4] + dcoef2$Foods_3[5]*df_CA_2_train[train_sample,5] + dcoef2$Foods_3[6]*df_CA_2_train[train_sample,6] + dcoef2$Foods_3[7]

    df_CA_3_test[i, 7] = dcoef3$Hobbies[1]*df_CA_3_train[train_sample,1] + dcoef3$Hobbies[2]*df_CA_3_train[train_sample,2] + dcoef3$Hobbies[3]*df_CA_3_train[train_sample,3] + dcoef3$Hobbies[4]*df_CA_3_train[train_sample,4] + dcoef3$Hobbies[5]*df_CA_3_train[train_sample,5] + dcoef3$Hobbies[6]*df_CA_3_train[train_sample,6] + dcoef3$Hobbies[7]
    df_CA_3_test[i, 8] = dcoef3$Household_1[1]*df_CA_3_train[train_sample,1] + dcoef3$Household_1[2]*df_CA_3_train[train_sample,2] + dcoef3$Household_1[3]*df_CA_3_train[train_sample,3] + dcoef3$Household_1[4]*df_CA_3_train[train_sample,4] + dcoef3$Household_1[5]*df_CA_3_train[train_sample,5] + dcoef3$Household_1[6]*df_CA_3_train[train_sample,6] + dcoef3$Household_1[7]
    df_CA_3_test[i, 9] = dcoef3$Household_2[1]*df_CA_3_train[train_sample,1] + dcoef3$Household_2[2]*df_CA_3_train[train_sample,2] + dcoef3$Household_2[3]*df_CA_3_train[train_sample,3] + dcoef3$Household_2[4]*df_CA_3_train[train_sample,4] + dcoef3$Household_2[5]*df_CA_3_train[train_sample,5] + dcoef3$Household_2[6]*df_CA_3_train[train_sample,6] + dcoef3$Household_2[7]
    df_CA_3_test[i, 10] = dcoef3$Foods_1[1]*df_CA_3_train[train_sample,1] + dcoef3$Foods_1[2]*df_CA_3_train[train_sample,2] + dcoef3$Foods_1[3]*df_CA_3_train[train_sample,3] + dcoef3$Foods_1[4]*df_CA_3_train[train_sample,4] + dcoef3$Foods_1[5]*df_CA_3_train[train_sample,5] + dcoef3$Foods_1[6]*df_CA_3_train[train_sample,6] + dcoef3$Foods_1[7]
    df_CA_3_test[i, 11] = dcoef3$Foods_2[1]*df_CA_3_train[train_sample,1] + dcoef3$Foods_2[2]*df_CA_3_train[train_sample,2] + dcoef3$Foods_2[3]*df_CA_3_train[train_sample,3] + dcoef3$Foods_2[4]*df_CA_3_train[train_sample,4] + dcoef3$Foods_2[5]*df_CA_3_train[train_sample,5] + dcoef3$Foods_2[6]*df_CA_3_train[train_sample,6] + dcoef3$Foods_2[7]
    df_CA_3_test[i, 12] = dcoef3$Foods_3[1]*df_CA_3_train[train_sample,1] + dcoef3$Foods_3[2]*df_CA_3_train[train_sample,2] + dcoef3$Foods_3[3]*df_CA_3_train[train_sample,3] + dcoef3$Foods_3[4]*df_CA_3_train[train_sample,4] + dcoef3$Foods_3[5]*df_CA_3_train[train_sample,5] + dcoef3$Foods_3[6]*df_CA_3_train[train_sample,6] + dcoef3$Foods_3[7]
    
    }
  else {
    df_CA_1_test[i, 7] = dcoef1$Hobbies[1]*df_CA_1_test[i-1,1] + dcoef1$Hobbies[2]*df_CA_1_test[i-1,2] + dcoef1$Hobbies[3]*df_CA_1_test[i-1,3] + dcoef1$Hobbies[4]*df_CA_1_test[i-1,4] + dcoef1$Hobbies[5]*df_CA_1_test[i-1,5] + dcoef1$Hobbies[6]*df_CA_1_test[i-1,6] + dcoef1$Hobbies[7]
    df_CA_1_test[i, 8] = dcoef1$Household_1[1]*df_CA_1_test[i-1,1] + dcoef1$Household_1[2]*df_CA_1_test[i-1,2] + dcoef1$Household_1[3]*df_CA_1_test[i-1,3] + dcoef1$Household_1[4]*df_CA_1_test[i-1,4] + dcoef1$Household_1[5]*df_CA_1_test[i-1,5] + dcoef1$Household_1[6]*df_CA_1_test[i-1,6] + dcoef1$Household_1[7]
    df_CA_1_test[i, 9] = dcoef1$Household_2[1]*df_CA_1_test[i-1,1] + dcoef1$Household_2[2]*df_CA_1_test[i-1,2] + dcoef1$Household_2[3]*df_CA_1_test[i-1,3] + dcoef1$Household_2[4]*df_CA_1_test[i-1,4] + dcoef1$Household_2[5]*df_CA_1_test[i-1,5] + dcoef1$Household_2[6]*df_CA_1_test[i-1,6] + dcoef1$Household_2[7]
    df_CA_1_test[i, 10] = dcoef1$Foods_1[1]*df_CA_1_test[i-1,1] + dcoef1$Foods_1[2]*df_CA_1_test[i-1,2] + dcoef1$Foods_1[3]*df_CA_1_test[i-1,3] + dcoef1$Foods_1[4]*df_CA_1_test[i-1,4] + dcoef1$Foods_1[5]*df_CA_1_test[i-1,5] + dcoef1$Foods_1[6]*df_CA_1_test[i-1,6] + dcoef1$Foods_1[7]
    df_CA_1_test[i, 11] = dcoef1$Foods_2[1]*df_CA_1_test[i-1,1] + dcoef1$Foods_2[2]*df_CA_1_test[i-1,2] + dcoef1$Foods_2[3]*df_CA_1_test[i-1,3] + dcoef1$Foods_2[4]*df_CA_1_test[i-1,4] + dcoef1$Foods_2[5]*df_CA_1_test[i-1,5] + dcoef1$Foods_2[6]*df_CA_1_test[i-1,6] + dcoef1$Foods_2[7]
    df_CA_1_test[i, 12] = dcoef1$Foods_3[1]*df_CA_1_test[i-1,1] + dcoef1$Foods_3[2]*df_CA_1_test[i-1,2] + dcoef1$Foods_3[3]*df_CA_1_test[i-1,3] + dcoef1$Foods_3[4]*df_CA_1_test[i-1,4] + dcoef1$Foods_3[5]*df_CA_1_test[i-1,5] + dcoef1$Foods_3[6]*df_CA_1_test[i-1,6] + dcoef1$Foods_3[7]
    
    df_CA_2_test[i, 7] = dcoef2$Hobbies[1]*df_CA_2_test[i-1,1] + dcoef2$Hobbies[2]*df_CA_2_test[i-1,2] + dcoef2$Hobbies[3]*df_CA_2_test[i-1,3] + dcoef2$Hobbies[4]*df_CA_2_test[i-1,4] + dcoef2$Hobbies[5]*df_CA_2_test[i-1,5] + dcoef2$Hobbies[6]*df_CA_2_test[i-1,6] + dcoef2$Hobbies[7]
    df_CA_2_test[i, 8] = dcoef2$Household_1[1]*df_CA_2_test[i-1,1] + dcoef2$Household_1[2]*df_CA_2_test[i-1,2] + dcoef2$Household_1[3]*df_CA_2_test[i-1,3] + dcoef2$Household_1[4]*df_CA_2_test[i-1,4] + dcoef2$Household_1[5]*df_CA_2_test[i-1,5] + dcoef2$Household_1[6]*df_CA_2_test[i-1,6] + dcoef2$Household_1[7]
    df_CA_2_test[i, 9] = dcoef2$Household_2[1]*df_CA_2_test[i-1,1] + dcoef2$Household_2[2]*df_CA_2_test[i-1,2] + dcoef2$Household_2[3]*df_CA_2_test[i-1,3] + dcoef2$Household_2[4]*df_CA_2_test[i-1,4] + dcoef2$Household_2[5]*df_CA_2_test[i-1,5] + dcoef2$Household_2[6]*df_CA_2_test[i-1,6] + dcoef2$Household_2[7]
    df_CA_2_test[i, 10] = dcoef2$Foods_1[1]*df_CA_2_test[i-1,1] + dcoef2$Foods_1[2]*df_CA_2_test[i-1,2] + dcoef2$Foods_1[3]*df_CA_2_test[i-1,3] + dcoef2$Foods_1[4]*df_CA_2_test[i-1,4] + dcoef2$Foods_1[5]*df_CA_2_test[i-1,5] + dcoef2$Foods_1[6]*df_CA_2_test[i-1,6] + dcoef2$Foods_1[7]
    df_CA_2_test[i, 11] = dcoef2$Foods_2[1]*df_CA_2_test[i-1,1] + dcoef2$Foods_2[2]*df_CA_2_test[i-1,2] + dcoef2$Foods_2[3]*df_CA_2_test[i-1,3] + dcoef2$Foods_2[4]*df_CA_2_test[i-1,4] + dcoef2$Foods_2[5]*df_CA_2_test[i-1,5] + dcoef2$Foods_2[6]*df_CA_2_test[i-1,6] + dcoef2$Foods_2[7]
    df_CA_2_test[i, 12] = dcoef2$Foods_3[1]*df_CA_2_test[i-1,1] + dcoef2$Foods_3[2]*df_CA_2_test[i-1,2] + dcoef2$Foods_3[3]*df_CA_2_test[i-1,3] + dcoef2$Foods_3[4]*df_CA_2_test[i-1,4] + dcoef2$Foods_3[5]*df_CA_2_test[i-1,5] + dcoef2$Foods_3[6]*df_CA_2_test[i-1,6] + dcoef2$Foods_3[7]
    
    df_CA_3_test[i, 7] = dcoef3$Hobbies[1]*df_CA_3_test[i-1,1] + dcoef3$Hobbies[2]*df_CA_3_test[i-1,2] + dcoef3$Hobbies[3]*df_CA_3_test[i-1,3] + dcoef3$Hobbies[4]*df_CA_3_test[i-1,4] + dcoef3$Hobbies[5]*df_CA_3_test[i-1,5] + dcoef3$Hobbies[6]*df_CA_3_test[i-1,6] + dcoef3$Hobbies[7]
    df_CA_3_test[i, 8] = dcoef3$Household_1[1]*df_CA_3_test[i-1,1] + dcoef3$Household_1[2]*df_CA_3_test[i-1,2] + dcoef3$Household_1[3]*df_CA_3_test[i-1,3] + dcoef3$Household_1[4]*df_CA_3_test[i-1,4] + dcoef3$Household_1[5]*df_CA_3_test[i-1,5] + dcoef3$Household_1[6]*df_CA_3_test[i-1,6] + dcoef3$Household_1[7]
    df_CA_3_test[i, 9] = dcoef3$Household_2[1]*df_CA_3_test[i-1,1] + dcoef3$Household_2[2]*df_CA_3_test[i-1,2] + dcoef3$Household_2[3]*df_CA_3_test[i-1,3] + dcoef3$Household_2[4]*df_CA_3_test[i-1,4] + dcoef3$Household_2[5]*df_CA_3_test[i-1,5] + dcoef3$Household_2[6]*df_CA_3_test[i-1,6] + dcoef3$Household_2[7]
    df_CA_3_test[i, 10] = dcoef3$Foods_1[1]*df_CA_3_test[i-1,1] + dcoef3$Foods_1[2]*df_CA_3_test[i-1,2] + dcoef3$Foods_1[3]*df_CA_3_test[i-1,3] + dcoef3$Foods_1[4]*df_CA_3_test[i-1,4] + dcoef3$Foods_1[5]*df_CA_3_test[i-1,5] + dcoef3$Foods_1[6]*df_CA_3_test[i-1,6] + dcoef3$Foods_1[7]
    df_CA_3_test[i, 11] = dcoef3$Foods_2[1]*df_CA_3_test[i-1,1] + dcoef3$Foods_2[2]*df_CA_3_test[i-1,2] + dcoef3$Foods_2[3]*df_CA_3_test[i-1,3] + dcoef3$Foods_2[4]*df_CA_3_test[i-1,4] + dcoef3$Foods_2[5]*df_CA_3_test[i-1,5] + dcoef3$Foods_2[6]*df_CA_3_test[i-1,6] + dcoef3$Foods_2[7]
    df_CA_3_test[i, 12] = dcoef3$Foods_3[1]*df_CA_3_test[i-1,1] + dcoef3$Foods_3[2]*df_CA_3_test[i-1,2] + dcoef3$Foods_3[3]*df_CA_3_test[i-1,3] + dcoef3$Foods_3[4]*df_CA_3_test[i-1,4] + dcoef3$Foods_3[5]*df_CA_3_test[i-1,5] + dcoef3$Foods_3[6]*df_CA_3_test[i-1,6] + dcoef3$Foods_3[7]
    
    
  }
}

colnames(df_CA_1_test) = c('Hobbies','Household_1','Household_2'
                           ,'Foods_1','Foods_2','Foods_3',
                           'Hobbies_pred','Household_1_pred','Household_2_pred'
                           ,'Foods_1_pred','Foods_2_pred','Foods_3_pred')

colnames(df_CA_2_test) = c('Hobbies','Household_1','Household_2'
                           ,'Foods_1','Foods_2','Foods_3',
                           'Hobbies_pred','Household_1_pred','Household_2_pred'
                           ,'Foods_1_pred','Foods_2_pred','Foods_3_pred')

colnames(df_CA_3_test) = c('Hobbies','Household_1','Household_2'
                           ,'Foods_1','Foods_2','Foods_3',
                           'Hobbies_pred','Household_1_pred','Household_2_pred'
                           ,'Foods_1_pred','Foods_2_pred','Foods_3_pred')

forecasts_CA_1_21 = df_CA_1_test
forecasts_CA_2_21 = df_CA_2_test
forecasts_CA_3_21 = df_CA_3_test

# Create RMSSE Data frames
df_rmsse_CA_1_3yr = data.frame()
df_rmsse_CA_2_3yr = data.frame()
df_rmsse_CA_3_3yr = data.frame()

# Save the RMSSE Results in a data frame
df_rmsse_CA_1_3yr[1, 1] = RMSSE(forecasts_CA_1_21$Hobbies, forecasts_CA_1_21$Hobbies_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_1_3yr[2, 1] = RMSSE(forecasts_CA_1_21$Household_1, forecasts_CA_1_21$Household_1_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_1_3yr[3, 1] = RMSSE(forecasts_CA_1_21$Household_2, forecasts_CA_1_21$Household_2_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_1_3yr[4, 1] = RMSSE(forecasts_CA_1_21$Foods_1, forecasts_CA_1_21$Foods_1_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_1_3yr[5, 1] = RMSSE(forecasts_CA_1_21$Foods_2, forecasts_CA_1_21$Foods_2_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_1_3yr[6, 1] = RMSSE(forecasts_CA_1_21$Foods_3, forecasts_CA_1_21$Foods_3_pred, scale = 1, na.rm = TRUE)

df_rmsse_CA_2_3yr[1, 1] = RMSSE(forecasts_CA_2_21$Hobbies, forecasts_CA_2_21$Hobbies_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_2_3yr[2, 1] = RMSSE(forecasts_CA_2_21$Household_1, forecasts_CA_2_21$Household_1_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_2_3yr[3, 1] = RMSSE(forecasts_CA_2_21$Household_2, forecasts_CA_2_21$Household_2_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_2_3yr[4, 1] = RMSSE(forecasts_CA_2_21$Foods_1, forecasts_CA_2_21$Foods_1_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_2_3yr[5, 1] = RMSSE(forecasts_CA_2_21$Foods_2, forecasts_CA_2_21$Foods_2_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_2_3yr[6, 1] = RMSSE(forecasts_CA_2_21$Foods_3, forecasts_CA_2_21$Foods_3_pred, scale = 1, na.rm = TRUE)

df_rmsse_CA_3_3yr[1, 1] = RMSSE(forecasts_CA_3_21$Hobbies, forecasts_CA_3_21$Hobbies_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_3_3yr[2, 1] = RMSSE(forecasts_CA_3_21$Household_1, forecasts_CA_3_21$Household_1_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_3_3yr[3, 1] = RMSSE(forecasts_CA_3_21$Household_2, forecasts_CA_3_21$Household_2_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_3_3yr[4, 1] = RMSSE(forecasts_CA_3_21$Foods_1, forecasts_CA_3_21$Foods_1_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_3_3yr[5, 1] = RMSSE(forecasts_CA_3_21$Foods_2, forecasts_CA_3_21$Foods_2_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_3_3yr[6, 1] = RMSSE(forecasts_CA_3_21$Foods_3, forecasts_CA_3_21$Foods_3_pred, scale = 1, na.rm = TRUE)

rownames(df_rmsse_CA_1_3yr) =  c("Hobbies","Household1","Household2","Foods1","Foods2","Foods3")
rownames(df_rmsse_CA_2_3yr) =  c("Hobbies","Household1","Household2","Foods1","Foods2","Foods3")
rownames(df_rmsse_CA_3_3yr) =  c("Hobbies","Household1","Household2","Foods1","Foods2","Foods3")

colnames(df_rmsse_CA_1_3yr) = c("var21")
colnames(df_rmsse_CA_2_3yr) = c("var21")
colnames(df_rmsse_CA_3_3yr) = c("var21")

```

```{r}

df_rmsse_CA_1_3yr
df_rmsse_CA_2_3yr
df_rmsse_CA_3_3yr

```


### Train-test split for data from 2011-2014 for training and 2015 for testing.

```{r, include=FALSE}

train_sample = 1433
test_sample = 1798

# Choose the columns for each store
df_CA_1 = df[c('Hobbies_CA_1','Household_1_CA_1','Household_2_CA_1'
               ,'Foods_1_CA_1','Foods_2_CA_1','Foods_3_CA_1' )]
colnames(df_CA_1) = c('Hobbies','Household_1','Household_2'
                       ,'Foods_1','Foods_2','Foods_3')

df_CA_2 = df[c('Hobbies_CA_2','Household_1_CA_2','Household_2_CA_2'
               ,'Foods_1_CA_2','Foods_2_CA_2','Foods_3_CA_2' )]
colnames(df_CA_2) = c('Hobbies','Household_1','Household_2'
                      ,'Foods_1','Foods_2','Foods_3')

df_CA_3 = df[c('Hobbies_CA_3','Household_1_CA_3','Household_2_CA_3'
               ,'Foods_1_CA_3','Foods_2_CA_3','Foods_3_CA_3' )]
colnames(df_CA_3) = c('Hobbies','Household_1','Household_2'
                      ,'Foods_1','Foods_2','Foods_3')

df_CA_1_train = head(df_CA_1, train_sample)
df_CA_1_test  = head(df_CA_1, test_sample)
df_CA_1_test  = tail(df_CA_1_test, test_sample - train_sample)

df_CA_2_train = head(df_CA_2, train_sample)
df_CA_2_test  = head(df_CA_2, test_sample)
df_CA_2_test  = tail(df_CA_2_test, test_sample - train_sample)

df_CA_3_train = head(df_CA_3, train_sample)
df_CA_3_test  = head(df_CA_3, test_sample)
df_CA_3_test  = tail(df_CA_3_test, test_sample - train_sample)

var_CA_1_train = VAR(df_CA_1_train, p=1)
var_CA_2_train = VAR(df_CA_2_train, p=1)
var_CA_3_train = VAR(df_CA_3_train, p=1)

dcoef1 = coef(var_CA_1_train)
dcoef2 = coef(var_CA_2_train)
dcoef3 = coef(var_CA_3_train)

# iterate the number of test samples to predict using the var coefficients

length_sample = test_sample - train_sample
for (i in 1:length_sample) {
  if (i==1) {
    df_CA_1_test[i, 7] = dcoef1$Hobbies[1]*df_CA_1_train[train_sample,1] + dcoef1$Hobbies[2]*df_CA_1_train[train_sample,2] + dcoef1$Hobbies[3]*df_CA_1_train[train_sample,3] + dcoef1$Hobbies[4]*df_CA_1_train[train_sample,4] + dcoef1$Hobbies[5]*df_CA_1_train[train_sample,5] + dcoef1$Hobbies[6]*df_CA_1_train[train_sample,6] + dcoef1$Hobbies[7]
    df_CA_1_test[i, 8] = dcoef1$Household_1[1]*df_CA_1_train[train_sample,1] + dcoef1$Household_1[2]*df_CA_1_train[train_sample,2] + dcoef1$Household_1[3]*df_CA_1_train[train_sample,3] + dcoef1$Household_1[4]*df_CA_1_train[train_sample,4] + dcoef1$Household_1[5]*df_CA_1_train[train_sample,5] + dcoef1$Household_1[6]*df_CA_1_train[train_sample,6] + dcoef1$Household_1[7]
    df_CA_1_test[i, 9] = dcoef1$Household_2[1]*df_CA_1_train[train_sample,1] + dcoef1$Household_2[2]*df_CA_1_train[train_sample,2] + dcoef1$Household_2[3]*df_CA_1_train[train_sample,3] + dcoef1$Household_2[4]*df_CA_1_train[train_sample,4] + dcoef1$Household_2[5]*df_CA_1_train[train_sample,5] + dcoef1$Household_2[6]*df_CA_1_train[train_sample,6] + dcoef1$Household_2[7]
    df_CA_1_test[i, 10] = dcoef1$Foods_1[1]*df_CA_1_train[train_sample,1] + dcoef1$Foods_1[2]*df_CA_1_train[train_sample,2] + dcoef1$Foods_1[3]*df_CA_1_train[train_sample,3] + dcoef1$Foods_1[4]*df_CA_1_train[train_sample,4] + dcoef1$Foods_1[5]*df_CA_1_train[train_sample,5] + dcoef1$Foods_1[6]*df_CA_1_train[train_sample,6] + dcoef1$Foods_1[7]
    df_CA_1_test[i, 11] = dcoef1$Foods_2[1]*df_CA_1_train[train_sample,1] + dcoef1$Foods_2[2]*df_CA_1_train[train_sample,2] + dcoef1$Foods_2[3]*df_CA_1_train[train_sample,3] + dcoef1$Foods_2[4]*df_CA_1_train[train_sample,4] + dcoef1$Foods_2[5]*df_CA_1_train[train_sample,5] + dcoef1$Foods_2[6]*df_CA_1_train[train_sample,6] + dcoef1$Foods_2[7]
    df_CA_1_test[i, 12] = dcoef1$Foods_3[1]*df_CA_1_train[train_sample,1] + dcoef1$Foods_3[2]*df_CA_1_train[train_sample,2] + dcoef1$Foods_3[3]*df_CA_1_train[train_sample,3] + dcoef1$Foods_3[4]*df_CA_1_train[train_sample,4] + dcoef1$Foods_3[5]*df_CA_1_train[train_sample,5] + dcoef1$Foods_3[6]*df_CA_1_train[train_sample,6] + dcoef1$Foods_3[7]

    df_CA_2_test[i, 7] = dcoef2$Hobbies[1]*df_CA_2_train[train_sample,1] + dcoef2$Hobbies[2]*df_CA_2_train[train_sample,2] + dcoef2$Hobbies[3]*df_CA_2_train[train_sample,3] + dcoef2$Hobbies[4]*df_CA_2_train[train_sample,4] + dcoef2$Hobbies[5]*df_CA_2_train[train_sample,5] + dcoef2$Hobbies[6]*df_CA_2_train[train_sample,6] + dcoef2$Hobbies[7]
    df_CA_2_test[i, 8] = dcoef2$Household_1[1]*df_CA_2_train[train_sample,1] + dcoef2$Household_1[2]*df_CA_2_train[train_sample,2] + dcoef2$Household_1[3]*df_CA_2_train[train_sample,3] + dcoef2$Household_1[4]*df_CA_2_train[train_sample,4] + dcoef2$Household_1[5]*df_CA_2_train[train_sample,5] + dcoef2$Household_1[6]*df_CA_2_train[train_sample,6] + dcoef2$Household_1[7]
    df_CA_2_test[i, 9] = dcoef2$Household_2[1]*df_CA_2_train[train_sample,1] + dcoef2$Household_2[2]*df_CA_2_train[train_sample,2] + dcoef2$Household_2[3]*df_CA_2_train[train_sample,3] + dcoef2$Household_2[4]*df_CA_2_train[train_sample,4] + dcoef2$Household_2[5]*df_CA_2_train[train_sample,5] + dcoef2$Household_2[6]*df_CA_2_train[train_sample,6] + dcoef2$Household_2[7]
    df_CA_2_test[i, 10] = dcoef2$Foods_1[1]*df_CA_2_train[train_sample,1] + dcoef2$Foods_1[2]*df_CA_2_train[train_sample,2] + dcoef2$Foods_1[3]*df_CA_2_train[train_sample,3] + dcoef2$Foods_1[4]*df_CA_2_train[train_sample,4] + dcoef2$Foods_1[5]*df_CA_2_train[train_sample,5] + dcoef2$Foods_1[6]*df_CA_2_train[train_sample,6] + dcoef2$Foods_1[7]
    df_CA_2_test[i, 11] = dcoef2$Foods_2[1]*df_CA_2_train[train_sample,1] + dcoef2$Foods_2[2]*df_CA_2_train[train_sample,2] + dcoef2$Foods_2[3]*df_CA_2_train[train_sample,3] + dcoef2$Foods_2[4]*df_CA_2_train[train_sample,4] + dcoef2$Foods_2[5]*df_CA_2_train[train_sample,5] + dcoef2$Foods_2[6]*df_CA_2_train[train_sample,6] + dcoef2$Foods_2[7]
    df_CA_2_test[i, 12] = dcoef2$Foods_3[1]*df_CA_2_train[train_sample,1] + dcoef2$Foods_3[2]*df_CA_2_train[train_sample,2] + dcoef2$Foods_3[3]*df_CA_2_train[train_sample,3] + dcoef2$Foods_3[4]*df_CA_2_train[train_sample,4] + dcoef2$Foods_3[5]*df_CA_2_train[train_sample,5] + dcoef2$Foods_3[6]*df_CA_2_train[train_sample,6] + dcoef2$Foods_3[7]

    df_CA_3_test[i, 7] = dcoef3$Hobbies[1]*df_CA_3_train[train_sample,1] + dcoef3$Hobbies[2]*df_CA_3_train[train_sample,2] + dcoef3$Hobbies[3]*df_CA_3_train[train_sample,3] + dcoef3$Hobbies[4]*df_CA_3_train[train_sample,4] + dcoef3$Hobbies[5]*df_CA_3_train[train_sample,5] + dcoef3$Hobbies[6]*df_CA_3_train[train_sample,6] + dcoef3$Hobbies[7]
    df_CA_3_test[i, 8] = dcoef3$Household_1[1]*df_CA_3_train[train_sample,1] + dcoef3$Household_1[2]*df_CA_3_train[train_sample,2] + dcoef3$Household_1[3]*df_CA_3_train[train_sample,3] + dcoef3$Household_1[4]*df_CA_3_train[train_sample,4] + dcoef3$Household_1[5]*df_CA_3_train[train_sample,5] + dcoef3$Household_1[6]*df_CA_3_train[train_sample,6] + dcoef3$Household_1[7]
    df_CA_3_test[i, 9] = dcoef3$Household_2[1]*df_CA_3_train[train_sample,1] + dcoef3$Household_2[2]*df_CA_3_train[train_sample,2] + dcoef3$Household_2[3]*df_CA_3_train[train_sample,3] + dcoef3$Household_2[4]*df_CA_3_train[train_sample,4] + dcoef3$Household_2[5]*df_CA_3_train[train_sample,5] + dcoef3$Household_2[6]*df_CA_3_train[train_sample,6] + dcoef3$Household_2[7]
    df_CA_3_test[i, 10] = dcoef3$Foods_1[1]*df_CA_3_train[train_sample,1] + dcoef3$Foods_1[2]*df_CA_3_train[train_sample,2] + dcoef3$Foods_1[3]*df_CA_3_train[train_sample,3] + dcoef3$Foods_1[4]*df_CA_3_train[train_sample,4] + dcoef3$Foods_1[5]*df_CA_3_train[train_sample,5] + dcoef3$Foods_1[6]*df_CA_3_train[train_sample,6] + dcoef3$Foods_1[7]
    df_CA_3_test[i, 11] = dcoef3$Foods_2[1]*df_CA_3_train[train_sample,1] + dcoef3$Foods_2[2]*df_CA_3_train[train_sample,2] + dcoef3$Foods_2[3]*df_CA_3_train[train_sample,3] + dcoef3$Foods_2[4]*df_CA_3_train[train_sample,4] + dcoef3$Foods_2[5]*df_CA_3_train[train_sample,5] + dcoef3$Foods_2[6]*df_CA_3_train[train_sample,6] + dcoef3$Foods_2[7]
    df_CA_3_test[i, 12] = dcoef3$Foods_3[1]*df_CA_3_train[train_sample,1] + dcoef3$Foods_3[2]*df_CA_3_train[train_sample,2] + dcoef3$Foods_3[3]*df_CA_3_train[train_sample,3] + dcoef3$Foods_3[4]*df_CA_3_train[train_sample,4] + dcoef3$Foods_3[5]*df_CA_3_train[train_sample,5] + dcoef3$Foods_3[6]*df_CA_3_train[train_sample,6] + dcoef3$Foods_3[7]
    
    }
  else {
    df_CA_1_test[i, 7] = dcoef1$Hobbies[1]*df_CA_1_test[i-1,1] + dcoef1$Hobbies[2]*df_CA_1_test[i-1,2] + dcoef1$Hobbies[3]*df_CA_1_test[i-1,3] + dcoef1$Hobbies[4]*df_CA_1_test[i-1,4] + dcoef1$Hobbies[5]*df_CA_1_test[i-1,5] + dcoef1$Hobbies[6]*df_CA_1_test[i-1,6] + dcoef1$Hobbies[7]
    df_CA_1_test[i, 8] = dcoef1$Household_1[1]*df_CA_1_test[i-1,1] + dcoef1$Household_1[2]*df_CA_1_test[i-1,2] + dcoef1$Household_1[3]*df_CA_1_test[i-1,3] + dcoef1$Household_1[4]*df_CA_1_test[i-1,4] + dcoef1$Household_1[5]*df_CA_1_test[i-1,5] + dcoef1$Household_1[6]*df_CA_1_test[i-1,6] + dcoef1$Household_1[7]
    df_CA_1_test[i, 9] = dcoef1$Household_2[1]*df_CA_1_test[i-1,1] + dcoef1$Household_2[2]*df_CA_1_test[i-1,2] + dcoef1$Household_2[3]*df_CA_1_test[i-1,3] + dcoef1$Household_2[4]*df_CA_1_test[i-1,4] + dcoef1$Household_2[5]*df_CA_1_test[i-1,5] + dcoef1$Household_2[6]*df_CA_1_test[i-1,6] + dcoef1$Household_2[7]
    df_CA_1_test[i, 10] = dcoef1$Foods_1[1]*df_CA_1_test[i-1,1] + dcoef1$Foods_1[2]*df_CA_1_test[i-1,2] + dcoef1$Foods_1[3]*df_CA_1_test[i-1,3] + dcoef1$Foods_1[4]*df_CA_1_test[i-1,4] + dcoef1$Foods_1[5]*df_CA_1_test[i-1,5] + dcoef1$Foods_1[6]*df_CA_1_test[i-1,6] + dcoef1$Foods_1[7]
    df_CA_1_test[i, 11] = dcoef1$Foods_2[1]*df_CA_1_test[i-1,1] + dcoef1$Foods_2[2]*df_CA_1_test[i-1,2] + dcoef1$Foods_2[3]*df_CA_1_test[i-1,3] + dcoef1$Foods_2[4]*df_CA_1_test[i-1,4] + dcoef1$Foods_2[5]*df_CA_1_test[i-1,5] + dcoef1$Foods_2[6]*df_CA_1_test[i-1,6] + dcoef1$Foods_2[7]
    df_CA_1_test[i, 12] = dcoef1$Foods_3[1]*df_CA_1_test[i-1,1] + dcoef1$Foods_3[2]*df_CA_1_test[i-1,2] + dcoef1$Foods_3[3]*df_CA_1_test[i-1,3] + dcoef1$Foods_3[4]*df_CA_1_test[i-1,4] + dcoef1$Foods_3[5]*df_CA_1_test[i-1,5] + dcoef1$Foods_3[6]*df_CA_1_test[i-1,6] + dcoef1$Foods_3[7]
    
    df_CA_2_test[i, 7] = dcoef2$Hobbies[1]*df_CA_2_test[i-1,1] + dcoef2$Hobbies[2]*df_CA_2_test[i-1,2] + dcoef2$Hobbies[3]*df_CA_2_test[i-1,3] + dcoef2$Hobbies[4]*df_CA_2_test[i-1,4] + dcoef2$Hobbies[5]*df_CA_2_test[i-1,5] + dcoef2$Hobbies[6]*df_CA_2_test[i-1,6] + dcoef2$Hobbies[7]
    df_CA_2_test[i, 8] = dcoef2$Household_1[1]*df_CA_2_test[i-1,1] + dcoef2$Household_1[2]*df_CA_2_test[i-1,2] + dcoef2$Household_1[3]*df_CA_2_test[i-1,3] + dcoef2$Household_1[4]*df_CA_2_test[i-1,4] + dcoef2$Household_1[5]*df_CA_2_test[i-1,5] + dcoef2$Household_1[6]*df_CA_2_test[i-1,6] + dcoef2$Household_1[7]
    df_CA_2_test[i, 9] = dcoef2$Household_2[1]*df_CA_2_test[i-1,1] + dcoef2$Household_2[2]*df_CA_2_test[i-1,2] + dcoef2$Household_2[3]*df_CA_2_test[i-1,3] + dcoef2$Household_2[4]*df_CA_2_test[i-1,4] + dcoef2$Household_2[5]*df_CA_2_test[i-1,5] + dcoef2$Household_2[6]*df_CA_2_test[i-1,6] + dcoef2$Household_2[7]
    df_CA_2_test[i, 10] = dcoef2$Foods_1[1]*df_CA_2_test[i-1,1] + dcoef2$Foods_1[2]*df_CA_2_test[i-1,2] + dcoef2$Foods_1[3]*df_CA_2_test[i-1,3] + dcoef2$Foods_1[4]*df_CA_2_test[i-1,4] + dcoef2$Foods_1[5]*df_CA_2_test[i-1,5] + dcoef2$Foods_1[6]*df_CA_2_test[i-1,6] + dcoef2$Foods_1[7]
    df_CA_2_test[i, 11] = dcoef2$Foods_2[1]*df_CA_2_test[i-1,1] + dcoef2$Foods_2[2]*df_CA_2_test[i-1,2] + dcoef2$Foods_2[3]*df_CA_2_test[i-1,3] + dcoef2$Foods_2[4]*df_CA_2_test[i-1,4] + dcoef2$Foods_2[5]*df_CA_2_test[i-1,5] + dcoef2$Foods_2[6]*df_CA_2_test[i-1,6] + dcoef2$Foods_2[7]
    df_CA_2_test[i, 12] = dcoef2$Foods_3[1]*df_CA_2_test[i-1,1] + dcoef2$Foods_3[2]*df_CA_2_test[i-1,2] + dcoef2$Foods_3[3]*df_CA_2_test[i-1,3] + dcoef2$Foods_3[4]*df_CA_2_test[i-1,4] + dcoef2$Foods_3[5]*df_CA_2_test[i-1,5] + dcoef2$Foods_3[6]*df_CA_2_test[i-1,6] + dcoef2$Foods_3[7]
    
    df_CA_3_test[i, 7] = dcoef3$Hobbies[1]*df_CA_3_test[i-1,1] + dcoef3$Hobbies[2]*df_CA_3_test[i-1,2] + dcoef3$Hobbies[3]*df_CA_3_test[i-1,3] + dcoef3$Hobbies[4]*df_CA_3_test[i-1,4] + dcoef3$Hobbies[5]*df_CA_3_test[i-1,5] + dcoef3$Hobbies[6]*df_CA_3_test[i-1,6] + dcoef3$Hobbies[7]
    df_CA_3_test[i, 8] = dcoef3$Household_1[1]*df_CA_3_test[i-1,1] + dcoef3$Household_1[2]*df_CA_3_test[i-1,2] + dcoef3$Household_1[3]*df_CA_3_test[i-1,3] + dcoef3$Household_1[4]*df_CA_3_test[i-1,4] + dcoef3$Household_1[5]*df_CA_3_test[i-1,5] + dcoef3$Household_1[6]*df_CA_3_test[i-1,6] + dcoef3$Household_1[7]
    df_CA_3_test[i, 9] = dcoef3$Household_2[1]*df_CA_3_test[i-1,1] + dcoef3$Household_2[2]*df_CA_3_test[i-1,2] + dcoef3$Household_2[3]*df_CA_3_test[i-1,3] + dcoef3$Household_2[4]*df_CA_3_test[i-1,4] + dcoef3$Household_2[5]*df_CA_3_test[i-1,5] + dcoef3$Household_2[6]*df_CA_3_test[i-1,6] + dcoef3$Household_2[7]
    df_CA_3_test[i, 10] = dcoef3$Foods_1[1]*df_CA_3_test[i-1,1] + dcoef3$Foods_1[2]*df_CA_3_test[i-1,2] + dcoef3$Foods_1[3]*df_CA_3_test[i-1,3] + dcoef3$Foods_1[4]*df_CA_3_test[i-1,4] + dcoef3$Foods_1[5]*df_CA_3_test[i-1,5] + dcoef3$Foods_1[6]*df_CA_3_test[i-1,6] + dcoef3$Foods_1[7]
    df_CA_3_test[i, 11] = dcoef3$Foods_2[1]*df_CA_3_test[i-1,1] + dcoef3$Foods_2[2]*df_CA_3_test[i-1,2] + dcoef3$Foods_2[3]*df_CA_3_test[i-1,3] + dcoef3$Foods_2[4]*df_CA_3_test[i-1,4] + dcoef3$Foods_2[5]*df_CA_3_test[i-1,5] + dcoef3$Foods_2[6]*df_CA_3_test[i-1,6] + dcoef3$Foods_2[7]
    df_CA_3_test[i, 12] = dcoef3$Foods_3[1]*df_CA_3_test[i-1,1] + dcoef3$Foods_3[2]*df_CA_3_test[i-1,2] + dcoef3$Foods_3[3]*df_CA_3_test[i-1,3] + dcoef3$Foods_3[4]*df_CA_3_test[i-1,4] + dcoef3$Foods_3[5]*df_CA_3_test[i-1,5] + dcoef3$Foods_3[6]*df_CA_3_test[i-1,6] + dcoef3$Foods_3[7]
    
    
  }
}

colnames(df_CA_1_test) = c('Hobbies','Household_1','Household_2'
                           ,'Foods_1','Foods_2','Foods_3',
                           'Hobbies_pred','Household_1_pred','Household_2_pred'
                           ,'Foods_1_pred','Foods_2_pred','Foods_3_pred')

colnames(df_CA_2_test) = c('Hobbies','Household_1','Household_2'
                           ,'Foods_1','Foods_2','Foods_3',
                           'Hobbies_pred','Household_1_pred','Household_2_pred'
                           ,'Foods_1_pred','Foods_2_pred','Foods_3_pred')

colnames(df_CA_3_test) = c('Hobbies','Household_1','Household_2'
                           ,'Foods_1','Foods_2','Foods_3',
                           'Hobbies_pred','Household_1_pred','Household_2_pred'
                           ,'Foods_1_pred','Foods_2_pred','Foods_3_pred')

forecasts_CA_1_21 = df_CA_1_test
forecasts_CA_2_21 = df_CA_2_test
forecasts_CA_3_21 = df_CA_3_test

# Create RMSSE Data frames
df_rmsse_CA_1_4yr = data.frame()
df_rmsse_CA_2_4yr = data.frame()
df_rmsse_CA_3_4yr = data.frame()

# Save the RMSSE Results in a data frame
df_rmsse_CA_1_4yr[1, 1] = RMSSE(forecasts_CA_1_21$Hobbies, forecasts_CA_1_21$Hobbies_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_1_4yr[2, 1] = RMSSE(forecasts_CA_1_21$Household_1, forecasts_CA_1_21$Household_1_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_1_4yr[3, 1] = RMSSE(forecasts_CA_1_21$Household_2, forecasts_CA_1_21$Household_2_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_1_4yr[4, 1] = RMSSE(forecasts_CA_1_21$Foods_1, forecasts_CA_1_21$Foods_1_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_1_4yr[5, 1] = RMSSE(forecasts_CA_1_21$Foods_2, forecasts_CA_1_21$Foods_2_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_1_4yr[6, 1] = RMSSE(forecasts_CA_1_21$Foods_3, forecasts_CA_1_21$Foods_3_pred, scale = 1, na.rm = TRUE)

df_rmsse_CA_2_4yr[1, 1] = RMSSE(forecasts_CA_2_21$Hobbies, forecasts_CA_2_21$Hobbies_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_2_4yr[2, 1] = RMSSE(forecasts_CA_2_21$Household_1, forecasts_CA_2_21$Household_1_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_2_4yr[3, 1] = RMSSE(forecasts_CA_2_21$Household_2, forecasts_CA_2_21$Household_2_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_2_4yr[4, 1] = RMSSE(forecasts_CA_2_21$Foods_1, forecasts_CA_2_21$Foods_1_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_2_4yr[5, 1] = RMSSE(forecasts_CA_2_21$Foods_2, forecasts_CA_2_21$Foods_2_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_2_4yr[6, 1] = RMSSE(forecasts_CA_2_21$Foods_3, forecasts_CA_2_21$Foods_3_pred, scale = 1, na.rm = TRUE)

df_rmsse_CA_3_4yr[1, 1] = RMSSE(forecasts_CA_3_21$Hobbies, forecasts_CA_3_21$Hobbies_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_3_4yr[2, 1] = RMSSE(forecasts_CA_3_21$Household_1, forecasts_CA_3_21$Household_1_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_3_4yr[3, 1] = RMSSE(forecasts_CA_3_21$Household_2, forecasts_CA_3_21$Household_2_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_3_4yr[4, 1] = RMSSE(forecasts_CA_3_21$Foods_1, forecasts_CA_3_21$Foods_1_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_3_4yr[5, 1] = RMSSE(forecasts_CA_3_21$Foods_2, forecasts_CA_3_21$Foods_2_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_3_4yr[6, 1] = RMSSE(forecasts_CA_3_21$Foods_3, forecasts_CA_3_21$Foods_3_pred, scale = 1, na.rm = TRUE)

rownames(df_rmsse_CA_1_4yr) =  c("Hobbies","Household1","Household2","Foods1","Foods2","Foods3")
rownames(df_rmsse_CA_2_4yr) =  c("Hobbies","Household1","Household2","Foods1","Foods2","Foods3")
rownames(df_rmsse_CA_3_4yr) =  c("Hobbies","Household1","Household2","Foods1","Foods2","Foods3")

colnames(df_rmsse_CA_1_4yr) = c("var21")
colnames(df_rmsse_CA_2_4yr) = c("var21")
colnames(df_rmsse_CA_3_4yr) = c("var21")

```

```{r}

df_rmsse_CA_1_4yr
df_rmsse_CA_2_4yr
df_rmsse_CA_3_4yr

```

### Train-test split for data from 2011-2015 for training and 2016 for testing.

```{r, include=FALSE}

train_sample = 1798
test_sample = 1969

# Choose the columns for each store
df_CA_1 = df[c('Hobbies_CA_1','Household_1_CA_1','Household_2_CA_1'
               ,'Foods_1_CA_1','Foods_2_CA_1','Foods_3_CA_1' )]
colnames(df_CA_1) = c('Hobbies','Household_1','Household_2'
                       ,'Foods_1','Foods_2','Foods_3')

df_CA_2 = df[c('Hobbies_CA_2','Household_1_CA_2','Household_2_CA_2'
               ,'Foods_1_CA_2','Foods_2_CA_2','Foods_3_CA_2' )]
colnames(df_CA_2) = c('Hobbies','Household_1','Household_2'
                      ,'Foods_1','Foods_2','Foods_3')

df_CA_3 = df[c('Hobbies_CA_3','Household_1_CA_3','Household_2_CA_3'
               ,'Foods_1_CA_3','Foods_2_CA_3','Foods_3_CA_3' )]
colnames(df_CA_3) = c('Hobbies','Household_1','Household_2'
                      ,'Foods_1','Foods_2','Foods_3')

df_CA_1_train = head(df_CA_1, train_sample)
df_CA_1_test  = head(df_CA_1, test_sample)
df_CA_1_test  = tail(df_CA_1_test, test_sample - train_sample)

df_CA_2_train = head(df_CA_2, train_sample)
df_CA_2_test  = head(df_CA_2, test_sample)
df_CA_2_test  = tail(df_CA_2_test, test_sample - train_sample)

df_CA_3_train = head(df_CA_3, train_sample)
df_CA_3_test  = head(df_CA_3, test_sample)
df_CA_3_test  = tail(df_CA_3_test, test_sample - train_sample)

var_CA_1_train = VAR(df_CA_1_train, p=1)
var_CA_2_train = VAR(df_CA_2_train, p=1)
var_CA_3_train = VAR(df_CA_3_train, p=1)

dcoef1 = coef(var_CA_1_train)
dcoef2 = coef(var_CA_2_train)
dcoef3 = coef(var_CA_3_train)

# iterate the number of test samples to predict using the var coefficients

length_sample = test_sample - train_sample
for (i in 1:length_sample) {
  if (i==1) {
    df_CA_1_test[i, 7] = dcoef1$Hobbies[1]*df_CA_1_train[train_sample,1] + dcoef1$Hobbies[2]*df_CA_1_train[train_sample,2] + dcoef1$Hobbies[3]*df_CA_1_train[train_sample,3] + dcoef1$Hobbies[4]*df_CA_1_train[train_sample,4] + dcoef1$Hobbies[5]*df_CA_1_train[train_sample,5] + dcoef1$Hobbies[6]*df_CA_1_train[train_sample,6] + dcoef1$Hobbies[7]
    df_CA_1_test[i, 8] = dcoef1$Household_1[1]*df_CA_1_train[train_sample,1] + dcoef1$Household_1[2]*df_CA_1_train[train_sample,2] + dcoef1$Household_1[3]*df_CA_1_train[train_sample,3] + dcoef1$Household_1[4]*df_CA_1_train[train_sample,4] + dcoef1$Household_1[5]*df_CA_1_train[train_sample,5] + dcoef1$Household_1[6]*df_CA_1_train[train_sample,6] + dcoef1$Household_1[7]
    df_CA_1_test[i, 9] = dcoef1$Household_2[1]*df_CA_1_train[train_sample,1] + dcoef1$Household_2[2]*df_CA_1_train[train_sample,2] + dcoef1$Household_2[3]*df_CA_1_train[train_sample,3] + dcoef1$Household_2[4]*df_CA_1_train[train_sample,4] + dcoef1$Household_2[5]*df_CA_1_train[train_sample,5] + dcoef1$Household_2[6]*df_CA_1_train[train_sample,6] + dcoef1$Household_2[7]
    df_CA_1_test[i, 10] = dcoef1$Foods_1[1]*df_CA_1_train[train_sample,1] + dcoef1$Foods_1[2]*df_CA_1_train[train_sample,2] + dcoef1$Foods_1[3]*df_CA_1_train[train_sample,3] + dcoef1$Foods_1[4]*df_CA_1_train[train_sample,4] + dcoef1$Foods_1[5]*df_CA_1_train[train_sample,5] + dcoef1$Foods_1[6]*df_CA_1_train[train_sample,6] + dcoef1$Foods_1[7]
    df_CA_1_test[i, 11] = dcoef1$Foods_2[1]*df_CA_1_train[train_sample,1] + dcoef1$Foods_2[2]*df_CA_1_train[train_sample,2] + dcoef1$Foods_2[3]*df_CA_1_train[train_sample,3] + dcoef1$Foods_2[4]*df_CA_1_train[train_sample,4] + dcoef1$Foods_2[5]*df_CA_1_train[train_sample,5] + dcoef1$Foods_2[6]*df_CA_1_train[train_sample,6] + dcoef1$Foods_2[7]
    df_CA_1_test[i, 12] = dcoef1$Foods_3[1]*df_CA_1_train[train_sample,1] + dcoef1$Foods_3[2]*df_CA_1_train[train_sample,2] + dcoef1$Foods_3[3]*df_CA_1_train[train_sample,3] + dcoef1$Foods_3[4]*df_CA_1_train[train_sample,4] + dcoef1$Foods_3[5]*df_CA_1_train[train_sample,5] + dcoef1$Foods_3[6]*df_CA_1_train[train_sample,6] + dcoef1$Foods_3[7]

    df_CA_2_test[i, 7] = dcoef2$Hobbies[1]*df_CA_2_train[train_sample,1] + dcoef2$Hobbies[2]*df_CA_2_train[train_sample,2] + dcoef2$Hobbies[3]*df_CA_2_train[train_sample,3] + dcoef2$Hobbies[4]*df_CA_2_train[train_sample,4] + dcoef2$Hobbies[5]*df_CA_2_train[train_sample,5] + dcoef2$Hobbies[6]*df_CA_2_train[train_sample,6] + dcoef2$Hobbies[7]
    df_CA_2_test[i, 8] = dcoef2$Household_1[1]*df_CA_2_train[train_sample,1] + dcoef2$Household_1[2]*df_CA_2_train[train_sample,2] + dcoef2$Household_1[3]*df_CA_2_train[train_sample,3] + dcoef2$Household_1[4]*df_CA_2_train[train_sample,4] + dcoef2$Household_1[5]*df_CA_2_train[train_sample,5] + dcoef2$Household_1[6]*df_CA_2_train[train_sample,6] + dcoef2$Household_1[7]
    df_CA_2_test[i, 9] = dcoef2$Household_2[1]*df_CA_2_train[train_sample,1] + dcoef2$Household_2[2]*df_CA_2_train[train_sample,2] + dcoef2$Household_2[3]*df_CA_2_train[train_sample,3] + dcoef2$Household_2[4]*df_CA_2_train[train_sample,4] + dcoef2$Household_2[5]*df_CA_2_train[train_sample,5] + dcoef2$Household_2[6]*df_CA_2_train[train_sample,6] + dcoef2$Household_2[7]
    df_CA_2_test[i, 10] = dcoef2$Foods_1[1]*df_CA_2_train[train_sample,1] + dcoef2$Foods_1[2]*df_CA_2_train[train_sample,2] + dcoef2$Foods_1[3]*df_CA_2_train[train_sample,3] + dcoef2$Foods_1[4]*df_CA_2_train[train_sample,4] + dcoef2$Foods_1[5]*df_CA_2_train[train_sample,5] + dcoef2$Foods_1[6]*df_CA_2_train[train_sample,6] + dcoef2$Foods_1[7]
    df_CA_2_test[i, 11] = dcoef2$Foods_2[1]*df_CA_2_train[train_sample,1] + dcoef2$Foods_2[2]*df_CA_2_train[train_sample,2] + dcoef2$Foods_2[3]*df_CA_2_train[train_sample,3] + dcoef2$Foods_2[4]*df_CA_2_train[train_sample,4] + dcoef2$Foods_2[5]*df_CA_2_train[train_sample,5] + dcoef2$Foods_2[6]*df_CA_2_train[train_sample,6] + dcoef2$Foods_2[7]
    df_CA_2_test[i, 12] = dcoef2$Foods_3[1]*df_CA_2_train[train_sample,1] + dcoef2$Foods_3[2]*df_CA_2_train[train_sample,2] + dcoef2$Foods_3[3]*df_CA_2_train[train_sample,3] + dcoef2$Foods_3[4]*df_CA_2_train[train_sample,4] + dcoef2$Foods_3[5]*df_CA_2_train[train_sample,5] + dcoef2$Foods_3[6]*df_CA_2_train[train_sample,6] + dcoef2$Foods_3[7]

    df_CA_3_test[i, 7] = dcoef3$Hobbies[1]*df_CA_3_train[train_sample,1] + dcoef3$Hobbies[2]*df_CA_3_train[train_sample,2] + dcoef3$Hobbies[3]*df_CA_3_train[train_sample,3] + dcoef3$Hobbies[4]*df_CA_3_train[train_sample,4] + dcoef3$Hobbies[5]*df_CA_3_train[train_sample,5] + dcoef3$Hobbies[6]*df_CA_3_train[train_sample,6] + dcoef3$Hobbies[7]
    df_CA_3_test[i, 8] = dcoef3$Household_1[1]*df_CA_3_train[train_sample,1] + dcoef3$Household_1[2]*df_CA_3_train[train_sample,2] + dcoef3$Household_1[3]*df_CA_3_train[train_sample,3] + dcoef3$Household_1[4]*df_CA_3_train[train_sample,4] + dcoef3$Household_1[5]*df_CA_3_train[train_sample,5] + dcoef3$Household_1[6]*df_CA_3_train[train_sample,6] + dcoef3$Household_1[7]
    df_CA_3_test[i, 9] = dcoef3$Household_2[1]*df_CA_3_train[train_sample,1] + dcoef3$Household_2[2]*df_CA_3_train[train_sample,2] + dcoef3$Household_2[3]*df_CA_3_train[train_sample,3] + dcoef3$Household_2[4]*df_CA_3_train[train_sample,4] + dcoef3$Household_2[5]*df_CA_3_train[train_sample,5] + dcoef3$Household_2[6]*df_CA_3_train[train_sample,6] + dcoef3$Household_2[7]
    df_CA_3_test[i, 10] = dcoef3$Foods_1[1]*df_CA_3_train[train_sample,1] + dcoef3$Foods_1[2]*df_CA_3_train[train_sample,2] + dcoef3$Foods_1[3]*df_CA_3_train[train_sample,3] + dcoef3$Foods_1[4]*df_CA_3_train[train_sample,4] + dcoef3$Foods_1[5]*df_CA_3_train[train_sample,5] + dcoef3$Foods_1[6]*df_CA_3_train[train_sample,6] + dcoef3$Foods_1[7]
    df_CA_3_test[i, 11] = dcoef3$Foods_2[1]*df_CA_3_train[train_sample,1] + dcoef3$Foods_2[2]*df_CA_3_train[train_sample,2] + dcoef3$Foods_2[3]*df_CA_3_train[train_sample,3] + dcoef3$Foods_2[4]*df_CA_3_train[train_sample,4] + dcoef3$Foods_2[5]*df_CA_3_train[train_sample,5] + dcoef3$Foods_2[6]*df_CA_3_train[train_sample,6] + dcoef3$Foods_2[7]
    df_CA_3_test[i, 12] = dcoef3$Foods_3[1]*df_CA_3_train[train_sample,1] + dcoef3$Foods_3[2]*df_CA_3_train[train_sample,2] + dcoef3$Foods_3[3]*df_CA_3_train[train_sample,3] + dcoef3$Foods_3[4]*df_CA_3_train[train_sample,4] + dcoef3$Foods_3[5]*df_CA_3_train[train_sample,5] + dcoef3$Foods_3[6]*df_CA_3_train[train_sample,6] + dcoef3$Foods_3[7]
    
    }
  else {
    df_CA_1_test[i, 7] = dcoef1$Hobbies[1]*df_CA_1_test[i-1,1] + dcoef1$Hobbies[2]*df_CA_1_test[i-1,2] + dcoef1$Hobbies[3]*df_CA_1_test[i-1,3] + dcoef1$Hobbies[4]*df_CA_1_test[i-1,4] + dcoef1$Hobbies[5]*df_CA_1_test[i-1,5] + dcoef1$Hobbies[6]*df_CA_1_test[i-1,6] + dcoef1$Hobbies[7]
    df_CA_1_test[i, 8] = dcoef1$Household_1[1]*df_CA_1_test[i-1,1] + dcoef1$Household_1[2]*df_CA_1_test[i-1,2] + dcoef1$Household_1[3]*df_CA_1_test[i-1,3] + dcoef1$Household_1[4]*df_CA_1_test[i-1,4] + dcoef1$Household_1[5]*df_CA_1_test[i-1,5] + dcoef1$Household_1[6]*df_CA_1_test[i-1,6] + dcoef1$Household_1[7]
    df_CA_1_test[i, 9] = dcoef1$Household_2[1]*df_CA_1_test[i-1,1] + dcoef1$Household_2[2]*df_CA_1_test[i-1,2] + dcoef1$Household_2[3]*df_CA_1_test[i-1,3] + dcoef1$Household_2[4]*df_CA_1_test[i-1,4] + dcoef1$Household_2[5]*df_CA_1_test[i-1,5] + dcoef1$Household_2[6]*df_CA_1_test[i-1,6] + dcoef1$Household_2[7]
    df_CA_1_test[i, 10] = dcoef1$Foods_1[1]*df_CA_1_test[i-1,1] + dcoef1$Foods_1[2]*df_CA_1_test[i-1,2] + dcoef1$Foods_1[3]*df_CA_1_test[i-1,3] + dcoef1$Foods_1[4]*df_CA_1_test[i-1,4] + dcoef1$Foods_1[5]*df_CA_1_test[i-1,5] + dcoef1$Foods_1[6]*df_CA_1_test[i-1,6] + dcoef1$Foods_1[7]
    df_CA_1_test[i, 11] = dcoef1$Foods_2[1]*df_CA_1_test[i-1,1] + dcoef1$Foods_2[2]*df_CA_1_test[i-1,2] + dcoef1$Foods_2[3]*df_CA_1_test[i-1,3] + dcoef1$Foods_2[4]*df_CA_1_test[i-1,4] + dcoef1$Foods_2[5]*df_CA_1_test[i-1,5] + dcoef1$Foods_2[6]*df_CA_1_test[i-1,6] + dcoef1$Foods_2[7]
    df_CA_1_test[i, 12] = dcoef1$Foods_3[1]*df_CA_1_test[i-1,1] + dcoef1$Foods_3[2]*df_CA_1_test[i-1,2] + dcoef1$Foods_3[3]*df_CA_1_test[i-1,3] + dcoef1$Foods_3[4]*df_CA_1_test[i-1,4] + dcoef1$Foods_3[5]*df_CA_1_test[i-1,5] + dcoef1$Foods_3[6]*df_CA_1_test[i-1,6] + dcoef1$Foods_3[7]
    
    df_CA_2_test[i, 7] = dcoef2$Hobbies[1]*df_CA_2_test[i-1,1] + dcoef2$Hobbies[2]*df_CA_2_test[i-1,2] + dcoef2$Hobbies[3]*df_CA_2_test[i-1,3] + dcoef2$Hobbies[4]*df_CA_2_test[i-1,4] + dcoef2$Hobbies[5]*df_CA_2_test[i-1,5] + dcoef2$Hobbies[6]*df_CA_2_test[i-1,6] + dcoef2$Hobbies[7]
    df_CA_2_test[i, 8] = dcoef2$Household_1[1]*df_CA_2_test[i-1,1] + dcoef2$Household_1[2]*df_CA_2_test[i-1,2] + dcoef2$Household_1[3]*df_CA_2_test[i-1,3] + dcoef2$Household_1[4]*df_CA_2_test[i-1,4] + dcoef2$Household_1[5]*df_CA_2_test[i-1,5] + dcoef2$Household_1[6]*df_CA_2_test[i-1,6] + dcoef2$Household_1[7]
    df_CA_2_test[i, 9] = dcoef2$Household_2[1]*df_CA_2_test[i-1,1] + dcoef2$Household_2[2]*df_CA_2_test[i-1,2] + dcoef2$Household_2[3]*df_CA_2_test[i-1,3] + dcoef2$Household_2[4]*df_CA_2_test[i-1,4] + dcoef2$Household_2[5]*df_CA_2_test[i-1,5] + dcoef2$Household_2[6]*df_CA_2_test[i-1,6] + dcoef2$Household_2[7]
    df_CA_2_test[i, 10] = dcoef2$Foods_1[1]*df_CA_2_test[i-1,1] + dcoef2$Foods_1[2]*df_CA_2_test[i-1,2] + dcoef2$Foods_1[3]*df_CA_2_test[i-1,3] + dcoef2$Foods_1[4]*df_CA_2_test[i-1,4] + dcoef2$Foods_1[5]*df_CA_2_test[i-1,5] + dcoef2$Foods_1[6]*df_CA_2_test[i-1,6] + dcoef2$Foods_1[7]
    df_CA_2_test[i, 11] = dcoef2$Foods_2[1]*df_CA_2_test[i-1,1] + dcoef2$Foods_2[2]*df_CA_2_test[i-1,2] + dcoef2$Foods_2[3]*df_CA_2_test[i-1,3] + dcoef2$Foods_2[4]*df_CA_2_test[i-1,4] + dcoef2$Foods_2[5]*df_CA_2_test[i-1,5] + dcoef2$Foods_2[6]*df_CA_2_test[i-1,6] + dcoef2$Foods_2[7]
    df_CA_2_test[i, 12] = dcoef2$Foods_3[1]*df_CA_2_test[i-1,1] + dcoef2$Foods_3[2]*df_CA_2_test[i-1,2] + dcoef2$Foods_3[3]*df_CA_2_test[i-1,3] + dcoef2$Foods_3[4]*df_CA_2_test[i-1,4] + dcoef2$Foods_3[5]*df_CA_2_test[i-1,5] + dcoef2$Foods_3[6]*df_CA_2_test[i-1,6] + dcoef2$Foods_3[7]
    
    df_CA_3_test[i, 7] = dcoef3$Hobbies[1]*df_CA_3_test[i-1,1] + dcoef3$Hobbies[2]*df_CA_3_test[i-1,2] + dcoef3$Hobbies[3]*df_CA_3_test[i-1,3] + dcoef3$Hobbies[4]*df_CA_3_test[i-1,4] + dcoef3$Hobbies[5]*df_CA_3_test[i-1,5] + dcoef3$Hobbies[6]*df_CA_3_test[i-1,6] + dcoef3$Hobbies[7]
    df_CA_3_test[i, 8] = dcoef3$Household_1[1]*df_CA_3_test[i-1,1] + dcoef3$Household_1[2]*df_CA_3_test[i-1,2] + dcoef3$Household_1[3]*df_CA_3_test[i-1,3] + dcoef3$Household_1[4]*df_CA_3_test[i-1,4] + dcoef3$Household_1[5]*df_CA_3_test[i-1,5] + dcoef3$Household_1[6]*df_CA_3_test[i-1,6] + dcoef3$Household_1[7]
    df_CA_3_test[i, 9] = dcoef3$Household_2[1]*df_CA_3_test[i-1,1] + dcoef3$Household_2[2]*df_CA_3_test[i-1,2] + dcoef3$Household_2[3]*df_CA_3_test[i-1,3] + dcoef3$Household_2[4]*df_CA_3_test[i-1,4] + dcoef3$Household_2[5]*df_CA_3_test[i-1,5] + dcoef3$Household_2[6]*df_CA_3_test[i-1,6] + dcoef3$Household_2[7]
    df_CA_3_test[i, 10] = dcoef3$Foods_1[1]*df_CA_3_test[i-1,1] + dcoef3$Foods_1[2]*df_CA_3_test[i-1,2] + dcoef3$Foods_1[3]*df_CA_3_test[i-1,3] + dcoef3$Foods_1[4]*df_CA_3_test[i-1,4] + dcoef3$Foods_1[5]*df_CA_3_test[i-1,5] + dcoef3$Foods_1[6]*df_CA_3_test[i-1,6] + dcoef3$Foods_1[7]
    df_CA_3_test[i, 11] = dcoef3$Foods_2[1]*df_CA_3_test[i-1,1] + dcoef3$Foods_2[2]*df_CA_3_test[i-1,2] + dcoef3$Foods_2[3]*df_CA_3_test[i-1,3] + dcoef3$Foods_2[4]*df_CA_3_test[i-1,4] + dcoef3$Foods_2[5]*df_CA_3_test[i-1,5] + dcoef3$Foods_2[6]*df_CA_3_test[i-1,6] + dcoef3$Foods_2[7]
    df_CA_3_test[i, 12] = dcoef3$Foods_3[1]*df_CA_3_test[i-1,1] + dcoef3$Foods_3[2]*df_CA_3_test[i-1,2] + dcoef3$Foods_3[3]*df_CA_3_test[i-1,3] + dcoef3$Foods_3[4]*df_CA_3_test[i-1,4] + dcoef3$Foods_3[5]*df_CA_3_test[i-1,5] + dcoef3$Foods_3[6]*df_CA_3_test[i-1,6] + dcoef3$Foods_3[7]
    
    
  }
}

colnames(df_CA_1_test) = c('Hobbies','Household_1','Household_2'
                           ,'Foods_1','Foods_2','Foods_3',
                           'Hobbies_pred','Household_1_pred','Household_2_pred'
                           ,'Foods_1_pred','Foods_2_pred','Foods_3_pred')

colnames(df_CA_2_test) = c('Hobbies','Household_1','Household_2'
                           ,'Foods_1','Foods_2','Foods_3',
                           'Hobbies_pred','Household_1_pred','Household_2_pred'
                           ,'Foods_1_pred','Foods_2_pred','Foods_3_pred')

colnames(df_CA_3_test) = c('Hobbies','Household_1','Household_2'
                           ,'Foods_1','Foods_2','Foods_3',
                           'Hobbies_pred','Household_1_pred','Household_2_pred'
                           ,'Foods_1_pred','Foods_2_pred','Foods_3_pred')

forecasts_CA_1_21 = df_CA_1_test
forecasts_CA_2_21 = df_CA_2_test
forecasts_CA_3_21 = df_CA_3_test

# Create RMSSE Data frames
df_rmsse_CA_1_5yr = data.frame()
df_rmsse_CA_2_5yr = data.frame()
df_rmsse_CA_3_5yr = data.frame()

# Save the RMSSE Results in a data frame
df_rmsse_CA_1_5yr[1, 1] = RMSSE(forecasts_CA_1_21$Hobbies, forecasts_CA_1_21$Hobbies_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_1_5yr[2, 1] = RMSSE(forecasts_CA_1_21$Household_1, forecasts_CA_1_21$Household_1_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_1_5yr[3, 1] = RMSSE(forecasts_CA_1_21$Household_2, forecasts_CA_1_21$Household_2_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_1_5yr[4, 1] = RMSSE(forecasts_CA_1_21$Foods_1, forecasts_CA_1_21$Foods_1_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_1_5yr[5, 1] = RMSSE(forecasts_CA_1_21$Foods_2, forecasts_CA_1_21$Foods_2_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_1_5yr[6, 1] = RMSSE(forecasts_CA_1_21$Foods_3, forecasts_CA_1_21$Foods_3_pred, scale = 1, na.rm = TRUE)

df_rmsse_CA_2_5yr[1, 1] = RMSSE(forecasts_CA_2_21$Hobbies, forecasts_CA_2_21$Hobbies_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_2_5yr[2, 1] = RMSSE(forecasts_CA_2_21$Household_1, forecasts_CA_2_21$Household_1_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_2_5yr[3, 1] = RMSSE(forecasts_CA_2_21$Household_2, forecasts_CA_2_21$Household_2_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_2_5yr[4, 1] = RMSSE(forecasts_CA_2_21$Foods_1, forecasts_CA_2_21$Foods_1_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_2_5yr[5, 1] = RMSSE(forecasts_CA_2_21$Foods_2, forecasts_CA_2_21$Foods_2_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_2_5yr[6, 1] = RMSSE(forecasts_CA_2_21$Foods_3, forecasts_CA_2_21$Foods_3_pred, scale = 1, na.rm = TRUE)

df_rmsse_CA_3_5yr[1, 1] = RMSSE(forecasts_CA_3_21$Hobbies, forecasts_CA_3_21$Hobbies_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_3_5yr[2, 1] = RMSSE(forecasts_CA_3_21$Household_1, forecasts_CA_3_21$Household_1_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_3_5yr[3, 1] = RMSSE(forecasts_CA_3_21$Household_2, forecasts_CA_3_21$Household_2_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_3_5yr[4, 1] = RMSSE(forecasts_CA_3_21$Foods_1, forecasts_CA_3_21$Foods_1_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_3_5yr[5, 1] = RMSSE(forecasts_CA_3_21$Foods_2, forecasts_CA_3_21$Foods_2_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_3_5yr[6, 1] = RMSSE(forecasts_CA_3_21$Foods_3, forecasts_CA_3_21$Foods_3_pred, scale = 1, na.rm = TRUE)

rownames(df_rmsse_CA_1_5yr) =  c("Hobbies","Household1","Household2","Foods1","Foods2","Foods3")
rownames(df_rmsse_CA_2_5yr) =  c("Hobbies","Household1","Household2","Foods1","Foods2","Foods3")
rownames(df_rmsse_CA_3_5yr) =  c("Hobbies","Household1","Household2","Foods1","Foods2","Foods3")

colnames(df_rmsse_CA_1_5yr) = c("var21")
colnames(df_rmsse_CA_2_5yr) = c("var21")
colnames(df_rmsse_CA_3_5yr) = c("var21")

```

```{r}

df_rmsse_CA_1_5yr
df_rmsse_CA_2_5yr
df_rmsse_CA_3_5yr

```

The time series of the first store with the biggest training interval will be plotted
to analyze the differences in the prediction:

### Store 1:

```{r, echo=FALSE}

# plot the VAR time-series and estimates at 1-step 
length_x = test_sample-train_sample
x = 1:length_x

# Plot hobbies real vs predicted forecasts for each store

forecasts_CA_1_21$Hobbies_High = forecasts_CA_1_21$Hobbies_pred + 1.96 * (dcoef1$Hobbies[1,2] + dcoef1$Hobbies[2,2] + dcoef1$Hobbies[3,2] + dcoef1$Hobbies[4,2] + dcoef1$Hobbies[5,2] + dcoef1$Hobbies[6,2] + dcoef1$Hobbies[7,2])

forecasts_CA_1_21$Hobbies_Low = forecasts_CA_1_21$Hobbies_pred - 1.96 * (dcoef1$Hobbies[1,2] + dcoef1$Hobbies[2,2] + dcoef1$Hobbies[3,2] + dcoef1$Hobbies[4,2] + dcoef1$Hobbies[5,2] + dcoef1$Hobbies[6,2] + dcoef1$Hobbies[7,2])

forecasts_CA_1_21$Household_1_High = forecasts_CA_1_21$Household_1_pred + 1.96 * (dcoef1$Household_1[1,2] + dcoef1$Household_1[2,2] + dcoef1$Household_1[3,2] + dcoef1$Household_1[4,2] + dcoef1$Household_1[5,2] + dcoef1$Household_1[6,2] + dcoef1$Household_1[7,2])

forecasts_CA_1_21$Household_1_Low = forecasts_CA_1_21$Household_1_pred - 1.96 * (dcoef1$Household_1[1,2] + dcoef1$Household_1[2,2] + dcoef1$Household_1[3,2] + dcoef1$Household_1[4,2] + dcoef1$Household_1[5,2] + dcoef1$Household_1[6,2] + dcoef1$Household_1[7,2])

forecasts_CA_1_21$Household_2_High = forecasts_CA_1_21$Household_2_pred + 1.96 * (dcoef1$Household_2[1,2] + dcoef1$Household_2[2,2] + dcoef1$Household_2[3,2] + dcoef1$Household_2[4,2] + dcoef1$Household_2[5,2] + dcoef1$Household_2[6,2] + dcoef1$Household_2[7,2])

forecasts_CA_1_21$Household_2_Low = forecasts_CA_1_21$Household_2_pred - 1.96 * (dcoef1$Household_2[1,2] + dcoef1$Household_2[2,2] + dcoef1$Household_2[3,2] + dcoef1$Household_2[4,2] + dcoef1$Household_2[5,2] + dcoef1$Household_2[6,2] + dcoef1$Household_2[7,2])

forecasts_CA_1_21$Foods_1_High = forecasts_CA_1_21$Foods_1_pred + 1.96 * (dcoef1$Foods_1[1,2] + dcoef1$Foods_1[2,2] + dcoef1$Foods_1[3,2] + dcoef1$Foods_1[4,2] + dcoef1$Foods_1[5,2] + dcoef1$Foods_1[6,2] + dcoef1$Foods_1[7,2])

forecasts_CA_1_21$Foods_1_Low = forecasts_CA_1_21$Foods_1_pred - 1.96 * (dcoef1$Foods_1[1,2] + dcoef1$Foods_1[2,2] + dcoef1$Foods_1[3,2] + dcoef1$Foods_1[4,2] + dcoef1$Foods_1[5,2] + dcoef1$Foods_1[6,2] + dcoef1$Foods_1[7,2])

forecasts_CA_1_21$Foods_2_High = forecasts_CA_1_21$Foods_2_pred + 1.96 * (dcoef1$Foods_2[1,2] + dcoef1$Foods_2[2,2] + dcoef1$Foods_2[3,2] + dcoef1$Foods_2[4,2] + dcoef1$Foods_2[5,2] + dcoef1$Foods_2[6,2] + dcoef1$Foods_2[7,2])

forecasts_CA_1_21$Foods_2_Low = forecasts_CA_1_21$Foods_2_pred - 1.96 * (dcoef1$Foods_2[1,2] + dcoef1$Foods_2[2,2] + dcoef1$Foods_2[3,2] + dcoef1$Foods_2[4,2] + dcoef1$Foods_2[5,2] + dcoef1$Foods_2[6,2] + dcoef1$Foods_2[7,2])

forecasts_CA_1_21$Foods_3_High = forecasts_CA_1_21$Foods_3_pred + 1.96 * (dcoef1$Foods_3[1,2] + dcoef1$Foods_3[2,2] + dcoef1$Foods_3[3,2] + dcoef1$Foods_3[4,2] + dcoef1$Foods_3[5,2] + dcoef1$Foods_3[6,2] + dcoef1$Foods_3[7,2])

forecasts_CA_1_21$Foods_3_Low = forecasts_CA_1_21$Foods_3_pred - 1.96 * (dcoef1$Foods_3[1,2] + dcoef1$Foods_3[2,2] + dcoef1$Foods_3[3,2] + dcoef1$Foods_3[4,2] + dcoef1$Foods_3[5,2] + dcoef1$Foods_3[6,2] + dcoef1$Foods_3[7,2])


plot(x, forecasts_CA_1_21$Hobbies, type = "l", frame = FALSE, pch = 19, col = "blue", xlab = "time", ylab = "Hobbies Store 1")
polygon(c(x,rev(x)),c(forecasts_CA_1_21$Hobbies_Low,rev(forecasts_CA_1_21$Hobbies_High)),col="thistle",border=NA)
lines(x, forecasts_CA_1_21$Hobbies, type = "l",  pch = 19, col = "blue")
lines(x, forecasts_CA_1_21$Hobbies_pred, pch = 18, col = "red", type = "l")
legend("bottomright", legend=c("Real", "Predicted", "C.I. 95%"),col=c("blue", "red","thistle"), lty = 1:1, cex=0.8)
title("Hobbies Store 1 - VAR Store 1")

plot(x, forecasts_CA_1_21$Household_1, type = "l", frame = FALSE, pch = 19, col = "blue", xlab = "time", ylab = "Household 1 Store 1")
polygon(c(x,rev(x)),c(forecasts_CA_1_21$Household_1_Low,rev(forecasts_CA_1_21$Household_1_High)),col="thistle",border=NA)
lines(x, forecasts_CA_1_21$Household_1, type = "l",  pch = 19, col = "blue")
lines(x, forecasts_CA_1_21$Household_1_pred, pch = 18, col = "red", type = "l")
legend("bottomright", legend=c("Real", "Predicted", "C.I. 95%"),col=c("blue", "red","thistle"), lty = 1:1, cex=0.8)
title("Household 1 Store 1 - VAR Store 1")

plot(x, forecasts_CA_1_21$Household_2, type = "l", frame = FALSE, pch = 19, col = "blue", xlab = "time", ylab = "Household 2 Store 1")
polygon(c(x,rev(x)),c(forecasts_CA_1_21$Household_2_Low,rev(forecasts_CA_1_21$Household_2_High)),col="thistle",border=NA)
lines(x, forecasts_CA_1_21$Household_2, type = "l",  pch = 19, col = "blue")
lines(x, forecasts_CA_1_21$Household_2_pred, pch = 18, col = "red", type = "l")
legend("bottomright", legend=c("Real", "Predicted", "C.I. 95%"),col=c("blue", "red","thistle"), lty = 1:1, cex=0.8)
title("Household 2 Store 1 - VAR Store 1")

plot(x, forecasts_CA_1_21$Foods_1, type = "l", frame = FALSE, pch = 19, col = "blue", xlab = "time", ylab = "Foods 1 Store 1")
polygon(c(x,rev(x)),c(forecasts_CA_1_21$Foods_1_Low,rev(forecasts_CA_1_21$Foods_1_High)),col="thistle",border=NA)
lines(x, forecasts_CA_1_21$Foods_1, type = "l",  pch = 19, col = "blue")
lines(x, forecasts_CA_1_21$Foods_1_pred, pch = 18, col = "red", type = "l")
legend("bottomright", legend=c("Real", "Predicted", "C.I. 95%"),col=c("blue", "red","thistle"), lty = 1:1, cex=0.8)
title("Foods 1 Store 1 - VAR Store 1")

plot(x, forecasts_CA_1_21$Foods_2, type = "l", frame = FALSE, pch = 19, col = "blue", xlab = "time", ylab = "Foods 2 Store 1")
polygon(c(x,rev(x)),c(forecasts_CA_1_21$Foods_2_Low,rev(forecasts_CA_1_21$Foods_2_High)),col="thistle",border=NA)
lines(x, forecasts_CA_1_21$Foods_2, type = "l",  pch = 19, col = "blue")
lines(x, forecasts_CA_1_21$Foods_2_pred, pch = 18, col = "red", type = "l")
legend("bottomright", legend=c("Real", "Predicted", "C.I. 95%"),col=c("blue", "red","thistle"), lty = 1:1, cex=0.8)
title("Foods 2 Store 1 - VAR Store 1")

plot(x, forecasts_CA_1_21$Foods_3, type = "l", frame = FALSE, pch = 19, col = "blue", xlab = "time", ylab = "Foods 3 Store 1")
polygon(c(x,rev(x)),c(forecasts_CA_1_21$Foods_3_Low,rev(forecasts_CA_1_21$Foods_3_High)),col="thistle",border=NA)
lines(x, forecasts_CA_1_21$Foods_3, type = "l",  pch = 19, col = "blue")
lines(x, forecasts_CA_1_21$Foods_3_pred, pch = 18, col = "red", type = "l")
legend("bottomright", legend=c("Real", "Predicted", "C.I. 95%"),col=c("blue", "red","thistle"), lty = 1:1, cex=0.8)
title("Foods 3 Store 1 - VAR Store 1")

```

To conclude the first exercise we will compute the average of the RMSSE for the four splits:

```{r}

df_rmsse_CA_1_avg = data.frame()
df_rmsse_CA_2_avg = data.frame()
df_rmsse_CA_3_avg = data.frame()

# Save the RMSSE Results in a data frame
df_rmsse_CA_1_avg[1, 1] = df_rmsse_CA_1_2yr[1, 1]
df_rmsse_CA_1_avg[2, 1] = df_rmsse_CA_1_2yr[2, 1]
df_rmsse_CA_1_avg[3, 1] = df_rmsse_CA_1_2yr[3, 1]
df_rmsse_CA_1_avg[4, 1] = df_rmsse_CA_1_2yr[4, 1]
df_rmsse_CA_1_avg[5, 1] = df_rmsse_CA_1_2yr[5, 1]
df_rmsse_CA_1_avg[6, 1] = df_rmsse_CA_1_2yr[6, 1]

df_rmsse_CA_1_avg[1, 2] = df_rmsse_CA_1_3yr[1, 1]
df_rmsse_CA_1_avg[2, 2] = df_rmsse_CA_1_3yr[2, 1]
df_rmsse_CA_1_avg[3, 2] = df_rmsse_CA_1_3yr[3, 1]
df_rmsse_CA_1_avg[4, 2] = df_rmsse_CA_1_3yr[4, 1]
df_rmsse_CA_1_avg[5, 2] = df_rmsse_CA_1_3yr[5, 1]
df_rmsse_CA_1_avg[6, 2] = df_rmsse_CA_1_3yr[6, 1]

df_rmsse_CA_1_avg[1, 3] = df_rmsse_CA_1_4yr[1, 1]
df_rmsse_CA_1_avg[2, 3] = df_rmsse_CA_1_4yr[2, 1]
df_rmsse_CA_1_avg[3, 3] = df_rmsse_CA_1_4yr[3, 1]
df_rmsse_CA_1_avg[4, 3] = df_rmsse_CA_1_4yr[4, 1]
df_rmsse_CA_1_avg[5, 3] = df_rmsse_CA_1_4yr[5, 1]
df_rmsse_CA_1_avg[6, 3] = df_rmsse_CA_1_4yr[6, 1]

df_rmsse_CA_1_avg[1, 4] = df_rmsse_CA_1_5yr[1, 1]
df_rmsse_CA_1_avg[2, 4] = df_rmsse_CA_1_5yr[2, 1]
df_rmsse_CA_1_avg[3, 4] = df_rmsse_CA_1_5yr[3, 1]
df_rmsse_CA_1_avg[4, 4] = df_rmsse_CA_1_5yr[4, 1]
df_rmsse_CA_1_avg[5, 4] = df_rmsse_CA_1_5yr[5, 1]
df_rmsse_CA_1_avg[6, 4] = df_rmsse_CA_1_5yr[6, 1]

df_rmsse_CA_1_avg[1, 5] = (df_rmsse_CA_1_avg[1, 1] + df_rmsse_CA_1_avg[1, 2] + df_rmsse_CA_1_avg[1, 3] + df_rmsse_CA_1_avg[1, 4])/4 
df_rmsse_CA_1_avg[2, 5] = (df_rmsse_CA_1_avg[2, 1] + df_rmsse_CA_1_avg[2, 2] + df_rmsse_CA_1_avg[2, 3] + df_rmsse_CA_1_avg[2, 4])/4
df_rmsse_CA_1_avg[3, 5] = (df_rmsse_CA_1_avg[3, 1] + df_rmsse_CA_1_avg[3, 2] + df_rmsse_CA_1_avg[3, 3] + df_rmsse_CA_1_avg[3, 4])/4
df_rmsse_CA_1_avg[4, 5] = (df_rmsse_CA_1_avg[4, 1] + df_rmsse_CA_1_avg[4, 2] + df_rmsse_CA_1_avg[4, 3] + df_rmsse_CA_1_avg[4, 4])/4
df_rmsse_CA_1_avg[5, 5] = (df_rmsse_CA_1_avg[5, 1] + df_rmsse_CA_1_avg[5, 2] + df_rmsse_CA_1_avg[5, 3] + df_rmsse_CA_1_avg[5, 4])/4
df_rmsse_CA_1_avg[6, 5] = (df_rmsse_CA_1_avg[6, 1] + df_rmsse_CA_1_avg[6, 2] + df_rmsse_CA_1_avg[6, 3] + df_rmsse_CA_1_avg[6, 4])/4

colnames(df_rmsse_CA_1_avg) = c("split2yr","split3yr","split4yr","split5yr","avg")
rownames(df_rmsse_CA_1_avg) =  c("Hobbies","Household1","Household2","Foods1","Foods2","Foods3")


df_rmsse_CA_1_avg


```

Store 2:

```{r, echo=FALSE}


# Save the RMSSE Results in a data frame
df_rmsse_CA_2_avg[1, 1] = df_rmsse_CA_2_2yr[1, 1]
df_rmsse_CA_2_avg[2, 1] = df_rmsse_CA_2_2yr[2, 1]
df_rmsse_CA_2_avg[3, 1] = df_rmsse_CA_2_2yr[3, 1]
df_rmsse_CA_2_avg[4, 1] = df_rmsse_CA_2_2yr[4, 1]
df_rmsse_CA_2_avg[5, 1] = df_rmsse_CA_2_2yr[5, 1]
df_rmsse_CA_2_avg[6, 1] = df_rmsse_CA_2_2yr[6, 1]

df_rmsse_CA_2_avg[1, 2] = df_rmsse_CA_2_3yr[1, 1]
df_rmsse_CA_2_avg[2, 2] = df_rmsse_CA_2_3yr[2, 1]
df_rmsse_CA_2_avg[3, 2] = df_rmsse_CA_2_3yr[3, 1]
df_rmsse_CA_2_avg[4, 2] = df_rmsse_CA_2_3yr[4, 1]
df_rmsse_CA_2_avg[5, 2] = df_rmsse_CA_2_3yr[5, 1]
df_rmsse_CA_2_avg[6, 2] = df_rmsse_CA_2_3yr[6, 1]

df_rmsse_CA_2_avg[1, 3] = df_rmsse_CA_2_4yr[1, 1]
df_rmsse_CA_2_avg[2, 3] = df_rmsse_CA_2_4yr[2, 1]
df_rmsse_CA_2_avg[3, 3] = df_rmsse_CA_2_4yr[3, 1]
df_rmsse_CA_2_avg[4, 3] = df_rmsse_CA_2_4yr[4, 1]
df_rmsse_CA_2_avg[5, 3] = df_rmsse_CA_2_4yr[5, 1]
df_rmsse_CA_2_avg[6, 3] = df_rmsse_CA_2_4yr[6, 1]

df_rmsse_CA_2_avg[1, 4] = df_rmsse_CA_2_5yr[1, 1]
df_rmsse_CA_2_avg[2, 4] = df_rmsse_CA_2_5yr[2, 1]
df_rmsse_CA_2_avg[3, 4] = df_rmsse_CA_2_5yr[3, 1]
df_rmsse_CA_2_avg[4, 4] = df_rmsse_CA_2_5yr[4, 1]
df_rmsse_CA_2_avg[5, 4] = df_rmsse_CA_2_5yr[5, 1]
df_rmsse_CA_2_avg[6, 4] = df_rmsse_CA_2_5yr[6, 1]

df_rmsse_CA_2_avg[1, 5] = (df_rmsse_CA_2_avg[1, 1] + df_rmsse_CA_2_avg[1, 2] + df_rmsse_CA_2_avg[1, 3] + df_rmsse_CA_2_avg[1, 4])/4 
df_rmsse_CA_2_avg[2, 5] = (df_rmsse_CA_2_avg[2, 1] + df_rmsse_CA_2_avg[2, 2] + df_rmsse_CA_2_avg[2, 3] + df_rmsse_CA_2_avg[2, 4])/4
df_rmsse_CA_2_avg[3, 5] = (df_rmsse_CA_2_avg[3, 1] + df_rmsse_CA_2_avg[3, 2] + df_rmsse_CA_2_avg[3, 3] + df_rmsse_CA_2_avg[3, 4])/4
df_rmsse_CA_2_avg[4, 5] = (df_rmsse_CA_2_avg[4, 1] + df_rmsse_CA_2_avg[4, 2] + df_rmsse_CA_2_avg[4, 3] + df_rmsse_CA_2_avg[4, 4])/4
df_rmsse_CA_2_avg[5, 5] = (df_rmsse_CA_2_avg[5, 1] + df_rmsse_CA_2_avg[5, 2] + df_rmsse_CA_2_avg[5, 3] + df_rmsse_CA_2_avg[5, 4])/4
df_rmsse_CA_2_avg[6, 5] = (df_rmsse_CA_2_avg[6, 1] + df_rmsse_CA_2_avg[6, 2] + df_rmsse_CA_2_avg[6, 3] + df_rmsse_CA_2_avg[6, 4])/4

colnames(df_rmsse_CA_2_avg) = c("split2yr","split3yr","split4yr","split5yr","avg")
rownames(df_rmsse_CA_2_avg) =  c("Hobbies","Household1","Household2","Foods1","Foods2","Foods3")


df_rmsse_CA_2_avg


```

Store 3:

```{r, echo=FALSE}


# Save the RMSSE Results in a data frame
df_rmsse_CA_3_avg[1, 1] = df_rmsse_CA_3_2yr[1, 1]
df_rmsse_CA_3_avg[2, 1] = df_rmsse_CA_3_2yr[2, 1]
df_rmsse_CA_3_avg[3, 1] = df_rmsse_CA_3_2yr[3, 1]
df_rmsse_CA_3_avg[4, 1] = df_rmsse_CA_3_2yr[4, 1]
df_rmsse_CA_3_avg[5, 1] = df_rmsse_CA_3_2yr[5, 1]
df_rmsse_CA_3_avg[6, 1] = df_rmsse_CA_3_2yr[6, 1]

df_rmsse_CA_3_avg[1, 2] = df_rmsse_CA_3_3yr[1, 1]
df_rmsse_CA_3_avg[2, 2] = df_rmsse_CA_3_3yr[2, 1]
df_rmsse_CA_3_avg[3, 2] = df_rmsse_CA_3_3yr[3, 1]
df_rmsse_CA_3_avg[4, 2] = df_rmsse_CA_3_3yr[4, 1]
df_rmsse_CA_3_avg[5, 2] = df_rmsse_CA_3_3yr[5, 1]
df_rmsse_CA_3_avg[6, 2] = df_rmsse_CA_3_3yr[6, 1]

df_rmsse_CA_3_avg[1, 3] = df_rmsse_CA_3_4yr[1, 1]
df_rmsse_CA_3_avg[2, 3] = df_rmsse_CA_3_4yr[2, 1]
df_rmsse_CA_3_avg[3, 3] = df_rmsse_CA_3_4yr[3, 1]
df_rmsse_CA_3_avg[4, 3] = df_rmsse_CA_3_4yr[4, 1]
df_rmsse_CA_3_avg[5, 3] = df_rmsse_CA_3_4yr[5, 1]
df_rmsse_CA_3_avg[6, 3] = df_rmsse_CA_3_4yr[6, 1]

df_rmsse_CA_3_avg[1, 4] = df_rmsse_CA_3_5yr[1, 1]
df_rmsse_CA_3_avg[2, 4] = df_rmsse_CA_3_5yr[2, 1]
df_rmsse_CA_3_avg[3, 4] = df_rmsse_CA_3_5yr[3, 1]
df_rmsse_CA_3_avg[4, 4] = df_rmsse_CA_3_5yr[4, 1]
df_rmsse_CA_3_avg[5, 4] = df_rmsse_CA_3_5yr[5, 1]
df_rmsse_CA_3_avg[6, 4] = df_rmsse_CA_3_5yr[6, 1]

df_rmsse_CA_3_avg[1, 5] = (df_rmsse_CA_3_avg[1, 1] + df_rmsse_CA_3_avg[1, 2] + df_rmsse_CA_3_avg[1, 3] + df_rmsse_CA_3_avg[1, 4])/4 
df_rmsse_CA_3_avg[2, 5] = (df_rmsse_CA_3_avg[2, 1] + df_rmsse_CA_3_avg[2, 2] + df_rmsse_CA_3_avg[2, 3] + df_rmsse_CA_3_avg[2, 4])/4
df_rmsse_CA_3_avg[3, 5] = (df_rmsse_CA_3_avg[3, 1] + df_rmsse_CA_3_avg[3, 2] + df_rmsse_CA_3_avg[3, 3] + df_rmsse_CA_3_avg[3, 4])/4
df_rmsse_CA_3_avg[4, 5] = (df_rmsse_CA_3_avg[4, 1] + df_rmsse_CA_3_avg[4, 2] + df_rmsse_CA_3_avg[4, 3] + df_rmsse_CA_3_avg[4, 4])/4
df_rmsse_CA_3_avg[5, 5] = (df_rmsse_CA_3_avg[5, 1] + df_rmsse_CA_3_avg[5, 2] + df_rmsse_CA_3_avg[5, 3] + df_rmsse_CA_3_avg[5, 4])/4
df_rmsse_CA_3_avg[6, 5] = (df_rmsse_CA_3_avg[6, 1] + df_rmsse_CA_3_avg[6, 2] + df_rmsse_CA_3_avg[6, 3] + df_rmsse_CA_3_avg[6, 4])/4
colnames(df_rmsse_CA_3_avg) = c("split2yr","split3yr","split4yr","split5yr","avg")
rownames(df_rmsse_CA_3_avg) =  c("Hobbies","Household1","Household2","Foods1","Foods2","Foods3")


df_rmsse_CA_3_avg


```

From exercise 2.1 we can conclude that the VAR models per store capture the trend of the time series but they do not account for the random noise. With the development of the following exercises the RMSSE will be used to compare the results.

## Question 2.2- VAR per product
### First split


#### Transformations

First train-test split for data from 2011-2012 for training and 2013 for testing. 

Three data frames are created, one for each store: df_CA_1, df_CA_2 and df_CA_3.


```{r }

# Define the train-test split 703 is 2012-12-31 and 1068 for 2013-12-31
train_sample = 703
test_sample = 1068

# Extracting the columns of the CA_1 store and renaming them
df_hobbies = df[c('Hobbies_CA_1','Hobbies_CA_2','Hobbies_CA_3')]
df_household1 = df[c('Household_1_CA_1','Household_1_CA_2','Household_1_CA_3')]
df_household2 = df[c('Household_2_CA_1','Household_2_CA_2','Household_2_CA_3')]
df_foods1 = df[c('Foods_1_CA_1','Foods_1_CA_2','Foods_1_CA_3')]
df_foods2 = df[c('Foods_2_CA_1','Foods_2_CA_2','Foods_2_CA_3')]
df_foods3 = df[c('Foods_3_CA_1','Foods_3_CA_2','Foods_3_CA_3')]

head(df_hobbies,5)

```


These are the plots for the time series of Store 1 that will be used to train a VAR Model

```{r echo=FALSE}

# plot the VAR time-series and estimates at 1-step 
x = 1:1969
plot(x, df_hobbies$Hobbies_CA_1, type = "l", frame = FALSE, pch = 19, col = "blue", xlab = "time", ylab = "Hobbies Store 1")
plot(x, df_hobbies$Hobbies_CA_2, type = "l", frame = FALSE, pch = 19, col = "blue", xlab = "time", ylab = "Hobbies Store 2")
plot(x, df_hobbies$Hobbies_CA_2, type = "l", frame = FALSE, pch = 19, col = "blue", xlab = "time", ylab = "Hobbies Store 3")

```

The dataframes are splitted for each store to have train and test splits

```{r}

# Create train and test samples based on the previous variables
df_hobbies_train = head(df_hobbies, train_sample)
df_hobbies_test  = head(df_hobbies, test_sample)
df_hobbies_test  = tail(df_hobbies_test, test_sample - train_sample)

df_household1_train = head(df_household1, train_sample)
df_household1_test  = head(df_household1, test_sample)
df_household1_test  = tail(df_household1_test, test_sample - train_sample)

df_household2_train = head(df_household2, train_sample)
df_household2_test  = head(df_household2, test_sample)
df_household2_test  = tail(df_household2_test, test_sample - train_sample)

df_foods1_train = head(df_foods1, train_sample)
df_foods1_test  = head(df_foods1, test_sample)
df_foods1_test  = tail(df_foods1_test, test_sample - train_sample)

df_foods2_train = head(df_foods2, train_sample)
df_foods2_test  = head(df_foods2, test_sample)
df_foods2_test  = tail(df_foods2_test, test_sample - train_sample)

df_foods3_train = head(df_foods3, train_sample)
df_foods3_test  = head(df_foods3, test_sample)
df_foods3_test  = tail(df_foods3_test, test_sample - train_sample)

dim(df_foods2_train)
dim(df_foods2_test)

```


### Fitting VAR models

With the training data, and setting p = 1, a VAR model is fitted for each
product.

The summary statistics of the first var are shown as ouput.

```{r}

var_hobbies_train = VAR(df_hobbies_train, p=1)
var_household1_train = VAR(df_household1_train, p=1)
var_household2_train = VAR(df_household2_train, p=1)
var_foods1_train = VAR(df_foods1_train, p=1)
var_foods2_train = VAR(df_foods2_train, p=1)
var_foods3_train = VAR(df_foods3_train, p=1)

summary(var_household2_train)

```

As we can see each variable of the VAR is calculated with respect to the other variables during the previous period.

Now, with the coefficients we forecast the test periods. 

```{r, echo=FALSE}

# Extract the coefficients
dcoef_hobbies = coef(var_hobbies_train)
dcoef_household1 = coef(var_household1_train)
dcoef_household2 = coef(var_household2_train)
dcoef_foods1 = coef(var_foods1_train)
dcoef_foods2 = coef(var_foods2_train)
dcoef_foods3 = coef(var_foods3_train)

# iterate the number of test samples to predict using the var coefficients

length_sample = test_sample - train_sample
for (i in 1:length_sample) {
  if (i==1) {
    df_hobbies_test[i, 4] = dcoef_hobbies$Hobbies_CA_1[1]*df_hobbies_train[train_sample,1] + dcoef_hobbies$Hobbies_CA_1[2]*df_hobbies_train[train_sample,2] + dcoef_hobbies$Hobbies_CA_1[3]*df_hobbies_train[train_sample,3]+ dcoef_hobbies$Hobbies_CA_1[4]
    df_hobbies_test[i, 5] = dcoef_hobbies$Hobbies_CA_2[1]*df_hobbies_train[train_sample,1] + dcoef_hobbies$Hobbies_CA_2[2]*df_hobbies_train[train_sample,2] + dcoef_hobbies$Hobbies_CA_2[3]*df_hobbies_train[train_sample,3]+ dcoef_hobbies$Hobbies_CA_2[4]
    df_hobbies_test[i, 6] = dcoef_hobbies$Hobbies_CA_3[1]*df_hobbies_train[train_sample,1] + dcoef_hobbies$Hobbies_CA_3[2]*df_hobbies_train[train_sample,2] + dcoef_hobbies$Hobbies_CA_3[3]*df_hobbies_train[train_sample,3]+ dcoef_hobbies$Hobbies_CA_3[4]

    df_household1_test[i, 4] = dcoef_household1$Household_1_CA_1[1]*df_household1_train[train_sample,1] + dcoef_household1$Household_1_CA_1[2]*df_household1_train[train_sample,2] + dcoef_household1$Household_1_CA_1[3]*df_household1_train[train_sample,3]+ dcoef_household1$Household_1_CA_1[4]
    df_household1_test[i, 5] = dcoef_household1$Household_1_CA_2[1]*df_household1_train[train_sample,1] + dcoef_household1$Household_1_CA_2[2]*df_household1_train[train_sample,2] + dcoef_household1$Household_1_CA_2[3]*df_household1_train[train_sample,3]+ dcoef_household1$Household_1_CA_2[4]
    df_household1_test[i, 6] = dcoef_household1$Household_1_CA_3[1]*df_household1_train[train_sample,1] + dcoef_household1$Household_1_CA_3[2]*df_household1_train[train_sample,2] + dcoef_household1$Household_1_CA_3[3]*df_household1_train[train_sample,3]+ dcoef_household1$Household_1_CA_3[4]
    
    df_household2_test[i, 4] = dcoef_household2$Household_2_CA_1[1]*df_household2_train[train_sample,1] + dcoef_household2$Household_2_CA_1[2]*df_household2_train[train_sample,2] + dcoef_household2$Household_2_CA_1[3]*df_household2_train[train_sample,3]+ dcoef_household2$Household_2_CA_1[4]
    df_household2_test[i, 5] = dcoef_household2$Household_2_CA_2[1]*df_household2_train[train_sample,1] + dcoef_household2$Household_2_CA_2[2]*df_household2_train[train_sample,2] + dcoef_household2$Household_2_CA_2[3]*df_household2_train[train_sample,3]+ dcoef_household2$Household_2_CA_2[4]
    df_household2_test[i, 6] = dcoef_household2$Household_2_CA_3[1]*df_household2_train[train_sample,1] + dcoef_household2$Household_2_CA_3[2]*df_household2_train[train_sample,2] + dcoef_household2$Household_2_CA_3[3]*df_household2_train[train_sample,3]+ dcoef_household2$Household_2_CA_3[4]
    
    df_foods1_test[i, 4] = dcoef_foods1$Foods_1_CA_1[1]*df_foods1_train[train_sample,1] + dcoef_foods1$Foods_1_CA_1[2]*df_foods1_train[train_sample,2] + dcoef_foods1$Foods_1_CA_1[3]*df_foods1_train[train_sample,3]+ dcoef_foods1$Foods_1_CA_1[4]
    df_foods1_test[i, 5] = dcoef_foods1$Foods_1_CA_2[1]*df_foods1_train[train_sample,1] + dcoef_foods1$Foods_1_CA_2[2]*df_foods1_train[train_sample,2] + dcoef_foods1$Foods_1_CA_2[3]*df_foods1_train[train_sample,3]+ dcoef_foods1$Foods_1_CA_2[4]
    df_foods1_test[i, 6] = dcoef_foods1$Foods_1_CA_3[1]*df_foods1_train[train_sample,1] + dcoef_foods1$Foods_1_CA_3[2]*df_foods1_train[train_sample,2] + dcoef_foods1$Foods_1_CA_3[3]*df_foods1_train[train_sample,3]+ dcoef_foods1$Foods_1_CA_3[4]
    
    df_foods2_test[i, 4] = dcoef_foods2$Foods_2_CA_1[1]*df_foods2_train[train_sample,1] + dcoef_foods2$Foods_2_CA_1[2]*df_foods2_train[train_sample,2] + dcoef_foods2$Foods_2_CA_1[3]*df_foods2_train[train_sample,3]+ dcoef_foods2$Foods_2_CA_1[4]
    df_foods2_test[i, 5] = dcoef_foods2$Foods_2_CA_2[1]*df_foods2_train[train_sample,1] + dcoef_foods2$Foods_2_CA_2[2]*df_foods2_train[train_sample,2] + dcoef_foods2$Foods_2_CA_2[3]*df_foods2_train[train_sample,3]+ dcoef_foods2$Foods_2_CA_2[4]
    df_foods2_test[i, 6] = dcoef_foods2$Foods_2_CA_3[1]*df_foods2_train[train_sample,1] + dcoef_foods2$Foods_2_CA_3[2]*df_foods2_train[train_sample,2] + dcoef_foods2$Foods_2_CA_3[3]*df_foods2_train[train_sample,3]+ dcoef_foods2$Foods_2_CA_3[4]
    
    df_foods3_test[i, 4] = dcoef_foods3$Foods_3_CA_1[1]*df_foods3_train[train_sample,1] + dcoef_foods3$Foods_3_CA_1[2]*df_foods3_train[train_sample,2] + dcoef_foods3$Foods_3_CA_1[3]*df_foods3_train[train_sample,3]+ dcoef_foods3$Foods_3_CA_1[4]
    df_foods3_test[i, 5] = dcoef_foods3$Foods_3_CA_2[1]*df_foods3_train[train_sample,1] + dcoef_foods3$Foods_3_CA_2[2]*df_foods3_train[train_sample,2] + dcoef_foods3$Foods_3_CA_2[3]*df_foods3_train[train_sample,3]+ dcoef_foods3$Foods_3_CA_2[4]
    df_foods3_test[i, 6] = dcoef_foods3$Foods_3_CA_3[1]*df_foods3_train[train_sample,1] + dcoef_foods3$Foods_3_CA_3[2]*df_foods3_train[train_sample,2] + dcoef_foods3$Foods_3_CA_3[3]*df_foods3_train[train_sample,3]+ dcoef_foods3$Foods_3_CA_3[4]
    
    
  }
  else {

    df_hobbies_test[i, 4] = dcoef_hobbies$Hobbies_CA_1[1]*df_hobbies_test[i-1,1] + dcoef_hobbies$Hobbies_CA_1[2]*df_hobbies_test[i-1,2] + dcoef_hobbies$Hobbies_CA_1[3]*df_hobbies_test[i-1,3]+ dcoef_hobbies$Hobbies_CA_1[4]
    df_hobbies_test[i, 5] = dcoef_hobbies$Hobbies_CA_2[1]*df_hobbies_test[i-1,1] + dcoef_hobbies$Hobbies_CA_2[2]*df_hobbies_test[i-1,2] + dcoef_hobbies$Hobbies_CA_2[3]*df_hobbies_test[i-1,3]+ dcoef_hobbies$Hobbies_CA_2[4]
    df_hobbies_test[i, 6] = dcoef_hobbies$Hobbies_CA_3[1]*df_hobbies_test[i-1,1] + dcoef_hobbies$Hobbies_CA_3[2]*df_hobbies_test[i-1,2] + dcoef_hobbies$Hobbies_CA_3[3]*df_hobbies_test[i-1,3]+ dcoef_hobbies$Hobbies_CA_3[4]
    
    df_household1_test[i, 4] = dcoef_household1$Household_1_CA_1[1]*df_household1_test[i-1,1] + dcoef_household1$Household_1_CA_1[2]*df_household1_test[i-1,2] + dcoef_household1$Household_1_CA_1[3]*df_household1_test[i-1,3]+ dcoef_household1$Household_1_CA_1[4]
    df_household1_test[i, 5] = dcoef_household1$Household_1_CA_2[1]*df_household1_test[i-1,1] + dcoef_household1$Household_1_CA_2[2]*df_household1_test[i-1,2] + dcoef_household1$Household_1_CA_2[3]*df_household1_test[i-1,3]+ dcoef_household1$Household_1_CA_2[4]
    df_household1_test[i, 6] = dcoef_household1$Household_1_CA_3[1]*df_household1_test[i-1,1] + dcoef_household1$Household_1_CA_3[2]*df_household1_test[i-1,2] + dcoef_household1$Household_1_CA_3[3]*df_household1_test[i-1,3]+ dcoef_household1$Household_1_CA_3[4]
    
    df_household2_test[i, 4] = dcoef_household2$Household_2_CA_1[1]*df_household2_test[i-1,1] + dcoef_household2$Household_2_CA_1[2]*df_household2_test[i-1,2] + dcoef_household2$Household_2_CA_1[3]*df_household2_test[i-1,3]+ dcoef_household2$Household_2_CA_1[4]
    df_household2_test[i, 5] = dcoef_household2$Household_2_CA_2[1]*df_household2_test[i-1,1] + dcoef_household2$Household_2_CA_2[2]*df_household2_test[i-1,2] + dcoef_household2$Household_2_CA_2[3]*df_household2_test[i-1,3]+ dcoef_household2$Household_2_CA_2[4]
    df_household2_test[i, 6] = dcoef_household2$Household_2_CA_3[1]*df_household2_test[i-1,1] + dcoef_household2$Household_2_CA_3[2]*df_household2_test[i-1,2] + dcoef_household2$Household_2_CA_3[3]*df_household2_test[i-1,3]+ dcoef_household2$Household_2_CA_3[4]
    
    df_foods1_test[i, 4] = dcoef_foods1$Foods_1_CA_1[1]*df_foods1_test[i-1,1] + dcoef_foods1$Foods_1_CA_1[2]*df_foods1_test[i-1,2] + dcoef_foods1$Foods_1_CA_1[3]*df_foods1_test[i-1,3]+ dcoef_foods1$Foods_1_CA_1[4]
    df_foods1_test[i, 5] = dcoef_foods1$Foods_1_CA_2[1]*df_foods1_test[i-1,1] + dcoef_foods1$Foods_1_CA_2[2]*df_foods1_test[i-1,2] + dcoef_foods1$Foods_1_CA_2[3]*df_foods1_test[i-1,3]+ dcoef_foods1$Foods_1_CA_2[4]
    df_foods1_test[i, 6] = dcoef_foods1$Foods_1_CA_3[1]*df_foods1_test[i-1,1] + dcoef_foods1$Foods_1_CA_3[2]*df_foods1_test[i-1,2] + dcoef_foods1$Foods_1_CA_3[3]*df_foods1_test[i-1,3]+ dcoef_foods1$Foods_1_CA_3[4]    
    
    df_foods2_test[i, 4] = dcoef_foods2$Foods_2_CA_1[1]*df_foods2_test[i-1,1] + dcoef_foods2$Foods_2_CA_1[2]*df_foods2_test[i-1,2] + dcoef_foods2$Foods_2_CA_1[3]*df_foods2_test[i-1,3]+ dcoef_foods2$Foods_2_CA_1[4]
    df_foods2_test[i, 5] = dcoef_foods2$Foods_2_CA_2[1]*df_foods2_test[i-1,1] + dcoef_foods2$Foods_2_CA_2[2]*df_foods2_test[i-1,2] + dcoef_foods2$Foods_2_CA_2[3]*df_foods2_test[i-1,3]+ dcoef_foods2$Foods_2_CA_2[4]
    df_foods2_test[i, 6] = dcoef_foods2$Foods_2_CA_3[1]*df_foods2_test[i-1,1] + dcoef_foods2$Foods_2_CA_3[2]*df_foods2_test[i-1,2] + dcoef_foods2$Foods_2_CA_3[3]*df_foods2_test[i-1,3]+ dcoef_foods2$Foods_2_CA_3[4]    
    
    df_foods3_test[i, 4] = dcoef_foods3$Foods_3_CA_1[1]*df_foods3_test[i-1,1] + dcoef_foods3$Foods_3_CA_1[2]*df_foods3_test[i-1,2] + dcoef_foods3$Foods_3_CA_1[3]*df_foods3_test[i-1,3]+ dcoef_foods3$Foods_3_CA_1[4]
    df_foods3_test[i, 5] = dcoef_foods3$Foods_3_CA_2[1]*df_foods3_test[i-1,1] + dcoef_foods3$Foods_3_CA_2[2]*df_foods3_test[i-1,2] + dcoef_foods3$Foods_3_CA_2[3]*df_foods3_test[i-1,3]+ dcoef_foods3$Foods_3_CA_2[4]
    df_foods3_test[i, 6] = dcoef_foods3$Foods_3_CA_3[1]*df_foods3_test[i-1,1] + dcoef_foods3$Foods_3_CA_3[2]*df_foods3_test[i-1,2] + dcoef_foods3$Foods_3_CA_3[3]*df_foods3_test[i-1,3]+ dcoef_foods3$Foods_3_CA_3[4]    
    
  }
}

  

colnames(df_hobbies_test) = c('Hobbies_CA_1','Hobbies_CA_2','Hobbies_CA_3'
                           ,'Hobbies_CA_1_pred','Hobbies_CA_2_pred','Hobbies_CA_3_pred')

colnames(df_household1_test) = c('Household_1_CA_1','Household_1_CA_2','Household_1_CA_3'
                              ,'Household_1_CA_1_pred','Household_1_CA_2_pred','Household_1_CA_3_pred')

colnames(df_household2_test) = c('Household_2_CA_1','Household_2_CA_2','Household_2_CA_3'
                                 ,'Household_2_CA_1_pred','Household_2_CA_2_pred','Household_2_CA_3_pred')

colnames(df_foods1_test) = c('Foods_1_CA_1','Foods_1_CA_2','Foods_1_CA_3'
                                 ,'Foods_1_CA_1_pred','Foods_1_CA_2_pred','Foods_1_CA_3_pred')

colnames(df_foods2_test) = c('Foods_2_CA_1','Foods_2_CA_2','Foods_2_CA_3'
                             ,'Foods_2_CA_1_pred','Foods_2_CA_2_pred','Foods_2_CA_3_pred')

colnames(df_foods3_test) = c('Foods_3_CA_1','Foods_3_CA_2','Foods_3_CA_3'
                             ,'Foods_3_CA_1_pred','Foods_3_CA_2_pred','Foods_3_CA_3_pred')


```

The output after predicting one-time step is:

```{r}

forecasts_hobbies_22 = df_hobbies_test
forecasts_household1_22 = df_household1_test
forecasts_household2_22 = df_household2_test
forecasts_foods1_22 = df_foods1_test
forecasts_foods2_22 = df_foods2_test
forecasts_foods3_22 = df_foods3_test

head(forecasts_foods1_22, 5)

```

The resulting data frames are used both to plot the real vs predicted time series and also to compute the RMSSE.

Now with these forecasts we plot the predicted time series (one step ahead) from the VAR model  vs the real time series, also we plot the 95% confidence interval.

### Hobbies:

```{r, echo=FALSE}

# plot the VAR time-series and estimates at 1-step 
length_x = test_sample-train_sample
x = 1:length_x

# Plot hobbies real vs predicted forecasts for each store

forecasts_hobbies_22$Hobbies_CA_1_High = forecasts_hobbies_22$Hobbies_CA_1_pred + 1.96 * (dcoef_hobbies$Hobbies_CA_1[1,2] + dcoef_hobbies$Hobbies_CA_1[2,2] + dcoef_hobbies$Hobbies_CA_1[3,2] + dcoef_hobbies$Hobbies_CA_1[4,2])

forecasts_hobbies_22$Hobbies_CA_1_Low = forecasts_hobbies_22$Hobbies_CA_1_pred - 1.96 * (dcoef_hobbies$Hobbies_CA_1[1,2] + dcoef_hobbies$Hobbies_CA_1[2,2] + dcoef_hobbies$Hobbies_CA_1[3,2] + dcoef_hobbies$Hobbies_CA_1[4,2])

forecasts_hobbies_22$Hobbies_CA_2_High = forecasts_hobbies_22$Hobbies_CA_2_pred + 1.96 * (dcoef_hobbies$Hobbies_CA_2[1,2] + dcoef_hobbies$Hobbies_CA_2[2,2] + dcoef_hobbies$Hobbies_CA_2[3,2] + dcoef_hobbies$Hobbies_CA_2[4,2])

forecasts_hobbies_22$Hobbies_CA_2_Low = forecasts_hobbies_22$Hobbies_CA_2_pred - 1.96 * (dcoef_hobbies$Hobbies_CA_2[1,2] + dcoef_hobbies$Hobbies_CA_2[2,2] + dcoef_hobbies$Hobbies_CA_2[3,2] + dcoef_hobbies$Hobbies_CA_2[4,2])

forecasts_hobbies_22$Hobbies_CA_3_High = forecasts_hobbies_22$Hobbies_CA_3_pred + 1.96 * (dcoef_hobbies$Hobbies_CA_3[1,2] + dcoef_hobbies$Hobbies_CA_3[2,2] + dcoef_hobbies$Hobbies_CA_3[3,2] + dcoef_hobbies$Hobbies_CA_3[4,2])

forecasts_hobbies_22$Hobbies_CA_3_Low = forecasts_hobbies_22$Hobbies_CA_3_pred - 1.96 * (dcoef_hobbies$Hobbies_CA_3[1,2] + dcoef_hobbies$Hobbies_CA_3[2,2] + dcoef_hobbies$Hobbies_CA_3[3,2] + dcoef_hobbies$Hobbies_CA_3[4,2])


plot(x, forecasts_hobbies_22$Hobbies_CA_1, type = "l", frame = FALSE, pch = 19, col = "blue", xlab = "time", ylab = "Hobbies Store 1")
polygon(c(x,rev(x)),c(forecasts_hobbies_22$Hobbies_CA_1_Low,rev(forecasts_hobbies_22$Hobbies_CA_1_High)),col="thistle",border=NA)
lines(x, forecasts_hobbies_22$Hobbies_CA_1, type = "l",  pch = 19, col = "blue")
lines(x, forecasts_hobbies_22$Hobbies_CA_1_pred, pch = 18, col = "red", type = "l")
legend("bottomright", legend=c("Real", "Predicted", "C.I. 95%"),col=c("blue", "red","thistle"), lty = 1:1, cex=0.8)
title("Hobbies Store 1 - VAR Product Hobbies")

plot(x, forecasts_hobbies_22$Hobbies_CA_2, type = "l", frame = FALSE, pch = 19, col = "blue", xlab = "time", ylab = "Hobbies Store 2")
polygon(c(x,rev(x)),c(forecasts_hobbies_22$Hobbies_CA_2_Low,rev(forecasts_hobbies_22$Hobbies_CA_2_High)),col="thistle",border=NA)
lines(x, forecasts_hobbies_22$Hobbies_CA_2, type = "l",  pch = 19, col = "blue")
lines(x, forecasts_hobbies_22$Hobbies_CA_2_pred, pch = 18, col = "red", type = "l")
legend("bottomright", legend=c("Real", "Predicted", "C.I. 95%"),col=c("blue", "red","thistle"), lty = 1:1, cex=0.8)
title("Hobbies Store 2 - VAR Product Hobbies")

plot(x, forecasts_hobbies_22$Hobbies_CA_3, type = "l", frame = FALSE, pch = 19, col = "blue", xlab = "time", ylab = "Hobbies Store 3")
polygon(c(x,rev(x)),c(forecasts_hobbies_22$Hobbies_CA_3_Low,rev(forecasts_hobbies_22$Hobbies_CA_3_High)),col="thistle",border=NA)
lines(x, forecasts_hobbies_22$Hobbies_CA_3, type = "l",  pch = 19, col = "blue")
lines(x, forecasts_hobbies_22$Hobbies_CA_3_pred, pch = 18, col = "red", type = "l")
legend("bottomright", legend=c("Real", "Predicted", "C.I. 95%"),col=c("blue", "red","thistle"), lty = 1:1, cex=0.8)
title("Hobbies Store 3 - VAR Product Hobbies")

```

### Household 1:

```{r, echo=FALSE}

# plot the VAR time-series and estimates at 1-step 
length_x = test_sample-train_sample
x = 1:length_x

# Plot hobbies real vs predicted forecasts for each store

forecasts_household1_22$Household_1_CA_1_High = forecasts_household1_22$Household_1_CA_1_pred + 1.96 * (dcoef_household1$Household_1_CA_1[1,2] + dcoef_household1$Household_1_CA_1[2,2] + dcoef_household1$Household_1_CA_1[3,2] + dcoef_household1$Household_1_CA_1[4,2])

forecasts_household1_22$Household_1_CA_1_Low = forecasts_household1_22$Household_1_CA_1_pred - 1.96 * (dcoef_household1$Household_1_CA_1[1,2] + dcoef_household1$Household_1_CA_1[2,2] + dcoef_household1$Household_1_CA_1[3,2] + dcoef_household1$Household_1_CA_1[4,2])

forecasts_household1_22$Household_1_CA_2_High = forecasts_household1_22$Household_1_CA_2_pred + 1.96 * (dcoef_household1$Household_1_CA_2[1,2] + dcoef_household1$Household_1_CA_2[2,2] + dcoef_household1$Household_1_CA_2[3,2] + dcoef_household1$Household_1_CA_2[4,2])

forecasts_household1_22$Household_1_CA_2_Low = forecasts_household1_22$Household_1_CA_2_pred - 1.96 * (dcoef_household1$Household_1_CA_2[1,2] + dcoef_household1$Household_1_CA_2[2,2] + dcoef_household1$Household_1_CA_2[3,2] + dcoef_household1$Household_1_CA_2[4,2])

forecasts_household1_22$Household_1_CA_3_High = forecasts_household1_22$Household_1_CA_3_pred + 1.96 * (dcoef_household1$Household_1_CA_3[1,2] + dcoef_household1$Household_1_CA_3[2,2] + dcoef_household1$Household_1_CA_3[3,2] + dcoef_household1$Household_1_CA_3[4,2])

forecasts_household1_22$Household_1_CA_3_Low = forecasts_household1_22$Household_1_CA_3_pred - 1.96 * (dcoef_household1$Household_1_CA_3[1,2] + dcoef_household1$Household_1_CA_3[2,2] + dcoef_household1$Household_1_CA_3[3,2] + dcoef_household1$Household_1_CA_3[4,2])


plot(x, forecasts_household1_22$Household_1_CA_1, type = "l", frame = FALSE, pch = 19, col = "blue", xlab = "time", ylab = "Household 1 Store 1")
polygon(c(x,rev(x)),c(forecasts_household1_22$Household_1_CA_1_Low,rev(forecasts_household1_22$Household_1_CA_1_High)),col="thistle",border=NA)
lines(x, forecasts_household1_22$Household_1_CA_1, type = "l",  pch = 19, col = "blue")
lines(x, forecasts_household1_22$Household_1_CA_1_pred, pch = 18, col = "red", type = "l")
legend("bottomright", legend=c("Real", "Predicted", "C.I. 95%"),col=c("blue", "red","thistle"), lty = 1:1, cex=0.8)
title("Household 1 Store 1 - VAR Product Household 1")

plot(x, forecasts_household1_22$Household_1_CA_2, type = "l", frame = FALSE, pch = 19, col = "blue", xlab = "time", ylab = "Household 1 Store 2")
polygon(c(x,rev(x)),c(forecasts_household1_22$Household_1_CA_2_Low,rev(forecasts_household1_22$Household_1_CA_2_High)),col="thistle",border=NA)
lines(x, forecasts_household1_22$Household_1_CA_2, type = "l",  pch = 19, col = "blue")
lines(x, forecasts_household1_22$Household_1_CA_2_pred, pch = 18, col = "red", type = "l")
legend("bottomright", legend=c("Real", "Predicted", "C.I. 95%"),col=c("blue", "red","thistle"), lty = 1:1, cex=0.8)
title("Household 1 Store 2 - VAR Product Household 1")

plot(x, forecasts_household1_22$Household_1_CA_3, type = "l", frame = FALSE, pch = 19, col = "blue", xlab = "time", ylab = "Household 1 Store 3")
polygon(c(x,rev(x)),c(forecasts_household1_22$Household_1_CA_3_Low,rev(forecasts_household1_22$Household_1_CA_3_High)),col="thistle",border=NA)
lines(x, forecasts_household1_22$Household_1_CA_3, type = "l",  pch = 19, col = "blue")
lines(x, forecasts_household1_22$Household_1_CA_3_pred, pch = 18, col = "red", type = "l")
legend("bottomright", legend=c("Real", "Predicted", "C.I. 95%"),col=c("blue", "red","thistle"), lty = 1:1, cex=0.8)
title("Household 1 Store 3 - VAR Product Household 1")

```

### Household 2:

```{r, echo=FALSE}

# plot the VAR time-series and estimates at 1-step 
length_x = test_sample-train_sample
x = 1:length_x

# Plot hobbies real vs predicted forecasts for each store

forecasts_household2_22$Household_2_CA_1_High = forecasts_household2_22$Household_2_CA_1_pred + 1.96 * (dcoef_household2$Household_2_CA_1[1,2] + dcoef_household2$Household_2_CA_1[2,2] + dcoef_household2$Household_2_CA_1[3,2] + dcoef_household2$Household_2_CA_1[4,2])

forecasts_household2_22$Household_2_CA_1_Low = forecasts_household2_22$Household_2_CA_1_pred - 1.96 * (dcoef_household2$Household_2_CA_1[1,2] + dcoef_household2$Household_2_CA_1[2,2] + dcoef_household2$Household_2_CA_1[3,2] + dcoef_household2$Household_2_CA_1[4,2])

forecasts_household2_22$Household_2_CA_2_High = forecasts_household2_22$Household_2_CA_2_pred + 1.96 * (dcoef_household2$Household_2_CA_2[1,2] + dcoef_household2$Household_2_CA_2[2,2] + dcoef_household2$Household_2_CA_2[3,2] + dcoef_household2$Household_2_CA_2[4,2])

forecasts_household2_22$Household_2_CA_2_Low = forecasts_household2_22$Household_2_CA_2_pred - 1.96 * (dcoef_household2$Household_2_CA_2[1,2] + dcoef_household2$Household_2_CA_2[2,2] + dcoef_household2$Household_2_CA_2[3,2] + dcoef_household2$Household_2_CA_2[4,2])

forecasts_household2_22$Household_2_CA_3_High = forecasts_household2_22$Household_2_CA_3_pred + 1.96 * (dcoef_household2$Household_2_CA_3[1,2] + dcoef_household2$Household_2_CA_3[2,2] + dcoef_household2$Household_2_CA_3[3,2] + dcoef_household2$Household_2_CA_3[4,2])

forecasts_household2_22$Household_2_CA_3_Low = forecasts_household2_22$Household_2_CA_3_pred - 1.96 * (dcoef_household2$Household_2_CA_3[1,2] + dcoef_household2$Household_2_CA_3[2,2] + dcoef_household2$Household_2_CA_3[3,2] + dcoef_household2$Household_2_CA_1[4,2])


plot(x, forecasts_household2_22$Household_2_CA_1, type = "l", frame = FALSE, pch = 19, col = "blue", xlab = "time", ylab = "Household 2 Store 1")
polygon(c(x,rev(x)),c(forecasts_household2_22$Household_2_CA_1_Low,rev(forecasts_household2_22$Household_2_CA_1_High)),col="thistle",border=NA)
lines(x, forecasts_household2_22$Household_2_CA_1, type = "l",  pch = 19, col = "blue")
lines(x, forecasts_household2_22$Household_2_CA_1_pred, pch = 18, col = "red", type = "l")
legend("bottomright", legend=c("Real", "Predicted", "C.I. 95%"),col=c("blue", "red","thistle"), lty = 1:1, cex=0.8)
title("Household 2 Store 1 - VAR Product Household 2")

plot(x, forecasts_household2_22$Household_2_CA_2, type = "l", frame = FALSE, pch = 19, col = "blue", xlab = "time", ylab = "Household 2 Store 2")
polygon(c(x,rev(x)),c(forecasts_household2_22$Household_2_CA_2_Low,rev(forecasts_household2_22$Household_2_CA_2_High)),col="thistle",border=NA)
lines(x, forecasts_household2_22$Household_2_CA_2, type = "l",  pch = 19, col = "blue")
lines(x, forecasts_household2_22$Household_2_CA_2_pred, pch = 18, col = "red", type = "l")
legend("bottomright", legend=c("Real", "Predicted", "C.I. 95%"),col=c("blue", "red","thistle"), lty = 1:1, cex=0.8)
title("Household 2 Store 2 - VAR Product Household 2")

plot(x, forecasts_household2_22$Household_2_CA_3, type = "l", frame = FALSE, pch = 19, col = "blue", xlab = "time", ylab = "Household 2 Store 3")
polygon(c(x,rev(x)),c(forecasts_household2_22$Household_2_CA_3_Low,rev(forecasts_household2_22$Household_2_CA_3_High)),col="thistle",border=NA)
lines(x, forecasts_household2_22$Household_2_CA_3, type = "l",  pch = 19, col = "blue")
lines(x, forecasts_household2_22$Household_2_CA_3_pred, pch = 18, col = "red", type = "l")
legend("bottomright", legend=c("Real", "Predicted", "C.I. 95%"),col=c("blue", "red","thistle"), lty = 1:1, cex=0.8)
title("Household 2 Store 3 - VAR Product Household 2")

```

### Foods 1:

```{r, echo=FALSE}

# plot the VAR time-series and estimates at 1-step 
length_x = test_sample-train_sample
x = 1:length_x

# Plot hobbies real vs predicted forecasts for each store

forecasts_foods1_22$Foods_1_CA_1_High = forecasts_foods1_22$Foods_1_CA_1_pred + 1.96 * (dcoef_foods1$Foods_1_CA_1[1,2] + dcoef_foods1$Foods_1_CA_1[2,2] + dcoef_foods1$Foods_1_CA_1[3,2] + dcoef_foods1$Foods_1_CA_1[4,2])

forecasts_foods1_22$Foods_1_CA_1_Low = forecasts_foods1_22$Foods_1_CA_1_pred - 1.96 * (dcoef_foods1$Foods_1_CA_1[1,2] + dcoef_foods1$Foods_1_CA_1[2,2] + dcoef_foods1$Foods_1_CA_1[3,2] + dcoef_foods1$Foods_1_CA_1[4,2])

forecasts_foods1_22$Foods_1_CA_2_High = forecasts_foods1_22$Foods_1_CA_2_pred + 1.96 * (dcoef_foods1$Foods_1_CA_2[1,2] + dcoef_foods1$Foods_1_CA_2[2,2] + dcoef_foods1$Foods_1_CA_2[3,2] + dcoef_foods1$Foods_1_CA_2[4,2])

forecasts_foods1_22$Foods_1_CA_2_Low = forecasts_foods1_22$Foods_1_CA_2_pred - 1.96 * (dcoef_foods1$Foods_1_CA_2[1,2] + dcoef_foods1$Foods_1_CA_2[2,2] + dcoef_foods1$Foods_1_CA_2[3,2] + dcoef_foods1$Foods_1_CA_2[4,2])

forecasts_foods1_22$Foods_1_CA_3_High = forecasts_foods1_22$Foods_1_CA_3_pred + 1.96 * (dcoef_foods1$Foods_1_CA_3[1,2] + dcoef_foods1$Foods_1_CA_3[2,2] + dcoef_foods1$Foods_1_CA_3[3,2] + dcoef_foods1$Foods_1_CA_3[4,2])

forecasts_foods1_22$Foods_1_CA_3_Low = forecasts_foods1_22$Foods_1_CA_3_pred - 1.96 * (dcoef_foods1$Foods_1_CA_3[1,2] + dcoef_foods1$Foods_1_CA_3[2,2] + dcoef_foods1$Foods_1_CA_3[3,2] + dcoef_foods1$Foods_1_CA_3[4,2])


plot(x, forecasts_foods1_22$Foods_1_CA_1, type = "l", frame = FALSE, pch = 19, col = "blue", xlab = "time", ylab = "Foods 1 Store 1")
polygon(c(x,rev(x)),c(forecasts_foods1_22$Foods_1_CA_1_Low,rev(forecasts_foods1_22$Foods_1_CA_1_High)),col="thistle",border=NA)
lines(x, forecasts_foods1_22$Foods_1_CA_1, type = "l",  pch = 19, col = "blue")
lines(x, forecasts_foods1_22$Foods_1_CA_1_pred, pch = 18, col = "red", type = "l")
legend("bottomright", legend=c("Real", "Predicted", "C.I. 95%"),col=c("blue", "red","thistle"), lty = 1:1, cex=0.8)
title("Foods 1 Store 1 - VAR Product Foods 1")

plot(x, forecasts_foods1_22$Foods_1_CA_2, type = "l", frame = FALSE, pch = 19, col = "blue", xlab = "time", ylab = "Foods 1 Store 2")
polygon(c(x,rev(x)),c(forecasts_foods1_22$Foods_1_CA_2_Low,rev(forecasts_foods1_22$Foods_1_CA_2_High)),col="thistle",border=NA)
lines(x, forecasts_foods1_22$Foods_1_CA_2, type = "l",  pch = 19, col = "blue")
lines(x, forecasts_foods1_22$Foods_1_CA_2_pred, pch = 18, col = "red", type = "l")
legend("bottomright", legend=c("Real", "Predicted", "C.I. 95%"),col=c("blue", "red","thistle"), lty = 1:1, cex=0.8)
title("Foods 1 Store 2 - VAR Product Foods 1")

plot(x, forecasts_foods1_22$Foods_1_CA_3, type = "l", frame = FALSE, pch = 19, col = "blue", xlab = "time", ylab = "Foods 1 Store 3")
polygon(c(x,rev(x)),c(forecasts_foods1_22$Foods_1_CA_3_Low,rev(forecasts_foods1_22$Foods_1_CA_3_High)),col="thistle",border=NA)
lines(x, forecasts_foods1_22$Foods_1_CA_3, type = "l",  pch = 19, col = "blue")
lines(x, forecasts_foods1_22$Foods_1_CA_3_pred, pch = 18, col = "red", type = "l")
legend("bottomright", legend=c("Real", "Predicted", "C.I. 95%"),col=c("blue", "red","thistle"), lty = 1:1, cex=0.8)
title("Foods 1 Store 3 - VAR Product Foods 1")

```

### Foods 2:

```{r, echo=FALSE}

# plot the VAR time-series and estimates at 1-step 
length_x = test_sample-train_sample
x = 1:length_x

# Plot hobbies real vs predicted forecasts for each store

forecasts_foods2_22$Foods_2_CA_1_High = forecasts_foods2_22$Foods_2_CA_1_pred + 1.96 * (dcoef_foods2$Foods_2_CA_1[1,2] + dcoef_foods2$Foods_2_CA_1[2,2] + dcoef_foods2$Foods_2_CA_1[3,2] + dcoef_foods2$Foods_2_CA_1[4,2])

forecasts_foods2_22$Foods_2_CA_1_Low = forecasts_foods2_22$Foods_2_CA_1_pred - 1.96 * (dcoef_foods2$Foods_2_CA_1[1,2] + dcoef_foods2$Foods_2_CA_1[2,2] + dcoef_foods2$Foods_2_CA_1[3,2] + dcoef_foods2$Foods_2_CA_1[4,2])

forecasts_foods2_22$Foods_2_CA_2_High = forecasts_foods2_22$Foods_2_CA_2_pred + 1.96 * (dcoef_foods2$Foods_2_CA_2[1,2] + dcoef_foods2$Foods_2_CA_2[2,2] + dcoef_foods2$Foods_2_CA_2[3,2] + dcoef_foods2$Foods_2_CA_2[4,2])

forecasts_foods2_22$Foods_2_CA_2_Low = forecasts_foods2_22$Foods_2_CA_2_pred - 1.96 * (dcoef_foods2$Foods_2_CA_2[1,2] + dcoef_foods2$Foods_2_CA_2[2,2] + dcoef_foods2$Foods_2_CA_2[3,2] + dcoef_foods2$Foods_2_CA_2[4,2])

forecasts_foods2_22$Foods_2_CA_3_High = forecasts_foods2_22$Foods_2_CA_3_pred + 1.96 * (dcoef_foods2$Foods_2_CA_3[1,2] + dcoef_foods2$Foods_2_CA_3[2,2] + dcoef_foods2$Foods_2_CA_3[3,2] + dcoef_foods2$Foods_2_CA_3[4,2])

forecasts_foods2_22$Foods_2_CA_3_Low = forecasts_foods2_22$Foods_2_CA_3_pred - 1.96 * (dcoef_foods2$Foods_2_CA_3[1,2] + dcoef_foods2$Foods_2_CA_3[2,2] + dcoef_foods2$Foods_2_CA_3[3,2] + dcoef_foods2$Foods_2_CA_3[4,2])


plot(x, forecasts_foods2_22$Foods_2_CA_1, type = "l", frame = FALSE, pch = 19, col = "blue", xlab = "time", ylab = "Foods 2 Store 1")
polygon(c(x,rev(x)),c(forecasts_foods2_22$Foods_2_CA_1_Low,rev(forecasts_foods2_22$Foods_2_CA_1_High)),col="thistle",border=NA)
lines(x, forecasts_foods2_22$Foods_2_CA_1, type = "l",  pch = 19, col = "blue")
lines(x, forecasts_foods2_22$Foods_2_CA_1_pred, pch = 18, col = "red", type = "l")
legend("bottomright", legend=c("Real", "Predicted", "C.I. 95%"),col=c("blue", "red","thistle"), lty = 1:1, cex=0.8)
title("Foods 2 Store 1 - VAR Product Foods 2")

plot(x, forecasts_foods2_22$Foods_2_CA_2, type = "l", frame = FALSE, pch = 19, col = "blue", xlab = "time", ylab = "Foods 2 Store 2")
polygon(c(x,rev(x)),c(forecasts_foods2_22$Foods_2_CA_2_Low,rev(forecasts_foods2_22$Foods_2_CA_2_High)),col="thistle",border=NA)
lines(x, forecasts_foods2_22$Foods_2_CA_2, type = "l",  pch = 19, col = "blue")
lines(x, forecasts_foods2_22$Foods_2_CA_2_pred, pch = 18, col = "red", type = "l")
legend("bottomright", legend=c("Real", "Predicted", "C.I. 95%"),col=c("blue", "red","thistle"), lty = 1:1, cex=0.8)
title("Foods 2 Store 2 - VAR Product Foods 2")

plot(x, forecasts_foods2_22$Foods_2_CA_3, type = "l", frame = FALSE, pch = 19, col = "blue", xlab = "time", ylab = "Foods 2 Store 3")
polygon(c(x,rev(x)),c(forecasts_foods2_22$Foods_2_CA_3_Low,rev(forecasts_foods2_22$Foods_2_CA_3_High)),col="thistle",border=NA)
lines(x, forecasts_foods2_22$Foods_2_CA_3, type = "l",  pch = 19, col = "blue")
lines(x, forecasts_foods2_22$Foods_2_CA_3_pred, pch = 18, col = "red", type = "l")
legend("bottomright", legend=c("Real", "Predicted", "C.I. 95%"),col=c("blue", "red","thistle"), lty = 1:1, cex=0.8)
title("Foods 2 Store 3 - VAR Product Foods 2")

```

### Foods 3:

```{r, echo=FALSE}

# plot the VAR time-series and estimates at 1-step 
length_x = test_sample-train_sample
x = 1:length_x

# Plot hobbies real vs predicted forecasts for each store

forecasts_foods3_22$Foods_3_CA_1_High = forecasts_foods3_22$Foods_3_CA_1_pred + 1.96 * (dcoef_foods3$Foods_3_CA_1[1,2] + dcoef_foods3$Foods_3_CA_1[2,2] + dcoef_foods3$Foods_3_CA_1[3,2] + dcoef_foods3$Foods_3_CA_1[4,2])

forecasts_foods3_22$Foods_3_CA_1_Low = forecasts_foods3_22$Foods_3_CA_1_pred - 1.96 * (dcoef_foods3$Foods_3_CA_1[1,2] + dcoef_foods3$Foods_3_CA_1[2,2] + dcoef_foods3$Foods_3_CA_1[3,2] + dcoef_foods3$Foods_3_CA_1[4,2])

forecasts_foods3_22$Foods_3_CA_2_High = forecasts_foods3_22$Foods_3_CA_2_pred + 1.96 * (dcoef_foods3$Foods_3_CA_2[1,2] + dcoef_foods3$Foods_3_CA_2[2,2] + dcoef_foods3$Foods_3_CA_2[3,2] + dcoef_foods3$Foods_3_CA_2[4,2])

forecasts_foods3_22$Foods_3_CA_2_Low = forecasts_foods3_22$Foods_3_CA_2_pred - 1.96 * (dcoef_foods3$Foods_3_CA_2[1,2] + dcoef_foods3$Foods_3_CA_2[2,2] + dcoef_foods3$Foods_3_CA_2[3,2] + dcoef_foods3$Foods_3_CA_2[4,2])

forecasts_foods3_22$Foods_3_CA_3_High = forecasts_foods3_22$Foods_3_CA_3_pred + 1.96 * (dcoef_foods3$Foods_3_CA_3[1,2] + dcoef_foods3$Foods_3_CA_3[2,2] + dcoef_foods3$Foods_3_CA_3[3,2] + dcoef_foods3$Foods_3_CA_3[4,2])

forecasts_foods3_22$Foods_3_CA_3_Low = forecasts_foods3_22$Foods_3_CA_3_pred - 1.96 * (dcoef_foods3$Foods_3_CA_3[1,2] + dcoef_foods3$Foods_3_CA_3[2,2] + dcoef_foods3$Foods_3_CA_3[3,2] + dcoef_foods3$Foods_3_CA_3[4,2])


plot(x, forecasts_foods3_22$Foods_3_CA_1, type = "l", frame = FALSE, pch = 19, col = "blue", xlab = "time", ylab = "Foods 3 Store 1")
polygon(c(x,rev(x)),c(forecasts_foods3_22$Foods_3_CA_1_Low,rev(forecasts_foods3_22$Foods_3_CA_1_High)),col="thistle",border=NA)
lines(x, forecasts_foods3_22$Foods_3_CA_1, type = "l",  pch = 19, col = "blue")
lines(x, forecasts_foods3_22$Foods_3_CA_1_pred, pch = 18, col = "red", type = "l")
legend("bottomright", legend=c("Real", "Predicted", "C.I. 95%"),col=c("blue", "red","thistle"), lty = 1:1, cex=0.8)
title("Foods 3 Store 1 - VAR Product Foods 3")

plot(x, forecasts_foods3_22$Foods_3_CA_2, type = "l", frame = FALSE, pch = 19, col = "blue", xlab = "time", ylab = "Foods 3 Store 2")
polygon(c(x,rev(x)),c(forecasts_foods3_22$Foods_3_CA_2_Low,rev(forecasts_foods3_22$Foods_3_CA_2_High)),col="thistle",border=NA)
lines(x, forecasts_foods3_22$Foods_3_CA_2, type = "l",  pch = 19, col = "blue")
lines(x, forecasts_foods3_22$Foods_3_CA_2_pred, pch = 18, col = "red", type = "l")
legend("bottomright", legend=c("Real", "Predicted", "C.I. 95%"),col=c("blue", "red","thistle"), lty = 1:1, cex=0.8)
title("Foods 3 Store 2 - VAR Product Foods 3")

plot(x, forecasts_foods3_22$Foods_3_CA_3, type = "l", frame = FALSE, pch = 19, col = "blue", xlab = "time", ylab = "Foods 3 Store 3")
polygon(c(x,rev(x)),c(forecasts_foods3_22$Foods_3_CA_3_Low,rev(forecasts_foods3_22$Foods_3_CA_3_High)),col="thistle",border=NA)
lines(x, forecasts_foods3_22$Foods_3_CA_3, type = "l",  pch = 19, col = "blue")
lines(x, forecasts_foods3_22$Foods_3_CA_3_pred, pch = 18, col = "red", type = "l")
legend("bottomright", legend=c("Real", "Predicted", "C.I. 95%"),col=c("blue", "red","thistle"), lty = 1:1, cex=0.8)
title("Foods 3 Store 3 - VAR Product Foods 3")

```

Finally this allows us to calculate the RMSSE for each variable. This will be compared at the end with the other two VAR models to conclude which one is best.


```{r}

# Save the RMSSE Results in a data frame
df_rmsse_CA_1_2yr[1, 2] = RMSSE(forecasts_hobbies_22$Hobbies_CA_1, forecasts_hobbies_22$Hobbies_CA_1_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_1_2yr[2, 2] = RMSSE(forecasts_household1_22$Household_1_CA_1, forecasts_household1_22$Household_1_CA_1_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_1_2yr[3, 2] = RMSSE(forecasts_household2_22$Household_2_CA_1, forecasts_household2_22$Household_2_CA_1_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_1_2yr[4, 2] = RMSSE(forecasts_foods1_22$Foods_1_CA_1, forecasts_foods1_22$Foods_1_CA_1_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_1_2yr[5, 2] = RMSSE(forecasts_foods2_22$Foods_2_CA_1, forecasts_foods2_22$Foods_2_CA_1_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_1_2yr[6, 2] = RMSSE(forecasts_foods3_22$Foods_3_CA_1, forecasts_foods3_22$Foods_3_CA_1_pred, scale = 1, na.rm = TRUE)

df_rmsse_CA_2_2yr[1, 2] = RMSSE(forecasts_hobbies_22$Hobbies_CA_2, forecasts_hobbies_22$Hobbies_CA_2_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_2_2yr[2, 2] = RMSSE(forecasts_household1_22$Household_1_CA_2, forecasts_household1_22$Household_1_CA_2_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_2_2yr[3, 2] = RMSSE(forecasts_household2_22$Household_2_CA_2, forecasts_household2_22$Household_2_CA_2_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_2_2yr[4, 2] = RMSSE(forecasts_foods1_22$Foods_1_CA_2, forecasts_foods1_22$Foods_1_CA_2_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_2_2yr[5, 2] = RMSSE(forecasts_foods2_22$Foods_2_CA_2, forecasts_foods2_22$Foods_2_CA_2_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_2_2yr[6, 2] = RMSSE(forecasts_foods3_22$Foods_3_CA_2, forecasts_foods3_22$Foods_3_CA_2_pred, scale = 1, na.rm = TRUE)

df_rmsse_CA_3_2yr[1, 2] = RMSSE(forecasts_hobbies_22$Hobbies_CA_3, forecasts_hobbies_22$Hobbies_CA_3_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_3_2yr[2, 2] = RMSSE(forecasts_household1_22$Household_1_CA_3, forecasts_household1_22$Household_1_CA_3_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_3_2yr[3, 2] = RMSSE(forecasts_household2_22$Household_2_CA_3, forecasts_household2_22$Household_2_CA_3_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_3_2yr[4, 2] = RMSSE(forecasts_foods1_22$Foods_1_CA_3, forecasts_foods1_22$Foods_1_CA_3_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_3_2yr[5, 2] = RMSSE(forecasts_foods2_22$Foods_2_CA_3, forecasts_foods2_22$Foods_2_CA_3_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_3_2yr[6, 2] = RMSSE(forecasts_foods3_22$Foods_3_CA_3, forecasts_foods3_22$Foods_3_CA_3_pred, scale = 1, na.rm = TRUE)

rownames(df_rmsse_CA_1_2yr) =  c("Hobbies","Household1","Household2","Foods1","Foods2","Foods3")
rownames(df_rmsse_CA_2_2yr) =  c("Hobbies","Household1","Household2","Foods1","Foods2","Foods3")
rownames(df_rmsse_CA_3_2yr) =  c("Hobbies","Household1","Household2","Foods1","Foods2","Foods3")

colnames(df_rmsse_CA_1_2yr) = c("var21","var22")
colnames(df_rmsse_CA_2_2yr) = c("var21","var22")
colnames(df_rmsse_CA_3_2yr) = c("var21","var22")

df_rmsse_CA_1_2yr
df_rmsse_CA_2_2yr
df_rmsse_CA_3_2yr

```


The RMSSE results show that compared to the store VARs, it performs better in certain products such as Hobbies.
The same analysis will be done for the other train-test splits to have a preliminary conclusion.

### Train-test split for data from 2011-2013 for training and 2014 for testing.

```{r, include=FALSE}

# Define the train-test split 703 is 2012-12-31 and 1068 for 2013-12-31
train_sample = 1068
test_sample = 1433

# Choose the columns for each store
# Extracting the columns of the CA_1 store and renaming them
df_hobbies = df[c('Hobbies_CA_1','Hobbies_CA_2','Hobbies_CA_3')]
df_household1 = df[c('Household_1_CA_1','Household_1_CA_2','Household_1_CA_3')]
df_household2 = df[c('Household_2_CA_1','Household_2_CA_2','Household_2_CA_3')]
df_foods1 = df[c('Foods_1_CA_1','Foods_1_CA_2','Foods_1_CA_3')]
df_foods2 = df[c('Foods_2_CA_1','Foods_2_CA_2','Foods_2_CA_3')]
df_foods3 = df[c('Foods_3_CA_1','Foods_3_CA_2','Foods_3_CA_3')]

df_hobbies_train = head(df_hobbies, train_sample)
df_hobbies_test  = head(df_hobbies, test_sample)
df_hobbies_test  = tail(df_hobbies_test, test_sample - train_sample)

df_household1_train = head(df_household1, train_sample)
df_household1_test  = head(df_household1, test_sample)
df_household1_test  = tail(df_household1_test, test_sample - train_sample)

df_household2_train = head(df_household2, train_sample)
df_household2_test  = head(df_household2, test_sample)
df_household2_test  = tail(df_household2_test, test_sample - train_sample)

df_foods1_train = head(df_foods1, train_sample)
df_foods1_test  = head(df_foods1, test_sample)
df_foods1_test  = tail(df_foods1_test, test_sample - train_sample)

df_foods2_train = head(df_foods2, train_sample)
df_foods2_test  = head(df_foods2, test_sample)
df_foods2_test  = tail(df_foods2_test, test_sample - train_sample)

df_foods3_train = head(df_foods3, train_sample)
df_foods3_test  = head(df_foods3, test_sample)
df_foods3_test  = tail(df_foods3_test, test_sample - train_sample)

var_hobbies_train = VAR(df_hobbies_train, p=1)
var_household1_train = VAR(df_household1_train, p=1)
var_household2_train = VAR(df_household2_train, p=1)
var_foods1_train = VAR(df_foods1_train, p=1)
var_foods2_train = VAR(df_foods2_train, p=1)
var_foods3_train = VAR(df_foods3_train, p=1)

dcoef_hobbies = coef(var_hobbies_train)
dcoef_household1 = coef(var_household1_train)
dcoef_household2 = coef(var_household2_train)
dcoef_foods1 = coef(var_foods1_train)
dcoef_foods2 = coef(var_foods2_train)
dcoef_foods3 = coef(var_foods3_train)

# iterate the number of test samples to predict using the var coefficients

length_sample = test_sample - train_sample
for (i in 1:length_sample) {
  if (i==1) {
    df_hobbies_test[i, 4] = dcoef_hobbies$Hobbies_CA_1[1]*df_hobbies_train[train_sample,1] + dcoef_hobbies$Hobbies_CA_1[2]*df_hobbies_train[train_sample,2] + dcoef_hobbies$Hobbies_CA_1[3]*df_hobbies_train[train_sample,3]+ dcoef_hobbies$Hobbies_CA_1[4]
    df_hobbies_test[i, 5] = dcoef_hobbies$Hobbies_CA_2[1]*df_hobbies_train[train_sample,1] + dcoef_hobbies$Hobbies_CA_2[2]*df_hobbies_train[train_sample,2] + dcoef_hobbies$Hobbies_CA_2[3]*df_hobbies_train[train_sample,3]+ dcoef_hobbies$Hobbies_CA_2[4]
    df_hobbies_test[i, 6] = dcoef_hobbies$Hobbies_CA_3[1]*df_hobbies_train[train_sample,1] + dcoef_hobbies$Hobbies_CA_3[2]*df_hobbies_train[train_sample,2] + dcoef_hobbies$Hobbies_CA_3[3]*df_hobbies_train[train_sample,3]+ dcoef_hobbies$Hobbies_CA_3[4]

    df_household1_test[i, 4] = dcoef_household1$Household_1_CA_1[1]*df_household1_train[train_sample,1] + dcoef_household1$Household_1_CA_1[2]*df_household1_train[train_sample,2] + dcoef_household1$Household_1_CA_1[3]*df_household1_train[train_sample,3]+ dcoef_household1$Household_1_CA_1[4]
    df_household1_test[i, 5] = dcoef_household1$Household_1_CA_2[1]*df_household1_train[train_sample,1] + dcoef_household1$Household_1_CA_2[2]*df_household1_train[train_sample,2] + dcoef_household1$Household_1_CA_2[3]*df_household1_train[train_sample,3]+ dcoef_household1$Household_1_CA_2[4]
    df_household1_test[i, 6] = dcoef_household1$Household_1_CA_3[1]*df_household1_train[train_sample,1] + dcoef_household1$Household_1_CA_3[2]*df_household1_train[train_sample,2] + dcoef_household1$Household_1_CA_3[3]*df_household1_train[train_sample,3]+ dcoef_household1$Household_1_CA_3[4]
    
    df_household2_test[i, 4] = dcoef_household2$Household_2_CA_1[1]*df_household2_train[train_sample,1] + dcoef_household2$Household_2_CA_1[2]*df_household2_train[train_sample,2] + dcoef_household2$Household_2_CA_1[3]*df_household2_train[train_sample,3]+ dcoef_household2$Household_2_CA_1[4]
    df_household2_test[i, 5] = dcoef_household2$Household_2_CA_2[1]*df_household2_train[train_sample,1] + dcoef_household2$Household_2_CA_2[2]*df_household2_train[train_sample,2] + dcoef_household2$Household_2_CA_2[3]*df_household2_train[train_sample,3]+ dcoef_household2$Household_2_CA_2[4]
    df_household2_test[i, 6] = dcoef_household2$Household_2_CA_3[1]*df_household2_train[train_sample,1] + dcoef_household2$Household_2_CA_3[2]*df_household2_train[train_sample,2] + dcoef_household2$Household_2_CA_3[3]*df_household2_train[train_sample,3]+ dcoef_household2$Household_2_CA_3[4]
    
    df_foods1_test[i, 4] = dcoef_foods1$Foods_1_CA_1[1]*df_foods1_train[train_sample,1] + dcoef_foods1$Foods_1_CA_1[2]*df_foods1_train[train_sample,2] + dcoef_foods1$Foods_1_CA_1[3]*df_foods1_train[train_sample,3]+ dcoef_foods1$Foods_1_CA_1[4]
    df_foods1_test[i, 5] = dcoef_foods1$Foods_1_CA_2[1]*df_foods1_train[train_sample,1] + dcoef_foods1$Foods_1_CA_2[2]*df_foods1_train[train_sample,2] + dcoef_foods1$Foods_1_CA_2[3]*df_foods1_train[train_sample,3]+ dcoef_foods1$Foods_1_CA_2[4]
    df_foods1_test[i, 6] = dcoef_foods1$Foods_1_CA_3[1]*df_foods1_train[train_sample,1] + dcoef_foods1$Foods_1_CA_3[2]*df_foods1_train[train_sample,2] + dcoef_foods1$Foods_1_CA_3[3]*df_foods1_train[train_sample,3]+ dcoef_foods1$Foods_1_CA_3[4]
    
    df_foods2_test[i, 4] = dcoef_foods2$Foods_2_CA_1[1]*df_foods2_train[train_sample,1] + dcoef_foods2$Foods_2_CA_1[2]*df_foods2_train[train_sample,2] + dcoef_foods2$Foods_2_CA_1[3]*df_foods2_train[train_sample,3]+ dcoef_foods2$Foods_2_CA_1[4]
    df_foods2_test[i, 5] = dcoef_foods2$Foods_2_CA_2[1]*df_foods2_train[train_sample,1] + dcoef_foods2$Foods_2_CA_2[2]*df_foods2_train[train_sample,2] + dcoef_foods2$Foods_2_CA_2[3]*df_foods2_train[train_sample,3]+ dcoef_foods2$Foods_2_CA_2[4]
    df_foods2_test[i, 6] = dcoef_foods2$Foods_2_CA_3[1]*df_foods2_train[train_sample,1] + dcoef_foods2$Foods_2_CA_3[2]*df_foods2_train[train_sample,2] + dcoef_foods2$Foods_2_CA_3[3]*df_foods2_train[train_sample,3]+ dcoef_foods2$Foods_2_CA_3[4]
    
    df_foods3_test[i, 4] = dcoef_foods3$Foods_3_CA_1[1]*df_foods3_train[train_sample,1] + dcoef_foods3$Foods_3_CA_1[2]*df_foods3_train[train_sample,2] + dcoef_foods3$Foods_3_CA_1[3]*df_foods3_train[train_sample,3]+ dcoef_foods3$Foods_3_CA_1[4]
    df_foods3_test[i, 5] = dcoef_foods3$Foods_3_CA_2[1]*df_foods3_train[train_sample,1] + dcoef_foods3$Foods_3_CA_2[2]*df_foods3_train[train_sample,2] + dcoef_foods3$Foods_3_CA_2[3]*df_foods3_train[train_sample,3]+ dcoef_foods3$Foods_3_CA_2[4]
    df_foods3_test[i, 6] = dcoef_foods3$Foods_3_CA_3[1]*df_foods3_train[train_sample,1] + dcoef_foods3$Foods_3_CA_3[2]*df_foods3_train[train_sample,2] + dcoef_foods3$Foods_3_CA_3[3]*df_foods3_train[train_sample,3]+ dcoef_foods3$Foods_3_CA_3[4]
    
    
  }
  else {

    df_hobbies_test[i, 4] = dcoef_hobbies$Hobbies_CA_1[1]*df_hobbies_test[i-1,1] + dcoef_hobbies$Hobbies_CA_1[2]*df_hobbies_test[i-1,2] + dcoef_hobbies$Hobbies_CA_1[3]*df_hobbies_test[i-1,3]+ dcoef_hobbies$Hobbies_CA_1[4]
    df_hobbies_test[i, 5] = dcoef_hobbies$Hobbies_CA_2[1]*df_hobbies_test[i-1,1] + dcoef_hobbies$Hobbies_CA_2[2]*df_hobbies_test[i-1,2] + dcoef_hobbies$Hobbies_CA_2[3]*df_hobbies_test[i-1,3]+ dcoef_hobbies$Hobbies_CA_2[4]
    df_hobbies_test[i, 6] = dcoef_hobbies$Hobbies_CA_3[1]*df_hobbies_test[i-1,1] + dcoef_hobbies$Hobbies_CA_3[2]*df_hobbies_test[i-1,2] + dcoef_hobbies$Hobbies_CA_3[3]*df_hobbies_test[i-1,3]+ dcoef_hobbies$Hobbies_CA_3[4]
    
    df_household1_test[i, 4] = dcoef_household1$Household_1_CA_1[1]*df_household1_test[i-1,1] + dcoef_household1$Household_1_CA_1[2]*df_household1_test[i-1,2] + dcoef_household1$Household_1_CA_1[3]*df_household1_test[i-1,3]+ dcoef_household1$Household_1_CA_1[4]
    df_household1_test[i, 5] = dcoef_household1$Household_1_CA_2[1]*df_household1_test[i-1,1] + dcoef_household1$Household_1_CA_2[2]*df_household1_test[i-1,2] + dcoef_household1$Household_1_CA_2[3]*df_household1_test[i-1,3]+ dcoef_household1$Household_1_CA_2[4]
    df_household1_test[i, 6] = dcoef_household1$Household_1_CA_3[1]*df_household1_test[i-1,1] + dcoef_household1$Household_1_CA_3[2]*df_household1_test[i-1,2] + dcoef_household1$Household_1_CA_3[3]*df_household1_test[i-1,3]+ dcoef_household1$Household_1_CA_3[4]
    
    df_household2_test[i, 4] = dcoef_household2$Household_2_CA_1[1]*df_household2_test[i-1,1] + dcoef_household2$Household_2_CA_1[2]*df_household2_test[i-1,2] + dcoef_household2$Household_2_CA_1[3]*df_household2_test[i-1,3]+ dcoef_household2$Household_2_CA_1[4]
    df_household2_test[i, 5] = dcoef_household2$Household_2_CA_2[1]*df_household2_test[i-1,1] + dcoef_household2$Household_2_CA_2[2]*df_household2_test[i-1,2] + dcoef_household2$Household_2_CA_2[3]*df_household2_test[i-1,3]+ dcoef_household2$Household_2_CA_2[4]
    df_household2_test[i, 6] = dcoef_household2$Household_2_CA_3[1]*df_household2_test[i-1,1] + dcoef_household2$Household_2_CA_3[2]*df_household2_test[i-1,2] + dcoef_household2$Household_2_CA_3[3]*df_household2_test[i-1,3]+ dcoef_household2$Household_2_CA_3[4]
    
    df_foods1_test[i, 4] = dcoef_foods1$Foods_1_CA_1[1]*df_foods1_test[i-1,1] + dcoef_foods1$Foods_1_CA_1[2]*df_foods1_test[i-1,2] + dcoef_foods1$Foods_1_CA_1[3]*df_foods1_test[i-1,3]+ dcoef_foods1$Foods_1_CA_1[4]
    df_foods1_test[i, 5] = dcoef_foods1$Foods_1_CA_2[1]*df_foods1_test[i-1,1] + dcoef_foods1$Foods_1_CA_2[2]*df_foods1_test[i-1,2] + dcoef_foods1$Foods_1_CA_2[3]*df_foods1_test[i-1,3]+ dcoef_foods1$Foods_1_CA_2[4]
    df_foods1_test[i, 6] = dcoef_foods1$Foods_1_CA_3[1]*df_foods1_test[i-1,1] + dcoef_foods1$Foods_1_CA_3[2]*df_foods1_test[i-1,2] + dcoef_foods1$Foods_1_CA_3[3]*df_foods1_test[i-1,3]+ dcoef_foods1$Foods_1_CA_3[4]    
    
    df_foods2_test[i, 4] = dcoef_foods2$Foods_2_CA_1[1]*df_foods2_test[i-1,1] + dcoef_foods2$Foods_2_CA_1[2]*df_foods2_test[i-1,2] + dcoef_foods2$Foods_2_CA_1[3]*df_foods2_test[i-1,3]+ dcoef_foods2$Foods_2_CA_1[4]
    df_foods2_test[i, 5] = dcoef_foods2$Foods_2_CA_2[1]*df_foods2_test[i-1,1] + dcoef_foods2$Foods_2_CA_2[2]*df_foods2_test[i-1,2] + dcoef_foods2$Foods_2_CA_2[3]*df_foods2_test[i-1,3]+ dcoef_foods2$Foods_2_CA_2[4]
    df_foods2_test[i, 6] = dcoef_foods2$Foods_2_CA_3[1]*df_foods2_test[i-1,1] + dcoef_foods2$Foods_2_CA_3[2]*df_foods2_test[i-1,2] + dcoef_foods2$Foods_2_CA_3[3]*df_foods2_test[i-1,3]+ dcoef_foods2$Foods_2_CA_3[4]    
    
    df_foods3_test[i, 4] = dcoef_foods3$Foods_3_CA_1[1]*df_foods3_test[i-1,1] + dcoef_foods3$Foods_3_CA_1[2]*df_foods3_test[i-1,2] + dcoef_foods3$Foods_3_CA_1[3]*df_foods3_test[i-1,3]+ dcoef_foods3$Foods_3_CA_1[4]
    df_foods3_test[i, 5] = dcoef_foods3$Foods_3_CA_2[1]*df_foods3_test[i-1,1] + dcoef_foods3$Foods_3_CA_2[2]*df_foods3_test[i-1,2] + dcoef_foods3$Foods_3_CA_2[3]*df_foods3_test[i-1,3]+ dcoef_foods3$Foods_3_CA_2[4]
    df_foods3_test[i, 6] = dcoef_foods3$Foods_3_CA_3[1]*df_foods3_test[i-1,1] + dcoef_foods3$Foods_3_CA_3[2]*df_foods3_test[i-1,2] + dcoef_foods3$Foods_3_CA_3[3]*df_foods3_test[i-1,3]+ dcoef_foods3$Foods_3_CA_3[4]    
    
  }
}

  

colnames(df_hobbies_test) = c('Hobbies_CA_1','Hobbies_CA_2','Hobbies_CA_3'
                           ,'Hobbies_CA_1_pred','Hobbies_CA_2_pred','Hobbies_CA_3_pred')

colnames(df_household1_test) = c('Household_1_CA_1','Household_1_CA_2','Household_1_CA_3'
                              ,'Household_1_CA_1_pred','Household_1_CA_2_pred','Household_1_CA_3_pred')

colnames(df_household2_test) = c('Household_2_CA_1','Household_2_CA_2','Household_2_CA_3'
                                 ,'Household_2_CA_1_pred','Household_2_CA_2_pred','Household_2_CA_3_pred')

colnames(df_foods1_test) = c('Foods_1_CA_1','Foods_1_CA_2','Foods_1_CA_3'
                                 ,'Foods_1_CA_1_pred','Foods_1_CA_2_pred','Foods_1_CA_3_pred')

colnames(df_foods2_test) = c('Foods_2_CA_1','Foods_2_CA_2','Foods_2_CA_3'
                             ,'Foods_2_CA_1_pred','Foods_2_CA_2_pred','Foods_2_CA_3_pred')

colnames(df_foods3_test) = c('Foods_3_CA_1','Foods_3_CA_2','Foods_3_CA_3'
                             ,'Foods_3_CA_1_pred','Foods_3_CA_2_pred','Foods_3_CA_3_pred')


forecasts_hobbies_22 = df_hobbies_test
forecasts_household1_22 = df_household1_test
forecasts_household2_22 = df_household2_test
forecasts_foods1_22 = df_foods1_test
forecasts_foods2_22 = df_foods2_test
forecasts_foods3_22 = df_foods3_test

# Save the RMSSE Results in a data frame
df_rmsse_CA_1_3yr[1, 2] = RMSSE(forecasts_hobbies_22$Hobbies_CA_1, forecasts_hobbies_22$Hobbies_CA_1_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_1_3yr[2, 2] = RMSSE(forecasts_household1_22$Household_1_CA_1, forecasts_household1_22$Household_1_CA_1_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_1_3yr[3, 2] = RMSSE(forecasts_household2_22$Household_2_CA_1, forecasts_household2_22$Household_2_CA_1_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_1_3yr[4, 2] = RMSSE(forecasts_foods1_22$Foods_1_CA_1, forecasts_foods1_22$Foods_1_CA_1_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_1_3yr[5, 2] = RMSSE(forecasts_foods2_22$Foods_2_CA_1, forecasts_foods2_22$Foods_2_CA_1_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_1_3yr[6, 2] = RMSSE(forecasts_foods3_22$Foods_3_CA_1, forecasts_foods3_22$Foods_3_CA_1_pred, scale = 1, na.rm = TRUE)

df_rmsse_CA_2_3yr[1, 2] = RMSSE(forecasts_hobbies_22$Hobbies_CA_2, forecasts_hobbies_22$Hobbies_CA_2_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_2_3yr[2, 2] = RMSSE(forecasts_household1_22$Household_1_CA_2, forecasts_household1_22$Household_1_CA_2_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_2_3yr[3, 2] = RMSSE(forecasts_household2_22$Household_2_CA_2, forecasts_household2_22$Household_2_CA_2_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_2_3yr[4, 2] = RMSSE(forecasts_foods1_22$Foods_1_CA_2, forecasts_foods1_22$Foods_1_CA_2_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_2_3yr[5, 2] = RMSSE(forecasts_foods2_22$Foods_2_CA_2, forecasts_foods2_22$Foods_2_CA_2_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_2_3yr[6, 2] = RMSSE(forecasts_foods3_22$Foods_3_CA_2, forecasts_foods3_22$Foods_3_CA_2_pred, scale = 1, na.rm = TRUE)

df_rmsse_CA_3_3yr[1, 2] = RMSSE(forecasts_hobbies_22$Hobbies_CA_3, forecasts_hobbies_22$Hobbies_CA_3_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_3_3yr[2, 2] = RMSSE(forecasts_household1_22$Household_1_CA_3, forecasts_household1_22$Household_1_CA_3_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_3_3yr[3, 2] = RMSSE(forecasts_household2_22$Household_2_CA_3, forecasts_household2_22$Household_2_CA_3_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_3_3yr[4, 2] = RMSSE(forecasts_foods1_22$Foods_1_CA_3, forecasts_foods1_22$Foods_1_CA_3_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_3_3yr[5, 2] = RMSSE(forecasts_foods2_22$Foods_2_CA_3, forecasts_foods2_22$Foods_2_CA_3_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_3_3yr[6, 2] = RMSSE(forecasts_foods3_22$Foods_3_CA_3, forecasts_foods3_22$Foods_3_CA_3_pred, scale = 1, na.rm = TRUE)

rownames(df_rmsse_CA_1_3yr) =  c("Hobbies","Household1","Household2","Foods1","Foods2","Foods3")
rownames(df_rmsse_CA_2_3yr) =  c("Hobbies","Household1","Household2","Foods1","Foods2","Foods3")
rownames(df_rmsse_CA_3_3yr) =  c("Hobbies","Household1","Household2","Foods1","Foods2","Foods3")

colnames(df_rmsse_CA_1_3yr) = c("var21","var22")
colnames(df_rmsse_CA_2_3yr) = c("var21","var22")
colnames(df_rmsse_CA_3_3yr) = c("var21","var22")


```

```{r}

df_rmsse_CA_1_3yr
df_rmsse_CA_2_3yr
df_rmsse_CA_3_3yr

```

### Train-test split for data from 2011-2014 for training and 2015 for testing.

```{r, include=FALSE}

# Define the train-test split 703 is 2012-12-31 and 1068 for 2013-12-31
train_sample = 1433
test_sample = 1798

# Choose the columns for each store
# Extracting the columns of the CA_1 store and renaming them
df_hobbies = df[c('Hobbies_CA_1','Hobbies_CA_2','Hobbies_CA_3')]
df_household1 = df[c('Household_1_CA_1','Household_1_CA_2','Household_1_CA_3')]
df_household2 = df[c('Household_2_CA_1','Household_2_CA_2','Household_2_CA_3')]
df_foods1 = df[c('Foods_1_CA_1','Foods_1_CA_2','Foods_1_CA_3')]
df_foods2 = df[c('Foods_2_CA_1','Foods_2_CA_2','Foods_2_CA_3')]
df_foods3 = df[c('Foods_3_CA_1','Foods_3_CA_2','Foods_3_CA_3')]

df_hobbies_train = head(df_hobbies, train_sample)
df_hobbies_test  = head(df_hobbies, test_sample)
df_hobbies_test  = tail(df_hobbies_test, test_sample - train_sample)

df_household1_train = head(df_household1, train_sample)
df_household1_test  = head(df_household1, test_sample)
df_household1_test  = tail(df_household1_test, test_sample - train_sample)

df_household2_train = head(df_household2, train_sample)
df_household2_test  = head(df_household2, test_sample)
df_household2_test  = tail(df_household2_test, test_sample - train_sample)

df_foods1_train = head(df_foods1, train_sample)
df_foods1_test  = head(df_foods1, test_sample)
df_foods1_test  = tail(df_foods1_test, test_sample - train_sample)

df_foods2_train = head(df_foods2, train_sample)
df_foods2_test  = head(df_foods2, test_sample)
df_foods2_test  = tail(df_foods2_test, test_sample - train_sample)

df_foods3_train = head(df_foods3, train_sample)
df_foods3_test  = head(df_foods3, test_sample)
df_foods3_test  = tail(df_foods3_test, test_sample - train_sample)

var_hobbies_train = VAR(df_hobbies_train, p=1)
var_household1_train = VAR(df_household1_train, p=1)
var_household2_train = VAR(df_household2_train, p=1)
var_foods1_train = VAR(df_foods1_train, p=1)
var_foods2_train = VAR(df_foods2_train, p=1)
var_foods3_train = VAR(df_foods3_train, p=1)

dcoef_hobbies = coef(var_hobbies_train)
dcoef_household1 = coef(var_household1_train)
dcoef_household2 = coef(var_household2_train)
dcoef_foods1 = coef(var_foods1_train)
dcoef_foods2 = coef(var_foods2_train)
dcoef_foods3 = coef(var_foods3_train)

# iterate the number of test samples to predict using the var coefficients

length_sample = test_sample - train_sample
for (i in 1:length_sample) {
  if (i==1) {
    df_hobbies_test[i, 4] = dcoef_hobbies$Hobbies_CA_1[1]*df_hobbies_train[train_sample,1] + dcoef_hobbies$Hobbies_CA_1[2]*df_hobbies_train[train_sample,2] + dcoef_hobbies$Hobbies_CA_1[3]*df_hobbies_train[train_sample,3]+ dcoef_hobbies$Hobbies_CA_1[4]
    df_hobbies_test[i, 5] = dcoef_hobbies$Hobbies_CA_2[1]*df_hobbies_train[train_sample,1] + dcoef_hobbies$Hobbies_CA_2[2]*df_hobbies_train[train_sample,2] + dcoef_hobbies$Hobbies_CA_2[3]*df_hobbies_train[train_sample,3]+ dcoef_hobbies$Hobbies_CA_2[4]
    df_hobbies_test[i, 6] = dcoef_hobbies$Hobbies_CA_3[1]*df_hobbies_train[train_sample,1] + dcoef_hobbies$Hobbies_CA_3[2]*df_hobbies_train[train_sample,2] + dcoef_hobbies$Hobbies_CA_3[3]*df_hobbies_train[train_sample,3]+ dcoef_hobbies$Hobbies_CA_3[4]

    df_household1_test[i, 4] = dcoef_household1$Household_1_CA_1[1]*df_household1_train[train_sample,1] + dcoef_household1$Household_1_CA_1[2]*df_household1_train[train_sample,2] + dcoef_household1$Household_1_CA_1[3]*df_household1_train[train_sample,3]+ dcoef_household1$Household_1_CA_1[4]
    df_household1_test[i, 5] = dcoef_household1$Household_1_CA_2[1]*df_household1_train[train_sample,1] + dcoef_household1$Household_1_CA_2[2]*df_household1_train[train_sample,2] + dcoef_household1$Household_1_CA_2[3]*df_household1_train[train_sample,3]+ dcoef_household1$Household_1_CA_2[4]
    df_household1_test[i, 6] = dcoef_household1$Household_1_CA_3[1]*df_household1_train[train_sample,1] + dcoef_household1$Household_1_CA_3[2]*df_household1_train[train_sample,2] + dcoef_household1$Household_1_CA_3[3]*df_household1_train[train_sample,3]+ dcoef_household1$Household_1_CA_3[4]
    
    df_household2_test[i, 4] = dcoef_household2$Household_2_CA_1[1]*df_household2_train[train_sample,1] + dcoef_household2$Household_2_CA_1[2]*df_household2_train[train_sample,2] + dcoef_household2$Household_2_CA_1[3]*df_household2_train[train_sample,3]+ dcoef_household2$Household_2_CA_1[4]
    df_household2_test[i, 5] = dcoef_household2$Household_2_CA_2[1]*df_household2_train[train_sample,1] + dcoef_household2$Household_2_CA_2[2]*df_household2_train[train_sample,2] + dcoef_household2$Household_2_CA_2[3]*df_household2_train[train_sample,3]+ dcoef_household2$Household_2_CA_2[4]
    df_household2_test[i, 6] = dcoef_household2$Household_2_CA_3[1]*df_household2_train[train_sample,1] + dcoef_household2$Household_2_CA_3[2]*df_household2_train[train_sample,2] + dcoef_household2$Household_2_CA_3[3]*df_household2_train[train_sample,3]+ dcoef_household2$Household_2_CA_3[4]
    
    df_foods1_test[i, 4] = dcoef_foods1$Foods_1_CA_1[1]*df_foods1_train[train_sample,1] + dcoef_foods1$Foods_1_CA_1[2]*df_foods1_train[train_sample,2] + dcoef_foods1$Foods_1_CA_1[3]*df_foods1_train[train_sample,3]+ dcoef_foods1$Foods_1_CA_1[4]
    df_foods1_test[i, 5] = dcoef_foods1$Foods_1_CA_2[1]*df_foods1_train[train_sample,1] + dcoef_foods1$Foods_1_CA_2[2]*df_foods1_train[train_sample,2] + dcoef_foods1$Foods_1_CA_2[3]*df_foods1_train[train_sample,3]+ dcoef_foods1$Foods_1_CA_2[4]
    df_foods1_test[i, 6] = dcoef_foods1$Foods_1_CA_3[1]*df_foods1_train[train_sample,1] + dcoef_foods1$Foods_1_CA_3[2]*df_foods1_train[train_sample,2] + dcoef_foods1$Foods_1_CA_3[3]*df_foods1_train[train_sample,3]+ dcoef_foods1$Foods_1_CA_3[4]
    
    df_foods2_test[i, 4] = dcoef_foods2$Foods_2_CA_1[1]*df_foods2_train[train_sample,1] + dcoef_foods2$Foods_2_CA_1[2]*df_foods2_train[train_sample,2] + dcoef_foods2$Foods_2_CA_1[3]*df_foods2_train[train_sample,3]+ dcoef_foods2$Foods_2_CA_1[4]
    df_foods2_test[i, 5] = dcoef_foods2$Foods_2_CA_2[1]*df_foods2_train[train_sample,1] + dcoef_foods2$Foods_2_CA_2[2]*df_foods2_train[train_sample,2] + dcoef_foods2$Foods_2_CA_2[3]*df_foods2_train[train_sample,3]+ dcoef_foods2$Foods_2_CA_2[4]
    df_foods2_test[i, 6] = dcoef_foods2$Foods_2_CA_3[1]*df_foods2_train[train_sample,1] + dcoef_foods2$Foods_2_CA_3[2]*df_foods2_train[train_sample,2] + dcoef_foods2$Foods_2_CA_3[3]*df_foods2_train[train_sample,3]+ dcoef_foods2$Foods_2_CA_3[4]
    
    df_foods3_test[i, 4] = dcoef_foods3$Foods_3_CA_1[1]*df_foods3_train[train_sample,1] + dcoef_foods3$Foods_3_CA_1[2]*df_foods3_train[train_sample,2] + dcoef_foods3$Foods_3_CA_1[3]*df_foods3_train[train_sample,3]+ dcoef_foods3$Foods_3_CA_1[4]
    df_foods3_test[i, 5] = dcoef_foods3$Foods_3_CA_2[1]*df_foods3_train[train_sample,1] + dcoef_foods3$Foods_3_CA_2[2]*df_foods3_train[train_sample,2] + dcoef_foods3$Foods_3_CA_2[3]*df_foods3_train[train_sample,3]+ dcoef_foods3$Foods_3_CA_2[4]
    df_foods3_test[i, 6] = dcoef_foods3$Foods_3_CA_3[1]*df_foods3_train[train_sample,1] + dcoef_foods3$Foods_3_CA_3[2]*df_foods3_train[train_sample,2] + dcoef_foods3$Foods_3_CA_3[3]*df_foods3_train[train_sample,3]+ dcoef_foods3$Foods_3_CA_3[4]
    
    
  }
  else {

    df_hobbies_test[i, 4] = dcoef_hobbies$Hobbies_CA_1[1]*df_hobbies_test[i-1,1] + dcoef_hobbies$Hobbies_CA_1[2]*df_hobbies_test[i-1,2] + dcoef_hobbies$Hobbies_CA_1[3]*df_hobbies_test[i-1,3]+ dcoef_hobbies$Hobbies_CA_1[4]
    df_hobbies_test[i, 5] = dcoef_hobbies$Hobbies_CA_2[1]*df_hobbies_test[i-1,1] + dcoef_hobbies$Hobbies_CA_2[2]*df_hobbies_test[i-1,2] + dcoef_hobbies$Hobbies_CA_2[3]*df_hobbies_test[i-1,3]+ dcoef_hobbies$Hobbies_CA_2[4]
    df_hobbies_test[i, 6] = dcoef_hobbies$Hobbies_CA_3[1]*df_hobbies_test[i-1,1] + dcoef_hobbies$Hobbies_CA_3[2]*df_hobbies_test[i-1,2] + dcoef_hobbies$Hobbies_CA_3[3]*df_hobbies_test[i-1,3]+ dcoef_hobbies$Hobbies_CA_3[4]
    
    df_household1_test[i, 4] = dcoef_household1$Household_1_CA_1[1]*df_household1_test[i-1,1] + dcoef_household1$Household_1_CA_1[2]*df_household1_test[i-1,2] + dcoef_household1$Household_1_CA_1[3]*df_household1_test[i-1,3]+ dcoef_household1$Household_1_CA_1[4]
    df_household1_test[i, 5] = dcoef_household1$Household_1_CA_2[1]*df_household1_test[i-1,1] + dcoef_household1$Household_1_CA_2[2]*df_household1_test[i-1,2] + dcoef_household1$Household_1_CA_2[3]*df_household1_test[i-1,3]+ dcoef_household1$Household_1_CA_2[4]
    df_household1_test[i, 6] = dcoef_household1$Household_1_CA_3[1]*df_household1_test[i-1,1] + dcoef_household1$Household_1_CA_3[2]*df_household1_test[i-1,2] + dcoef_household1$Household_1_CA_3[3]*df_household1_test[i-1,3]+ dcoef_household1$Household_1_CA_3[4]
    
    df_household2_test[i, 4] = dcoef_household2$Household_2_CA_1[1]*df_household2_test[i-1,1] + dcoef_household2$Household_2_CA_1[2]*df_household2_test[i-1,2] + dcoef_household2$Household_2_CA_1[3]*df_household2_test[i-1,3]+ dcoef_household2$Household_2_CA_1[4]
    df_household2_test[i, 5] = dcoef_household2$Household_2_CA_2[1]*df_household2_test[i-1,1] + dcoef_household2$Household_2_CA_2[2]*df_household2_test[i-1,2] + dcoef_household2$Household_2_CA_2[3]*df_household2_test[i-1,3]+ dcoef_household2$Household_2_CA_2[4]
    df_household2_test[i, 6] = dcoef_household2$Household_2_CA_3[1]*df_household2_test[i-1,1] + dcoef_household2$Household_2_CA_3[2]*df_household2_test[i-1,2] + dcoef_household2$Household_2_CA_3[3]*df_household2_test[i-1,3]+ dcoef_household2$Household_2_CA_3[4]
    
    df_foods1_test[i, 4] = dcoef_foods1$Foods_1_CA_1[1]*df_foods1_test[i-1,1] + dcoef_foods1$Foods_1_CA_1[2]*df_foods1_test[i-1,2] + dcoef_foods1$Foods_1_CA_1[3]*df_foods1_test[i-1,3]+ dcoef_foods1$Foods_1_CA_1[4]
    df_foods1_test[i, 5] = dcoef_foods1$Foods_1_CA_2[1]*df_foods1_test[i-1,1] + dcoef_foods1$Foods_1_CA_2[2]*df_foods1_test[i-1,2] + dcoef_foods1$Foods_1_CA_2[3]*df_foods1_test[i-1,3]+ dcoef_foods1$Foods_1_CA_2[4]
    df_foods1_test[i, 6] = dcoef_foods1$Foods_1_CA_3[1]*df_foods1_test[i-1,1] + dcoef_foods1$Foods_1_CA_3[2]*df_foods1_test[i-1,2] + dcoef_foods1$Foods_1_CA_3[3]*df_foods1_test[i-1,3]+ dcoef_foods1$Foods_1_CA_3[4]    
    
    df_foods2_test[i, 4] = dcoef_foods2$Foods_2_CA_1[1]*df_foods2_test[i-1,1] + dcoef_foods2$Foods_2_CA_1[2]*df_foods2_test[i-1,2] + dcoef_foods2$Foods_2_CA_1[3]*df_foods2_test[i-1,3]+ dcoef_foods2$Foods_2_CA_1[4]
    df_foods2_test[i, 5] = dcoef_foods2$Foods_2_CA_2[1]*df_foods2_test[i-1,1] + dcoef_foods2$Foods_2_CA_2[2]*df_foods2_test[i-1,2] + dcoef_foods2$Foods_2_CA_2[3]*df_foods2_test[i-1,3]+ dcoef_foods2$Foods_2_CA_2[4]
    df_foods2_test[i, 6] = dcoef_foods2$Foods_2_CA_3[1]*df_foods2_test[i-1,1] + dcoef_foods2$Foods_2_CA_3[2]*df_foods2_test[i-1,2] + dcoef_foods2$Foods_2_CA_3[3]*df_foods2_test[i-1,3]+ dcoef_foods2$Foods_2_CA_3[4]    
    
    df_foods3_test[i, 4] = dcoef_foods3$Foods_3_CA_1[1]*df_foods3_test[i-1,1] + dcoef_foods3$Foods_3_CA_1[2]*df_foods3_test[i-1,2] + dcoef_foods3$Foods_3_CA_1[3]*df_foods3_test[i-1,3]+ dcoef_foods3$Foods_3_CA_1[4]
    df_foods3_test[i, 5] = dcoef_foods3$Foods_3_CA_2[1]*df_foods3_test[i-1,1] + dcoef_foods3$Foods_3_CA_2[2]*df_foods3_test[i-1,2] + dcoef_foods3$Foods_3_CA_2[3]*df_foods3_test[i-1,3]+ dcoef_foods3$Foods_3_CA_2[4]
    df_foods3_test[i, 6] = dcoef_foods3$Foods_3_CA_3[1]*df_foods3_test[i-1,1] + dcoef_foods3$Foods_3_CA_3[2]*df_foods3_test[i-1,2] + dcoef_foods3$Foods_3_CA_3[3]*df_foods3_test[i-1,3]+ dcoef_foods3$Foods_3_CA_3[4]    
    
  }
}

  

colnames(df_hobbies_test) = c('Hobbies_CA_1','Hobbies_CA_2','Hobbies_CA_3'
                           ,'Hobbies_CA_1_pred','Hobbies_CA_2_pred','Hobbies_CA_3_pred')

colnames(df_household1_test) = c('Household_1_CA_1','Household_1_CA_2','Household_1_CA_3'
                              ,'Household_1_CA_1_pred','Household_1_CA_2_pred','Household_1_CA_3_pred')

colnames(df_household2_test) = c('Household_2_CA_1','Household_2_CA_2','Household_2_CA_3'
                                 ,'Household_2_CA_1_pred','Household_2_CA_2_pred','Household_2_CA_3_pred')

colnames(df_foods1_test) = c('Foods_1_CA_1','Foods_1_CA_2','Foods_1_CA_3'
                                 ,'Foods_1_CA_1_pred','Foods_1_CA_2_pred','Foods_1_CA_3_pred')

colnames(df_foods2_test) = c('Foods_2_CA_1','Foods_2_CA_2','Foods_2_CA_3'
                             ,'Foods_2_CA_1_pred','Foods_2_CA_2_pred','Foods_2_CA_3_pred')

colnames(df_foods3_test) = c('Foods_3_CA_1','Foods_3_CA_2','Foods_3_CA_3'
                             ,'Foods_3_CA_1_pred','Foods_3_CA_2_pred','Foods_3_CA_3_pred')


forecasts_hobbies_22 = df_hobbies_test
forecasts_household1_22 = df_household1_test
forecasts_household2_22 = df_household2_test
forecasts_foods1_22 = df_foods1_test
forecasts_foods2_22 = df_foods2_test
forecasts_foods3_22 = df_foods3_test

# Save the RMSSE Results in a data frame
df_rmsse_CA_1_4yr[1, 2] = RMSSE(forecasts_hobbies_22$Hobbies_CA_1, forecasts_hobbies_22$Hobbies_CA_1_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_1_4yr[2, 2] = RMSSE(forecasts_household1_22$Household_1_CA_1, forecasts_household1_22$Household_1_CA_1_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_1_4yr[3, 2] = RMSSE(forecasts_household2_22$Household_2_CA_1, forecasts_household2_22$Household_2_CA_1_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_1_4yr[4, 2] = RMSSE(forecasts_foods1_22$Foods_1_CA_1, forecasts_foods1_22$Foods_1_CA_1_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_1_4yr[5, 2] = RMSSE(forecasts_foods2_22$Foods_2_CA_1, forecasts_foods2_22$Foods_2_CA_1_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_1_4yr[6, 2] = RMSSE(forecasts_foods3_22$Foods_3_CA_1, forecasts_foods3_22$Foods_3_CA_1_pred, scale = 1, na.rm = TRUE)

df_rmsse_CA_2_4yr[1, 2] = RMSSE(forecasts_hobbies_22$Hobbies_CA_2, forecasts_hobbies_22$Hobbies_CA_2_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_2_4yr[2, 2] = RMSSE(forecasts_household1_22$Household_1_CA_2, forecasts_household1_22$Household_1_CA_2_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_2_4yr[3, 2] = RMSSE(forecasts_household2_22$Household_2_CA_2, forecasts_household2_22$Household_2_CA_2_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_2_4yr[4, 2] = RMSSE(forecasts_foods1_22$Foods_1_CA_2, forecasts_foods1_22$Foods_1_CA_2_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_2_4yr[5, 2] = RMSSE(forecasts_foods2_22$Foods_2_CA_2, forecasts_foods2_22$Foods_2_CA_2_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_2_4yr[6, 2] = RMSSE(forecasts_foods3_22$Foods_3_CA_2, forecasts_foods3_22$Foods_3_CA_2_pred, scale = 1, na.rm = TRUE)

df_rmsse_CA_3_4yr[1, 2] = RMSSE(forecasts_hobbies_22$Hobbies_CA_3, forecasts_hobbies_22$Hobbies_CA_3_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_3_4yr[2, 2] = RMSSE(forecasts_household1_22$Household_1_CA_3, forecasts_household1_22$Household_1_CA_3_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_3_4yr[3, 2] = RMSSE(forecasts_household2_22$Household_2_CA_3, forecasts_household2_22$Household_2_CA_3_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_3_4yr[4, 2] = RMSSE(forecasts_foods1_22$Foods_1_CA_3, forecasts_foods1_22$Foods_1_CA_3_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_3_4yr[5, 2] = RMSSE(forecasts_foods2_22$Foods_2_CA_3, forecasts_foods2_22$Foods_2_CA_3_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_3_4yr[6, 2] = RMSSE(forecasts_foods3_22$Foods_3_CA_3, forecasts_foods3_22$Foods_3_CA_3_pred, scale = 1, na.rm = TRUE)

rownames(df_rmsse_CA_1_4yr) =  c("Hobbies","Household1","Household2","Foods1","Foods2","Foods3")
rownames(df_rmsse_CA_2_4yr) =  c("Hobbies","Household1","Household2","Foods1","Foods2","Foods3")
rownames(df_rmsse_CA_3_4yr) =  c("Hobbies","Household1","Household2","Foods1","Foods2","Foods3")

colnames(df_rmsse_CA_1_4yr) = c("var21","var22")
colnames(df_rmsse_CA_2_4yr) = c("var21","var22")
colnames(df_rmsse_CA_3_4yr) = c("var21","var22")


```

```{r}

df_rmsse_CA_1_4yr
df_rmsse_CA_2_4yr
df_rmsse_CA_3_4yr

```

### Train-test split for data from 2011-2014 for training and 2015 for testing.

```{r, include=FALSE}

# Define the train-test split 703 is 2012-12-31 and 1068 for 2013-12-31
train_sample = 1798
test_sample = 1969

# Choose the columns for each store
# Extracting the columns of the CA_1 store and renaming them
df_hobbies = df[c('Hobbies_CA_1','Hobbies_CA_2','Hobbies_CA_3')]
df_household1 = df[c('Household_1_CA_1','Household_1_CA_2','Household_1_CA_3')]
df_household2 = df[c('Household_2_CA_1','Household_2_CA_2','Household_2_CA_3')]
df_foods1 = df[c('Foods_1_CA_1','Foods_1_CA_2','Foods_1_CA_3')]
df_foods2 = df[c('Foods_2_CA_1','Foods_2_CA_2','Foods_2_CA_3')]
df_foods3 = df[c('Foods_3_CA_1','Foods_3_CA_2','Foods_3_CA_3')]

df_hobbies_train = head(df_hobbies, train_sample)
df_hobbies_test  = head(df_hobbies, test_sample)
df_hobbies_test  = tail(df_hobbies_test, test_sample - train_sample)

df_household1_train = head(df_household1, train_sample)
df_household1_test  = head(df_household1, test_sample)
df_household1_test  = tail(df_household1_test, test_sample - train_sample)

df_household2_train = head(df_household2, train_sample)
df_household2_test  = head(df_household2, test_sample)
df_household2_test  = tail(df_household2_test, test_sample - train_sample)

df_foods1_train = head(df_foods1, train_sample)
df_foods1_test  = head(df_foods1, test_sample)
df_foods1_test  = tail(df_foods1_test, test_sample - train_sample)

df_foods2_train = head(df_foods2, train_sample)
df_foods2_test  = head(df_foods2, test_sample)
df_foods2_test  = tail(df_foods2_test, test_sample - train_sample)

df_foods3_train = head(df_foods3, train_sample)
df_foods3_test  = head(df_foods3, test_sample)
df_foods3_test  = tail(df_foods3_test, test_sample - train_sample)

var_hobbies_train = VAR(df_hobbies_train, p=1)
var_household1_train = VAR(df_household1_train, p=1)
var_household2_train = VAR(df_household2_train, p=1)
var_foods1_train = VAR(df_foods1_train, p=1)
var_foods2_train = VAR(df_foods2_train, p=1)
var_foods3_train = VAR(df_foods3_train, p=1)

dcoef_hobbies = coef(var_hobbies_train)
dcoef_household1 = coef(var_household1_train)
dcoef_household2 = coef(var_household2_train)
dcoef_foods1 = coef(var_foods1_train)
dcoef_foods2 = coef(var_foods2_train)
dcoef_foods3 = coef(var_foods3_train)

# iterate the number of test samples to predict using the var coefficients

length_sample = test_sample - train_sample
for (i in 1:length_sample) {
  if (i==1) {
    df_hobbies_test[i, 4] = dcoef_hobbies$Hobbies_CA_1[1]*df_hobbies_train[train_sample,1] + dcoef_hobbies$Hobbies_CA_1[2]*df_hobbies_train[train_sample,2] + dcoef_hobbies$Hobbies_CA_1[3]*df_hobbies_train[train_sample,3]+ dcoef_hobbies$Hobbies_CA_1[4]
    df_hobbies_test[i, 5] = dcoef_hobbies$Hobbies_CA_2[1]*df_hobbies_train[train_sample,1] + dcoef_hobbies$Hobbies_CA_2[2]*df_hobbies_train[train_sample,2] + dcoef_hobbies$Hobbies_CA_2[3]*df_hobbies_train[train_sample,3]+ dcoef_hobbies$Hobbies_CA_2[4]
    df_hobbies_test[i, 6] = dcoef_hobbies$Hobbies_CA_3[1]*df_hobbies_train[train_sample,1] + dcoef_hobbies$Hobbies_CA_3[2]*df_hobbies_train[train_sample,2] + dcoef_hobbies$Hobbies_CA_3[3]*df_hobbies_train[train_sample,3]+ dcoef_hobbies$Hobbies_CA_3[4]

    df_household1_test[i, 4] = dcoef_household1$Household_1_CA_1[1]*df_household1_train[train_sample,1] + dcoef_household1$Household_1_CA_1[2]*df_household1_train[train_sample,2] + dcoef_household1$Household_1_CA_1[3]*df_household1_train[train_sample,3]+ dcoef_household1$Household_1_CA_1[4]
    df_household1_test[i, 5] = dcoef_household1$Household_1_CA_2[1]*df_household1_train[train_sample,1] + dcoef_household1$Household_1_CA_2[2]*df_household1_train[train_sample,2] + dcoef_household1$Household_1_CA_2[3]*df_household1_train[train_sample,3]+ dcoef_household1$Household_1_CA_2[4]
    df_household1_test[i, 6] = dcoef_household1$Household_1_CA_3[1]*df_household1_train[train_sample,1] + dcoef_household1$Household_1_CA_3[2]*df_household1_train[train_sample,2] + dcoef_household1$Household_1_CA_3[3]*df_household1_train[train_sample,3]+ dcoef_household1$Household_1_CA_3[4]
    
    df_household2_test[i, 4] = dcoef_household2$Household_2_CA_1[1]*df_household2_train[train_sample,1] + dcoef_household2$Household_2_CA_1[2]*df_household2_train[train_sample,2] + dcoef_household2$Household_2_CA_1[3]*df_household2_train[train_sample,3]+ dcoef_household2$Household_2_CA_1[4]
    df_household2_test[i, 5] = dcoef_household2$Household_2_CA_2[1]*df_household2_train[train_sample,1] + dcoef_household2$Household_2_CA_2[2]*df_household2_train[train_sample,2] + dcoef_household2$Household_2_CA_2[3]*df_household2_train[train_sample,3]+ dcoef_household2$Household_2_CA_2[4]
    df_household2_test[i, 6] = dcoef_household2$Household_2_CA_3[1]*df_household2_train[train_sample,1] + dcoef_household2$Household_2_CA_3[2]*df_household2_train[train_sample,2] + dcoef_household2$Household_2_CA_3[3]*df_household2_train[train_sample,3]+ dcoef_household2$Household_2_CA_3[4]
    
    df_foods1_test[i, 4] = dcoef_foods1$Foods_1_CA_1[1]*df_foods1_train[train_sample,1] + dcoef_foods1$Foods_1_CA_1[2]*df_foods1_train[train_sample,2] + dcoef_foods1$Foods_1_CA_1[3]*df_foods1_train[train_sample,3]+ dcoef_foods1$Foods_1_CA_1[4]
    df_foods1_test[i, 5] = dcoef_foods1$Foods_1_CA_2[1]*df_foods1_train[train_sample,1] + dcoef_foods1$Foods_1_CA_2[2]*df_foods1_train[train_sample,2] + dcoef_foods1$Foods_1_CA_2[3]*df_foods1_train[train_sample,3]+ dcoef_foods1$Foods_1_CA_2[4]
    df_foods1_test[i, 6] = dcoef_foods1$Foods_1_CA_3[1]*df_foods1_train[train_sample,1] + dcoef_foods1$Foods_1_CA_3[2]*df_foods1_train[train_sample,2] + dcoef_foods1$Foods_1_CA_3[3]*df_foods1_train[train_sample,3]+ dcoef_foods1$Foods_1_CA_3[4]
    
    df_foods2_test[i, 4] = dcoef_foods2$Foods_2_CA_1[1]*df_foods2_train[train_sample,1] + dcoef_foods2$Foods_2_CA_1[2]*df_foods2_train[train_sample,2] + dcoef_foods2$Foods_2_CA_1[3]*df_foods2_train[train_sample,3]+ dcoef_foods2$Foods_2_CA_1[4]
    df_foods2_test[i, 5] = dcoef_foods2$Foods_2_CA_2[1]*df_foods2_train[train_sample,1] + dcoef_foods2$Foods_2_CA_2[2]*df_foods2_train[train_sample,2] + dcoef_foods2$Foods_2_CA_2[3]*df_foods2_train[train_sample,3]+ dcoef_foods2$Foods_2_CA_2[4]
    df_foods2_test[i, 6] = dcoef_foods2$Foods_2_CA_3[1]*df_foods2_train[train_sample,1] + dcoef_foods2$Foods_2_CA_3[2]*df_foods2_train[train_sample,2] + dcoef_foods2$Foods_2_CA_3[3]*df_foods2_train[train_sample,3]+ dcoef_foods2$Foods_2_CA_3[4]
    
    df_foods3_test[i, 4] = dcoef_foods3$Foods_3_CA_1[1]*df_foods3_train[train_sample,1] + dcoef_foods3$Foods_3_CA_1[2]*df_foods3_train[train_sample,2] + dcoef_foods3$Foods_3_CA_1[3]*df_foods3_train[train_sample,3]+ dcoef_foods3$Foods_3_CA_1[4]
    df_foods3_test[i, 5] = dcoef_foods3$Foods_3_CA_2[1]*df_foods3_train[train_sample,1] + dcoef_foods3$Foods_3_CA_2[2]*df_foods3_train[train_sample,2] + dcoef_foods3$Foods_3_CA_2[3]*df_foods3_train[train_sample,3]+ dcoef_foods3$Foods_3_CA_2[4]
    df_foods3_test[i, 6] = dcoef_foods3$Foods_3_CA_3[1]*df_foods3_train[train_sample,1] + dcoef_foods3$Foods_3_CA_3[2]*df_foods3_train[train_sample,2] + dcoef_foods3$Foods_3_CA_3[3]*df_foods3_train[train_sample,3]+ dcoef_foods3$Foods_3_CA_3[4]
    
    
  }
  else {

    df_hobbies_test[i, 4] = dcoef_hobbies$Hobbies_CA_1[1]*df_hobbies_test[i-1,1] + dcoef_hobbies$Hobbies_CA_1[2]*df_hobbies_test[i-1,2] + dcoef_hobbies$Hobbies_CA_1[3]*df_hobbies_test[i-1,3]+ dcoef_hobbies$Hobbies_CA_1[4]
    df_hobbies_test[i, 5] = dcoef_hobbies$Hobbies_CA_2[1]*df_hobbies_test[i-1,1] + dcoef_hobbies$Hobbies_CA_2[2]*df_hobbies_test[i-1,2] + dcoef_hobbies$Hobbies_CA_2[3]*df_hobbies_test[i-1,3]+ dcoef_hobbies$Hobbies_CA_2[4]
    df_hobbies_test[i, 6] = dcoef_hobbies$Hobbies_CA_3[1]*df_hobbies_test[i-1,1] + dcoef_hobbies$Hobbies_CA_3[2]*df_hobbies_test[i-1,2] + dcoef_hobbies$Hobbies_CA_3[3]*df_hobbies_test[i-1,3]+ dcoef_hobbies$Hobbies_CA_3[4]
    
    df_household1_test[i, 4] = dcoef_household1$Household_1_CA_1[1]*df_household1_test[i-1,1] + dcoef_household1$Household_1_CA_1[2]*df_household1_test[i-1,2] + dcoef_household1$Household_1_CA_1[3]*df_household1_test[i-1,3]+ dcoef_household1$Household_1_CA_1[4]
    df_household1_test[i, 5] = dcoef_household1$Household_1_CA_2[1]*df_household1_test[i-1,1] + dcoef_household1$Household_1_CA_2[2]*df_household1_test[i-1,2] + dcoef_household1$Household_1_CA_2[3]*df_household1_test[i-1,3]+ dcoef_household1$Household_1_CA_2[4]
    df_household1_test[i, 6] = dcoef_household1$Household_1_CA_3[1]*df_household1_test[i-1,1] + dcoef_household1$Household_1_CA_3[2]*df_household1_test[i-1,2] + dcoef_household1$Household_1_CA_3[3]*df_household1_test[i-1,3]+ dcoef_household1$Household_1_CA_3[4]
    
    df_household2_test[i, 4] = dcoef_household2$Household_2_CA_1[1]*df_household2_test[i-1,1] + dcoef_household2$Household_2_CA_1[2]*df_household2_test[i-1,2] + dcoef_household2$Household_2_CA_1[3]*df_household2_test[i-1,3]+ dcoef_household2$Household_2_CA_1[4]
    df_household2_test[i, 5] = dcoef_household2$Household_2_CA_2[1]*df_household2_test[i-1,1] + dcoef_household2$Household_2_CA_2[2]*df_household2_test[i-1,2] + dcoef_household2$Household_2_CA_2[3]*df_household2_test[i-1,3]+ dcoef_household2$Household_2_CA_2[4]
    df_household2_test[i, 6] = dcoef_household2$Household_2_CA_3[1]*df_household2_test[i-1,1] + dcoef_household2$Household_2_CA_3[2]*df_household2_test[i-1,2] + dcoef_household2$Household_2_CA_3[3]*df_household2_test[i-1,3]+ dcoef_household2$Household_2_CA_3[4]
    
    df_foods1_test[i, 4] = dcoef_foods1$Foods_1_CA_1[1]*df_foods1_test[i-1,1] + dcoef_foods1$Foods_1_CA_1[2]*df_foods1_test[i-1,2] + dcoef_foods1$Foods_1_CA_1[3]*df_foods1_test[i-1,3]+ dcoef_foods1$Foods_1_CA_1[4]
    df_foods1_test[i, 5] = dcoef_foods1$Foods_1_CA_2[1]*df_foods1_test[i-1,1] + dcoef_foods1$Foods_1_CA_2[2]*df_foods1_test[i-1,2] + dcoef_foods1$Foods_1_CA_2[3]*df_foods1_test[i-1,3]+ dcoef_foods1$Foods_1_CA_2[4]
    df_foods1_test[i, 6] = dcoef_foods1$Foods_1_CA_3[1]*df_foods1_test[i-1,1] + dcoef_foods1$Foods_1_CA_3[2]*df_foods1_test[i-1,2] + dcoef_foods1$Foods_1_CA_3[3]*df_foods1_test[i-1,3]+ dcoef_foods1$Foods_1_CA_3[4]    
    
    df_foods2_test[i, 4] = dcoef_foods2$Foods_2_CA_1[1]*df_foods2_test[i-1,1] + dcoef_foods2$Foods_2_CA_1[2]*df_foods2_test[i-1,2] + dcoef_foods2$Foods_2_CA_1[3]*df_foods2_test[i-1,3]+ dcoef_foods2$Foods_2_CA_1[4]
    df_foods2_test[i, 5] = dcoef_foods2$Foods_2_CA_2[1]*df_foods2_test[i-1,1] + dcoef_foods2$Foods_2_CA_2[2]*df_foods2_test[i-1,2] + dcoef_foods2$Foods_2_CA_2[3]*df_foods2_test[i-1,3]+ dcoef_foods2$Foods_2_CA_2[4]
    df_foods2_test[i, 6] = dcoef_foods2$Foods_2_CA_3[1]*df_foods2_test[i-1,1] + dcoef_foods2$Foods_2_CA_3[2]*df_foods2_test[i-1,2] + dcoef_foods2$Foods_2_CA_3[3]*df_foods2_test[i-1,3]+ dcoef_foods2$Foods_2_CA_3[4]    
    
    df_foods3_test[i, 4] = dcoef_foods3$Foods_3_CA_1[1]*df_foods3_test[i-1,1] + dcoef_foods3$Foods_3_CA_1[2]*df_foods3_test[i-1,2] + dcoef_foods3$Foods_3_CA_1[3]*df_foods3_test[i-1,3]+ dcoef_foods3$Foods_3_CA_1[4]
    df_foods3_test[i, 5] = dcoef_foods3$Foods_3_CA_2[1]*df_foods3_test[i-1,1] + dcoef_foods3$Foods_3_CA_2[2]*df_foods3_test[i-1,2] + dcoef_foods3$Foods_3_CA_2[3]*df_foods3_test[i-1,3]+ dcoef_foods3$Foods_3_CA_2[4]
    df_foods3_test[i, 6] = dcoef_foods3$Foods_3_CA_3[1]*df_foods3_test[i-1,1] + dcoef_foods3$Foods_3_CA_3[2]*df_foods3_test[i-1,2] + dcoef_foods3$Foods_3_CA_3[3]*df_foods3_test[i-1,3]+ dcoef_foods3$Foods_3_CA_3[4]    
    
  }
}

  

colnames(df_hobbies_test) = c('Hobbies_CA_1','Hobbies_CA_2','Hobbies_CA_3'
                           ,'Hobbies_CA_1_pred','Hobbies_CA_2_pred','Hobbies_CA_3_pred')

colnames(df_household1_test) = c('Household_1_CA_1','Household_1_CA_2','Household_1_CA_3'
                              ,'Household_1_CA_1_pred','Household_1_CA_2_pred','Household_1_CA_3_pred')

colnames(df_household2_test) = c('Household_2_CA_1','Household_2_CA_2','Household_2_CA_3'
                                 ,'Household_2_CA_1_pred','Household_2_CA_2_pred','Household_2_CA_3_pred')

colnames(df_foods1_test) = c('Foods_1_CA_1','Foods_1_CA_2','Foods_1_CA_3'
                                 ,'Foods_1_CA_1_pred','Foods_1_CA_2_pred','Foods_1_CA_3_pred')

colnames(df_foods2_test) = c('Foods_2_CA_1','Foods_2_CA_2','Foods_2_CA_3'
                             ,'Foods_2_CA_1_pred','Foods_2_CA_2_pred','Foods_2_CA_3_pred')

colnames(df_foods3_test) = c('Foods_3_CA_1','Foods_3_CA_2','Foods_3_CA_3'
                             ,'Foods_3_CA_1_pred','Foods_3_CA_2_pred','Foods_3_CA_3_pred')


forecasts_hobbies_22 = df_hobbies_test
forecasts_household1_22 = df_household1_test
forecasts_household2_22 = df_household2_test
forecasts_foods1_22 = df_foods1_test
forecasts_foods2_22 = df_foods2_test
forecasts_foods3_22 = df_foods3_test

# Save the RMSSE Results in a data frame
df_rmsse_CA_1_5yr[1, 2] = RMSSE(forecasts_hobbies_22$Hobbies_CA_1, forecasts_hobbies_22$Hobbies_CA_1_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_1_5yr[2, 2] = RMSSE(forecasts_household1_22$Household_1_CA_1, forecasts_household1_22$Household_1_CA_1_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_1_5yr[3, 2] = RMSSE(forecasts_household2_22$Household_2_CA_1, forecasts_household2_22$Household_2_CA_1_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_1_5yr[4, 2] = RMSSE(forecasts_foods1_22$Foods_1_CA_1, forecasts_foods1_22$Foods_1_CA_1_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_1_5yr[5, 2] = RMSSE(forecasts_foods2_22$Foods_2_CA_1, forecasts_foods2_22$Foods_2_CA_1_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_1_5yr[6, 2] = RMSSE(forecasts_foods3_22$Foods_3_CA_1, forecasts_foods3_22$Foods_3_CA_1_pred, scale = 1, na.rm = TRUE)

df_rmsse_CA_2_5yr[1, 2] = RMSSE(forecasts_hobbies_22$Hobbies_CA_2, forecasts_hobbies_22$Hobbies_CA_2_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_2_5yr[2, 2] = RMSSE(forecasts_household1_22$Household_1_CA_2, forecasts_household1_22$Household_1_CA_2_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_2_5yr[3, 2] = RMSSE(forecasts_household2_22$Household_2_CA_2, forecasts_household2_22$Household_2_CA_2_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_2_5yr[4, 2] = RMSSE(forecasts_foods1_22$Foods_1_CA_2, forecasts_foods1_22$Foods_1_CA_2_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_2_5yr[5, 2] = RMSSE(forecasts_foods2_22$Foods_2_CA_2, forecasts_foods2_22$Foods_2_CA_2_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_2_5yr[6, 2] = RMSSE(forecasts_foods3_22$Foods_3_CA_2, forecasts_foods3_22$Foods_3_CA_2_pred, scale = 1, na.rm = TRUE)

df_rmsse_CA_3_5yr[1, 2] = RMSSE(forecasts_hobbies_22$Hobbies_CA_3, forecasts_hobbies_22$Hobbies_CA_3_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_3_5yr[2, 2] = RMSSE(forecasts_household1_22$Household_1_CA_3, forecasts_household1_22$Household_1_CA_3_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_3_5yr[3, 2] = RMSSE(forecasts_household2_22$Household_2_CA_3, forecasts_household2_22$Household_2_CA_3_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_3_5yr[4, 2] = RMSSE(forecasts_foods1_22$Foods_1_CA_3, forecasts_foods1_22$Foods_1_CA_3_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_3_5yr[5, 2] = RMSSE(forecasts_foods2_22$Foods_2_CA_3, forecasts_foods2_22$Foods_2_CA_3_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_3_5yr[6, 2] = RMSSE(forecasts_foods3_22$Foods_3_CA_3, forecasts_foods3_22$Foods_3_CA_3_pred, scale = 1, na.rm = TRUE)

rownames(df_rmsse_CA_1_5yr) =  c("Hobbies","Household1","Household2","Foods1","Foods2","Foods3")
rownames(df_rmsse_CA_2_5yr) =  c("Hobbies","Household1","Household2","Foods1","Foods2","Foods3")
rownames(df_rmsse_CA_3_5yr) =  c("Hobbies","Household1","Household2","Foods1","Foods2","Foods3")

colnames(df_rmsse_CA_1_5yr) = c("var21","var22")
colnames(df_rmsse_CA_2_5yr) = c("var21","var22")
colnames(df_rmsse_CA_3_5yr) = c("var21","var22")


```

```{r}

df_rmsse_CA_1_5yr
df_rmsse_CA_2_5yr
df_rmsse_CA_3_5yr

```

## Final results

Also, we will compute the average of the RMSSE for the four splits in the second VAR:

```{r, echo=FALSE}

df_rmsse_CA_1_avg_2 = data.frame()
df_rmsse_CA_2_avg_2 = data.frame()
df_rmsse_CA_3_avg_2 = data.frame()

# Save the RMSSE Results in a data frame
df_rmsse_CA_1_avg_2[1, 1] = df_rmsse_CA_1_2yr[1, 2]
df_rmsse_CA_1_avg_2[2, 1] = df_rmsse_CA_1_2yr[2, 2]
df_rmsse_CA_1_avg_2[3, 1] = df_rmsse_CA_1_2yr[3, 2]
df_rmsse_CA_1_avg_2[4, 1] = df_rmsse_CA_1_2yr[4, 2]
df_rmsse_CA_1_avg_2[5, 1] = df_rmsse_CA_1_2yr[5, 2]
df_rmsse_CA_1_avg_2[6, 1] = df_rmsse_CA_1_2yr[6, 2]

df_rmsse_CA_1_avg_2[1, 2] = df_rmsse_CA_1_3yr[1, 2]
df_rmsse_CA_1_avg_2[2, 2] = df_rmsse_CA_1_3yr[2, 2]
df_rmsse_CA_1_avg_2[3, 2] = df_rmsse_CA_1_3yr[3, 2]
df_rmsse_CA_1_avg_2[4, 2] = df_rmsse_CA_1_3yr[4, 2]
df_rmsse_CA_1_avg_2[5, 2] = df_rmsse_CA_1_3yr[5, 2]
df_rmsse_CA_1_avg_2[6, 2] = df_rmsse_CA_1_3yr[6, 2]

df_rmsse_CA_1_avg_2[1, 3] = df_rmsse_CA_1_4yr[1, 2]
df_rmsse_CA_1_avg_2[2, 3] = df_rmsse_CA_1_4yr[2, 2]
df_rmsse_CA_1_avg_2[3, 3] = df_rmsse_CA_1_4yr[3, 2]
df_rmsse_CA_1_avg_2[4, 3] = df_rmsse_CA_1_4yr[4, 2]
df_rmsse_CA_1_avg_2[5, 3] = df_rmsse_CA_1_4yr[5, 2]
df_rmsse_CA_1_avg_2[6, 3] = df_rmsse_CA_1_4yr[6, 2]

df_rmsse_CA_1_avg_2[1, 4] = df_rmsse_CA_1_5yr[1, 2]
df_rmsse_CA_1_avg_2[2, 4] = df_rmsse_CA_1_5yr[2, 2]
df_rmsse_CA_1_avg_2[3, 4] = df_rmsse_CA_1_5yr[3, 2]
df_rmsse_CA_1_avg_2[4, 4] = df_rmsse_CA_1_5yr[4, 2]
df_rmsse_CA_1_avg_2[5, 4] = df_rmsse_CA_1_5yr[5, 2]
df_rmsse_CA_1_avg_2[6, 4] = df_rmsse_CA_1_5yr[6, 2]

df_rmsse_CA_1_avg_2[1, 5] = (df_rmsse_CA_1_avg_2[1, 1] + df_rmsse_CA_1_avg_2[1, 2] + df_rmsse_CA_1_avg_2[1, 3] + df_rmsse_CA_1_avg_2[1, 4])/4 
df_rmsse_CA_1_avg_2[2, 5] = (df_rmsse_CA_1_avg_2[2, 1] + df_rmsse_CA_1_avg_2[2, 2] + df_rmsse_CA_1_avg_2[2, 3] + df_rmsse_CA_1_avg_2[2, 4])/4
df_rmsse_CA_1_avg_2[3, 5] = (df_rmsse_CA_1_avg_2[3, 1] + df_rmsse_CA_1_avg_2[3, 2] + df_rmsse_CA_1_avg_2[3, 3] + df_rmsse_CA_1_avg_2[3, 4])/4
df_rmsse_CA_1_avg_2[4, 5] = (df_rmsse_CA_1_avg_2[4, 1] + df_rmsse_CA_1_avg_2[4, 2] + df_rmsse_CA_1_avg_2[4, 3] + df_rmsse_CA_1_avg_2[4, 4])/4
df_rmsse_CA_1_avg_2[5, 5] = (df_rmsse_CA_1_avg_2[5, 1] + df_rmsse_CA_1_avg_2[5, 2] + df_rmsse_CA_1_avg_2[5, 3] + df_rmsse_CA_1_avg_2[5, 4])/4
df_rmsse_CA_1_avg_2[6, 5] = (df_rmsse_CA_1_avg_2[6, 1] + df_rmsse_CA_1_avg_2[6, 2] + df_rmsse_CA_1_avg_2[6, 3] + df_rmsse_CA_1_avg_2[6, 4])/4

colnames(df_rmsse_CA_1_avg_2) = c("split2yr","split3yr","split4yr","split5yr","avg")
rownames(df_rmsse_CA_1_avg_2) =  c("Hobbies","Household1","Household2","Foods1","Foods2","Foods3")


df_rmsse_CA_1_avg_2


```

Store 2:

```{r, echo=FALSE}


# Save the RMSSE Results in a data frame
df_rmsse_CA_2_avg_2[1, 1] = df_rmsse_CA_2_2yr[1, 2]
df_rmsse_CA_2_avg_2[2, 1] = df_rmsse_CA_2_2yr[2, 2]
df_rmsse_CA_2_avg_2[3, 1] = df_rmsse_CA_2_2yr[3, 2]
df_rmsse_CA_2_avg_2[4, 1] = df_rmsse_CA_2_2yr[4, 2]
df_rmsse_CA_2_avg_2[5, 1] = df_rmsse_CA_2_2yr[5, 2]
df_rmsse_CA_2_avg_2[6, 1] = df_rmsse_CA_2_2yr[6, 2]

df_rmsse_CA_2_avg_2[1, 2] = df_rmsse_CA_2_3yr[1, 2]
df_rmsse_CA_2_avg_2[2, 2] = df_rmsse_CA_2_3yr[2, 2]
df_rmsse_CA_2_avg_2[3, 2] = df_rmsse_CA_2_3yr[3, 2]
df_rmsse_CA_2_avg_2[4, 2] = df_rmsse_CA_2_3yr[4, 2]
df_rmsse_CA_2_avg_2[5, 2] = df_rmsse_CA_2_3yr[5, 2]
df_rmsse_CA_2_avg_2[6, 2] = df_rmsse_CA_2_3yr[6, 2]

df_rmsse_CA_2_avg_2[1, 3] = df_rmsse_CA_2_4yr[1, 2]
df_rmsse_CA_2_avg_2[2, 3] = df_rmsse_CA_2_4yr[2, 2]
df_rmsse_CA_2_avg_2[3, 3] = df_rmsse_CA_2_4yr[3, 2]
df_rmsse_CA_2_avg_2[4, 3] = df_rmsse_CA_2_4yr[4, 2]
df_rmsse_CA_2_avg_2[5, 3] = df_rmsse_CA_2_4yr[5, 2]
df_rmsse_CA_2_avg_2[6, 3] = df_rmsse_CA_2_4yr[6, 2]

df_rmsse_CA_2_avg_2[1, 4] = df_rmsse_CA_2_5yr[1, 2]
df_rmsse_CA_2_avg_2[2, 4] = df_rmsse_CA_2_5yr[2, 2]
df_rmsse_CA_2_avg_2[3, 4] = df_rmsse_CA_2_5yr[3, 2]
df_rmsse_CA_2_avg_2[4, 4] = df_rmsse_CA_2_5yr[4, 2]
df_rmsse_CA_2_avg_2[5, 4] = df_rmsse_CA_2_5yr[5, 2]
df_rmsse_CA_2_avg_2[6, 4] = df_rmsse_CA_2_5yr[6, 2]

df_rmsse_CA_2_avg_2[1, 5] = (df_rmsse_CA_2_avg_2[1, 1] + df_rmsse_CA_2_avg_2[1, 2] + df_rmsse_CA_2_avg_2[1, 3] + df_rmsse_CA_2_avg_2[1, 4])/4 
df_rmsse_CA_2_avg_2[2, 5] = (df_rmsse_CA_2_avg_2[2, 1] + df_rmsse_CA_2_avg_2[2, 2] + df_rmsse_CA_2_avg_2[2, 3] + df_rmsse_CA_2_avg_2[2, 4])/4
df_rmsse_CA_2_avg_2[3, 5] = (df_rmsse_CA_2_avg_2[3, 1] + df_rmsse_CA_2_avg_2[3, 2] + df_rmsse_CA_2_avg_2[3, 3] + df_rmsse_CA_2_avg_2[3, 4])/4
df_rmsse_CA_2_avg_2[4, 5] = (df_rmsse_CA_2_avg_2[4, 1] + df_rmsse_CA_2_avg_2[4, 2] + df_rmsse_CA_2_avg_2[4, 3] + df_rmsse_CA_2_avg_2[4, 4])/4
df_rmsse_CA_2_avg_2[5, 5] = (df_rmsse_CA_2_avg_2[5, 1] + df_rmsse_CA_2_avg_2[5, 2] + df_rmsse_CA_2_avg_2[5, 3] + df_rmsse_CA_2_avg_2[5, 4])/4
df_rmsse_CA_2_avg_2[6, 5] = (df_rmsse_CA_2_avg_2[6, 1] + df_rmsse_CA_2_avg_2[6, 2] + df_rmsse_CA_2_avg_2[6, 3] + df_rmsse_CA_2_avg_2[6, 4])/4

colnames(df_rmsse_CA_2_avg_2) = c("split2yr","split3yr","split4yr","split5yr","avg")
rownames(df_rmsse_CA_2_avg_2) =  c("Hobbies","Household1","Household2","Foods1","Foods2","Foods3")


df_rmsse_CA_2_avg_2


```

Store 3:

```{r, echo=FALSE}


# Save the RMSSE Results in a data frame
df_rmsse_CA_3_avg_2[1, 1] = df_rmsse_CA_3_2yr[1, 2]
df_rmsse_CA_3_avg_2[2, 1] = df_rmsse_CA_3_2yr[2, 2]
df_rmsse_CA_3_avg_2[3, 1] = df_rmsse_CA_3_2yr[3, 2]
df_rmsse_CA_3_avg_2[4, 1] = df_rmsse_CA_3_2yr[4, 2]
df_rmsse_CA_3_avg_2[5, 1] = df_rmsse_CA_3_2yr[5, 2]
df_rmsse_CA_3_avg_2[6, 1] = df_rmsse_CA_3_2yr[6, 2]

df_rmsse_CA_3_avg_2[1, 2] = df_rmsse_CA_3_3yr[1, 2]
df_rmsse_CA_3_avg_2[2, 2] = df_rmsse_CA_3_3yr[2, 2]
df_rmsse_CA_3_avg_2[3, 2] = df_rmsse_CA_3_3yr[3, 2]
df_rmsse_CA_3_avg_2[4, 2] = df_rmsse_CA_3_3yr[4, 2]
df_rmsse_CA_3_avg_2[5, 2] = df_rmsse_CA_3_3yr[5, 2]
df_rmsse_CA_3_avg_2[6, 2] = df_rmsse_CA_3_3yr[6, 2]

df_rmsse_CA_3_avg_2[1, 3] = df_rmsse_CA_3_4yr[1, 2]
df_rmsse_CA_3_avg_2[2, 3] = df_rmsse_CA_3_4yr[2, 2]
df_rmsse_CA_3_avg_2[3, 3] = df_rmsse_CA_3_4yr[3, 2]
df_rmsse_CA_3_avg_2[4, 3] = df_rmsse_CA_3_4yr[4, 2]
df_rmsse_CA_3_avg_2[5, 3] = df_rmsse_CA_3_4yr[5, 2]
df_rmsse_CA_3_avg_2[6, 3] = df_rmsse_CA_3_4yr[6, 2]

df_rmsse_CA_3_avg_2[1, 4] = df_rmsse_CA_3_5yr[1, 2]
df_rmsse_CA_3_avg_2[2, 4] = df_rmsse_CA_3_5yr[2, 2]
df_rmsse_CA_3_avg_2[3, 4] = df_rmsse_CA_3_5yr[3, 2]
df_rmsse_CA_3_avg_2[4, 4] = df_rmsse_CA_3_5yr[4, 2]
df_rmsse_CA_3_avg_2[5, 4] = df_rmsse_CA_3_5yr[5, 2]
df_rmsse_CA_3_avg_2[6, 4] = df_rmsse_CA_3_5yr[6, 2]

df_rmsse_CA_3_avg_2[1, 5] = (df_rmsse_CA_3_avg_2[1, 1] + df_rmsse_CA_3_avg_2[1, 2] + df_rmsse_CA_3_avg_2[1, 3] + df_rmsse_CA_3_avg_2[1, 4])/4 
df_rmsse_CA_3_avg_2[2, 5] = (df_rmsse_CA_3_avg_2[2, 1] + df_rmsse_CA_3_avg_2[2, 2] + df_rmsse_CA_3_avg_2[2, 3] + df_rmsse_CA_3_avg_2[2, 4])/4
df_rmsse_CA_3_avg_2[3, 5] = (df_rmsse_CA_3_avg_2[3, 1] + df_rmsse_CA_3_avg_2[3, 2] + df_rmsse_CA_3_avg_2[3, 3] + df_rmsse_CA_3_avg_2[3, 4])/4
df_rmsse_CA_3_avg_2[4, 5] = (df_rmsse_CA_3_avg_2[4, 1] + df_rmsse_CA_3_avg_2[4, 2] + df_rmsse_CA_3_avg_2[4, 3] + df_rmsse_CA_3_avg_2[4, 4])/4
df_rmsse_CA_3_avg_2[5, 5] = (df_rmsse_CA_3_avg_2[5, 1] + df_rmsse_CA_3_avg_2[5, 2] + df_rmsse_CA_3_avg_2[5, 3] + df_rmsse_CA_3_avg_2[5, 4])/4
df_rmsse_CA_3_avg_2[6, 5] = (df_rmsse_CA_3_avg_2[6, 1] + df_rmsse_CA_3_avg_2[6, 2] + df_rmsse_CA_3_avg_2[6, 3] + df_rmsse_CA_3_avg_2[6, 4])/4
colnames(df_rmsse_CA_3_avg_2) = c("split2yr","split3yr","split4yr","split5yr","avg")
rownames(df_rmsse_CA_3_avg_2) =  c("Hobbies","Household1","Household2","Foods1","Foods2","Foods3")


df_rmsse_CA_3_avg_2


```

## Results from Store VAR and Product VAR compared

```{r }

df_avg_rmsse_CA1 =  data.frame()
df_avg_rmsse_CA2 =  data.frame()
df_avg_rmsse_CA3 =  data.frame()

df_avg_rmsse_CA1[1,1] = df_rmsse_CA_1_avg[1,5]
df_avg_rmsse_CA1[2,1] = df_rmsse_CA_1_avg[2,5]
df_avg_rmsse_CA1[3,1] = df_rmsse_CA_1_avg[3,5]
df_avg_rmsse_CA1[4,1] = df_rmsse_CA_1_avg[4,5]
df_avg_rmsse_CA1[5,1] = df_rmsse_CA_1_avg[5,5]
df_avg_rmsse_CA1[6,1] = df_rmsse_CA_1_avg[6,5]

df_avg_rmsse_CA1[1,2] = df_rmsse_CA_1_avg_2[1,5]
df_avg_rmsse_CA1[2,2] = df_rmsse_CA_1_avg_2[2,5]
df_avg_rmsse_CA1[3,2] = df_rmsse_CA_1_avg_2[3,5]
df_avg_rmsse_CA1[4,2] = df_rmsse_CA_1_avg_2[4,5]
df_avg_rmsse_CA1[5,2] = df_rmsse_CA_1_avg_2[5,5]
df_avg_rmsse_CA1[6,2] = df_rmsse_CA_1_avg_2[6,5]

df_avg_rmsse_CA2[1,1] = df_rmsse_CA_2_avg[1,5]
df_avg_rmsse_CA2[2,1] = df_rmsse_CA_2_avg[2,5]
df_avg_rmsse_CA2[3,1] = df_rmsse_CA_2_avg[3,5]
df_avg_rmsse_CA2[4,1] = df_rmsse_CA_2_avg[4,5]
df_avg_rmsse_CA2[5,1] = df_rmsse_CA_2_avg[5,5]
df_avg_rmsse_CA2[6,1] = df_rmsse_CA_2_avg[6,5]

df_avg_rmsse_CA2[1,2] = df_rmsse_CA_2_avg_2[1,5]
df_avg_rmsse_CA2[2,2] = df_rmsse_CA_2_avg_2[2,5]
df_avg_rmsse_CA2[3,2] = df_rmsse_CA_2_avg_2[3,5]
df_avg_rmsse_CA2[4,2] = df_rmsse_CA_2_avg_2[4,5]
df_avg_rmsse_CA2[5,2] = df_rmsse_CA_2_avg_2[5,5]
df_avg_rmsse_CA2[6,2] = df_rmsse_CA_2_avg_2[6,5]

df_avg_rmsse_CA3[1,1] = df_rmsse_CA_3_avg[1,5]
df_avg_rmsse_CA3[2,1] = df_rmsse_CA_3_avg[2,5]
df_avg_rmsse_CA3[3,1] = df_rmsse_CA_3_avg[3,5]
df_avg_rmsse_CA3[4,1] = df_rmsse_CA_3_avg[4,5]
df_avg_rmsse_CA3[5,1] = df_rmsse_CA_3_avg[5,5]
df_avg_rmsse_CA3[6,1] = df_rmsse_CA_3_avg[6,5]

df_avg_rmsse_CA3[1,2] = df_rmsse_CA_3_avg_2[1,5]
df_avg_rmsse_CA3[2,2] = df_rmsse_CA_3_avg_2[2,5]
df_avg_rmsse_CA3[3,2] = df_rmsse_CA_3_avg_2[3,5]
df_avg_rmsse_CA3[4,2] = df_rmsse_CA_3_avg_2[4,5]
df_avg_rmsse_CA3[5,2] = df_rmsse_CA_3_avg_2[5,5]
df_avg_rmsse_CA3[6,2] = df_rmsse_CA_3_avg_2[6,5]

colnames(df_avg_rmsse_CA1) = c("avg_rmsse_21","avg_rmsse_22")
rownames(df_avg_rmsse_CA1) =  c("Hobbies","Household1","Household2","Foods1","Foods2","Foods3")

colnames(df_avg_rmsse_CA2) = c("avg_rmsse_21","avg_rmsse_22")
rownames(df_avg_rmsse_CA2) =  c("Hobbies","Household1","Household2","Foods1","Foods2","Foods3")

colnames(df_avg_rmsse_CA3) = c("avg_rmsse_21","avg_rmsse_22")
rownames(df_avg_rmsse_CA3) =  c("Hobbies","Household1","Household2","Foods1","Foods2","Foods3")

df_avg_rmsse_CA1

df_avg_rmsse_CA2

df_avg_rmsse_CA3

```


We can see that for the store 1 (CA_1) the Product VAR performs better for hobbies.
For store 2 (CA_2) the Product VAR is better in all the products.
Finally, for store 3 (CA_3) the Product VAR performs with less RMSSE in Hobbies, Household1 and Household2.


## Question 2.3- One VAR for all the dataset
### First split


#### Transformations

First train-test split for data from 2011-2012 for training and 2013 for testing. 

Three data frames are created, one for each store: df_CA_1, df_CA_2 and df_CA_3.


```{r }

# Define the train-test split 703 is 2012-12-31 and 1068 for 2013-12-31
train_sample = 703
test_sample = 1068

# Extracting the columns of the CA_1 store and renaming them
df_all = df
df_all$date = NULL

df_all_train = head(df_all, train_sample)
df_all_test  = head(df_all, test_sample)
df_all_test  = tail(df_all_test, test_sample - train_sample)

dim(df_all_train)
dim(df_all_test)

```


### Fitting VAR models

With the training data, and setting p = 1, a VAR model is fitted for each
product.

The summary statistics of the VAR are shown as output.

```{r}

var_all_train = VAR(df_all_train, p=1)
summary(var_all_train)

```

As we can see each variable of the VAR is calculated with respect to the other variables during the previous period.

Now, with the coefficients we forecast the test periods. 

```{r, echo=FALSE}

# Extract the coefficients
dcoef_all = coef(var_all_train)

# iterate the number of test samples to predict using the var coefficients

length_sample = test_sample - train_sample
for (i in 1:length_sample) {
 if (i==1) {
    df_all_test[i, 19] = dcoef_all$Hobbies_CA_1[1]*df_all_train[train_sample,1] + dcoef_all$Hobbies_CA_1[2]*df_all_train[train_sample,2] + dcoef_all$Hobbies_CA_1[3]*df_all_train[train_sample,3] + dcoef_all$Hobbies_CA_1[4]*df_all_train[train_sample,4] + dcoef_all$Hobbies_CA_1[5]*df_all_train[train_sample,5] + dcoef_all$Hobbies_CA_1[6]*df_all_train[train_sample,6] + dcoef_all$Hobbies_CA_1[7]*df_all_train[train_sample,7] + dcoef_all$Hobbies_CA_1[8]*df_all_train[train_sample,8] + dcoef_all$Hobbies_CA_1[9]*df_all_train[train_sample,9] + dcoef_all$Hobbies_CA_1[10]*df_all_train[train_sample,10] + dcoef_all$Hobbies_CA_1[11]*df_all_train[train_sample,11] + dcoef_all$Hobbies_CA_1[12]*df_all_train[train_sample,12] + dcoef_all$Hobbies_CA_1[13]*df_all_train[train_sample,13] + dcoef_all$Hobbies_CA_1[14]*df_all_train[train_sample,14] + dcoef_all$Hobbies_CA_1[15]*df_all_train[train_sample,15] + dcoef_all$Hobbies_CA_1[16]*df_all_train[train_sample,16] + dcoef_all$Hobbies_CA_1[17]*df_all_train[train_sample,17] + dcoef_all$Hobbies_CA_1[18]*df_all_train[train_sample,18] + dcoef_all$Hobbies_CA_1[19]
    df_all_test[i, 20] = dcoef_all$Household_1_CA_1[1]*df_all_train[train_sample,1] + dcoef_all$Household_1_CA_1[2]*df_all_train[train_sample,2] + dcoef_all$Household_1_CA_1[3]*df_all_train[train_sample,3] + dcoef_all$Household_1_CA_1[4]*df_all_train[train_sample,4] + dcoef_all$Household_1_CA_1[5]*df_all_train[train_sample,5] + dcoef_all$Household_1_CA_1[6]*df_all_train[train_sample,6] + dcoef_all$Household_1_CA_1[7]*df_all_train[train_sample,7] + dcoef_all$Household_1_CA_1[8]*df_all_train[train_sample,8] + dcoef_all$Household_1_CA_1[9]*df_all_train[train_sample,9] + dcoef_all$Household_1_CA_1[10]*df_all_train[train_sample,10] + dcoef_all$Household_1_CA_1[11]*df_all_train[train_sample,11] + dcoef_all$Household_1_CA_1[12]*df_all_train[train_sample,12] + dcoef_all$Household_1_CA_1[13]*df_all_train[train_sample,13] + dcoef_all$Household_1_CA_1[14]*df_all_train[train_sample,14] + dcoef_all$Household_1_CA_1[15]*df_all_train[train_sample,15] + dcoef_all$Household_1_CA_1[16]*df_all_train[train_sample,16] + dcoef_all$Household_1_CA_1[17]*df_all_train[train_sample,17] + dcoef_all$Household_1_CA_1[18]*df_all_train[train_sample,18] + dcoef_all$Household_1_CA_1[19]
    df_all_test[i, 21] = dcoef_all$Household_2_CA_1[1]*df_all_train[train_sample,1] + dcoef_all$Household_2_CA_1[2]*df_all_train[train_sample,2] + dcoef_all$Household_2_CA_1[3]*df_all_train[train_sample,3] + dcoef_all$Household_2_CA_1[4]*df_all_train[train_sample,4] + dcoef_all$Household_2_CA_1[5]*df_all_train[train_sample,5] + dcoef_all$Household_2_CA_1[6]*df_all_train[train_sample,6] + dcoef_all$Household_2_CA_1[7]*df_all_train[train_sample,7] + dcoef_all$Household_2_CA_1[8]*df_all_train[train_sample,8] + dcoef_all$Household_2_CA_1[9]*df_all_train[train_sample,9] + dcoef_all$Household_2_CA_1[10]*df_all_train[train_sample,10] + dcoef_all$Household_2_CA_1[11]*df_all_train[train_sample,11] + dcoef_all$Household_2_CA_1[12]*df_all_train[train_sample,12] + dcoef_all$Household_2_CA_1[13]*df_all_train[train_sample,13] + dcoef_all$Household_2_CA_1[14]*df_all_train[train_sample,14] + dcoef_all$Household_2_CA_1[15]*df_all_train[train_sample,15] + dcoef_all$Household_2_CA_1[16]*df_all_train[train_sample,16] + dcoef_all$Household_2_CA_1[17]*df_all_train[train_sample,17] + dcoef_all$Household_2_CA_1[18]*df_all_train[train_sample,18] + dcoef_all$Household_2_CA_1[19]
    df_all_test[i, 22] = dcoef_all$Foods_1_CA_1[1]*df_all_train[train_sample,1] + dcoef_all$Foods_1_CA_1[2]*df_all_train[train_sample,2] + dcoef_all$Foods_1_CA_1[3]*df_all_train[train_sample,3] + dcoef_all$Foods_1_CA_1[4]*df_all_train[train_sample,4] + dcoef_all$Foods_1_CA_1[5]*df_all_train[train_sample,5] + dcoef_all$Foods_1_CA_1[6]*df_all_train[train_sample,6] + dcoef_all$Foods_1_CA_1[7]*df_all_train[train_sample,7] + dcoef_all$Foods_1_CA_1[8]*df_all_train[train_sample,8] + dcoef_all$Foods_1_CA_1[9]*df_all_train[train_sample,9] + dcoef_all$Foods_1_CA_1[10]*df_all_train[train_sample,10] + dcoef_all$Foods_1_CA_1[11]*df_all_train[train_sample,11] + dcoef_all$Foods_1_CA_1[12]*df_all_train[train_sample,12] + dcoef_all$Foods_1_CA_1[13]*df_all_train[train_sample,13] + dcoef_all$Foods_1_CA_1[14]*df_all_train[train_sample,14] + dcoef_all$Foods_1_CA_1[15]*df_all_train[train_sample,15] + dcoef_all$Foods_1_CA_1[16]*df_all_train[train_sample,16] + dcoef_all$Foods_1_CA_1[17]*df_all_train[train_sample,17] + dcoef_all$Foods_1_CA_1[18]*df_all_train[train_sample,18] + dcoef_all$Foods_1_CA_1[19]
    df_all_test[i, 23] = dcoef_all$Foods_2_CA_1[1]*df_all_train[train_sample,1] + dcoef_all$Foods_2_CA_1[2]*df_all_train[train_sample,2] + dcoef_all$Foods_2_CA_1[3]*df_all_train[train_sample,3] + dcoef_all$Foods_2_CA_1[4]*df_all_train[train_sample,4] + dcoef_all$Foods_2_CA_1[5]*df_all_train[train_sample,5] + dcoef_all$Foods_2_CA_1[6]*df_all_train[train_sample,6] + dcoef_all$Foods_2_CA_1[7]*df_all_train[train_sample,7] + dcoef_all$Foods_2_CA_1[8]*df_all_train[train_sample,8] + dcoef_all$Foods_2_CA_1[9]*df_all_train[train_sample,9] + dcoef_all$Foods_2_CA_1[10]*df_all_train[train_sample,10] + dcoef_all$Foods_2_CA_1[11]*df_all_train[train_sample,11] + dcoef_all$Foods_2_CA_1[12]*df_all_train[train_sample,12] + dcoef_all$Foods_2_CA_1[13]*df_all_train[train_sample,13] + dcoef_all$Foods_2_CA_1[14]*df_all_train[train_sample,14] + dcoef_all$Foods_2_CA_1[15]*df_all_train[train_sample,15] + dcoef_all$Foods_2_CA_1[16]*df_all_train[train_sample,16] + dcoef_all$Foods_2_CA_1[17]*df_all_train[train_sample,17] + dcoef_all$Foods_2_CA_1[18]*df_all_train[train_sample,18] + dcoef_all$Foods_2_CA_1[19]
    df_all_test[i, 24] = dcoef_all$Foods_3_CA_1[1]*df_all_train[train_sample,1] + dcoef_all$Foods_3_CA_1[2]*df_all_train[train_sample,2] + dcoef_all$Foods_3_CA_1[3]*df_all_train[train_sample,3] + dcoef_all$Foods_3_CA_1[4]*df_all_train[train_sample,4] + dcoef_all$Foods_3_CA_1[5]*df_all_train[train_sample,5] + dcoef_all$Foods_3_CA_1[6]*df_all_train[train_sample,6] + dcoef_all$Foods_3_CA_1[7]*df_all_train[train_sample,7] + dcoef_all$Foods_3_CA_1[8]*df_all_train[train_sample,8] + dcoef_all$Foods_3_CA_1[9]*df_all_train[train_sample,9] + dcoef_all$Foods_3_CA_1[10]*df_all_train[train_sample,10] + dcoef_all$Foods_3_CA_1[11]*df_all_train[train_sample,11] + dcoef_all$Foods_3_CA_1[12]*df_all_train[train_sample,12] + dcoef_all$Foods_3_CA_1[13]*df_all_train[train_sample,13] + dcoef_all$Foods_3_CA_1[14]*df_all_train[train_sample,14] + dcoef_all$Foods_3_CA_1[15]*df_all_train[train_sample,15] + dcoef_all$Foods_3_CA_1[16]*df_all_train[train_sample,16] + dcoef_all$Foods_3_CA_1[17]*df_all_train[train_sample,17] + dcoef_all$Foods_3_CA_1[18]*df_all_train[train_sample,18] + dcoef_all$Foods_3_CA_1[19]
    df_all_test[i, 25] = dcoef_all$Hobbies_CA_2[1]*df_all_train[train_sample,1] + dcoef_all$Hobbies_CA_2[2]*df_all_train[train_sample,2] + dcoef_all$Hobbies_CA_2[3]*df_all_train[train_sample,3] + dcoef_all$Hobbies_CA_2[4]*df_all_train[train_sample,4] + dcoef_all$Hobbies_CA_2[5]*df_all_train[train_sample,5] + dcoef_all$Hobbies_CA_2[6]*df_all_train[train_sample,6] + dcoef_all$Hobbies_CA_2[7]*df_all_train[train_sample,7] + dcoef_all$Hobbies_CA_2[8]*df_all_train[train_sample,8] + dcoef_all$Hobbies_CA_2[9]*df_all_train[train_sample,9] + dcoef_all$Hobbies_CA_2[10]*df_all_train[train_sample,10] + dcoef_all$Hobbies_CA_2[11]*df_all_train[train_sample,11] + dcoef_all$Hobbies_CA_2[12]*df_all_train[train_sample,12] + dcoef_all$Hobbies_CA_2[13]*df_all_train[train_sample,13] + dcoef_all$Hobbies_CA_2[14]*df_all_train[train_sample,14] + dcoef_all$Hobbies_CA_2[15]*df_all_train[train_sample,15] + dcoef_all$Hobbies_CA_2[16]*df_all_train[train_sample,16] + dcoef_all$Hobbies_CA_2[17]*df_all_train[train_sample,17] + dcoef_all$Hobbies_CA_2[18]*df_all_train[train_sample,18] + dcoef_all$Hobbies_CA_2[19]
    df_all_test[i, 26] = dcoef_all$Household_1_CA_2[1]*df_all_train[train_sample,1] + dcoef_all$Household_1_CA_2[2]*df_all_train[train_sample,2] + dcoef_all$Household_1_CA_2[3]*df_all_train[train_sample,3] + dcoef_all$Household_1_CA_2[4]*df_all_train[train_sample,4] + dcoef_all$Household_1_CA_2[5]*df_all_train[train_sample,5] + dcoef_all$Household_1_CA_2[6]*df_all_train[train_sample,6] + dcoef_all$Household_1_CA_2[7]*df_all_train[train_sample,7] + dcoef_all$Household_1_CA_2[8]*df_all_train[train_sample,8] + dcoef_all$Household_1_CA_2[9]*df_all_train[train_sample,9] + dcoef_all$Household_1_CA_2[10]*df_all_train[train_sample,10] + dcoef_all$Household_1_CA_2[11]*df_all_train[train_sample,11] + dcoef_all$Household_1_CA_2[12]*df_all_train[train_sample,12] + dcoef_all$Household_1_CA_2[13]*df_all_train[train_sample,13] + dcoef_all$Household_1_CA_2[14]*df_all_train[train_sample,14] + dcoef_all$Household_1_CA_2[15]*df_all_train[train_sample,15] + dcoef_all$Household_1_CA_2[16]*df_all_train[train_sample,16] + dcoef_all$Household_1_CA_2[17]*df_all_train[train_sample,17] + dcoef_all$Household_1_CA_2[18]*df_all_train[train_sample,18] + dcoef_all$Household_1_CA_2[19]
    df_all_test[i, 27] = dcoef_all$Household_2_CA_2[1]*df_all_train[train_sample,1] + dcoef_all$Household_2_CA_2[2]*df_all_train[train_sample,2] + dcoef_all$Household_2_CA_2[3]*df_all_train[train_sample,3] + dcoef_all$Household_2_CA_2[4]*df_all_train[train_sample,4] + dcoef_all$Household_2_CA_2[5]*df_all_train[train_sample,5] + dcoef_all$Household_2_CA_2[6]*df_all_train[train_sample,6] + dcoef_all$Household_2_CA_2[7]*df_all_train[train_sample,7] + dcoef_all$Household_2_CA_2[8]*df_all_train[train_sample,8] + dcoef_all$Household_2_CA_2[9]*df_all_train[train_sample,9] + dcoef_all$Household_2_CA_2[10]*df_all_train[train_sample,10] + dcoef_all$Household_2_CA_2[11]*df_all_train[train_sample,11] + dcoef_all$Household_2_CA_2[12]*df_all_train[train_sample,12] + dcoef_all$Household_2_CA_2[13]*df_all_train[train_sample,13] + dcoef_all$Household_2_CA_2[14]*df_all_train[train_sample,14] + dcoef_all$Household_2_CA_2[15]*df_all_train[train_sample,15] + dcoef_all$Household_2_CA_2[16]*df_all_train[train_sample,16] + dcoef_all$Household_2_CA_2[17]*df_all_train[train_sample,17] + dcoef_all$Household_2_CA_2[18]*df_all_train[train_sample,18] + dcoef_all$Household_2_CA_2[19]
    df_all_test[i, 28] = dcoef_all$Foods_1_CA_2[1]*df_all_train[train_sample,1] + dcoef_all$Foods_1_CA_2[2]*df_all_train[train_sample,2] + dcoef_all$Foods_1_CA_2[3]*df_all_train[train_sample,3] + dcoef_all$Foods_1_CA_2[4]*df_all_train[train_sample,4] + dcoef_all$Foods_1_CA_2[5]*df_all_train[train_sample,5] + dcoef_all$Foods_1_CA_2[6]*df_all_train[train_sample,6] + dcoef_all$Foods_1_CA_2[7]*df_all_train[train_sample,7] + dcoef_all$Foods_1_CA_2[8]*df_all_train[train_sample,8] + dcoef_all$Foods_1_CA_2[9]*df_all_train[train_sample,9] + dcoef_all$Foods_1_CA_2[10]*df_all_train[train_sample,10] + dcoef_all$Foods_1_CA_2[11]*df_all_train[train_sample,11] + dcoef_all$Foods_1_CA_2[12]*df_all_train[train_sample,12] + dcoef_all$Foods_1_CA_2[13]*df_all_train[train_sample,13] + dcoef_all$Foods_1_CA_2[14]*df_all_train[train_sample,14] + dcoef_all$Foods_1_CA_2[15]*df_all_train[train_sample,15] + dcoef_all$Foods_1_CA_2[16]*df_all_train[train_sample,16] + dcoef_all$Foods_1_CA_2[17]*df_all_train[train_sample,17] + dcoef_all$Foods_1_CA_2[18]*df_all_train[train_sample,18] + dcoef_all$Foods_1_CA_2[19]
    df_all_test[i, 29] = dcoef_all$Foods_2_CA_2[1]*df_all_train[train_sample,1] + dcoef_all$Foods_2_CA_2[2]*df_all_train[train_sample,2] + dcoef_all$Foods_2_CA_2[3]*df_all_train[train_sample,3] + dcoef_all$Foods_2_CA_2[4]*df_all_train[train_sample,4] + dcoef_all$Foods_2_CA_2[5]*df_all_train[train_sample,5] + dcoef_all$Foods_2_CA_2[6]*df_all_train[train_sample,6] + dcoef_all$Foods_2_CA_2[7]*df_all_train[train_sample,7] + dcoef_all$Foods_2_CA_2[8]*df_all_train[train_sample,8] + dcoef_all$Foods_2_CA_2[9]*df_all_train[train_sample,9] + dcoef_all$Foods_2_CA_2[10]*df_all_train[train_sample,10] + dcoef_all$Foods_2_CA_2[11]*df_all_train[train_sample,11] + dcoef_all$Foods_2_CA_2[12]*df_all_train[train_sample,12] + dcoef_all$Foods_2_CA_2[13]*df_all_train[train_sample,13] + dcoef_all$Foods_2_CA_2[14]*df_all_train[train_sample,14] + dcoef_all$Foods_2_CA_2[15]*df_all_train[train_sample,15] + dcoef_all$Foods_2_CA_2[16]*df_all_train[train_sample,16] + dcoef_all$Foods_2_CA_2[17]*df_all_train[train_sample,17] + dcoef_all$Foods_2_CA_2[18]*df_all_train[train_sample,18] + dcoef_all$Foods_2_CA_2[19]
    df_all_test[i, 30] = dcoef_all$Foods_3_CA_2[1]*df_all_train[train_sample,1] + dcoef_all$Foods_3_CA_2[2]*df_all_train[train_sample,2] + dcoef_all$Foods_3_CA_2[3]*df_all_train[train_sample,3] + dcoef_all$Foods_3_CA_2[4]*df_all_train[train_sample,4] + dcoef_all$Foods_3_CA_2[5]*df_all_train[train_sample,5] + dcoef_all$Foods_3_CA_2[6]*df_all_train[train_sample,6] + dcoef_all$Foods_3_CA_2[7]*df_all_train[train_sample,7] + dcoef_all$Foods_3_CA_2[8]*df_all_train[train_sample,8] + dcoef_all$Foods_3_CA_2[9]*df_all_train[train_sample,9] + dcoef_all$Foods_3_CA_2[10]*df_all_train[train_sample,10] + dcoef_all$Foods_3_CA_2[11]*df_all_train[train_sample,11] + dcoef_all$Foods_3_CA_2[12]*df_all_train[train_sample,12] + dcoef_all$Foods_3_CA_2[13]*df_all_train[train_sample,13] + dcoef_all$Foods_3_CA_2[14]*df_all_train[train_sample,14] + dcoef_all$Foods_3_CA_2[15]*df_all_train[train_sample,15] + dcoef_all$Foods_3_CA_2[16]*df_all_train[train_sample,16] + dcoef_all$Foods_3_CA_2[17]*df_all_train[train_sample,17] + dcoef_all$Foods_3_CA_2[18]*df_all_train[train_sample,18] + dcoef_all$Foods_3_CA_2[19]
    df_all_test[i, 31] = dcoef_all$Hobbies_CA_3[1]*df_all_train[train_sample,1] + dcoef_all$Hobbies_CA_3[2]*df_all_train[train_sample,2] + dcoef_all$Hobbies_CA_3[3]*df_all_train[train_sample,3] + dcoef_all$Hobbies_CA_3[4]*df_all_train[train_sample,4] + dcoef_all$Hobbies_CA_3[5]*df_all_train[train_sample,5] + dcoef_all$Hobbies_CA_3[6]*df_all_train[train_sample,6] + dcoef_all$Hobbies_CA_3[7]*df_all_train[train_sample,7] + dcoef_all$Hobbies_CA_3[8]*df_all_train[train_sample,8] + dcoef_all$Hobbies_CA_3[9]*df_all_train[train_sample,9] + dcoef_all$Hobbies_CA_3[10]*df_all_train[train_sample,10] + dcoef_all$Hobbies_CA_3[11]*df_all_train[train_sample,11] + dcoef_all$Hobbies_CA_3[12]*df_all_train[train_sample,12] + dcoef_all$Hobbies_CA_3[13]*df_all_train[train_sample,13] + dcoef_all$Hobbies_CA_3[14]*df_all_train[train_sample,14] + dcoef_all$Hobbies_CA_3[15]*df_all_train[train_sample,15] + dcoef_all$Hobbies_CA_3[16]*df_all_train[train_sample,16] + dcoef_all$Hobbies_CA_3[17]*df_all_train[train_sample,17] + dcoef_all$Hobbies_CA_3[18]*df_all_train[train_sample,18] + dcoef_all$Hobbies_CA_3[19]
    df_all_test[i, 32] = dcoef_all$Household_1_CA_3[1]*df_all_train[train_sample,1] + dcoef_all$Household_1_CA_3[2]*df_all_train[train_sample,2] + dcoef_all$Household_1_CA_3[3]*df_all_train[train_sample,3] + dcoef_all$Household_1_CA_3[4]*df_all_train[train_sample,4] + dcoef_all$Household_1_CA_3[5]*df_all_train[train_sample,5] + dcoef_all$Household_1_CA_3[6]*df_all_train[train_sample,6] + dcoef_all$Household_1_CA_3[7]*df_all_train[train_sample,7] + dcoef_all$Household_1_CA_3[8]*df_all_train[train_sample,8] + dcoef_all$Household_1_CA_3[9]*df_all_train[train_sample,9] + dcoef_all$Household_1_CA_3[10]*df_all_train[train_sample,10] + dcoef_all$Household_1_CA_3[11]*df_all_train[train_sample,11] + dcoef_all$Household_1_CA_3[12]*df_all_train[train_sample,12] + dcoef_all$Household_1_CA_3[13]*df_all_train[train_sample,13] + dcoef_all$Household_1_CA_3[14]*df_all_train[train_sample,14] + dcoef_all$Household_1_CA_3[15]*df_all_train[train_sample,15] + dcoef_all$Household_1_CA_3[16]*df_all_train[train_sample,16] + dcoef_all$Household_1_CA_3[17]*df_all_train[train_sample,17] + dcoef_all$Household_1_CA_3[18]*df_all_train[train_sample,18] + dcoef_all$Household_1_CA_3[19]
    df_all_test[i, 33] = dcoef_all$Household_2_CA_3[1]*df_all_train[train_sample,1] + dcoef_all$Household_2_CA_3[2]*df_all_train[train_sample,2] + dcoef_all$Household_2_CA_3[3]*df_all_train[train_sample,3] + dcoef_all$Household_2_CA_3[4]*df_all_train[train_sample,4] + dcoef_all$Household_2_CA_3[5]*df_all_train[train_sample,5] + dcoef_all$Household_2_CA_3[6]*df_all_train[train_sample,6] + dcoef_all$Household_2_CA_3[7]*df_all_train[train_sample,7] + dcoef_all$Household_2_CA_3[8]*df_all_train[train_sample,8] + dcoef_all$Household_2_CA_3[9]*df_all_train[train_sample,9] + dcoef_all$Household_2_CA_3[10]*df_all_train[train_sample,10] + dcoef_all$Household_2_CA_3[11]*df_all_train[train_sample,11] + dcoef_all$Household_2_CA_3[12]*df_all_train[train_sample,12] + dcoef_all$Household_2_CA_3[13]*df_all_train[train_sample,13] + dcoef_all$Household_2_CA_3[14]*df_all_train[train_sample,14] + dcoef_all$Household_2_CA_3[15]*df_all_train[train_sample,15] + dcoef_all$Household_2_CA_3[16]*df_all_train[train_sample,16] + dcoef_all$Household_2_CA_3[17]*df_all_train[train_sample,17] + dcoef_all$Household_2_CA_3[18]*df_all_train[train_sample,18] + dcoef_all$Household_2_CA_3[19]
    df_all_test[i, 34] = dcoef_all$Foods_1_CA_3[1]*df_all_train[train_sample,1] + dcoef_all$Foods_1_CA_3[2]*df_all_train[train_sample,2] + dcoef_all$Foods_1_CA_3[3]*df_all_train[train_sample,3] + dcoef_all$Foods_1_CA_3[4]*df_all_train[train_sample,4] + dcoef_all$Foods_1_CA_3[5]*df_all_train[train_sample,5] + dcoef_all$Foods_1_CA_3[6]*df_all_train[train_sample,6] + dcoef_all$Foods_1_CA_3[7]*df_all_train[train_sample,7] + dcoef_all$Foods_1_CA_3[8]*df_all_train[train_sample,8] + dcoef_all$Foods_1_CA_3[9]*df_all_train[train_sample,9] + dcoef_all$Foods_1_CA_3[10]*df_all_train[train_sample,10] + dcoef_all$Foods_1_CA_3[11]*df_all_train[train_sample,11] + dcoef_all$Foods_1_CA_3[12]*df_all_train[train_sample,12] + dcoef_all$Foods_1_CA_3[13]*df_all_train[train_sample,13] + dcoef_all$Foods_1_CA_3[14]*df_all_train[train_sample,14] + dcoef_all$Foods_1_CA_3[15]*df_all_train[train_sample,15] + dcoef_all$Foods_1_CA_3[16]*df_all_train[train_sample,16] + dcoef_all$Foods_1_CA_3[17]*df_all_train[train_sample,17] + dcoef_all$Foods_1_CA_3[18]*df_all_train[train_sample,18] + dcoef_all$Foods_1_CA_3[19]
    df_all_test[i, 35] = dcoef_all$Foods_2_CA_3[1]*df_all_train[train_sample,1] + dcoef_all$Foods_2_CA_3[2]*df_all_train[train_sample,2] + dcoef_all$Foods_2_CA_3[3]*df_all_train[train_sample,3] + dcoef_all$Foods_2_CA_3[4]*df_all_train[train_sample,4] + dcoef_all$Foods_2_CA_3[5]*df_all_train[train_sample,5] + dcoef_all$Foods_2_CA_3[6]*df_all_train[train_sample,6] + dcoef_all$Foods_2_CA_3[7]*df_all_train[train_sample,7] + dcoef_all$Foods_2_CA_3[8]*df_all_train[train_sample,8] + dcoef_all$Foods_2_CA_3[9]*df_all_train[train_sample,9] + dcoef_all$Foods_2_CA_3[10]*df_all_train[train_sample,10] + dcoef_all$Foods_2_CA_3[11]*df_all_train[train_sample,11] + dcoef_all$Foods_2_CA_3[12]*df_all_train[train_sample,12] + dcoef_all$Foods_2_CA_3[13]*df_all_train[train_sample,13] + dcoef_all$Foods_2_CA_3[14]*df_all_train[train_sample,14] + dcoef_all$Foods_2_CA_3[15]*df_all_train[train_sample,15] + dcoef_all$Foods_2_CA_3[16]*df_all_train[train_sample,16] + dcoef_all$Foods_2_CA_3[17]*df_all_train[train_sample,17] + dcoef_all$Foods_2_CA_3[18]*df_all_train[train_sample,18] + dcoef_all$Foods_2_CA_3[19]
    df_all_test[i, 36] = dcoef_all$Foods_3_CA_3[1]*df_all_train[train_sample,1] + dcoef_all$Foods_3_CA_3[2]*df_all_train[train_sample,2] + dcoef_all$Foods_3_CA_3[3]*df_all_train[train_sample,3] + dcoef_all$Foods_3_CA_3[4]*df_all_train[train_sample,4] + dcoef_all$Foods_3_CA_3[5]*df_all_train[train_sample,5] + dcoef_all$Foods_3_CA_3[6]*df_all_train[train_sample,6] + dcoef_all$Foods_3_CA_3[7]*df_all_train[train_sample,7] + dcoef_all$Foods_3_CA_3[8]*df_all_train[train_sample,8] + dcoef_all$Foods_3_CA_3[9]*df_all_train[train_sample,9] + dcoef_all$Foods_3_CA_3[10]*df_all_train[train_sample,10] + dcoef_all$Foods_3_CA_3[11]*df_all_train[train_sample,11] + dcoef_all$Foods_3_CA_3[12]*df_all_train[train_sample,12] + dcoef_all$Foods_3_CA_3[13]*df_all_train[train_sample,13] + dcoef_all$Foods_3_CA_3[14]*df_all_train[train_sample,14] + dcoef_all$Foods_3_CA_3[15]*df_all_train[train_sample,15] + dcoef_all$Foods_3_CA_3[16]*df_all_train[train_sample,16] + dcoef_all$Foods_3_CA_3[17]*df_all_train[train_sample,17] + dcoef_all$Foods_3_CA_3[18]*df_all_train[train_sample,18] + dcoef_all$Foods_3_CA_3[19]
    
  }
  else {
    df_all_test[i, 19] = dcoef_all$Hobbies_CA_1[1]*df_all_test[i-1,1] + dcoef_all$Hobbies_CA_1[2]*df_all_test[i-1,2] + dcoef_all$Hobbies_CA_1[3]*df_all_test[i-1,3] + dcoef_all$Hobbies_CA_1[4]*df_all_test[i-1,4] + dcoef_all$Hobbies_CA_1[5]*df_all_test[i-1,5] + dcoef_all$Hobbies_CA_1[6]*df_all_test[i-1,6] + dcoef_all$Hobbies_CA_1[7]*df_all_test[i-1,7] + dcoef_all$Hobbies_CA_1[8]*df_all_test[i-1,8] + dcoef_all$Hobbies_CA_1[9]*df_all_test[i-1,9] + dcoef_all$Hobbies_CA_1[10]*df_all_test[i-1,10] + dcoef_all$Hobbies_CA_1[11]*df_all_test[i-1,11] + dcoef_all$Hobbies_CA_1[12]*df_all_test[i-1,12] + dcoef_all$Hobbies_CA_1[13]*df_all_test[i-1,13] + dcoef_all$Hobbies_CA_1[14]*df_all_test[i-1,14] + dcoef_all$Hobbies_CA_1[15]*df_all_test[i-1,15] + dcoef_all$Hobbies_CA_1[16]*df_all_test[i-1,16] + dcoef_all$Hobbies_CA_1[17]*df_all_test[i-1,17] + dcoef_all$Hobbies_CA_1[18]*df_all_test[i-1,18] + dcoef_all$Hobbies_CA_1[19]
    df_all_test[i, 20] = dcoef_all$Household_1_CA_1[1]*df_all_test[i-1,1] + dcoef_all$Household_1_CA_1[2]*df_all_test[i-1,2] + dcoef_all$Household_1_CA_1[3]*df_all_test[i-1,3] + dcoef_all$Household_1_CA_1[4]*df_all_test[i-1,4] + dcoef_all$Household_1_CA_1[5]*df_all_test[i-1,5] + dcoef_all$Household_1_CA_1[6]*df_all_test[i-1,6] + dcoef_all$Household_1_CA_1[7]*df_all_test[i-1,7] + dcoef_all$Household_1_CA_1[8]*df_all_test[i-1,8] + dcoef_all$Household_1_CA_1[9]*df_all_test[i-1,9] + dcoef_all$Household_1_CA_1[10]*df_all_test[i-1,10] + dcoef_all$Household_1_CA_1[11]*df_all_test[i-1,11] + dcoef_all$Household_1_CA_1[12]*df_all_test[i-1,12] + dcoef_all$Household_1_CA_1[13]*df_all_test[i-1,13] + dcoef_all$Household_1_CA_1[14]*df_all_test[i-1,14] + dcoef_all$Household_1_CA_1[15]*df_all_test[i-1,15] + dcoef_all$Household_1_CA_1[16]*df_all_test[i-1,16] + dcoef_all$Household_1_CA_1[17]*df_all_test[i-1,17] + dcoef_all$Household_1_CA_1[18]*df_all_test[i-1,18] + dcoef_all$Household_1_CA_1[19]
    df_all_test[i, 21] = dcoef_all$Household_2_CA_1[1]*df_all_test[i-1,1] + dcoef_all$Household_2_CA_1[2]*df_all_test[i-1,2] + dcoef_all$Household_2_CA_1[3]*df_all_test[i-1,3] + dcoef_all$Household_2_CA_1[4]*df_all_test[i-1,4] + dcoef_all$Household_2_CA_1[5]*df_all_test[i-1,5] + dcoef_all$Household_2_CA_1[6]*df_all_test[i-1,6] + dcoef_all$Household_2_CA_1[7]*df_all_test[i-1,7] + dcoef_all$Household_2_CA_1[8]*df_all_test[i-1,8] + dcoef_all$Household_2_CA_1[9]*df_all_test[i-1,9] + dcoef_all$Household_2_CA_1[10]*df_all_test[i-1,10] + dcoef_all$Household_2_CA_1[11]*df_all_test[i-1,11] + dcoef_all$Household_2_CA_1[12]*df_all_test[i-1,12] + dcoef_all$Household_2_CA_1[13]*df_all_test[i-1,13] + dcoef_all$Household_2_CA_1[14]*df_all_test[i-1,14] + dcoef_all$Household_2_CA_1[15]*df_all_test[i-1,15] + dcoef_all$Household_2_CA_1[16]*df_all_test[i-1,16] + dcoef_all$Household_2_CA_1[17]*df_all_test[i-1,17] + dcoef_all$Household_2_CA_1[18]*df_all_test[i-1,18] + dcoef_all$Household_2_CA_1[19]
    df_all_test[i, 22] = dcoef_all$Foods_1_CA_1[1]*df_all_test[i-1,1] + dcoef_all$Foods_1_CA_1[2]*df_all_test[i-1,2] + dcoef_all$Foods_1_CA_1[3]*df_all_test[i-1,3] + dcoef_all$Foods_1_CA_1[4]*df_all_test[i-1,4] + dcoef_all$Foods_1_CA_1[5]*df_all_test[i-1,5] + dcoef_all$Foods_1_CA_1[6]*df_all_test[i-1,6] + dcoef_all$Foods_1_CA_1[7]*df_all_test[i-1,7] + dcoef_all$Foods_1_CA_1[8]*df_all_test[i-1,8] + dcoef_all$Foods_1_CA_1[9]*df_all_test[i-1,9] + dcoef_all$Foods_1_CA_1[10]*df_all_test[i-1,10] + dcoef_all$Foods_1_CA_1[11]*df_all_test[i-1,11] + dcoef_all$Foods_1_CA_1[12]*df_all_test[i-1,12] + dcoef_all$Foods_1_CA_1[13]*df_all_test[i-1,13] + dcoef_all$Foods_1_CA_1[14]*df_all_test[i-1,14] + dcoef_all$Foods_1_CA_1[15]*df_all_test[i-1,15] + dcoef_all$Foods_1_CA_1[16]*df_all_test[i-1,16] + dcoef_all$Foods_1_CA_1[17]*df_all_test[i-1,17] + dcoef_all$Foods_1_CA_1[18]*df_all_test[i-1,18] + dcoef_all$Foods_1_CA_1[19]
    df_all_test[i, 23] = dcoef_all$Foods_2_CA_1[1]*df_all_test[i-1,1] + dcoef_all$Foods_2_CA_1[2]*df_all_test[i-1,2] + dcoef_all$Foods_2_CA_1[3]*df_all_test[i-1,3] + dcoef_all$Foods_2_CA_1[4]*df_all_test[i-1,4] + dcoef_all$Foods_2_CA_1[5]*df_all_test[i-1,5] + dcoef_all$Foods_2_CA_1[6]*df_all_test[i-1,6] + dcoef_all$Foods_2_CA_1[7]*df_all_test[i-1,7] + dcoef_all$Foods_2_CA_1[8]*df_all_test[i-1,8] + dcoef_all$Foods_2_CA_1[9]*df_all_test[i-1,9] + dcoef_all$Foods_2_CA_1[10]*df_all_test[i-1,10] + dcoef_all$Foods_2_CA_1[11]*df_all_test[i-1,11] + dcoef_all$Foods_2_CA_1[12]*df_all_test[i-1,12] + dcoef_all$Foods_2_CA_1[13]*df_all_test[i-1,13] + dcoef_all$Foods_2_CA_1[14]*df_all_test[i-1,14] + dcoef_all$Foods_2_CA_1[15]*df_all_test[i-1,15] + dcoef_all$Foods_2_CA_1[16]*df_all_test[i-1,16] + dcoef_all$Foods_2_CA_1[17]*df_all_test[i-1,17] + dcoef_all$Foods_2_CA_1[18]*df_all_test[i-1,18] + dcoef_all$Foods_2_CA_1[19]
    df_all_test[i, 24] = dcoef_all$Foods_3_CA_1[1]*df_all_test[i-1,1] + dcoef_all$Foods_3_CA_1[2]*df_all_test[i-1,2] + dcoef_all$Foods_3_CA_1[3]*df_all_test[i-1,3] + dcoef_all$Foods_3_CA_1[4]*df_all_test[i-1,4] + dcoef_all$Foods_3_CA_1[5]*df_all_test[i-1,5] + dcoef_all$Foods_3_CA_1[6]*df_all_test[i-1,6] + dcoef_all$Foods_3_CA_1[7]*df_all_test[i-1,7] + dcoef_all$Foods_3_CA_1[8]*df_all_test[i-1,8] + dcoef_all$Foods_3_CA_1[9]*df_all_test[i-1,9] + dcoef_all$Foods_3_CA_1[10]*df_all_test[i-1,10] + dcoef_all$Foods_3_CA_1[11]*df_all_test[i-1,11] + dcoef_all$Foods_3_CA_1[12]*df_all_test[i-1,12] + dcoef_all$Foods_3_CA_1[13]*df_all_test[i-1,13] + dcoef_all$Foods_3_CA_1[14]*df_all_test[i-1,14] + dcoef_all$Foods_3_CA_1[15]*df_all_test[i-1,15] + dcoef_all$Foods_3_CA_1[16]*df_all_test[i-1,16] + dcoef_all$Foods_3_CA_1[17]*df_all_test[i-1,17] + dcoef_all$Foods_3_CA_1[18]*df_all_test[i-1,18] + dcoef_all$Foods_3_CA_1[19]
    df_all_test[i, 25] = dcoef_all$Hobbies_CA_2[1]*df_all_test[i-1,1] + dcoef_all$Hobbies_CA_2[2]*df_all_test[i-1,2] + dcoef_all$Hobbies_CA_2[3]*df_all_test[i-1,3] + dcoef_all$Hobbies_CA_2[4]*df_all_test[i-1,4] + dcoef_all$Hobbies_CA_2[5]*df_all_test[i-1,5] + dcoef_all$Hobbies_CA_2[6]*df_all_test[i-1,6] + dcoef_all$Hobbies_CA_2[7]*df_all_test[i-1,7] + dcoef_all$Hobbies_CA_2[8]*df_all_test[i-1,8] + dcoef_all$Hobbies_CA_2[9]*df_all_test[i-1,9] + dcoef_all$Hobbies_CA_2[10]*df_all_test[i-1,10] + dcoef_all$Hobbies_CA_2[11]*df_all_test[i-1,11] + dcoef_all$Hobbies_CA_2[12]*df_all_test[i-1,12] + dcoef_all$Hobbies_CA_2[13]*df_all_test[i-1,13] + dcoef_all$Hobbies_CA_2[14]*df_all_test[i-1,14] + dcoef_all$Hobbies_CA_2[15]*df_all_test[i-1,15] + dcoef_all$Hobbies_CA_2[16]*df_all_test[i-1,16] + dcoef_all$Hobbies_CA_2[17]*df_all_test[i-1,17] + dcoef_all$Hobbies_CA_2[18]*df_all_test[i-1,18] + dcoef_all$Hobbies_CA_2[19]
    df_all_test[i, 26] = dcoef_all$Household_1_CA_2[1]*df_all_test[i-1,1] + dcoef_all$Household_1_CA_2[2]*df_all_test[i-1,2] + dcoef_all$Household_1_CA_2[3]*df_all_test[i-1,3] + dcoef_all$Household_1_CA_2[4]*df_all_test[i-1,4] + dcoef_all$Household_1_CA_2[5]*df_all_test[i-1,5] + dcoef_all$Household_1_CA_2[6]*df_all_test[i-1,6] + dcoef_all$Household_1_CA_2[7]*df_all_test[i-1,7] + dcoef_all$Household_1_CA_2[8]*df_all_test[i-1,8] + dcoef_all$Household_1_CA_2[9]*df_all_test[i-1,9] + dcoef_all$Household_1_CA_2[10]*df_all_test[i-1,10] + dcoef_all$Household_1_CA_2[11]*df_all_test[i-1,11] + dcoef_all$Household_1_CA_2[12]*df_all_test[i-1,12] + dcoef_all$Household_1_CA_2[13]*df_all_test[i-1,13] + dcoef_all$Household_1_CA_2[14]*df_all_test[i-1,14] + dcoef_all$Household_1_CA_2[15]*df_all_test[i-1,15] + dcoef_all$Household_1_CA_2[16]*df_all_test[i-1,16] + dcoef_all$Household_1_CA_2[17]*df_all_test[i-1,17] + dcoef_all$Household_1_CA_2[18]*df_all_test[i-1,18] + dcoef_all$Household_1_CA_2[19]
    df_all_test[i, 27] = dcoef_all$Household_2_CA_2[1]*df_all_test[i-1,1] + dcoef_all$Household_2_CA_2[2]*df_all_test[i-1,2] + dcoef_all$Household_2_CA_2[3]*df_all_test[i-1,3] + dcoef_all$Household_2_CA_2[4]*df_all_test[i-1,4] + dcoef_all$Household_2_CA_2[5]*df_all_test[i-1,5] + dcoef_all$Household_2_CA_2[6]*df_all_test[i-1,6] + dcoef_all$Household_2_CA_2[7]*df_all_test[i-1,7] + dcoef_all$Household_2_CA_2[8]*df_all_test[i-1,8] + dcoef_all$Household_2_CA_2[9]*df_all_test[i-1,9] + dcoef_all$Household_2_CA_2[10]*df_all_test[i-1,10] + dcoef_all$Household_2_CA_2[11]*df_all_test[i-1,11] + dcoef_all$Household_2_CA_2[12]*df_all_test[i-1,12] + dcoef_all$Household_2_CA_2[13]*df_all_test[i-1,13] + dcoef_all$Household_2_CA_2[14]*df_all_test[i-1,14] + dcoef_all$Household_2_CA_2[15]*df_all_test[i-1,15] + dcoef_all$Household_2_CA_2[16]*df_all_test[i-1,16] + dcoef_all$Household_2_CA_2[17]*df_all_test[i-1,17] + dcoef_all$Household_2_CA_2[18]*df_all_test[i-1,18] + dcoef_all$Household_2_CA_2[19]
    df_all_test[i, 28] = dcoef_all$Foods_1_CA_2[1]*df_all_test[i-1,1] + dcoef_all$Foods_1_CA_2[2]*df_all_test[i-1,2] + dcoef_all$Foods_1_CA_2[3]*df_all_test[i-1,3] + dcoef_all$Foods_1_CA_2[4]*df_all_test[i-1,4] + dcoef_all$Foods_1_CA_2[5]*df_all_test[i-1,5] + dcoef_all$Foods_1_CA_2[6]*df_all_test[i-1,6] + dcoef_all$Foods_1_CA_2[7]*df_all_test[i-1,7] + dcoef_all$Foods_1_CA_2[8]*df_all_test[i-1,8] + dcoef_all$Foods_1_CA_2[9]*df_all_test[i-1,9] + dcoef_all$Foods_1_CA_2[10]*df_all_test[i-1,10] + dcoef_all$Foods_1_CA_2[11]*df_all_test[i-1,11] + dcoef_all$Foods_1_CA_2[12]*df_all_test[i-1,12] + dcoef_all$Foods_1_CA_2[13]*df_all_test[i-1,13] + dcoef_all$Foods_1_CA_2[14]*df_all_test[i-1,14] + dcoef_all$Foods_1_CA_2[15]*df_all_test[i-1,15] + dcoef_all$Foods_1_CA_2[16]*df_all_test[i-1,16] + dcoef_all$Foods_1_CA_2[17]*df_all_test[i-1,17] + dcoef_all$Foods_1_CA_2[18]*df_all_test[i-1,18] + dcoef_all$Foods_1_CA_2[19]
    df_all_test[i, 29] = dcoef_all$Foods_2_CA_2[1]*df_all_test[i-1,1] + dcoef_all$Foods_2_CA_2[2]*df_all_test[i-1,2] + dcoef_all$Foods_2_CA_2[3]*df_all_test[i-1,3] + dcoef_all$Foods_2_CA_2[4]*df_all_test[i-1,4] + dcoef_all$Foods_2_CA_2[5]*df_all_test[i-1,5] + dcoef_all$Foods_2_CA_2[6]*df_all_test[i-1,6] + dcoef_all$Foods_2_CA_2[7]*df_all_test[i-1,7] + dcoef_all$Foods_2_CA_2[8]*df_all_test[i-1,8] + dcoef_all$Foods_2_CA_2[9]*df_all_test[i-1,9] + dcoef_all$Foods_2_CA_2[10]*df_all_test[i-1,10] + dcoef_all$Foods_2_CA_2[11]*df_all_test[i-1,11] + dcoef_all$Foods_2_CA_2[12]*df_all_test[i-1,12] + dcoef_all$Foods_2_CA_2[13]*df_all_test[i-1,13] + dcoef_all$Foods_2_CA_2[14]*df_all_test[i-1,14] + dcoef_all$Foods_2_CA_2[15]*df_all_test[i-1,15] + dcoef_all$Foods_2_CA_2[16]*df_all_test[i-1,16] + dcoef_all$Foods_2_CA_2[17]*df_all_test[i-1,17] + dcoef_all$Foods_2_CA_2[18]*df_all_test[i-1,18] + dcoef_all$Foods_2_CA_2[19]
    df_all_test[i, 30] = dcoef_all$Foods_3_CA_2[1]*df_all_test[i-1,1] + dcoef_all$Foods_3_CA_2[2]*df_all_test[i-1,2] + dcoef_all$Foods_3_CA_2[3]*df_all_test[i-1,3] + dcoef_all$Foods_3_CA_2[4]*df_all_test[i-1,4] + dcoef_all$Foods_3_CA_2[5]*df_all_test[i-1,5] + dcoef_all$Foods_3_CA_2[6]*df_all_test[i-1,6] + dcoef_all$Foods_3_CA_2[7]*df_all_test[i-1,7] + dcoef_all$Foods_3_CA_2[8]*df_all_test[i-1,8] + dcoef_all$Foods_3_CA_2[9]*df_all_test[i-1,9] + dcoef_all$Foods_3_CA_2[10]*df_all_test[i-1,10] + dcoef_all$Foods_3_CA_2[11]*df_all_test[i-1,11] + dcoef_all$Foods_3_CA_2[12]*df_all_test[i-1,12] + dcoef_all$Foods_3_CA_2[13]*df_all_test[i-1,13] + dcoef_all$Foods_3_CA_2[14]*df_all_test[i-1,14] + dcoef_all$Foods_3_CA_2[15]*df_all_test[i-1,15] + dcoef_all$Foods_3_CA_2[16]*df_all_test[i-1,16] + dcoef_all$Foods_3_CA_2[17]*df_all_test[i-1,17] + dcoef_all$Foods_3_CA_2[18]*df_all_test[i-1,18] + dcoef_all$Foods_3_CA_2[19]
    df_all_test[i, 31] = dcoef_all$Hobbies_CA_3[1]*df_all_test[i-1,1] + dcoef_all$Hobbies_CA_3[2]*df_all_test[i-1,2] + dcoef_all$Hobbies_CA_3[3]*df_all_test[i-1,3] + dcoef_all$Hobbies_CA_3[4]*df_all_test[i-1,4] + dcoef_all$Hobbies_CA_3[5]*df_all_test[i-1,5] + dcoef_all$Hobbies_CA_3[6]*df_all_test[i-1,6] + dcoef_all$Hobbies_CA_3[7]*df_all_test[i-1,7] + dcoef_all$Hobbies_CA_3[8]*df_all_test[i-1,8] + dcoef_all$Hobbies_CA_3[9]*df_all_test[i-1,9] + dcoef_all$Hobbies_CA_3[10]*df_all_test[i-1,10] + dcoef_all$Hobbies_CA_3[11]*df_all_test[i-1,11] + dcoef_all$Hobbies_CA_3[12]*df_all_test[i-1,12] + dcoef_all$Hobbies_CA_3[13]*df_all_test[i-1,13] + dcoef_all$Hobbies_CA_3[14]*df_all_test[i-1,14] + dcoef_all$Hobbies_CA_3[15]*df_all_test[i-1,15] + dcoef_all$Hobbies_CA_3[16]*df_all_test[i-1,16] + dcoef_all$Hobbies_CA_3[17]*df_all_test[i-1,17] + dcoef_all$Hobbies_CA_3[18]*df_all_test[i-1,18] + dcoef_all$Hobbies_CA_3[19]
    df_all_test[i, 32] = dcoef_all$Household_1_CA_3[1]*df_all_test[i-1,1] + dcoef_all$Household_1_CA_3[2]*df_all_test[i-1,2] + dcoef_all$Household_1_CA_3[3]*df_all_test[i-1,3] + dcoef_all$Household_1_CA_3[4]*df_all_test[i-1,4] + dcoef_all$Household_1_CA_3[5]*df_all_test[i-1,5] + dcoef_all$Household_1_CA_3[6]*df_all_test[i-1,6] + dcoef_all$Household_1_CA_3[7]*df_all_test[i-1,7] + dcoef_all$Household_1_CA_3[8]*df_all_test[i-1,8] + dcoef_all$Household_1_CA_3[9]*df_all_test[i-1,9] + dcoef_all$Household_1_CA_3[10]*df_all_test[i-1,10] + dcoef_all$Household_1_CA_3[11]*df_all_test[i-1,11] + dcoef_all$Household_1_CA_3[12]*df_all_test[i-1,12] + dcoef_all$Household_1_CA_3[13]*df_all_test[i-1,13] + dcoef_all$Household_1_CA_3[14]*df_all_test[i-1,14] + dcoef_all$Household_1_CA_3[15]*df_all_test[i-1,15] + dcoef_all$Household_1_CA_3[16]*df_all_test[i-1,16] + dcoef_all$Household_1_CA_3[17]*df_all_test[i-1,17] + dcoef_all$Household_1_CA_3[18]*df_all_test[i-1,18] + dcoef_all$Household_1_CA_3[19]
    df_all_test[i, 33] = dcoef_all$Household_2_CA_3[1]*df_all_test[i-1,1] + dcoef_all$Household_2_CA_3[2]*df_all_test[i-1,2] + dcoef_all$Household_2_CA_3[3]*df_all_test[i-1,3] + dcoef_all$Household_2_CA_3[4]*df_all_test[i-1,4] + dcoef_all$Household_2_CA_3[5]*df_all_test[i-1,5] + dcoef_all$Household_2_CA_3[6]*df_all_test[i-1,6] + dcoef_all$Household_2_CA_3[7]*df_all_test[i-1,7] + dcoef_all$Household_2_CA_3[8]*df_all_test[i-1,8] + dcoef_all$Household_2_CA_3[9]*df_all_test[i-1,9] + dcoef_all$Household_2_CA_3[10]*df_all_test[i-1,10] + dcoef_all$Household_2_CA_3[11]*df_all_test[i-1,11] + dcoef_all$Household_2_CA_3[12]*df_all_test[i-1,12] + dcoef_all$Household_2_CA_3[13]*df_all_test[i-1,13] + dcoef_all$Household_2_CA_3[14]*df_all_test[i-1,14] + dcoef_all$Household_2_CA_3[15]*df_all_test[i-1,15] + dcoef_all$Household_2_CA_3[16]*df_all_test[i-1,16] + dcoef_all$Household_2_CA_3[17]*df_all_test[i-1,17] + dcoef_all$Household_2_CA_3[18]*df_all_test[i-1,18] + dcoef_all$Household_2_CA_3[19]
    df_all_test[i, 34] = dcoef_all$Foods_1_CA_3[1]*df_all_test[i-1,1] + dcoef_all$Foods_1_CA_3[2]*df_all_test[i-1,2] + dcoef_all$Foods_1_CA_3[3]*df_all_test[i-1,3] + dcoef_all$Foods_1_CA_3[4]*df_all_test[i-1,4] + dcoef_all$Foods_1_CA_3[5]*df_all_test[i-1,5] + dcoef_all$Foods_1_CA_3[6]*df_all_test[i-1,6] + dcoef_all$Foods_1_CA_3[7]*df_all_test[i-1,7] + dcoef_all$Foods_1_CA_3[8]*df_all_test[i-1,8] + dcoef_all$Foods_1_CA_3[9]*df_all_test[i-1,9] + dcoef_all$Foods_1_CA_3[10]*df_all_test[i-1,10] + dcoef_all$Foods_1_CA_3[11]*df_all_test[i-1,11] + dcoef_all$Foods_1_CA_3[12]*df_all_test[i-1,12] + dcoef_all$Foods_1_CA_3[13]*df_all_test[i-1,13] + dcoef_all$Foods_1_CA_3[14]*df_all_test[i-1,14] + dcoef_all$Foods_1_CA_3[15]*df_all_test[i-1,15] + dcoef_all$Foods_1_CA_3[16]*df_all_test[i-1,16] + dcoef_all$Foods_1_CA_3[17]*df_all_test[i-1,17] + dcoef_all$Foods_1_CA_3[18]*df_all_test[i-1,18] + dcoef_all$Foods_1_CA_3[19]
    df_all_test[i, 35] = dcoef_all$Foods_2_CA_3[1]*df_all_test[i-1,1] + dcoef_all$Foods_2_CA_3[2]*df_all_test[i-1,2] + dcoef_all$Foods_2_CA_3[3]*df_all_test[i-1,3] + dcoef_all$Foods_2_CA_3[4]*df_all_test[i-1,4] + dcoef_all$Foods_2_CA_3[5]*df_all_test[i-1,5] + dcoef_all$Foods_2_CA_3[6]*df_all_test[i-1,6] + dcoef_all$Foods_2_CA_3[7]*df_all_test[i-1,7] + dcoef_all$Foods_2_CA_3[8]*df_all_test[i-1,8] + dcoef_all$Foods_2_CA_3[9]*df_all_test[i-1,9] + dcoef_all$Foods_2_CA_3[10]*df_all_test[i-1,10] + dcoef_all$Foods_2_CA_3[11]*df_all_test[i-1,11] + dcoef_all$Foods_2_CA_3[12]*df_all_test[i-1,12] + dcoef_all$Foods_2_CA_3[13]*df_all_test[i-1,13] + dcoef_all$Foods_2_CA_3[14]*df_all_test[i-1,14] + dcoef_all$Foods_2_CA_3[15]*df_all_test[i-1,15] + dcoef_all$Foods_2_CA_3[16]*df_all_test[i-1,16] + dcoef_all$Foods_2_CA_3[17]*df_all_test[i-1,17] + dcoef_all$Foods_2_CA_3[18]*df_all_test[i-1,18] + dcoef_all$Foods_2_CA_3[19]
    df_all_test[i, 36] = dcoef_all$Foods_3_CA_3[1]*df_all_test[i-1,1] + dcoef_all$Foods_3_CA_3[2]*df_all_test[i-1,2] + dcoef_all$Foods_3_CA_3[3]*df_all_test[i-1,3] + dcoef_all$Foods_3_CA_3[4]*df_all_test[i-1,4] + dcoef_all$Foods_3_CA_3[5]*df_all_test[i-1,5] + dcoef_all$Foods_3_CA_3[6]*df_all_test[i-1,6] + dcoef_all$Foods_3_CA_3[7]*df_all_test[i-1,7] + dcoef_all$Foods_3_CA_3[8]*df_all_test[i-1,8] + dcoef_all$Foods_3_CA_3[9]*df_all_test[i-1,9] + dcoef_all$Foods_3_CA_3[10]*df_all_test[i-1,10] + dcoef_all$Foods_3_CA_3[11]*df_all_test[i-1,11] + dcoef_all$Foods_3_CA_3[12]*df_all_test[i-1,12] + dcoef_all$Foods_3_CA_3[13]*df_all_test[i-1,13] + dcoef_all$Foods_3_CA_3[14]*df_all_test[i-1,14] + dcoef_all$Foods_3_CA_3[15]*df_all_test[i-1,15] + dcoef_all$Foods_3_CA_3[16]*df_all_test[i-1,16] + dcoef_all$Foods_3_CA_3[17]*df_all_test[i-1,17] + dcoef_all$Foods_3_CA_3[18]*df_all_test[i-1,18] + dcoef_all$Foods_3_CA_3[19]
        
  }
}

  
colnames(df_all_test) = c('Hobbies_CA_1','Household_1_CA_1','Household_2_CA_1','Foods_1_CA_1','Foods_2_CA_1','Foods_3_CA_1'
                          ,'Hobbies_CA_2','Household_1_CA_2','Household_2_CA_2','Foods_1_CA_2','Foods_2_CA_2','Foods_3_CA_2'
                          ,'Hobbies_CA_3','Household_1_CA_3','Household_2_CA_3','Foods_1_CA_3','Foods_2_CA_3','Foods_3_CA_3'
                          ,'Hobbies_CA_1_pred','Household_1_CA_1_pred','Household_2_CA_1_pred','Foods_1_CA_1_pred','Foods_2_CA_1_pred','Foods_3_CA_1_pred'
                          ,'Hobbies_CA_2_pred','Household_1_CA_2_pred','Household_2_CA_2_pred','Foods_1_CA_2_pred','Foods_2_CA_2_pred','Foods_3_CA_2_pred'
                          ,'Hobbies_CA_3_pred','Household_1_CA_3_pred','Household_2_CA_3_pred','Foods_1_CA_3_pred','Foods_2_CA_3_pred','Foods_3_CA_3_pred'
                          )



```

The output after predicting one-time step is:

```{r}

forecasts_all_23 = df_all_test
head(forecasts_all_23, 5)

```

The resulting data frames are used both to plot the real vs predicted time series and also to compute the RMSSE.

Now with these forecasts we plot the predicted time series (one step ahead) from the VAR model  vs the real time series, also we plot the 95% confidence interval.

### Hobbies:

```{r, echo=FALSE}

# plot the VAR time-series and estimates at 1-step 
length_x = test_sample-train_sample
x = 1:length_x


# Plot hobbies real vs predicted forecasts for each store

forecasts_all_23$Hobbies_CA_1_High = forecasts_all_23$Hobbies_CA_1_pred + 1.96 * (dcoef_all$Hobbies_CA_1[1,2] + dcoef_all$Hobbies_CA_1[2,2] + dcoef_all$Hobbies_CA_1[3,2] + dcoef_all$Hobbies_CA_1[4,2] + dcoef_all$Hobbies_CA_1[5,2] + dcoef_all$Hobbies_CA_1[6,2] + dcoef_all$Hobbies_CA_1[7,2] + dcoef_all$Hobbies_CA_1[8,2] + dcoef_all$Hobbies_CA_1[9,2] + dcoef_all$Hobbies_CA_1[10,2] + dcoef_all$Hobbies_CA_1[11,2] + dcoef_all$Hobbies_CA_1[12,2] + dcoef_all$Hobbies_CA_1[13,2] + dcoef_all$Hobbies_CA_1[14,2] + dcoef_all$Hobbies_CA_1[14,2] + dcoef_all$Hobbies_CA_1[16,2] + dcoef_all$Hobbies_CA_1[17,2] + dcoef_all$Hobbies_CA_1[18,2] + dcoef_all$Hobbies_CA_1[19,2])

forecasts_all_23$Hobbies_CA_1_Low = forecasts_all_23$Hobbies_CA_1_pred - 1.96 * (dcoef_all$Hobbies_CA_1[1,2] + dcoef_all$Hobbies_CA_1[2,2] + dcoef_all$Hobbies_CA_1[3,2] + dcoef_all$Hobbies_CA_1[4,2] + dcoef_all$Hobbies_CA_1[5,2] + dcoef_all$Hobbies_CA_1[6,2] + dcoef_all$Hobbies_CA_1[7,2] + dcoef_all$Hobbies_CA_1[8,2] + dcoef_all$Hobbies_CA_1[9,2] + dcoef_all$Hobbies_CA_1[10,2] + dcoef_all$Hobbies_CA_1[11,2] + dcoef_all$Hobbies_CA_1[12,2] + dcoef_all$Hobbies_CA_1[13,2] + dcoef_all$Hobbies_CA_1[14,2] + dcoef_all$Hobbies_CA_1[14,2] + dcoef_all$Hobbies_CA_1[16,2] + dcoef_all$Hobbies_CA_1[17,2] + dcoef_all$Hobbies_CA_1[18,2] + dcoef_all$Hobbies_CA_1[19,2])

forecasts_all_23$Hobbies_CA_2_High = forecasts_all_23$Hobbies_CA_2_pred + 1.96 * (dcoef_all$Hobbies_CA_2[1,2] + dcoef_all$Hobbies_CA_2[2,2] + dcoef_all$Hobbies_CA_2[3,2] + dcoef_all$Hobbies_CA_2[4,2] + dcoef_all$Hobbies_CA_2[5,2] + dcoef_all$Hobbies_CA_2[6,2] + dcoef_all$Hobbies_CA_2[7,2] + dcoef_all$Hobbies_CA_2[8,2] + dcoef_all$Hobbies_CA_2[9,2] + dcoef_all$Hobbies_CA_2[10,2] + dcoef_all$Hobbies_CA_2[11,2] + dcoef_all$Hobbies_CA_2[12,2] + dcoef_all$Hobbies_CA_2[13,2] + dcoef_all$Hobbies_CA_2[14,2] + dcoef_all$Hobbies_CA_2[14,2] + dcoef_all$Hobbies_CA_2[16,2] + dcoef_all$Hobbies_CA_2[17,2] + dcoef_all$Hobbies_CA_2[18,2] + dcoef_all$Hobbies_CA_2[19,2])

forecasts_all_23$Hobbies_CA_2_Low = forecasts_all_23$Hobbies_CA_2_pred - 1.96 * (dcoef_all$Hobbies_CA_2[1,2] + dcoef_all$Hobbies_CA_2[2,2] + dcoef_all$Hobbies_CA_2[3,2] + dcoef_all$Hobbies_CA_2[4,2] + dcoef_all$Hobbies_CA_2[5,2] + dcoef_all$Hobbies_CA_2[6,2] + dcoef_all$Hobbies_CA_2[7,2] + dcoef_all$Hobbies_CA_2[8,2] + dcoef_all$Hobbies_CA_2[9,2] + dcoef_all$Hobbies_CA_2[10,2] + dcoef_all$Hobbies_CA_2[11,2] + dcoef_all$Hobbies_CA_2[12,2] + dcoef_all$Hobbies_CA_2[13,2] + dcoef_all$Hobbies_CA_2[14,2] + dcoef_all$Hobbies_CA_2[14,2] + dcoef_all$Hobbies_CA_2[16,2] + dcoef_all$Hobbies_CA_2[17,2] + dcoef_all$Hobbies_CA_2[18,2] + dcoef_all$Hobbies_CA_2[19,2])


forecasts_all_23$Hobbies_CA_3_High = forecasts_all_23$Hobbies_CA_3_pred + 1.96 * (dcoef_all$Hobbies_CA_3[1,2] + dcoef_all$Hobbies_CA_3[2,2] + dcoef_all$Hobbies_CA_3[3,2] + dcoef_all$Hobbies_CA_3[4,2] + dcoef_all$Hobbies_CA_3[5,2] + dcoef_all$Hobbies_CA_3[6,2] + dcoef_all$Hobbies_CA_3[7,2] + dcoef_all$Hobbies_CA_3[8,2] + dcoef_all$Hobbies_CA_3[9,2] + dcoef_all$Hobbies_CA_3[10,2] + dcoef_all$Hobbies_CA_3[11,2] + dcoef_all$Hobbies_CA_3[12,2] + dcoef_all$Hobbies_CA_3[13,2] + dcoef_all$Hobbies_CA_3[14,2] + dcoef_all$Hobbies_CA_3[14,2] + dcoef_all$Hobbies_CA_3[16,2] + dcoef_all$Hobbies_CA_3[17,2] + dcoef_all$Hobbies_CA_3[18,2] + dcoef_all$Hobbies_CA_3[19,2])

forecasts_all_23$Hobbies_CA_3_Low = forecasts_all_23$Hobbies_CA_3_pred - 1.96 * (dcoef_all$Hobbies_CA_3[1,2] + dcoef_all$Hobbies_CA_3[2,2] + dcoef_all$Hobbies_CA_3[3,2] + dcoef_all$Hobbies_CA_3[4,2] + dcoef_all$Hobbies_CA_3[5,2] + dcoef_all$Hobbies_CA_3[6,2] + dcoef_all$Hobbies_CA_3[7,2] + dcoef_all$Hobbies_CA_3[8,2] + dcoef_all$Hobbies_CA_3[9,2] + dcoef_all$Hobbies_CA_3[10,2] + dcoef_all$Hobbies_CA_3[11,2] + dcoef_all$Hobbies_CA_3[12,2] + dcoef_all$Hobbies_CA_3[13,2] + dcoef_all$Hobbies_CA_3[14,2] + dcoef_all$Hobbies_CA_3[14,2] + dcoef_all$Hobbies_CA_3[16,2] + dcoef_all$Hobbies_CA_3[17,2] + dcoef_all$Hobbies_CA_3[18,2] + dcoef_all$Hobbies_CA_3[19,2])

print(length_x)
print(dim(forecasts_all_23$Hobbies_CA_1_Low))

plot(x, forecasts_all_23$Hobbies_CA_1, type = "l", frame = FALSE, pch = 19, col = "blue", xlab = "time", ylab = "Hobbies Store 1")
polygon(c(x,rev(x)),c(forecasts_all_23$Hobbies_CA_1_Low,rev(forecasts_all_23$Hobbies_CA_1_High)),col="thistle",border=NA)
lines(x, forecasts_all_23$Hobbies_CA_1, type = "l",  pch = 19, col = "blue")
lines(x, forecasts_all_23$Hobbies_CA_1_pred, pch = 18, col = "red", type = "l")
legend("bottomright", legend=c("Real", "Predicted", "C.I. 95%"),col=c("blue", "red","thistle"), lty = 1:1, cex=0.8)
title("Hobbies Store 1 - VAR All")

plot(x, forecasts_all_23$Hobbies_CA_2, type = "l", frame = FALSE, pch = 19, col = "blue", xlab = "time", ylab = "Hobbies Store 2")
polygon(c(x,rev(x)),c(forecasts_all_23$Hobbies_CA_2_Low,rev(forecasts_all_23$Hobbies_CA_2_High)),col="thistle",border=NA)
lines(x, forecasts_all_23$Hobbies_CA_2, type = "l",  pch = 19, col = "blue")
lines(x, forecasts_all_23$Hobbies_CA_2_pred, pch = 18, col = "red", type = "l")
legend("bottomright", legend=c("Real", "Predicted", "C.I. 95%"),col=c("blue", "red","thistle"), lty = 1:1, cex=0.8)
title("Hobbies Store 2 - VAR All")

plot(x, forecasts_all_23$Hobbies_CA_3, type = "l", frame = FALSE, pch = 19, col = "blue", xlab = "time", ylab = "Hobbies Store 3")
polygon(c(x,rev(x)),c(forecasts_all_23$Hobbies_CA_3_Low,rev(forecasts_all_23$Hobbies_CA_3_High)),col="thistle",border=NA)
lines(x, forecasts_all_23$Hobbies_CA_3, type = "l",  pch = 19, col = "blue")
lines(x, forecasts_all_23$Hobbies_CA_3_pred, pch = 18, col = "red", type = "l")
legend("bottomright", legend=c("Real", "Predicted", "C.I. 95%"),col=c("blue", "red","thistle"), lty = 1:1, cex=0.8)
title("Hobbies Store 3 - VAR All")

```



### Household 1:

```{r, echo=FALSE}

# plot the VAR time-series and estimates at 1-step 
length_x = test_sample-train_sample
x = 1:length_x

# Plot hobbies real vs predicted forecasts for each store

forecasts_all_23$Household_1_CA_1_High = forecasts_all_23$Household_1_CA_1_pred + 1.96 * (dcoef_all$Household_1_CA_1[1,2] + dcoef_all$Household_1_CA_1[2,2] + dcoef_all$Household_1_CA_1[3,2] + dcoef_all$Household_1_CA_1[4,2] + dcoef_all$Household_1_CA_1[5,2] + dcoef_all$Household_1_CA_1[6,2] + dcoef_all$Household_1_CA_1[7,2] + dcoef_all$Household_1_CA_1[8,2] + dcoef_all$Household_1_CA_1[9,2] + dcoef_all$Household_1_CA_1[10,2] + dcoef_all$Household_1_CA_1[11,2] + dcoef_all$Household_1_CA_1[12,2] + dcoef_all$Household_1_CA_1[13,2] + dcoef_all$Household_1_CA_1[14,2] + dcoef_all$Household_1_CA_1[14,2] + dcoef_all$Household_1_CA_1[16,2] + dcoef_all$Household_1_CA_1[17,2] + dcoef_all$Household_1_CA_1[18,2] + dcoef_all$Household_1_CA_1[19,2])

forecasts_all_23$Household_1_CA_1_Low = forecasts_all_23$Household_1_CA_1_pred - 1.96 * (dcoef_all$Household_1_CA_1[1,2] + dcoef_all$Household_1_CA_1[2,2] + dcoef_all$Household_1_CA_1[3,2] + dcoef_all$Household_1_CA_1[4,2] + dcoef_all$Household_1_CA_1[5,2] + dcoef_all$Household_1_CA_1[6,2] + dcoef_all$Household_1_CA_1[7,2] + dcoef_all$Household_1_CA_1[8,2] + dcoef_all$Household_1_CA_1[9,2] + dcoef_all$Household_1_CA_1[10,2] + dcoef_all$Household_1_CA_1[11,2] + dcoef_all$Household_1_CA_1[12,2] + dcoef_all$Household_1_CA_1[13,2] + dcoef_all$Household_1_CA_1[14,2] + dcoef_all$Household_1_CA_1[14,2] + dcoef_all$Household_1_CA_1[16,2] + dcoef_all$Household_1_CA_1[17,2] + dcoef_all$Household_1_CA_1[18,2] + dcoef_all$Household_1_CA_1[19,2])

forecasts_all_23$Household_1_CA_2_High = forecasts_all_23$Household_1_CA_2_pred + 1.96 * (dcoef_all$Household_1_CA_2[1,2] + dcoef_all$Household_1_CA_2[2,2] + dcoef_all$Household_1_CA_2[3,2] + dcoef_all$Household_1_CA_2[4,2] + dcoef_all$Household_1_CA_2[5,2] + dcoef_all$Household_1_CA_2[6,2] + dcoef_all$Household_1_CA_2[7,2] + dcoef_all$Household_1_CA_2[8,2] + dcoef_all$Household_1_CA_2[9,2] + dcoef_all$Household_1_CA_2[10,2] + dcoef_all$Household_1_CA_2[11,2] + dcoef_all$Household_1_CA_2[12,2] + dcoef_all$Household_1_CA_2[13,2] + dcoef_all$Household_1_CA_2[14,2] + dcoef_all$Household_1_CA_2[14,2] + dcoef_all$Household_1_CA_2[16,2] + dcoef_all$Household_1_CA_2[17,2] + dcoef_all$Household_1_CA_2[18,2] + dcoef_all$Household_1_CA_2[19,2])

forecasts_all_23$Household_1_CA_2_Low = forecasts_all_23$Household_1_CA_2_pred - 1.96 * (dcoef_all$Household_1_CA_2[1,2] + dcoef_all$Household_1_CA_2[2,2] + dcoef_all$Household_1_CA_2[3,2] + dcoef_all$Household_1_CA_2[4,2] + dcoef_all$Household_1_CA_2[5,2] + dcoef_all$Household_1_CA_2[6,2] + dcoef_all$Household_1_CA_2[7,2] + dcoef_all$Household_1_CA_2[8,2] + dcoef_all$Household_1_CA_2[9,2] + dcoef_all$Household_1_CA_2[10,2] + dcoef_all$Household_1_CA_2[11,2] + dcoef_all$Household_1_CA_2[12,2] + dcoef_all$Household_1_CA_2[13,2] + dcoef_all$Household_1_CA_2[14,2] + dcoef_all$Household_1_CA_2[14,2] + dcoef_all$Household_1_CA_2[16,2] + dcoef_all$Household_1_CA_2[17,2] + dcoef_all$Household_1_CA_2[18,2] + dcoef_all$Household_1_CA_2[19,2])


forecasts_all_23$Household_1_CA_3_High = forecasts_all_23$Household_1_CA_3_pred + 1.96 * (dcoef_all$Household_1_CA_3[1,2] + dcoef_all$Household_1_CA_3[2,2] + dcoef_all$Household_1_CA_3[3,2] + dcoef_all$Household_1_CA_3[4,2] + dcoef_all$Household_1_CA_3[5,2] + dcoef_all$Household_1_CA_3[6,2] + dcoef_all$Household_1_CA_3[7,2] + dcoef_all$Household_1_CA_3[8,2] + dcoef_all$Household_1_CA_3[9,2] + dcoef_all$Household_1_CA_3[10,2] + dcoef_all$Household_1_CA_3[11,2] + dcoef_all$Household_1_CA_3[12,2] + dcoef_all$Household_1_CA_3[13,2] + dcoef_all$Household_1_CA_3[14,2] + dcoef_all$Household_1_CA_3[14,2] + dcoef_all$Household_1_CA_3[16,2] + dcoef_all$Household_1_CA_3[17,2] + dcoef_all$Household_1_CA_3[18,2] + dcoef_all$Household_1_CA_3[19,2])

forecasts_all_23$Household_1_CA_3_Low = forecasts_all_23$Household_1_CA_3_pred - 1.96 * (dcoef_all$Household_1_CA_3[1,2] + dcoef_all$Household_1_CA_3[2,2] + dcoef_all$Household_1_CA_3[3,2] + dcoef_all$Household_1_CA_3[4,2] + dcoef_all$Household_1_CA_3[5,2] + dcoef_all$Household_1_CA_3[6,2] + dcoef_all$Household_1_CA_3[7,2] + dcoef_all$Household_1_CA_3[8,2] + dcoef_all$Household_1_CA_3[9,2] + dcoef_all$Household_1_CA_3[10,2] + dcoef_all$Household_1_CA_3[11,2] + dcoef_all$Household_1_CA_3[12,2] + dcoef_all$Household_1_CA_3[13,2] + dcoef_all$Household_1_CA_3[14,2] + dcoef_all$Household_1_CA_3[14,2] + dcoef_all$Household_1_CA_3[16,2] + dcoef_all$Household_1_CA_3[17,2] + dcoef_all$Household_1_CA_3[18,2] + dcoef_all$Household_1_CA_3[19,2])


plot(x, forecasts_all_23$Household_1_CA_1, type = "l", frame = FALSE, pch = 19, col = "blue", xlab = "time", ylab = "Household 1 Store 1")
polygon(c(x,rev(x)),c(forecasts_all_23$Household_1_CA_1_Low,rev(forecasts_all_23$Household_1_CA_1_High)),col="thistle",border=NA)
lines(x, forecasts_all_23$Household_1_CA_1, type = "l",  pch = 19, col = "blue")
lines(x, forecasts_all_23$Household_1_CA_1_pred, pch = 18, col = "red", type = "l")
legend("bottomright", legend=c("Real", "Predicted", "C.I. 95%"),col=c("blue", "red","thistle"), lty = 1:1, cex=0.8)
title("Household 1 Store 1 - VAR All")

plot(x, forecasts_all_23$Household_1_CA_2, type = "l", frame = FALSE, pch = 19, col = "blue", xlab = "time", ylab = "Household 1 Store 2")
polygon(c(x,rev(x)),c(forecasts_all_23$Household_1_CA_2_Low,rev(forecasts_all_23$Household_1_CA_2_High)),col="thistle",border=NA)
lines(x, forecasts_all_23$Household_1_CA_2, type = "l",  pch = 19, col = "blue")
lines(x, forecasts_all_23$Household_1_CA_2_pred, pch = 18, col = "red", type = "l")
legend("bottomright", legend=c("Real", "Predicted", "C.I. 95%"),col=c("blue", "red","thistle"), lty = 1:1, cex=0.8)
title("Household 1 Store 2 - VAR All")

plot(x, forecasts_all_23$Household_1_CA_3, type = "l", frame = FALSE, pch = 19, col = "blue", xlab = "time", ylab = "Household 1 Store 3")
polygon(c(x,rev(x)),c(forecasts_all_23$Household_1_CA_3_Low,rev(forecasts_all_23$Household_1_CA_3_High)),col="thistle",border=NA)
lines(x, forecasts_all_23$Household_1_CA_3, type = "l",  pch = 19, col = "blue")
lines(x, forecasts_all_23$Household_1_CA_3_pred, pch = 18, col = "red", type = "l")
legend("bottomright", legend=c("Real", "Predicted", "C.I. 95%"),col=c("blue", "red","thistle"), lty = 1:1, cex=0.8)
title("Household 1 Store 3 - VAR All")
```

### Household 2:

```{r, echo=FALSE}

# plot the VAR time-series and estimates at 1-step 
length_x = test_sample-train_sample
x = 1:length_x

# Plot hobbies real vs predicted forecasts for each store
forecasts_all_23$Household_2_CA_1_High = forecasts_all_23$Household_2_CA_1_pred + 1.96 * (dcoef_all$Household_2_CA_1[1,2] + dcoef_all$Household_2_CA_1[2,2] + dcoef_all$Household_2_CA_1[3,2] + dcoef_all$Household_2_CA_1[4,2] + dcoef_all$Household_2_CA_1[5,2] + dcoef_all$Household_2_CA_1[6,2] + dcoef_all$Household_2_CA_1[7,2] + dcoef_all$Household_2_CA_1[8,2] + dcoef_all$Household_2_CA_1[9,2] + dcoef_all$Household_2_CA_1[10,2] + dcoef_all$Household_2_CA_1[11,2] + dcoef_all$Household_2_CA_1[12,2] + dcoef_all$Household_2_CA_1[13,2] + dcoef_all$Household_2_CA_1[14,2] + dcoef_all$Household_2_CA_1[14,2] + dcoef_all$Household_2_CA_1[16,2] + dcoef_all$Household_2_CA_1[17,2] + dcoef_all$Household_2_CA_1[18,2] + dcoef_all$Household_2_CA_1[19,2])

forecasts_all_23$Household_2_CA_1_Low = forecasts_all_23$Household_2_CA_1_pred - 1.96 * (dcoef_all$Household_2_CA_1[1,2] + dcoef_all$Household_2_CA_1[2,2] + dcoef_all$Household_2_CA_1[3,2] + dcoef_all$Household_2_CA_1[4,2] + dcoef_all$Household_2_CA_1[5,2] + dcoef_all$Household_2_CA_1[6,2] + dcoef_all$Household_2_CA_1[7,2] + dcoef_all$Household_2_CA_1[8,2] + dcoef_all$Household_2_CA_1[9,2] + dcoef_all$Household_2_CA_1[10,2] + dcoef_all$Household_2_CA_1[11,2] + dcoef_all$Household_2_CA_1[12,2] + dcoef_all$Household_2_CA_1[13,2] + dcoef_all$Household_2_CA_1[14,2] + dcoef_all$Household_2_CA_1[14,2] + dcoef_all$Household_2_CA_1[16,2] + dcoef_all$Household_2_CA_1[17,2] + dcoef_all$Household_2_CA_1[18,2] + dcoef_all$Household_2_CA_1[19,2])

forecasts_all_23$Household_2_CA_2_High = forecasts_all_23$Household_2_CA_2_pred + 1.96 * (dcoef_all$Household_2_CA_2[1,2] + dcoef_all$Household_2_CA_2[2,2] + dcoef_all$Household_2_CA_2[3,2] + dcoef_all$Household_2_CA_2[4,2] + dcoef_all$Household_2_CA_2[5,2] + dcoef_all$Household_2_CA_2[6,2] + dcoef_all$Household_2_CA_2[7,2] + dcoef_all$Household_2_CA_2[8,2] + dcoef_all$Household_2_CA_2[9,2] + dcoef_all$Household_2_CA_2[10,2] + dcoef_all$Household_2_CA_2[11,2] + dcoef_all$Household_2_CA_2[12,2] + dcoef_all$Household_2_CA_2[13,2] + dcoef_all$Household_2_CA_2[14,2] + dcoef_all$Household_2_CA_2[14,2] + dcoef_all$Household_2_CA_2[16,2] + dcoef_all$Household_2_CA_2[17,2] + dcoef_all$Household_2_CA_2[18,2] + dcoef_all$Household_2_CA_2[19,2])

forecasts_all_23$Household_2_CA_2_Low = forecasts_all_23$Household_2_CA_2_pred - 1.96 * (dcoef_all$Household_2_CA_2[1,2] + dcoef_all$Household_2_CA_2[2,2] + dcoef_all$Household_2_CA_2[3,2] + dcoef_all$Household_2_CA_2[4,2] + dcoef_all$Household_2_CA_2[5,2] + dcoef_all$Household_2_CA_2[6,2] + dcoef_all$Household_2_CA_2[7,2] + dcoef_all$Household_2_CA_2[8,2] + dcoef_all$Household_2_CA_2[9,2] + dcoef_all$Household_2_CA_2[10,2] + dcoef_all$Household_2_CA_2[11,2] + dcoef_all$Household_2_CA_2[12,2] + dcoef_all$Household_2_CA_2[13,2] + dcoef_all$Household_2_CA_2[14,2] + dcoef_all$Household_2_CA_2[14,2] + dcoef_all$Household_2_CA_2[16,2] + dcoef_all$Household_2_CA_2[17,2] + dcoef_all$Household_2_CA_2[18,2] + dcoef_all$Household_2_CA_2[19,2])


forecasts_all_23$Household_2_CA_3_High = forecasts_all_23$Household_2_CA_3_pred + 1.96 * (dcoef_all$Household_2_CA_3[1,2] + dcoef_all$Household_2_CA_3[2,2] + dcoef_all$Household_2_CA_3[3,2] + dcoef_all$Household_2_CA_3[4,2] + dcoef_all$Household_2_CA_3[5,2] + dcoef_all$Household_2_CA_3[6,2] + dcoef_all$Household_2_CA_3[7,2] + dcoef_all$Household_2_CA_3[8,2] + dcoef_all$Household_2_CA_3[9,2] + dcoef_all$Household_2_CA_3[10,2] + dcoef_all$Household_2_CA_3[11,2] + dcoef_all$Household_2_CA_3[12,2] + dcoef_all$Household_2_CA_3[13,2] + dcoef_all$Household_2_CA_3[14,2] + dcoef_all$Household_2_CA_3[14,2] + dcoef_all$Household_2_CA_3[16,2] + dcoef_all$Household_2_CA_3[17,2] + dcoef_all$Household_2_CA_3[18,2] + dcoef_all$Household_2_CA_3[19,2])

forecasts_all_23$Household_2_CA_3_Low = forecasts_all_23$Household_2_CA_3_pred - 1.96 * (dcoef_all$Household_2_CA_3[1,2] + dcoef_all$Household_2_CA_3[2,2] + dcoef_all$Household_2_CA_3[3,2] + dcoef_all$Household_2_CA_3[4,2] + dcoef_all$Household_2_CA_3[5,2] + dcoef_all$Household_2_CA_3[6,2] + dcoef_all$Household_2_CA_3[7,2] + dcoef_all$Household_2_CA_3[8,2] + dcoef_all$Household_2_CA_3[9,2] + dcoef_all$Household_2_CA_3[10,2] + dcoef_all$Household_2_CA_3[11,2] + dcoef_all$Household_2_CA_3[12,2] + dcoef_all$Household_2_CA_3[13,2] + dcoef_all$Household_2_CA_3[14,2] + dcoef_all$Household_2_CA_3[14,2] + dcoef_all$Household_2_CA_3[16,2] + dcoef_all$Household_2_CA_3[17,2] + dcoef_all$Household_2_CA_3[18,2] + dcoef_all$Household_2_CA_3[19,2])


plot(x, forecasts_all_23$Household_2_CA_1, type = "l", frame = FALSE, pch = 19, col = "blue", xlab = "time", ylab = "Household 2 Store 1")
polygon(c(x,rev(x)),c(forecasts_all_23$Household_2_CA_1_Low,rev(forecasts_all_23$Household_2_CA_1_High)),col="thistle",border=NA)
lines(x, forecasts_all_23$Household_2_CA_1, type = "l",  pch = 19, col = "blue")
lines(x, forecasts_all_23$Household_2_CA_1_pred, pch = 18, col = "red", type = "l")
legend("bottomright", legend=c("Real", "Predicted", "C.I. 95%"),col=c("blue", "red","thistle"), lty = 1:1, cex=0.8)
title("Household 2 Store 1 - VAR All")

plot(x, forecasts_all_23$Household_2_CA_2, type = "l", frame = FALSE, pch = 19, col = "blue", xlab = "time", ylab = "Household 2 Store 2")
polygon(c(x,rev(x)),c(forecasts_all_23$Household_2_CA_2_Low,rev(forecasts_all_23$Household_2_CA_2_High)),col="thistle",border=NA)
lines(x, forecasts_all_23$Household_2_CA_2, type = "l",  pch = 19, col = "blue")
lines(x, forecasts_all_23$Household_2_CA_2_pred, pch = 18, col = "red", type = "l")
legend("bottomright", legend=c("Real", "Predicted", "C.I. 95%"),col=c("blue", "red","thistle"), lty = 1:1, cex=0.8)
title("Household 2 Store 2 - VAR All")

plot(x, forecasts_all_23$Household_2_CA_3, type = "l", frame = FALSE, pch = 19, col = "blue", xlab = "time", ylab = "Household 2 Store 3")
polygon(c(x,rev(x)),c(forecasts_all_23$Household_2_CA_3_Low,rev(forecasts_all_23$Household_2_CA_3_High)),col="thistle",border=NA)
lines(x, forecasts_all_23$Household_2_CA_3, type = "l",  pch = 19, col = "blue")
lines(x, forecasts_all_23$Household_2_CA_3_pred, pch = 18, col = "red", type = "l")
legend("bottomright", legend=c("Real", "Predicted", "C.I. 95%"),col=c("blue", "red","thistle"), lty = 1:1, cex=0.8)
title("Household 2 Store 3 - VAR All")

```

### Foods 1:

```{r, echo=FALSE}

# plot the VAR time-series and estimates at 1-step 
length_x = test_sample-train_sample
x = 1:length_x

# Plot hobbies real vs predicted forecasts for each store

forecasts_all_23$Foods_1_CA_1_High = forecasts_all_23$Foods_1_CA_1_pred + 1.96 * (dcoef_all$Foods_1_CA_1[1,2] + dcoef_all$Foods_1_CA_1[2,2] + dcoef_all$Foods_1_CA_1[3,2] + dcoef_all$Foods_1_CA_1[4,2] + dcoef_all$Foods_1_CA_1[5,2] + dcoef_all$Foods_1_CA_1[6,2] + dcoef_all$Foods_1_CA_1[7,2] + dcoef_all$Foods_1_CA_1[8,2] + dcoef_all$Foods_1_CA_1[9,2] + dcoef_all$Foods_1_CA_1[10,2] + dcoef_all$Foods_1_CA_1[11,2] + dcoef_all$Foods_1_CA_1[12,2] + dcoef_all$Foods_1_CA_1[13,2] + dcoef_all$Foods_1_CA_1[14,2] + dcoef_all$Foods_1_CA_1[14,2] + dcoef_all$Foods_1_CA_1[16,2] + dcoef_all$Foods_1_CA_1[17,2] + dcoef_all$Foods_1_CA_1[18,2] + dcoef_all$Foods_1_CA_1[19,2])

forecasts_all_23$Foods_1_CA_1_Low = forecasts_all_23$Foods_1_CA_1_pred - 1.96 * (dcoef_all$Foods_1_CA_1[1,2] + dcoef_all$Foods_1_CA_1[2,2] + dcoef_all$Foods_1_CA_1[3,2] + dcoef_all$Foods_1_CA_1[4,2] + dcoef_all$Foods_1_CA_1[5,2] + dcoef_all$Foods_1_CA_1[6,2] + dcoef_all$Foods_1_CA_1[7,2] + dcoef_all$Foods_1_CA_1[8,2] + dcoef_all$Foods_1_CA_1[9,2] + dcoef_all$Foods_1_CA_1[10,2] + dcoef_all$Foods_1_CA_1[11,2] + dcoef_all$Foods_1_CA_1[12,2] + dcoef_all$Foods_1_CA_1[13,2] + dcoef_all$Foods_1_CA_1[14,2] + dcoef_all$Foods_1_CA_1[14,2] + dcoef_all$Foods_1_CA_1[16,2] + dcoef_all$Foods_1_CA_1[17,2] + dcoef_all$Foods_1_CA_1[18,2] + dcoef_all$Foods_1_CA_1[19,2])

forecasts_all_23$Foods_1_CA_2_High = forecasts_all_23$Foods_1_CA_2_pred + 1.96 * (dcoef_all$Foods_1_CA_2[1,2] + dcoef_all$Foods_1_CA_2[2,2] + dcoef_all$Foods_1_CA_2[3,2] + dcoef_all$Foods_1_CA_2[4,2] + dcoef_all$Foods_1_CA_2[5,2] + dcoef_all$Foods_1_CA_2[6,2] + dcoef_all$Foods_1_CA_2[7,2] + dcoef_all$Foods_1_CA_2[8,2] + dcoef_all$Foods_1_CA_2[9,2] + dcoef_all$Foods_1_CA_2[10,2] + dcoef_all$Foods_1_CA_2[11,2] + dcoef_all$Foods_1_CA_2[12,2] + dcoef_all$Foods_1_CA_2[13,2] + dcoef_all$Foods_1_CA_2[14,2] + dcoef_all$Foods_1_CA_2[14,2] + dcoef_all$Foods_1_CA_2[16,2] + dcoef_all$Foods_1_CA_2[17,2] + dcoef_all$Foods_1_CA_2[18,2] + dcoef_all$Foods_1_CA_2[19,2])

forecasts_all_23$Foods_1_CA_2_Low = forecasts_all_23$Foods_1_CA_2_pred - 1.96 * (dcoef_all$Foods_1_CA_2[1,2] + dcoef_all$Foods_1_CA_2[2,2] + dcoef_all$Foods_1_CA_2[3,2] + dcoef_all$Foods_1_CA_2[4,2] + dcoef_all$Foods_1_CA_2[5,2] + dcoef_all$Foods_1_CA_2[6,2] + dcoef_all$Foods_1_CA_2[7,2] + dcoef_all$Foods_1_CA_2[8,2] + dcoef_all$Foods_1_CA_2[9,2] + dcoef_all$Foods_1_CA_2[10,2] + dcoef_all$Foods_1_CA_2[11,2] + dcoef_all$Foods_1_CA_2[12,2] + dcoef_all$Foods_1_CA_2[13,2] + dcoef_all$Foods_1_CA_2[14,2] + dcoef_all$Foods_1_CA_2[14,2] + dcoef_all$Foods_1_CA_2[16,2] + dcoef_all$Foods_1_CA_2[17,2] + dcoef_all$Foods_1_CA_2[18,2] + dcoef_all$Foods_1_CA_2[19,2])


forecasts_all_23$Foods_1_CA_3_High = forecasts_all_23$Foods_1_CA_3_pred + 1.96 * (dcoef_all$Foods_1_CA_3[1,2] + dcoef_all$Foods_1_CA_3[2,2] + dcoef_all$Foods_1_CA_3[3,2] + dcoef_all$Foods_1_CA_3[4,2] + dcoef_all$Foods_1_CA_3[5,2] + dcoef_all$Foods_1_CA_3[6,2] + dcoef_all$Foods_1_CA_3[7,2] + dcoef_all$Foods_1_CA_3[8,2] + dcoef_all$Foods_1_CA_3[9,2] + dcoef_all$Foods_1_CA_3[10,2] + dcoef_all$Foods_1_CA_3[11,2] + dcoef_all$Foods_1_CA_3[12,2] + dcoef_all$Foods_1_CA_3[13,2] + dcoef_all$Foods_1_CA_3[14,2] + dcoef_all$Foods_1_CA_3[14,2] + dcoef_all$Foods_1_CA_3[16,2] + dcoef_all$Foods_1_CA_3[17,2] + dcoef_all$Foods_1_CA_3[18,2] + dcoef_all$Foods_1_CA_3[19,2])

forecasts_all_23$Foods_1_CA_3_Low = forecasts_all_23$Foods_1_CA_3_pred - 1.96 * (dcoef_all$Foods_1_CA_3[1,2] + dcoef_all$Foods_1_CA_3[2,2] + dcoef_all$Foods_1_CA_3[3,2] + dcoef_all$Foods_1_CA_3[4,2] + dcoef_all$Foods_1_CA_3[5,2] + dcoef_all$Foods_1_CA_3[6,2] + dcoef_all$Foods_1_CA_3[7,2] + dcoef_all$Foods_1_CA_3[8,2] + dcoef_all$Foods_1_CA_3[9,2] + dcoef_all$Foods_1_CA_3[10,2] + dcoef_all$Foods_1_CA_3[11,2] + dcoef_all$Foods_1_CA_3[12,2] + dcoef_all$Foods_1_CA_3[13,2] + dcoef_all$Foods_1_CA_3[14,2] + dcoef_all$Foods_1_CA_3[14,2] + dcoef_all$Foods_1_CA_3[16,2] + dcoef_all$Foods_1_CA_3[17,2] + dcoef_all$Foods_1_CA_3[18,2] + dcoef_all$Foods_1_CA_3[19,2])


plot(x, forecasts_all_23$Foods_1_CA_1, type = "l", frame = FALSE, pch = 19, col = "blue", xlab = "time", ylab = "Foods 1 Store 1")
polygon(c(x,rev(x)),c(forecasts_all_23$Foods_1_CA_1_Low,rev(forecasts_all_23$Foods_1_CA_1_High)),col="thistle",border=NA)
lines(x, forecasts_all_23$Foods_1_CA_1, type = "l",  pch = 19, col = "blue")
lines(x, forecasts_all_23$Foods_1_CA_1_pred, pch = 18, col = "red", type = "l")
legend("bottomright", legend=c("Real", "Predicted", "C.I. 95%"),col=c("blue", "red","thistle"), lty = 1:1, cex=0.8)
title("Foods 1 Store 1 - VAR All")

plot(x, forecasts_all_23$Foods_1_CA_2, type = "l", frame = FALSE, pch = 19, col = "blue", xlab = "time", ylab = "Foods 1 Store 2")
polygon(c(x,rev(x)),c(forecasts_all_23$Foods_1_CA_2_Low,rev(forecasts_all_23$Foods_1_CA_2_High)),col="thistle",border=NA)
lines(x, forecasts_all_23$Foods_1_CA_2, type = "l",  pch = 19, col = "blue")
lines(x, forecasts_all_23$Foods_1_CA_2_pred, pch = 18, col = "red", type = "l")
legend("bottomright", legend=c("Real", "Predicted", "C.I. 95%"),col=c("blue", "red","thistle"), lty = 1:1, cex=0.8)
title("Foods 1 Store 2 - VAR All")

plot(x, forecasts_all_23$Foods_1_CA_3, type = "l", frame = FALSE, pch = 19, col = "blue", xlab = "time", ylab = "Foods 1 Store 3")
polygon(c(x,rev(x)),c(forecasts_all_23$Foods_1_CA_3_Low,rev(forecasts_all_23$Foods_1_CA_3_High)),col="thistle",border=NA)
lines(x, forecasts_all_23$Foods_1_CA_3, type = "l",  pch = 19, col = "blue")
lines(x, forecasts_all_23$Foods_1_CA_3_pred, pch = 18, col = "red", type = "l")
legend("bottomright", legend=c("Real", "Predicted", "C.I. 95%"),col=c("blue", "red","thistle"), lty = 1:1, cex=0.8)
title("Foods 1 Store 3 - VAR All")

```

### Foods 2:

```{r, echo=FALSE}

# plot the VAR time-series and estimates at 1-step 
length_x = test_sample-train_sample
x = 1:length_x

# Plot hobbies real vs predicted forecasts for each store

forecasts_all_23$Foods_2_CA_1_High = forecasts_all_23$Foods_2_CA_1_pred + 1.96 * (dcoef_all$Foods_2_CA_1[1,2] + dcoef_all$Foods_2_CA_1[2,2] + dcoef_all$Foods_2_CA_1[3,2] + dcoef_all$Foods_2_CA_1[4,2] + dcoef_all$Foods_2_CA_1[5,2] + dcoef_all$Foods_2_CA_1[6,2] + dcoef_all$Foods_2_CA_1[7,2] + dcoef_all$Foods_2_CA_1[8,2] + dcoef_all$Foods_2_CA_1[9,2] + dcoef_all$Foods_2_CA_1[10,2] + dcoef_all$Foods_2_CA_1[11,2] + dcoef_all$Foods_2_CA_1[12,2] + dcoef_all$Foods_2_CA_1[13,2] + dcoef_all$Foods_2_CA_1[14,2] + dcoef_all$Foods_2_CA_1[14,2] + dcoef_all$Foods_2_CA_1[16,2] + dcoef_all$Foods_2_CA_1[17,2] + dcoef_all$Foods_2_CA_1[18,2] + dcoef_all$Foods_2_CA_1[19,2])

forecasts_all_23$Foods_2_CA_1_Low = forecasts_all_23$Foods_2_CA_1_pred - 1.96 * (dcoef_all$Foods_2_CA_1[1,2] + dcoef_all$Foods_2_CA_1[2,2] + dcoef_all$Foods_2_CA_1[3,2] + dcoef_all$Foods_2_CA_1[4,2] + dcoef_all$Foods_2_CA_1[5,2] + dcoef_all$Foods_2_CA_1[6,2] + dcoef_all$Foods_2_CA_1[7,2] + dcoef_all$Foods_2_CA_1[8,2] + dcoef_all$Foods_2_CA_1[9,2] + dcoef_all$Foods_2_CA_1[10,2] + dcoef_all$Foods_2_CA_1[11,2] + dcoef_all$Foods_2_CA_1[12,2] + dcoef_all$Foods_2_CA_1[13,2] + dcoef_all$Foods_2_CA_1[14,2] + dcoef_all$Foods_2_CA_1[14,2] + dcoef_all$Foods_2_CA_1[16,2] + dcoef_all$Foods_2_CA_1[17,2] + dcoef_all$Foods_2_CA_1[18,2] + dcoef_all$Foods_2_CA_1[19,2])

forecasts_all_23$Foods_2_CA_2_High = forecasts_all_23$Foods_2_CA_2_pred + 1.96 * (dcoef_all$Foods_2_CA_2[1,2] + dcoef_all$Foods_2_CA_2[2,2] + dcoef_all$Foods_2_CA_2[3,2] + dcoef_all$Foods_2_CA_2[4,2] + dcoef_all$Foods_2_CA_2[5,2] + dcoef_all$Foods_2_CA_2[6,2] + dcoef_all$Foods_2_CA_2[7,2] + dcoef_all$Foods_2_CA_2[8,2] + dcoef_all$Foods_2_CA_2[9,2] + dcoef_all$Foods_2_CA_2[10,2] + dcoef_all$Foods_2_CA_2[11,2] + dcoef_all$Foods_2_CA_2[12,2] + dcoef_all$Foods_2_CA_2[13,2] + dcoef_all$Foods_2_CA_2[14,2] + dcoef_all$Foods_2_CA_2[14,2] + dcoef_all$Foods_2_CA_2[16,2] + dcoef_all$Foods_2_CA_2[17,2] + dcoef_all$Foods_2_CA_2[18,2] + dcoef_all$Foods_2_CA_2[19,2])

forecasts_all_23$Foods_2_CA_2_Low = forecasts_all_23$Foods_2_CA_2_pred - 1.96 * (dcoef_all$Foods_2_CA_2[1,2] + dcoef_all$Foods_2_CA_2[2,2] + dcoef_all$Foods_2_CA_2[3,2] + dcoef_all$Foods_2_CA_2[4,2] + dcoef_all$Foods_2_CA_2[5,2] + dcoef_all$Foods_2_CA_2[6,2] + dcoef_all$Foods_2_CA_2[7,2] + dcoef_all$Foods_2_CA_2[8,2] + dcoef_all$Foods_2_CA_2[9,2] + dcoef_all$Foods_2_CA_2[10,2] + dcoef_all$Foods_2_CA_2[11,2] + dcoef_all$Foods_2_CA_2[12,2] + dcoef_all$Foods_2_CA_2[13,2] + dcoef_all$Foods_2_CA_2[14,2] + dcoef_all$Foods_2_CA_2[14,2] + dcoef_all$Foods_2_CA_2[16,2] + dcoef_all$Foods_2_CA_2[17,2] + dcoef_all$Foods_2_CA_2[18,2] + dcoef_all$Foods_2_CA_2[19,2])


forecasts_all_23$Foods_2_CA_3_High = forecasts_all_23$Foods_2_CA_3_pred + 1.96 * (dcoef_all$Foods_2_CA_3[1,2] + dcoef_all$Foods_2_CA_3[2,2] + dcoef_all$Foods_2_CA_3[3,2] + dcoef_all$Foods_2_CA_3[4,2] + dcoef_all$Foods_2_CA_3[5,2] + dcoef_all$Foods_2_CA_3[6,2] + dcoef_all$Foods_2_CA_3[7,2] + dcoef_all$Foods_2_CA_3[8,2] + dcoef_all$Foods_2_CA_3[9,2] + dcoef_all$Foods_2_CA_3[10,2] + dcoef_all$Foods_2_CA_3[11,2] + dcoef_all$Foods_2_CA_3[12,2] + dcoef_all$Foods_2_CA_3[13,2] + dcoef_all$Foods_2_CA_3[14,2] + dcoef_all$Foods_2_CA_3[14,2] + dcoef_all$Foods_2_CA_3[16,2] + dcoef_all$Foods_2_CA_3[17,2] + dcoef_all$Foods_2_CA_3[18,2] + dcoef_all$Foods_2_CA_3[19,2])

forecasts_all_23$Foods_2_CA_3_Low = forecasts_all_23$Foods_2_CA_3_pred - 1.96 * (dcoef_all$Foods_2_CA_3[1,2] + dcoef_all$Foods_2_CA_3[2,2] + dcoef_all$Foods_2_CA_3[3,2] + dcoef_all$Foods_2_CA_3[4,2] + dcoef_all$Foods_2_CA_3[5,2] + dcoef_all$Foods_2_CA_3[6,2] + dcoef_all$Foods_2_CA_3[7,2] + dcoef_all$Foods_2_CA_3[8,2] + dcoef_all$Foods_2_CA_3[9,2] + dcoef_all$Foods_2_CA_3[10,2] + dcoef_all$Foods_2_CA_3[11,2] + dcoef_all$Foods_2_CA_3[12,2] + dcoef_all$Foods_2_CA_3[13,2] + dcoef_all$Foods_2_CA_3[14,2] + dcoef_all$Foods_2_CA_3[14,2] + dcoef_all$Foods_2_CA_3[16,2] + dcoef_all$Foods_2_CA_3[17,2] + dcoef_all$Foods_2_CA_3[18,2] + dcoef_all$Foods_2_CA_3[19,2])


plot(x, forecasts_all_23$Foods_2_CA_1, type = "l", frame = FALSE, pch = 19, col = "blue", xlab = "time", ylab = "Foods 2 Store 1")
polygon(c(x,rev(x)),c(forecasts_all_23$Foods_2_CA_1_Low,rev(forecasts_all_23$Foods_2_CA_1_High)),col="thistle",border=NA)
lines(x, forecasts_all_23$Foods_2_CA_1, type = "l",  pch = 19, col = "blue")
lines(x, forecasts_all_23$Foods_2_CA_1_pred, pch = 18, col = "red", type = "l")
legend("bottomright", legend=c("Real", "Predicted", "C.I. 95%"),col=c("blue", "red","thistle"), lty = 1:1, cex=0.8)
title("Foods 2 Store 1 - VAR All")

plot(x, forecasts_all_23$Foods_2_CA_2, type = "l", frame = FALSE, pch = 19, col = "blue", xlab = "time", ylab = "Foods 2 Store 2")
polygon(c(x,rev(x)),c(forecasts_all_23$Foods_2_CA_2_Low,rev(forecasts_all_23$Foods_2_CA_2_High)),col="thistle",border=NA)
lines(x, forecasts_all_23$Foods_2_CA_2, type = "l",  pch = 19, col = "blue")
lines(x, forecasts_all_23$Foods_2_CA_2_pred, pch = 18, col = "red", type = "l")
legend("bottomright", legend=c("Real", "Predicted", "C.I. 95%"),col=c("blue", "red","thistle"), lty = 1:1, cex=0.8)
title("Foods 2 Store 2 - VAR All")

plot(x, forecasts_all_23$Foods_2_CA_3, type = "l", frame = FALSE, pch = 19, col = "blue", xlab = "time", ylab = "Foods 2 Store 3")
polygon(c(x,rev(x)),c(forecasts_all_23$Foods_2_CA_3_Low,rev(forecasts_all_23$Foods_2_CA_3_High)),col="thistle",border=NA)
lines(x, forecasts_all_23$Foods_2_CA_3, type = "l",  pch = 19, col = "blue")
lines(x, forecasts_all_23$Foods_2_CA_3_pred, pch = 18, col = "red", type = "l")
legend("bottomright", legend=c("Real", "Predicted", "C.I. 95%"),col=c("blue", "red","thistle"), lty = 1:1, cex=0.8)
title("Foods 2 Store 3 - VAR All")

```

### Foods 3:

```{r, echo=FALSE}

# plot the VAR time-series and estimates at 1-step 
length_x = test_sample-train_sample
x = 1:length_x

# Plot hobbies real vs predicted forecasts for each store

forecasts_all_23$Foods_3_CA_1_High = forecasts_all_23$Foods_3_CA_1_pred + 1.96 * (dcoef_all$Foods_3_CA_1[1,2] + dcoef_all$Foods_3_CA_1[2,2] + dcoef_all$Foods_3_CA_1[3,2] + dcoef_all$Foods_3_CA_1[4,2] + dcoef_all$Foods_3_CA_1[5,2] + dcoef_all$Foods_3_CA_1[6,2] + dcoef_all$Foods_3_CA_1[7,2] + dcoef_all$Foods_3_CA_1[8,2] + dcoef_all$Foods_3_CA_1[9,2] + dcoef_all$Foods_3_CA_1[10,2] + dcoef_all$Foods_3_CA_1[11,2] + dcoef_all$Foods_3_CA_1[12,2] + dcoef_all$Foods_3_CA_1[13,2] + dcoef_all$Foods_3_CA_1[14,2] + dcoef_all$Foods_3_CA_1[14,2] + dcoef_all$Foods_3_CA_1[16,2] + dcoef_all$Foods_3_CA_1[17,2] + dcoef_all$Foods_3_CA_1[18,2] + dcoef_all$Foods_3_CA_1[19,2])

forecasts_all_23$Foods_3_CA_1_Low = forecasts_all_23$Foods_3_CA_1_pred - 1.96 * (dcoef_all$Foods_3_CA_1[1,2] + dcoef_all$Foods_3_CA_1[2,2] + dcoef_all$Foods_3_CA_1[3,2] + dcoef_all$Foods_3_CA_1[4,2] + dcoef_all$Foods_3_CA_1[5,2] + dcoef_all$Foods_3_CA_1[6,2] + dcoef_all$Foods_3_CA_1[7,2] + dcoef_all$Foods_3_CA_1[8,2] + dcoef_all$Foods_3_CA_1[9,2] + dcoef_all$Foods_3_CA_1[10,2] + dcoef_all$Foods_3_CA_1[11,2] + dcoef_all$Foods_3_CA_1[12,2] + dcoef_all$Foods_3_CA_1[13,2] + dcoef_all$Foods_3_CA_1[14,2] + dcoef_all$Foods_3_CA_1[14,2] + dcoef_all$Foods_3_CA_1[16,2] + dcoef_all$Foods_3_CA_1[17,2] + dcoef_all$Foods_3_CA_1[18,2] + dcoef_all$Foods_3_CA_1[19,2])

forecasts_all_23$Foods_3_CA_2_High = forecasts_all_23$Foods_3_CA_2_pred + 1.96 * (dcoef_all$Foods_3_CA_2[1,2] + dcoef_all$Foods_3_CA_2[2,2] + dcoef_all$Foods_3_CA_2[3,2] + dcoef_all$Foods_3_CA_2[4,2] + dcoef_all$Foods_3_CA_2[5,2] + dcoef_all$Foods_3_CA_2[6,2] + dcoef_all$Foods_3_CA_2[7,2] + dcoef_all$Foods_3_CA_2[8,2] + dcoef_all$Foods_3_CA_2[9,2] + dcoef_all$Foods_3_CA_2[10,2] + dcoef_all$Foods_3_CA_2[11,2] + dcoef_all$Foods_3_CA_2[12,2] + dcoef_all$Foods_3_CA_2[13,2] + dcoef_all$Foods_3_CA_2[14,2] + dcoef_all$Foods_3_CA_2[14,2] + dcoef_all$Foods_3_CA_2[16,2] + dcoef_all$Foods_3_CA_2[17,2] + dcoef_all$Foods_3_CA_2[18,2] + dcoef_all$Foods_3_CA_2[19,2])

forecasts_all_23$Foods_3_CA_2_Low = forecasts_all_23$Foods_3_CA_2_pred - 1.96 * (dcoef_all$Foods_3_CA_2[1,2] + dcoef_all$Foods_3_CA_2[2,2] + dcoef_all$Foods_3_CA_2[3,2] + dcoef_all$Foods_3_CA_2[4,2] + dcoef_all$Foods_3_CA_2[5,2] + dcoef_all$Foods_3_CA_2[6,2] + dcoef_all$Foods_3_CA_2[7,2] + dcoef_all$Foods_3_CA_2[8,2] + dcoef_all$Foods_3_CA_2[9,2] + dcoef_all$Foods_3_CA_2[10,2] + dcoef_all$Foods_3_CA_2[11,2] + dcoef_all$Foods_3_CA_2[12,2] + dcoef_all$Foods_3_CA_2[13,2] + dcoef_all$Foods_3_CA_2[14,2] + dcoef_all$Foods_3_CA_2[14,2] + dcoef_all$Foods_3_CA_2[16,2] + dcoef_all$Foods_3_CA_2[17,2] + dcoef_all$Foods_3_CA_2[18,2] + dcoef_all$Foods_3_CA_2[19,2])


forecasts_all_23$Foods_3_CA_3_High = forecasts_all_23$Foods_3_CA_3_pred + 1.96 * (dcoef_all$Foods_3_CA_3[1,2] + dcoef_all$Foods_3_CA_3[2,2] + dcoef_all$Foods_3_CA_3[3,2] + dcoef_all$Foods_3_CA_3[4,2] + dcoef_all$Foods_3_CA_3[5,2] + dcoef_all$Foods_3_CA_3[6,2] + dcoef_all$Foods_3_CA_3[7,2] + dcoef_all$Foods_3_CA_3[8,2] + dcoef_all$Foods_3_CA_3[9,2] + dcoef_all$Foods_3_CA_3[10,2] + dcoef_all$Foods_3_CA_3[11,2] + dcoef_all$Foods_3_CA_3[12,2] + dcoef_all$Foods_3_CA_3[13,2] + dcoef_all$Foods_3_CA_3[14,2] + dcoef_all$Foods_3_CA_3[14,2] + dcoef_all$Foods_3_CA_3[16,2] + dcoef_all$Foods_3_CA_3[17,2] + dcoef_all$Foods_3_CA_3[18,2] + dcoef_all$Foods_3_CA_3[19,2])

forecasts_all_23$Foods_3_CA_3_Low = forecasts_all_23$Foods_3_CA_3_pred - 1.96 * (dcoef_all$Foods_3_CA_3[1,2] + dcoef_all$Foods_3_CA_3[2,2] + dcoef_all$Foods_3_CA_3[3,2] + dcoef_all$Foods_3_CA_3[4,2] + dcoef_all$Foods_3_CA_3[5,2] + dcoef_all$Foods_3_CA_3[6,2] + dcoef_all$Foods_3_CA_3[7,2] + dcoef_all$Foods_3_CA_3[8,2] + dcoef_all$Foods_3_CA_3[9,2] + dcoef_all$Foods_3_CA_3[10,2] + dcoef_all$Foods_3_CA_3[11,2] + dcoef_all$Foods_3_CA_3[12,2] + dcoef_all$Foods_3_CA_3[13,2] + dcoef_all$Foods_3_CA_3[14,2] + dcoef_all$Foods_3_CA_3[14,2] + dcoef_all$Foods_3_CA_3[16,2] + dcoef_all$Foods_3_CA_3[17,2] + dcoef_all$Foods_3_CA_3[18,2] + dcoef_all$Foods_3_CA_3[19,2])


plot(x, forecasts_all_23$Foods_3_CA_1, type = "l", frame = FALSE, pch = 19, col = "blue", xlab = "time", ylab = "Foods 3 Store 1")
polygon(c(x,rev(x)),c(forecasts_all_23$Foods_3_CA_1_Low,rev(forecasts_all_23$Foods_3_CA_1_High)),col="thistle",border=NA)
lines(x, forecasts_all_23$Foods_3_CA_1, type = "l",  pch = 19, col = "blue")
lines(x, forecasts_all_23$Foods_3_CA_1_pred, pch = 18, col = "red", type = "l")
legend("bottomright", legend=c("Real", "Predicted", "C.I. 95%"),col=c("blue", "red","thistle"), lty = 1:1, cex=0.8)
title("Foods 3 Store 1 - VAR All")

plot(x, forecasts_all_23$Foods_3_CA_2, type = "l", frame = FALSE, pch = 19, col = "blue", xlab = "time", ylab = "Foods 3 Store 2")
polygon(c(x,rev(x)),c(forecasts_all_23$Foods_3_CA_2_Low,rev(forecasts_all_23$Foods_3_CA_2_High)),col="thistle",border=NA)
lines(x, forecasts_all_23$Foods_3_CA_2, type = "l",  pch = 19, col = "blue")
lines(x, forecasts_all_23$Foods_3_CA_2_pred, pch = 18, col = "red", type = "l")
legend("bottomright", legend=c("Real", "Predicted", "C.I. 95%"),col=c("blue", "red","thistle"), lty = 1:1, cex=0.8)
title("Foods 3 Store 2 - VAR All")

plot(x, forecasts_all_23$Foods_3_CA_3, type = "l", frame = FALSE, pch = 19, col = "blue", xlab = "time", ylab = "Foods 3 Store 3")
polygon(c(x,rev(x)),c(forecasts_all_23$Foods_3_CA_3_Low,rev(forecasts_all_23$Foods_3_CA_3_High)),col="thistle",border=NA)
lines(x, forecasts_all_23$Foods_3_CA_3, type = "l",  pch = 19, col = "blue")
lines(x, forecasts_all_23$Foods_3_CA_3_pred, pch = 18, col = "red", type = "l")
legend("bottomright", legend=c("Real", "Predicted", "C.I. 95%"),col=c("blue", "red","thistle"), lty = 1:1, cex=0.8)
title("Foods 3 Store 3 - VAR All")

```

Finally this allows us to calculate the RMSSE for each variable. This will be compared at the end with the other two VAR models to conclude which one is best.


```{r}

# Save the RMSSE Results in a data frame
df_rmsse_CA_1_2yr[1, 3] = RMSSE(forecasts_all_23$Hobbies_CA_1, forecasts_all_23$Hobbies_CA_1_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_1_2yr[2, 3] = RMSSE(forecasts_all_23$Household_1_CA_1, forecasts_all_23$Household_1_CA_1_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_1_2yr[3, 3] = RMSSE(forecasts_all_23$Household_2_CA_1, forecasts_all_23$Household_2_CA_1_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_1_2yr[4, 3] = RMSSE(forecasts_all_23$Foods_1_CA_1, forecasts_all_23$Foods_1_CA_1_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_1_2yr[5, 3] = RMSSE(forecasts_all_23$Foods_2_CA_1, forecasts_all_23$Foods_2_CA_1_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_1_2yr[6, 3] = RMSSE(forecasts_all_23$Foods_3_CA_1, forecasts_all_23$Foods_3_CA_1_pred, scale = 1, na.rm = TRUE)

df_rmsse_CA_2_2yr[1, 3] = RMSSE(forecasts_all_23$Hobbies_CA_2, forecasts_all_23$Hobbies_CA_2_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_2_2yr[2, 3] = RMSSE(forecasts_all_23$Household_1_CA_2, forecasts_all_23$Household_1_CA_2_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_2_2yr[3, 3] = RMSSE(forecasts_all_23$Household_2_CA_2, forecasts_all_23$Household_2_CA_2_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_2_2yr[4, 3] = RMSSE(forecasts_all_23$Foods_1_CA_2, forecasts_all_23$Foods_1_CA_2_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_2_2yr[5, 3] = RMSSE(forecasts_all_23$Foods_2_CA_2, forecasts_all_23$Foods_2_CA_2_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_2_2yr[6, 3] = RMSSE(forecasts_all_23$Foods_3_CA_2, forecasts_all_23$Foods_3_CA_2_pred, scale = 1, na.rm = TRUE)

df_rmsse_CA_3_2yr[1, 3] = RMSSE(forecasts_all_23$Hobbies_CA_3, forecasts_all_23$Hobbies_CA_3_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_3_2yr[2, 3] = RMSSE(forecasts_all_23$Household_1_CA_3, forecasts_all_23$Household_1_CA_3_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_3_2yr[3, 3] = RMSSE(forecasts_all_23$Household_2_CA_3, forecasts_all_23$Household_2_CA_3_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_3_2yr[4, 3] = RMSSE(forecasts_all_23$Foods_1_CA_3, forecasts_all_23$Foods_1_CA_3_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_3_2yr[5, 3] = RMSSE(forecasts_all_23$Foods_2_CA_3, forecasts_all_23$Foods_2_CA_3_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_3_2yr[6, 3] = RMSSE(forecasts_all_23$Foods_3_CA_3, forecasts_all_23$Foods_3_CA_3_pred, scale = 1, na.rm = TRUE)

rownames(df_rmsse_CA_1_2yr) =  c("Hobbies","Household1","Household2","Foods1","Foods2","Foods3")
rownames(df_rmsse_CA_2_2yr) =  c("Hobbies","Household1","Household2","Foods1","Foods2","Foods3")
rownames(df_rmsse_CA_3_2yr) =  c("Hobbies","Household1","Household2","Foods1","Foods2","Foods3")

colnames(df_rmsse_CA_1_2yr) = c("var21","var22","var23")
colnames(df_rmsse_CA_2_2yr) = c("var21","var22","var23")
colnames(df_rmsse_CA_3_2yr) = c("var21","var22","var23")

df_rmsse_CA_1_2yr
df_rmsse_CA_2_2yr
df_rmsse_CA_3_2yr

```


The RMSSE results show that compared to the store and product VARs. For the store 1, this VAR performs best in foods1. In store 2 it performs best in all the product categories except for Hobbies and in store 3 it performs better in all the food categories.


### Train-test split for data from 2011-2013 for training and 2014 for testing.

```{r, include=FALSE}

# Define the train-test split 703 is 2012-12-31 and 1068 for 2013-12-31
train_sample = 1068
test_sample = 1433

# Choose the columns for each store
# Extracting the columns of the CA_1 store and renaming them
df_all = df
df_all$date = NULL

df_all_train = head(df_all, train_sample)
df_all_test  = head(df_all, test_sample)
df_all_test  = tail(df_all_test, test_sample - train_sample)

var_all_train = VAR(df_all_train, p=1)

dcoef_all = coef(var_all_train)

# iterate the number of test samples to predict using the var coefficients

length_sample = test_sample - train_sample
for (i in 1:length_sample) {
 if (i==1) {
    df_all_test[i, 19] = dcoef_all$Hobbies_CA_1[1]*df_all_train[train_sample,1] + dcoef_all$Hobbies_CA_1[2]*df_all_train[train_sample,2] + dcoef_all$Hobbies_CA_1[3]*df_all_train[train_sample,3] + dcoef_all$Hobbies_CA_1[4]*df_all_train[train_sample,4] + dcoef_all$Hobbies_CA_1[5]*df_all_train[train_sample,5] + dcoef_all$Hobbies_CA_1[6]*df_all_train[train_sample,6] + dcoef_all$Hobbies_CA_1[7]*df_all_train[train_sample,7] + dcoef_all$Hobbies_CA_1[8]*df_all_train[train_sample,8] + dcoef_all$Hobbies_CA_1[9]*df_all_train[train_sample,9] + dcoef_all$Hobbies_CA_1[10]*df_all_train[train_sample,10] + dcoef_all$Hobbies_CA_1[11]*df_all_train[train_sample,11] + dcoef_all$Hobbies_CA_1[12]*df_all_train[train_sample,12] + dcoef_all$Hobbies_CA_1[13]*df_all_train[train_sample,13] + dcoef_all$Hobbies_CA_1[14]*df_all_train[train_sample,14] + dcoef_all$Hobbies_CA_1[15]*df_all_train[train_sample,15] + dcoef_all$Hobbies_CA_1[16]*df_all_train[train_sample,16] + dcoef_all$Hobbies_CA_1[17]*df_all_train[train_sample,17] + dcoef_all$Hobbies_CA_1[18]*df_all_train[train_sample,18] + dcoef_all$Hobbies_CA_1[19]
    df_all_test[i, 20] = dcoef_all$Household_1_CA_1[1]*df_all_train[train_sample,1] + dcoef_all$Household_1_CA_1[2]*df_all_train[train_sample,2] + dcoef_all$Household_1_CA_1[3]*df_all_train[train_sample,3] + dcoef_all$Household_1_CA_1[4]*df_all_train[train_sample,4] + dcoef_all$Household_1_CA_1[5]*df_all_train[train_sample,5] + dcoef_all$Household_1_CA_1[6]*df_all_train[train_sample,6] + dcoef_all$Household_1_CA_1[7]*df_all_train[train_sample,7] + dcoef_all$Household_1_CA_1[8]*df_all_train[train_sample,8] + dcoef_all$Household_1_CA_1[9]*df_all_train[train_sample,9] + dcoef_all$Household_1_CA_1[10]*df_all_train[train_sample,10] + dcoef_all$Household_1_CA_1[11]*df_all_train[train_sample,11] + dcoef_all$Household_1_CA_1[12]*df_all_train[train_sample,12] + dcoef_all$Household_1_CA_1[13]*df_all_train[train_sample,13] + dcoef_all$Household_1_CA_1[14]*df_all_train[train_sample,14] + dcoef_all$Household_1_CA_1[15]*df_all_train[train_sample,15] + dcoef_all$Household_1_CA_1[16]*df_all_train[train_sample,16] + dcoef_all$Household_1_CA_1[17]*df_all_train[train_sample,17] + dcoef_all$Household_1_CA_1[18]*df_all_train[train_sample,18] + dcoef_all$Household_1_CA_1[19]
    df_all_test[i, 21] = dcoef_all$Household_2_CA_1[1]*df_all_train[train_sample,1] + dcoef_all$Household_2_CA_1[2]*df_all_train[train_sample,2] + dcoef_all$Household_2_CA_1[3]*df_all_train[train_sample,3] + dcoef_all$Household_2_CA_1[4]*df_all_train[train_sample,4] + dcoef_all$Household_2_CA_1[5]*df_all_train[train_sample,5] + dcoef_all$Household_2_CA_1[6]*df_all_train[train_sample,6] + dcoef_all$Household_2_CA_1[7]*df_all_train[train_sample,7] + dcoef_all$Household_2_CA_1[8]*df_all_train[train_sample,8] + dcoef_all$Household_2_CA_1[9]*df_all_train[train_sample,9] + dcoef_all$Household_2_CA_1[10]*df_all_train[train_sample,10] + dcoef_all$Household_2_CA_1[11]*df_all_train[train_sample,11] + dcoef_all$Household_2_CA_1[12]*df_all_train[train_sample,12] + dcoef_all$Household_2_CA_1[13]*df_all_train[train_sample,13] + dcoef_all$Household_2_CA_1[14]*df_all_train[train_sample,14] + dcoef_all$Household_2_CA_1[15]*df_all_train[train_sample,15] + dcoef_all$Household_2_CA_1[16]*df_all_train[train_sample,16] + dcoef_all$Household_2_CA_1[17]*df_all_train[train_sample,17] + dcoef_all$Household_2_CA_1[18]*df_all_train[train_sample,18] + dcoef_all$Household_2_CA_1[19]
    df_all_test[i, 22] = dcoef_all$Foods_1_CA_1[1]*df_all_train[train_sample,1] + dcoef_all$Foods_1_CA_1[2]*df_all_train[train_sample,2] + dcoef_all$Foods_1_CA_1[3]*df_all_train[train_sample,3] + dcoef_all$Foods_1_CA_1[4]*df_all_train[train_sample,4] + dcoef_all$Foods_1_CA_1[5]*df_all_train[train_sample,5] + dcoef_all$Foods_1_CA_1[6]*df_all_train[train_sample,6] + dcoef_all$Foods_1_CA_1[7]*df_all_train[train_sample,7] + dcoef_all$Foods_1_CA_1[8]*df_all_train[train_sample,8] + dcoef_all$Foods_1_CA_1[9]*df_all_train[train_sample,9] + dcoef_all$Foods_1_CA_1[10]*df_all_train[train_sample,10] + dcoef_all$Foods_1_CA_1[11]*df_all_train[train_sample,11] + dcoef_all$Foods_1_CA_1[12]*df_all_train[train_sample,12] + dcoef_all$Foods_1_CA_1[13]*df_all_train[train_sample,13] + dcoef_all$Foods_1_CA_1[14]*df_all_train[train_sample,14] + dcoef_all$Foods_1_CA_1[15]*df_all_train[train_sample,15] + dcoef_all$Foods_1_CA_1[16]*df_all_train[train_sample,16] + dcoef_all$Foods_1_CA_1[17]*df_all_train[train_sample,17] + dcoef_all$Foods_1_CA_1[18]*df_all_train[train_sample,18] + dcoef_all$Foods_1_CA_1[19]
    df_all_test[i, 23] = dcoef_all$Foods_2_CA_1[1]*df_all_train[train_sample,1] + dcoef_all$Foods_2_CA_1[2]*df_all_train[train_sample,2] + dcoef_all$Foods_2_CA_1[3]*df_all_train[train_sample,3] + dcoef_all$Foods_2_CA_1[4]*df_all_train[train_sample,4] + dcoef_all$Foods_2_CA_1[5]*df_all_train[train_sample,5] + dcoef_all$Foods_2_CA_1[6]*df_all_train[train_sample,6] + dcoef_all$Foods_2_CA_1[7]*df_all_train[train_sample,7] + dcoef_all$Foods_2_CA_1[8]*df_all_train[train_sample,8] + dcoef_all$Foods_2_CA_1[9]*df_all_train[train_sample,9] + dcoef_all$Foods_2_CA_1[10]*df_all_train[train_sample,10] + dcoef_all$Foods_2_CA_1[11]*df_all_train[train_sample,11] + dcoef_all$Foods_2_CA_1[12]*df_all_train[train_sample,12] + dcoef_all$Foods_2_CA_1[13]*df_all_train[train_sample,13] + dcoef_all$Foods_2_CA_1[14]*df_all_train[train_sample,14] + dcoef_all$Foods_2_CA_1[15]*df_all_train[train_sample,15] + dcoef_all$Foods_2_CA_1[16]*df_all_train[train_sample,16] + dcoef_all$Foods_2_CA_1[17]*df_all_train[train_sample,17] + dcoef_all$Foods_2_CA_1[18]*df_all_train[train_sample,18] + dcoef_all$Foods_2_CA_1[19]
    df_all_test[i, 24] = dcoef_all$Foods_3_CA_1[1]*df_all_train[train_sample,1] + dcoef_all$Foods_3_CA_1[2]*df_all_train[train_sample,2] + dcoef_all$Foods_3_CA_1[3]*df_all_train[train_sample,3] + dcoef_all$Foods_3_CA_1[4]*df_all_train[train_sample,4] + dcoef_all$Foods_3_CA_1[5]*df_all_train[train_sample,5] + dcoef_all$Foods_3_CA_1[6]*df_all_train[train_sample,6] + dcoef_all$Foods_3_CA_1[7]*df_all_train[train_sample,7] + dcoef_all$Foods_3_CA_1[8]*df_all_train[train_sample,8] + dcoef_all$Foods_3_CA_1[9]*df_all_train[train_sample,9] + dcoef_all$Foods_3_CA_1[10]*df_all_train[train_sample,10] + dcoef_all$Foods_3_CA_1[11]*df_all_train[train_sample,11] + dcoef_all$Foods_3_CA_1[12]*df_all_train[train_sample,12] + dcoef_all$Foods_3_CA_1[13]*df_all_train[train_sample,13] + dcoef_all$Foods_3_CA_1[14]*df_all_train[train_sample,14] + dcoef_all$Foods_3_CA_1[15]*df_all_train[train_sample,15] + dcoef_all$Foods_3_CA_1[16]*df_all_train[train_sample,16] + dcoef_all$Foods_3_CA_1[17]*df_all_train[train_sample,17] + dcoef_all$Foods_3_CA_1[18]*df_all_train[train_sample,18] + dcoef_all$Foods_3_CA_1[19]
    df_all_test[i, 25] = dcoef_all$Hobbies_CA_2[1]*df_all_train[train_sample,1] + dcoef_all$Hobbies_CA_2[2]*df_all_train[train_sample,2] + dcoef_all$Hobbies_CA_2[3]*df_all_train[train_sample,3] + dcoef_all$Hobbies_CA_2[4]*df_all_train[train_sample,4] + dcoef_all$Hobbies_CA_2[5]*df_all_train[train_sample,5] + dcoef_all$Hobbies_CA_2[6]*df_all_train[train_sample,6] + dcoef_all$Hobbies_CA_2[7]*df_all_train[train_sample,7] + dcoef_all$Hobbies_CA_2[8]*df_all_train[train_sample,8] + dcoef_all$Hobbies_CA_2[9]*df_all_train[train_sample,9] + dcoef_all$Hobbies_CA_2[10]*df_all_train[train_sample,10] + dcoef_all$Hobbies_CA_2[11]*df_all_train[train_sample,11] + dcoef_all$Hobbies_CA_2[12]*df_all_train[train_sample,12] + dcoef_all$Hobbies_CA_2[13]*df_all_train[train_sample,13] + dcoef_all$Hobbies_CA_2[14]*df_all_train[train_sample,14] + dcoef_all$Hobbies_CA_2[15]*df_all_train[train_sample,15] + dcoef_all$Hobbies_CA_2[16]*df_all_train[train_sample,16] + dcoef_all$Hobbies_CA_2[17]*df_all_train[train_sample,17] + dcoef_all$Hobbies_CA_2[18]*df_all_train[train_sample,18] + dcoef_all$Hobbies_CA_2[19]
    df_all_test[i, 26] = dcoef_all$Household_1_CA_2[1]*df_all_train[train_sample,1] + dcoef_all$Household_1_CA_2[2]*df_all_train[train_sample,2] + dcoef_all$Household_1_CA_2[3]*df_all_train[train_sample,3] + dcoef_all$Household_1_CA_2[4]*df_all_train[train_sample,4] + dcoef_all$Household_1_CA_2[5]*df_all_train[train_sample,5] + dcoef_all$Household_1_CA_2[6]*df_all_train[train_sample,6] + dcoef_all$Household_1_CA_2[7]*df_all_train[train_sample,7] + dcoef_all$Household_1_CA_2[8]*df_all_train[train_sample,8] + dcoef_all$Household_1_CA_2[9]*df_all_train[train_sample,9] + dcoef_all$Household_1_CA_2[10]*df_all_train[train_sample,10] + dcoef_all$Household_1_CA_2[11]*df_all_train[train_sample,11] + dcoef_all$Household_1_CA_2[12]*df_all_train[train_sample,12] + dcoef_all$Household_1_CA_2[13]*df_all_train[train_sample,13] + dcoef_all$Household_1_CA_2[14]*df_all_train[train_sample,14] + dcoef_all$Household_1_CA_2[15]*df_all_train[train_sample,15] + dcoef_all$Household_1_CA_2[16]*df_all_train[train_sample,16] + dcoef_all$Household_1_CA_2[17]*df_all_train[train_sample,17] + dcoef_all$Household_1_CA_2[18]*df_all_train[train_sample,18] + dcoef_all$Household_1_CA_2[19]
    df_all_test[i, 27] = dcoef_all$Household_2_CA_2[1]*df_all_train[train_sample,1] + dcoef_all$Household_2_CA_2[2]*df_all_train[train_sample,2] + dcoef_all$Household_2_CA_2[3]*df_all_train[train_sample,3] + dcoef_all$Household_2_CA_2[4]*df_all_train[train_sample,4] + dcoef_all$Household_2_CA_2[5]*df_all_train[train_sample,5] + dcoef_all$Household_2_CA_2[6]*df_all_train[train_sample,6] + dcoef_all$Household_2_CA_2[7]*df_all_train[train_sample,7] + dcoef_all$Household_2_CA_2[8]*df_all_train[train_sample,8] + dcoef_all$Household_2_CA_2[9]*df_all_train[train_sample,9] + dcoef_all$Household_2_CA_2[10]*df_all_train[train_sample,10] + dcoef_all$Household_2_CA_2[11]*df_all_train[train_sample,11] + dcoef_all$Household_2_CA_2[12]*df_all_train[train_sample,12] + dcoef_all$Household_2_CA_2[13]*df_all_train[train_sample,13] + dcoef_all$Household_2_CA_2[14]*df_all_train[train_sample,14] + dcoef_all$Household_2_CA_2[15]*df_all_train[train_sample,15] + dcoef_all$Household_2_CA_2[16]*df_all_train[train_sample,16] + dcoef_all$Household_2_CA_2[17]*df_all_train[train_sample,17] + dcoef_all$Household_2_CA_2[18]*df_all_train[train_sample,18] + dcoef_all$Household_2_CA_2[19]
    df_all_test[i, 28] = dcoef_all$Foods_1_CA_2[1]*df_all_train[train_sample,1] + dcoef_all$Foods_1_CA_2[2]*df_all_train[train_sample,2] + dcoef_all$Foods_1_CA_2[3]*df_all_train[train_sample,3] + dcoef_all$Foods_1_CA_2[4]*df_all_train[train_sample,4] + dcoef_all$Foods_1_CA_2[5]*df_all_train[train_sample,5] + dcoef_all$Foods_1_CA_2[6]*df_all_train[train_sample,6] + dcoef_all$Foods_1_CA_2[7]*df_all_train[train_sample,7] + dcoef_all$Foods_1_CA_2[8]*df_all_train[train_sample,8] + dcoef_all$Foods_1_CA_2[9]*df_all_train[train_sample,9] + dcoef_all$Foods_1_CA_2[10]*df_all_train[train_sample,10] + dcoef_all$Foods_1_CA_2[11]*df_all_train[train_sample,11] + dcoef_all$Foods_1_CA_2[12]*df_all_train[train_sample,12] + dcoef_all$Foods_1_CA_2[13]*df_all_train[train_sample,13] + dcoef_all$Foods_1_CA_2[14]*df_all_train[train_sample,14] + dcoef_all$Foods_1_CA_2[15]*df_all_train[train_sample,15] + dcoef_all$Foods_1_CA_2[16]*df_all_train[train_sample,16] + dcoef_all$Foods_1_CA_2[17]*df_all_train[train_sample,17] + dcoef_all$Foods_1_CA_2[18]*df_all_train[train_sample,18] + dcoef_all$Foods_1_CA_2[19]
    df_all_test[i, 29] = dcoef_all$Foods_2_CA_2[1]*df_all_train[train_sample,1] + dcoef_all$Foods_2_CA_2[2]*df_all_train[train_sample,2] + dcoef_all$Foods_2_CA_2[3]*df_all_train[train_sample,3] + dcoef_all$Foods_2_CA_2[4]*df_all_train[train_sample,4] + dcoef_all$Foods_2_CA_2[5]*df_all_train[train_sample,5] + dcoef_all$Foods_2_CA_2[6]*df_all_train[train_sample,6] + dcoef_all$Foods_2_CA_2[7]*df_all_train[train_sample,7] + dcoef_all$Foods_2_CA_2[8]*df_all_train[train_sample,8] + dcoef_all$Foods_2_CA_2[9]*df_all_train[train_sample,9] + dcoef_all$Foods_2_CA_2[10]*df_all_train[train_sample,10] + dcoef_all$Foods_2_CA_2[11]*df_all_train[train_sample,11] + dcoef_all$Foods_2_CA_2[12]*df_all_train[train_sample,12] + dcoef_all$Foods_2_CA_2[13]*df_all_train[train_sample,13] + dcoef_all$Foods_2_CA_2[14]*df_all_train[train_sample,14] + dcoef_all$Foods_2_CA_2[15]*df_all_train[train_sample,15] + dcoef_all$Foods_2_CA_2[16]*df_all_train[train_sample,16] + dcoef_all$Foods_2_CA_2[17]*df_all_train[train_sample,17] + dcoef_all$Foods_2_CA_2[18]*df_all_train[train_sample,18] + dcoef_all$Foods_2_CA_2[19]
    df_all_test[i, 30] = dcoef_all$Foods_3_CA_2[1]*df_all_train[train_sample,1] + dcoef_all$Foods_3_CA_2[2]*df_all_train[train_sample,2] + dcoef_all$Foods_3_CA_2[3]*df_all_train[train_sample,3] + dcoef_all$Foods_3_CA_2[4]*df_all_train[train_sample,4] + dcoef_all$Foods_3_CA_2[5]*df_all_train[train_sample,5] + dcoef_all$Foods_3_CA_2[6]*df_all_train[train_sample,6] + dcoef_all$Foods_3_CA_2[7]*df_all_train[train_sample,7] + dcoef_all$Foods_3_CA_2[8]*df_all_train[train_sample,8] + dcoef_all$Foods_3_CA_2[9]*df_all_train[train_sample,9] + dcoef_all$Foods_3_CA_2[10]*df_all_train[train_sample,10] + dcoef_all$Foods_3_CA_2[11]*df_all_train[train_sample,11] + dcoef_all$Foods_3_CA_2[12]*df_all_train[train_sample,12] + dcoef_all$Foods_3_CA_2[13]*df_all_train[train_sample,13] + dcoef_all$Foods_3_CA_2[14]*df_all_train[train_sample,14] + dcoef_all$Foods_3_CA_2[15]*df_all_train[train_sample,15] + dcoef_all$Foods_3_CA_2[16]*df_all_train[train_sample,16] + dcoef_all$Foods_3_CA_2[17]*df_all_train[train_sample,17] + dcoef_all$Foods_3_CA_2[18]*df_all_train[train_sample,18] + dcoef_all$Foods_3_CA_2[19]
    df_all_test[i, 31] = dcoef_all$Hobbies_CA_3[1]*df_all_train[train_sample,1] + dcoef_all$Hobbies_CA_3[2]*df_all_train[train_sample,2] + dcoef_all$Hobbies_CA_3[3]*df_all_train[train_sample,3] + dcoef_all$Hobbies_CA_3[4]*df_all_train[train_sample,4] + dcoef_all$Hobbies_CA_3[5]*df_all_train[train_sample,5] + dcoef_all$Hobbies_CA_3[6]*df_all_train[train_sample,6] + dcoef_all$Hobbies_CA_3[7]*df_all_train[train_sample,7] + dcoef_all$Hobbies_CA_3[8]*df_all_train[train_sample,8] + dcoef_all$Hobbies_CA_3[9]*df_all_train[train_sample,9] + dcoef_all$Hobbies_CA_3[10]*df_all_train[train_sample,10] + dcoef_all$Hobbies_CA_3[11]*df_all_train[train_sample,11] + dcoef_all$Hobbies_CA_3[12]*df_all_train[train_sample,12] + dcoef_all$Hobbies_CA_3[13]*df_all_train[train_sample,13] + dcoef_all$Hobbies_CA_3[14]*df_all_train[train_sample,14] + dcoef_all$Hobbies_CA_3[15]*df_all_train[train_sample,15] + dcoef_all$Hobbies_CA_3[16]*df_all_train[train_sample,16] + dcoef_all$Hobbies_CA_3[17]*df_all_train[train_sample,17] + dcoef_all$Hobbies_CA_3[18]*df_all_train[train_sample,18] + dcoef_all$Hobbies_CA_3[19]
    df_all_test[i, 32] = dcoef_all$Household_1_CA_3[1]*df_all_train[train_sample,1] + dcoef_all$Household_1_CA_3[2]*df_all_train[train_sample,2] + dcoef_all$Household_1_CA_3[3]*df_all_train[train_sample,3] + dcoef_all$Household_1_CA_3[4]*df_all_train[train_sample,4] + dcoef_all$Household_1_CA_3[5]*df_all_train[train_sample,5] + dcoef_all$Household_1_CA_3[6]*df_all_train[train_sample,6] + dcoef_all$Household_1_CA_3[7]*df_all_train[train_sample,7] + dcoef_all$Household_1_CA_3[8]*df_all_train[train_sample,8] + dcoef_all$Household_1_CA_3[9]*df_all_train[train_sample,9] + dcoef_all$Household_1_CA_3[10]*df_all_train[train_sample,10] + dcoef_all$Household_1_CA_3[11]*df_all_train[train_sample,11] + dcoef_all$Household_1_CA_3[12]*df_all_train[train_sample,12] + dcoef_all$Household_1_CA_3[13]*df_all_train[train_sample,13] + dcoef_all$Household_1_CA_3[14]*df_all_train[train_sample,14] + dcoef_all$Household_1_CA_3[15]*df_all_train[train_sample,15] + dcoef_all$Household_1_CA_3[16]*df_all_train[train_sample,16] + dcoef_all$Household_1_CA_3[17]*df_all_train[train_sample,17] + dcoef_all$Household_1_CA_3[18]*df_all_train[train_sample,18] + dcoef_all$Household_1_CA_3[19]
    df_all_test[i, 33] = dcoef_all$Household_2_CA_3[1]*df_all_train[train_sample,1] + dcoef_all$Household_2_CA_3[2]*df_all_train[train_sample,2] + dcoef_all$Household_2_CA_3[3]*df_all_train[train_sample,3] + dcoef_all$Household_2_CA_3[4]*df_all_train[train_sample,4] + dcoef_all$Household_2_CA_3[5]*df_all_train[train_sample,5] + dcoef_all$Household_2_CA_3[6]*df_all_train[train_sample,6] + dcoef_all$Household_2_CA_3[7]*df_all_train[train_sample,7] + dcoef_all$Household_2_CA_3[8]*df_all_train[train_sample,8] + dcoef_all$Household_2_CA_3[9]*df_all_train[train_sample,9] + dcoef_all$Household_2_CA_3[10]*df_all_train[train_sample,10] + dcoef_all$Household_2_CA_3[11]*df_all_train[train_sample,11] + dcoef_all$Household_2_CA_3[12]*df_all_train[train_sample,12] + dcoef_all$Household_2_CA_3[13]*df_all_train[train_sample,13] + dcoef_all$Household_2_CA_3[14]*df_all_train[train_sample,14] + dcoef_all$Household_2_CA_3[15]*df_all_train[train_sample,15] + dcoef_all$Household_2_CA_3[16]*df_all_train[train_sample,16] + dcoef_all$Household_2_CA_3[17]*df_all_train[train_sample,17] + dcoef_all$Household_2_CA_3[18]*df_all_train[train_sample,18] + dcoef_all$Household_2_CA_3[19]
    df_all_test[i, 34] = dcoef_all$Foods_1_CA_3[1]*df_all_train[train_sample,1] + dcoef_all$Foods_1_CA_3[2]*df_all_train[train_sample,2] + dcoef_all$Foods_1_CA_3[3]*df_all_train[train_sample,3] + dcoef_all$Foods_1_CA_3[4]*df_all_train[train_sample,4] + dcoef_all$Foods_1_CA_3[5]*df_all_train[train_sample,5] + dcoef_all$Foods_1_CA_3[6]*df_all_train[train_sample,6] + dcoef_all$Foods_1_CA_3[7]*df_all_train[train_sample,7] + dcoef_all$Foods_1_CA_3[8]*df_all_train[train_sample,8] + dcoef_all$Foods_1_CA_3[9]*df_all_train[train_sample,9] + dcoef_all$Foods_1_CA_3[10]*df_all_train[train_sample,10] + dcoef_all$Foods_1_CA_3[11]*df_all_train[train_sample,11] + dcoef_all$Foods_1_CA_3[12]*df_all_train[train_sample,12] + dcoef_all$Foods_1_CA_3[13]*df_all_train[train_sample,13] + dcoef_all$Foods_1_CA_3[14]*df_all_train[train_sample,14] + dcoef_all$Foods_1_CA_3[15]*df_all_train[train_sample,15] + dcoef_all$Foods_1_CA_3[16]*df_all_train[train_sample,16] + dcoef_all$Foods_1_CA_3[17]*df_all_train[train_sample,17] + dcoef_all$Foods_1_CA_3[18]*df_all_train[train_sample,18] + dcoef_all$Foods_1_CA_3[19]
    df_all_test[i, 35] = dcoef_all$Foods_2_CA_3[1]*df_all_train[train_sample,1] + dcoef_all$Foods_2_CA_3[2]*df_all_train[train_sample,2] + dcoef_all$Foods_2_CA_3[3]*df_all_train[train_sample,3] + dcoef_all$Foods_2_CA_3[4]*df_all_train[train_sample,4] + dcoef_all$Foods_2_CA_3[5]*df_all_train[train_sample,5] + dcoef_all$Foods_2_CA_3[6]*df_all_train[train_sample,6] + dcoef_all$Foods_2_CA_3[7]*df_all_train[train_sample,7] + dcoef_all$Foods_2_CA_3[8]*df_all_train[train_sample,8] + dcoef_all$Foods_2_CA_3[9]*df_all_train[train_sample,9] + dcoef_all$Foods_2_CA_3[10]*df_all_train[train_sample,10] + dcoef_all$Foods_2_CA_3[11]*df_all_train[train_sample,11] + dcoef_all$Foods_2_CA_3[12]*df_all_train[train_sample,12] + dcoef_all$Foods_2_CA_3[13]*df_all_train[train_sample,13] + dcoef_all$Foods_2_CA_3[14]*df_all_train[train_sample,14] + dcoef_all$Foods_2_CA_3[15]*df_all_train[train_sample,15] + dcoef_all$Foods_2_CA_3[16]*df_all_train[train_sample,16] + dcoef_all$Foods_2_CA_3[17]*df_all_train[train_sample,17] + dcoef_all$Foods_2_CA_3[18]*df_all_train[train_sample,18] + dcoef_all$Foods_2_CA_3[19]
    df_all_test[i, 36] = dcoef_all$Foods_3_CA_3[1]*df_all_train[train_sample,1] + dcoef_all$Foods_3_CA_3[2]*df_all_train[train_sample,2] + dcoef_all$Foods_3_CA_3[3]*df_all_train[train_sample,3] + dcoef_all$Foods_3_CA_3[4]*df_all_train[train_sample,4] + dcoef_all$Foods_3_CA_3[5]*df_all_train[train_sample,5] + dcoef_all$Foods_3_CA_3[6]*df_all_train[train_sample,6] + dcoef_all$Foods_3_CA_3[7]*df_all_train[train_sample,7] + dcoef_all$Foods_3_CA_3[8]*df_all_train[train_sample,8] + dcoef_all$Foods_3_CA_3[9]*df_all_train[train_sample,9] + dcoef_all$Foods_3_CA_3[10]*df_all_train[train_sample,10] + dcoef_all$Foods_3_CA_3[11]*df_all_train[train_sample,11] + dcoef_all$Foods_3_CA_3[12]*df_all_train[train_sample,12] + dcoef_all$Foods_3_CA_3[13]*df_all_train[train_sample,13] + dcoef_all$Foods_3_CA_3[14]*df_all_train[train_sample,14] + dcoef_all$Foods_3_CA_3[15]*df_all_train[train_sample,15] + dcoef_all$Foods_3_CA_3[16]*df_all_train[train_sample,16] + dcoef_all$Foods_3_CA_3[17]*df_all_train[train_sample,17] + dcoef_all$Foods_3_CA_3[18]*df_all_train[train_sample,18] + dcoef_all$Foods_3_CA_3[19]
    
  }
  else {
    df_all_test[i, 19] = dcoef_all$Hobbies_CA_1[1]*df_all_test[i-1,1] + dcoef_all$Hobbies_CA_1[2]*df_all_test[i-1,2] + dcoef_all$Hobbies_CA_1[3]*df_all_test[i-1,3] + dcoef_all$Hobbies_CA_1[4]*df_all_test[i-1,4] + dcoef_all$Hobbies_CA_1[5]*df_all_test[i-1,5] + dcoef_all$Hobbies_CA_1[6]*df_all_test[i-1,6] + dcoef_all$Hobbies_CA_1[7]*df_all_test[i-1,7] + dcoef_all$Hobbies_CA_1[8]*df_all_test[i-1,8] + dcoef_all$Hobbies_CA_1[9]*df_all_test[i-1,9] + dcoef_all$Hobbies_CA_1[10]*df_all_test[i-1,10] + dcoef_all$Hobbies_CA_1[11]*df_all_test[i-1,11] + dcoef_all$Hobbies_CA_1[12]*df_all_test[i-1,12] + dcoef_all$Hobbies_CA_1[13]*df_all_test[i-1,13] + dcoef_all$Hobbies_CA_1[14]*df_all_test[i-1,14] + dcoef_all$Hobbies_CA_1[15]*df_all_test[i-1,15] + dcoef_all$Hobbies_CA_1[16]*df_all_test[i-1,16] + dcoef_all$Hobbies_CA_1[17]*df_all_test[i-1,17] + dcoef_all$Hobbies_CA_1[18]*df_all_test[i-1,18] + dcoef_all$Hobbies_CA_1[19]
    df_all_test[i, 20] = dcoef_all$Household_1_CA_1[1]*df_all_test[i-1,1] + dcoef_all$Household_1_CA_1[2]*df_all_test[i-1,2] + dcoef_all$Household_1_CA_1[3]*df_all_test[i-1,3] + dcoef_all$Household_1_CA_1[4]*df_all_test[i-1,4] + dcoef_all$Household_1_CA_1[5]*df_all_test[i-1,5] + dcoef_all$Household_1_CA_1[6]*df_all_test[i-1,6] + dcoef_all$Household_1_CA_1[7]*df_all_test[i-1,7] + dcoef_all$Household_1_CA_1[8]*df_all_test[i-1,8] + dcoef_all$Household_1_CA_1[9]*df_all_test[i-1,9] + dcoef_all$Household_1_CA_1[10]*df_all_test[i-1,10] + dcoef_all$Household_1_CA_1[11]*df_all_test[i-1,11] + dcoef_all$Household_1_CA_1[12]*df_all_test[i-1,12] + dcoef_all$Household_1_CA_1[13]*df_all_test[i-1,13] + dcoef_all$Household_1_CA_1[14]*df_all_test[i-1,14] + dcoef_all$Household_1_CA_1[15]*df_all_test[i-1,15] + dcoef_all$Household_1_CA_1[16]*df_all_test[i-1,16] + dcoef_all$Household_1_CA_1[17]*df_all_test[i-1,17] + dcoef_all$Household_1_CA_1[18]*df_all_test[i-1,18] + dcoef_all$Household_1_CA_1[19]
    df_all_test[i, 21] = dcoef_all$Household_2_CA_1[1]*df_all_test[i-1,1] + dcoef_all$Household_2_CA_1[2]*df_all_test[i-1,2] + dcoef_all$Household_2_CA_1[3]*df_all_test[i-1,3] + dcoef_all$Household_2_CA_1[4]*df_all_test[i-1,4] + dcoef_all$Household_2_CA_1[5]*df_all_test[i-1,5] + dcoef_all$Household_2_CA_1[6]*df_all_test[i-1,6] + dcoef_all$Household_2_CA_1[7]*df_all_test[i-1,7] + dcoef_all$Household_2_CA_1[8]*df_all_test[i-1,8] + dcoef_all$Household_2_CA_1[9]*df_all_test[i-1,9] + dcoef_all$Household_2_CA_1[10]*df_all_test[i-1,10] + dcoef_all$Household_2_CA_1[11]*df_all_test[i-1,11] + dcoef_all$Household_2_CA_1[12]*df_all_test[i-1,12] + dcoef_all$Household_2_CA_1[13]*df_all_test[i-1,13] + dcoef_all$Household_2_CA_1[14]*df_all_test[i-1,14] + dcoef_all$Household_2_CA_1[15]*df_all_test[i-1,15] + dcoef_all$Household_2_CA_1[16]*df_all_test[i-1,16] + dcoef_all$Household_2_CA_1[17]*df_all_test[i-1,17] + dcoef_all$Household_2_CA_1[18]*df_all_test[i-1,18] + dcoef_all$Household_2_CA_1[19]
    df_all_test[i, 22] = dcoef_all$Foods_1_CA_1[1]*df_all_test[i-1,1] + dcoef_all$Foods_1_CA_1[2]*df_all_test[i-1,2] + dcoef_all$Foods_1_CA_1[3]*df_all_test[i-1,3] + dcoef_all$Foods_1_CA_1[4]*df_all_test[i-1,4] + dcoef_all$Foods_1_CA_1[5]*df_all_test[i-1,5] + dcoef_all$Foods_1_CA_1[6]*df_all_test[i-1,6] + dcoef_all$Foods_1_CA_1[7]*df_all_test[i-1,7] + dcoef_all$Foods_1_CA_1[8]*df_all_test[i-1,8] + dcoef_all$Foods_1_CA_1[9]*df_all_test[i-1,9] + dcoef_all$Foods_1_CA_1[10]*df_all_test[i-1,10] + dcoef_all$Foods_1_CA_1[11]*df_all_test[i-1,11] + dcoef_all$Foods_1_CA_1[12]*df_all_test[i-1,12] + dcoef_all$Foods_1_CA_1[13]*df_all_test[i-1,13] + dcoef_all$Foods_1_CA_1[14]*df_all_test[i-1,14] + dcoef_all$Foods_1_CA_1[15]*df_all_test[i-1,15] + dcoef_all$Foods_1_CA_1[16]*df_all_test[i-1,16] + dcoef_all$Foods_1_CA_1[17]*df_all_test[i-1,17] + dcoef_all$Foods_1_CA_1[18]*df_all_test[i-1,18] + dcoef_all$Foods_1_CA_1[19]
    df_all_test[i, 23] = dcoef_all$Foods_2_CA_1[1]*df_all_test[i-1,1] + dcoef_all$Foods_2_CA_1[2]*df_all_test[i-1,2] + dcoef_all$Foods_2_CA_1[3]*df_all_test[i-1,3] + dcoef_all$Foods_2_CA_1[4]*df_all_test[i-1,4] + dcoef_all$Foods_2_CA_1[5]*df_all_test[i-1,5] + dcoef_all$Foods_2_CA_1[6]*df_all_test[i-1,6] + dcoef_all$Foods_2_CA_1[7]*df_all_test[i-1,7] + dcoef_all$Foods_2_CA_1[8]*df_all_test[i-1,8] + dcoef_all$Foods_2_CA_1[9]*df_all_test[i-1,9] + dcoef_all$Foods_2_CA_1[10]*df_all_test[i-1,10] + dcoef_all$Foods_2_CA_1[11]*df_all_test[i-1,11] + dcoef_all$Foods_2_CA_1[12]*df_all_test[i-1,12] + dcoef_all$Foods_2_CA_1[13]*df_all_test[i-1,13] + dcoef_all$Foods_2_CA_1[14]*df_all_test[i-1,14] + dcoef_all$Foods_2_CA_1[15]*df_all_test[i-1,15] + dcoef_all$Foods_2_CA_1[16]*df_all_test[i-1,16] + dcoef_all$Foods_2_CA_1[17]*df_all_test[i-1,17] + dcoef_all$Foods_2_CA_1[18]*df_all_test[i-1,18] + dcoef_all$Foods_2_CA_1[19]
    df_all_test[i, 24] = dcoef_all$Foods_3_CA_1[1]*df_all_test[i-1,1] + dcoef_all$Foods_3_CA_1[2]*df_all_test[i-1,2] + dcoef_all$Foods_3_CA_1[3]*df_all_test[i-1,3] + dcoef_all$Foods_3_CA_1[4]*df_all_test[i-1,4] + dcoef_all$Foods_3_CA_1[5]*df_all_test[i-1,5] + dcoef_all$Foods_3_CA_1[6]*df_all_test[i-1,6] + dcoef_all$Foods_3_CA_1[7]*df_all_test[i-1,7] + dcoef_all$Foods_3_CA_1[8]*df_all_test[i-1,8] + dcoef_all$Foods_3_CA_1[9]*df_all_test[i-1,9] + dcoef_all$Foods_3_CA_1[10]*df_all_test[i-1,10] + dcoef_all$Foods_3_CA_1[11]*df_all_test[i-1,11] + dcoef_all$Foods_3_CA_1[12]*df_all_test[i-1,12] + dcoef_all$Foods_3_CA_1[13]*df_all_test[i-1,13] + dcoef_all$Foods_3_CA_1[14]*df_all_test[i-1,14] + dcoef_all$Foods_3_CA_1[15]*df_all_test[i-1,15] + dcoef_all$Foods_3_CA_1[16]*df_all_test[i-1,16] + dcoef_all$Foods_3_CA_1[17]*df_all_test[i-1,17] + dcoef_all$Foods_3_CA_1[18]*df_all_test[i-1,18] + dcoef_all$Foods_3_CA_1[19]
    df_all_test[i, 25] = dcoef_all$Hobbies_CA_2[1]*df_all_test[i-1,1] + dcoef_all$Hobbies_CA_2[2]*df_all_test[i-1,2] + dcoef_all$Hobbies_CA_2[3]*df_all_test[i-1,3] + dcoef_all$Hobbies_CA_2[4]*df_all_test[i-1,4] + dcoef_all$Hobbies_CA_2[5]*df_all_test[i-1,5] + dcoef_all$Hobbies_CA_2[6]*df_all_test[i-1,6] + dcoef_all$Hobbies_CA_2[7]*df_all_test[i-1,7] + dcoef_all$Hobbies_CA_2[8]*df_all_test[i-1,8] + dcoef_all$Hobbies_CA_2[9]*df_all_test[i-1,9] + dcoef_all$Hobbies_CA_2[10]*df_all_test[i-1,10] + dcoef_all$Hobbies_CA_2[11]*df_all_test[i-1,11] + dcoef_all$Hobbies_CA_2[12]*df_all_test[i-1,12] + dcoef_all$Hobbies_CA_2[13]*df_all_test[i-1,13] + dcoef_all$Hobbies_CA_2[14]*df_all_test[i-1,14] + dcoef_all$Hobbies_CA_2[15]*df_all_test[i-1,15] + dcoef_all$Hobbies_CA_2[16]*df_all_test[i-1,16] + dcoef_all$Hobbies_CA_2[17]*df_all_test[i-1,17] + dcoef_all$Hobbies_CA_2[18]*df_all_test[i-1,18] + dcoef_all$Hobbies_CA_2[19]
    df_all_test[i, 26] = dcoef_all$Household_1_CA_2[1]*df_all_test[i-1,1] + dcoef_all$Household_1_CA_2[2]*df_all_test[i-1,2] + dcoef_all$Household_1_CA_2[3]*df_all_test[i-1,3] + dcoef_all$Household_1_CA_2[4]*df_all_test[i-1,4] + dcoef_all$Household_1_CA_2[5]*df_all_test[i-1,5] + dcoef_all$Household_1_CA_2[6]*df_all_test[i-1,6] + dcoef_all$Household_1_CA_2[7]*df_all_test[i-1,7] + dcoef_all$Household_1_CA_2[8]*df_all_test[i-1,8] + dcoef_all$Household_1_CA_2[9]*df_all_test[i-1,9] + dcoef_all$Household_1_CA_2[10]*df_all_test[i-1,10] + dcoef_all$Household_1_CA_2[11]*df_all_test[i-1,11] + dcoef_all$Household_1_CA_2[12]*df_all_test[i-1,12] + dcoef_all$Household_1_CA_2[13]*df_all_test[i-1,13] + dcoef_all$Household_1_CA_2[14]*df_all_test[i-1,14] + dcoef_all$Household_1_CA_2[15]*df_all_test[i-1,15] + dcoef_all$Household_1_CA_2[16]*df_all_test[i-1,16] + dcoef_all$Household_1_CA_2[17]*df_all_test[i-1,17] + dcoef_all$Household_1_CA_2[18]*df_all_test[i-1,18] + dcoef_all$Household_1_CA_2[19]
    df_all_test[i, 27] = dcoef_all$Household_2_CA_2[1]*df_all_test[i-1,1] + dcoef_all$Household_2_CA_2[2]*df_all_test[i-1,2] + dcoef_all$Household_2_CA_2[3]*df_all_test[i-1,3] + dcoef_all$Household_2_CA_2[4]*df_all_test[i-1,4] + dcoef_all$Household_2_CA_2[5]*df_all_test[i-1,5] + dcoef_all$Household_2_CA_2[6]*df_all_test[i-1,6] + dcoef_all$Household_2_CA_2[7]*df_all_test[i-1,7] + dcoef_all$Household_2_CA_2[8]*df_all_test[i-1,8] + dcoef_all$Household_2_CA_2[9]*df_all_test[i-1,9] + dcoef_all$Household_2_CA_2[10]*df_all_test[i-1,10] + dcoef_all$Household_2_CA_2[11]*df_all_test[i-1,11] + dcoef_all$Household_2_CA_2[12]*df_all_test[i-1,12] + dcoef_all$Household_2_CA_2[13]*df_all_test[i-1,13] + dcoef_all$Household_2_CA_2[14]*df_all_test[i-1,14] + dcoef_all$Household_2_CA_2[15]*df_all_test[i-1,15] + dcoef_all$Household_2_CA_2[16]*df_all_test[i-1,16] + dcoef_all$Household_2_CA_2[17]*df_all_test[i-1,17] + dcoef_all$Household_2_CA_2[18]*df_all_test[i-1,18] + dcoef_all$Household_2_CA_2[19]
    df_all_test[i, 28] = dcoef_all$Foods_1_CA_2[1]*df_all_test[i-1,1] + dcoef_all$Foods_1_CA_2[2]*df_all_test[i-1,2] + dcoef_all$Foods_1_CA_2[3]*df_all_test[i-1,3] + dcoef_all$Foods_1_CA_2[4]*df_all_test[i-1,4] + dcoef_all$Foods_1_CA_2[5]*df_all_test[i-1,5] + dcoef_all$Foods_1_CA_2[6]*df_all_test[i-1,6] + dcoef_all$Foods_1_CA_2[7]*df_all_test[i-1,7] + dcoef_all$Foods_1_CA_2[8]*df_all_test[i-1,8] + dcoef_all$Foods_1_CA_2[9]*df_all_test[i-1,9] + dcoef_all$Foods_1_CA_2[10]*df_all_test[i-1,10] + dcoef_all$Foods_1_CA_2[11]*df_all_test[i-1,11] + dcoef_all$Foods_1_CA_2[12]*df_all_test[i-1,12] + dcoef_all$Foods_1_CA_2[13]*df_all_test[i-1,13] + dcoef_all$Foods_1_CA_2[14]*df_all_test[i-1,14] + dcoef_all$Foods_1_CA_2[15]*df_all_test[i-1,15] + dcoef_all$Foods_1_CA_2[16]*df_all_test[i-1,16] + dcoef_all$Foods_1_CA_2[17]*df_all_test[i-1,17] + dcoef_all$Foods_1_CA_2[18]*df_all_test[i-1,18] + dcoef_all$Foods_1_CA_2[19]
    df_all_test[i, 29] = dcoef_all$Foods_2_CA_2[1]*df_all_test[i-1,1] + dcoef_all$Foods_2_CA_2[2]*df_all_test[i-1,2] + dcoef_all$Foods_2_CA_2[3]*df_all_test[i-1,3] + dcoef_all$Foods_2_CA_2[4]*df_all_test[i-1,4] + dcoef_all$Foods_2_CA_2[5]*df_all_test[i-1,5] + dcoef_all$Foods_2_CA_2[6]*df_all_test[i-1,6] + dcoef_all$Foods_2_CA_2[7]*df_all_test[i-1,7] + dcoef_all$Foods_2_CA_2[8]*df_all_test[i-1,8] + dcoef_all$Foods_2_CA_2[9]*df_all_test[i-1,9] + dcoef_all$Foods_2_CA_2[10]*df_all_test[i-1,10] + dcoef_all$Foods_2_CA_2[11]*df_all_test[i-1,11] + dcoef_all$Foods_2_CA_2[12]*df_all_test[i-1,12] + dcoef_all$Foods_2_CA_2[13]*df_all_test[i-1,13] + dcoef_all$Foods_2_CA_2[14]*df_all_test[i-1,14] + dcoef_all$Foods_2_CA_2[15]*df_all_test[i-1,15] + dcoef_all$Foods_2_CA_2[16]*df_all_test[i-1,16] + dcoef_all$Foods_2_CA_2[17]*df_all_test[i-1,17] + dcoef_all$Foods_2_CA_2[18]*df_all_test[i-1,18] + dcoef_all$Foods_2_CA_2[19]
    df_all_test[i, 30] = dcoef_all$Foods_3_CA_2[1]*df_all_test[i-1,1] + dcoef_all$Foods_3_CA_2[2]*df_all_test[i-1,2] + dcoef_all$Foods_3_CA_2[3]*df_all_test[i-1,3] + dcoef_all$Foods_3_CA_2[4]*df_all_test[i-1,4] + dcoef_all$Foods_3_CA_2[5]*df_all_test[i-1,5] + dcoef_all$Foods_3_CA_2[6]*df_all_test[i-1,6] + dcoef_all$Foods_3_CA_2[7]*df_all_test[i-1,7] + dcoef_all$Foods_3_CA_2[8]*df_all_test[i-1,8] + dcoef_all$Foods_3_CA_2[9]*df_all_test[i-1,9] + dcoef_all$Foods_3_CA_2[10]*df_all_test[i-1,10] + dcoef_all$Foods_3_CA_2[11]*df_all_test[i-1,11] + dcoef_all$Foods_3_CA_2[12]*df_all_test[i-1,12] + dcoef_all$Foods_3_CA_2[13]*df_all_test[i-1,13] + dcoef_all$Foods_3_CA_2[14]*df_all_test[i-1,14] + dcoef_all$Foods_3_CA_2[15]*df_all_test[i-1,15] + dcoef_all$Foods_3_CA_2[16]*df_all_test[i-1,16] + dcoef_all$Foods_3_CA_2[17]*df_all_test[i-1,17] + dcoef_all$Foods_3_CA_2[18]*df_all_test[i-1,18] + dcoef_all$Foods_3_CA_2[19]
    df_all_test[i, 31] = dcoef_all$Hobbies_CA_3[1]*df_all_test[i-1,1] + dcoef_all$Hobbies_CA_3[2]*df_all_test[i-1,2] + dcoef_all$Hobbies_CA_3[3]*df_all_test[i-1,3] + dcoef_all$Hobbies_CA_3[4]*df_all_test[i-1,4] + dcoef_all$Hobbies_CA_3[5]*df_all_test[i-1,5] + dcoef_all$Hobbies_CA_3[6]*df_all_test[i-1,6] + dcoef_all$Hobbies_CA_3[7]*df_all_test[i-1,7] + dcoef_all$Hobbies_CA_3[8]*df_all_test[i-1,8] + dcoef_all$Hobbies_CA_3[9]*df_all_test[i-1,9] + dcoef_all$Hobbies_CA_3[10]*df_all_test[i-1,10] + dcoef_all$Hobbies_CA_3[11]*df_all_test[i-1,11] + dcoef_all$Hobbies_CA_3[12]*df_all_test[i-1,12] + dcoef_all$Hobbies_CA_3[13]*df_all_test[i-1,13] + dcoef_all$Hobbies_CA_3[14]*df_all_test[i-1,14] + dcoef_all$Hobbies_CA_3[15]*df_all_test[i-1,15] + dcoef_all$Hobbies_CA_3[16]*df_all_test[i-1,16] + dcoef_all$Hobbies_CA_3[17]*df_all_test[i-1,17] + dcoef_all$Hobbies_CA_3[18]*df_all_test[i-1,18] + dcoef_all$Hobbies_CA_3[19]
    df_all_test[i, 32] = dcoef_all$Household_1_CA_3[1]*df_all_test[i-1,1] + dcoef_all$Household_1_CA_3[2]*df_all_test[i-1,2] + dcoef_all$Household_1_CA_3[3]*df_all_test[i-1,3] + dcoef_all$Household_1_CA_3[4]*df_all_test[i-1,4] + dcoef_all$Household_1_CA_3[5]*df_all_test[i-1,5] + dcoef_all$Household_1_CA_3[6]*df_all_test[i-1,6] + dcoef_all$Household_1_CA_3[7]*df_all_test[i-1,7] + dcoef_all$Household_1_CA_3[8]*df_all_test[i-1,8] + dcoef_all$Household_1_CA_3[9]*df_all_test[i-1,9] + dcoef_all$Household_1_CA_3[10]*df_all_test[i-1,10] + dcoef_all$Household_1_CA_3[11]*df_all_test[i-1,11] + dcoef_all$Household_1_CA_3[12]*df_all_test[i-1,12] + dcoef_all$Household_1_CA_3[13]*df_all_test[i-1,13] + dcoef_all$Household_1_CA_3[14]*df_all_test[i-1,14] + dcoef_all$Household_1_CA_3[15]*df_all_test[i-1,15] + dcoef_all$Household_1_CA_3[16]*df_all_test[i-1,16] + dcoef_all$Household_1_CA_3[17]*df_all_test[i-1,17] + dcoef_all$Household_1_CA_3[18]*df_all_test[i-1,18] + dcoef_all$Household_1_CA_3[19]
    df_all_test[i, 33] = dcoef_all$Household_2_CA_3[1]*df_all_test[i-1,1] + dcoef_all$Household_2_CA_3[2]*df_all_test[i-1,2] + dcoef_all$Household_2_CA_3[3]*df_all_test[i-1,3] + dcoef_all$Household_2_CA_3[4]*df_all_test[i-1,4] + dcoef_all$Household_2_CA_3[5]*df_all_test[i-1,5] + dcoef_all$Household_2_CA_3[6]*df_all_test[i-1,6] + dcoef_all$Household_2_CA_3[7]*df_all_test[i-1,7] + dcoef_all$Household_2_CA_3[8]*df_all_test[i-1,8] + dcoef_all$Household_2_CA_3[9]*df_all_test[i-1,9] + dcoef_all$Household_2_CA_3[10]*df_all_test[i-1,10] + dcoef_all$Household_2_CA_3[11]*df_all_test[i-1,11] + dcoef_all$Household_2_CA_3[12]*df_all_test[i-1,12] + dcoef_all$Household_2_CA_3[13]*df_all_test[i-1,13] + dcoef_all$Household_2_CA_3[14]*df_all_test[i-1,14] + dcoef_all$Household_2_CA_3[15]*df_all_test[i-1,15] + dcoef_all$Household_2_CA_3[16]*df_all_test[i-1,16] + dcoef_all$Household_2_CA_3[17]*df_all_test[i-1,17] + dcoef_all$Household_2_CA_3[18]*df_all_test[i-1,18] + dcoef_all$Household_2_CA_3[19]
    df_all_test[i, 34] = dcoef_all$Foods_1_CA_3[1]*df_all_test[i-1,1] + dcoef_all$Foods_1_CA_3[2]*df_all_test[i-1,2] + dcoef_all$Foods_1_CA_3[3]*df_all_test[i-1,3] + dcoef_all$Foods_1_CA_3[4]*df_all_test[i-1,4] + dcoef_all$Foods_1_CA_3[5]*df_all_test[i-1,5] + dcoef_all$Foods_1_CA_3[6]*df_all_test[i-1,6] + dcoef_all$Foods_1_CA_3[7]*df_all_test[i-1,7] + dcoef_all$Foods_1_CA_3[8]*df_all_test[i-1,8] + dcoef_all$Foods_1_CA_3[9]*df_all_test[i-1,9] + dcoef_all$Foods_1_CA_3[10]*df_all_test[i-1,10] + dcoef_all$Foods_1_CA_3[11]*df_all_test[i-1,11] + dcoef_all$Foods_1_CA_3[12]*df_all_test[i-1,12] + dcoef_all$Foods_1_CA_3[13]*df_all_test[i-1,13] + dcoef_all$Foods_1_CA_3[14]*df_all_test[i-1,14] + dcoef_all$Foods_1_CA_3[15]*df_all_test[i-1,15] + dcoef_all$Foods_1_CA_3[16]*df_all_test[i-1,16] + dcoef_all$Foods_1_CA_3[17]*df_all_test[i-1,17] + dcoef_all$Foods_1_CA_3[18]*df_all_test[i-1,18] + dcoef_all$Foods_1_CA_3[19]
    df_all_test[i, 35] = dcoef_all$Foods_2_CA_3[1]*df_all_test[i-1,1] + dcoef_all$Foods_2_CA_3[2]*df_all_test[i-1,2] + dcoef_all$Foods_2_CA_3[3]*df_all_test[i-1,3] + dcoef_all$Foods_2_CA_3[4]*df_all_test[i-1,4] + dcoef_all$Foods_2_CA_3[5]*df_all_test[i-1,5] + dcoef_all$Foods_2_CA_3[6]*df_all_test[i-1,6] + dcoef_all$Foods_2_CA_3[7]*df_all_test[i-1,7] + dcoef_all$Foods_2_CA_3[8]*df_all_test[i-1,8] + dcoef_all$Foods_2_CA_3[9]*df_all_test[i-1,9] + dcoef_all$Foods_2_CA_3[10]*df_all_test[i-1,10] + dcoef_all$Foods_2_CA_3[11]*df_all_test[i-1,11] + dcoef_all$Foods_2_CA_3[12]*df_all_test[i-1,12] + dcoef_all$Foods_2_CA_3[13]*df_all_test[i-1,13] + dcoef_all$Foods_2_CA_3[14]*df_all_test[i-1,14] + dcoef_all$Foods_2_CA_3[15]*df_all_test[i-1,15] + dcoef_all$Foods_2_CA_3[16]*df_all_test[i-1,16] + dcoef_all$Foods_2_CA_3[17]*df_all_test[i-1,17] + dcoef_all$Foods_2_CA_3[18]*df_all_test[i-1,18] + dcoef_all$Foods_2_CA_3[19]
    df_all_test[i, 36] = dcoef_all$Foods_3_CA_3[1]*df_all_test[i-1,1] + dcoef_all$Foods_3_CA_3[2]*df_all_test[i-1,2] + dcoef_all$Foods_3_CA_3[3]*df_all_test[i-1,3] + dcoef_all$Foods_3_CA_3[4]*df_all_test[i-1,4] + dcoef_all$Foods_3_CA_3[5]*df_all_test[i-1,5] + dcoef_all$Foods_3_CA_3[6]*df_all_test[i-1,6] + dcoef_all$Foods_3_CA_3[7]*df_all_test[i-1,7] + dcoef_all$Foods_3_CA_3[8]*df_all_test[i-1,8] + dcoef_all$Foods_3_CA_3[9]*df_all_test[i-1,9] + dcoef_all$Foods_3_CA_3[10]*df_all_test[i-1,10] + dcoef_all$Foods_3_CA_3[11]*df_all_test[i-1,11] + dcoef_all$Foods_3_CA_3[12]*df_all_test[i-1,12] + dcoef_all$Foods_3_CA_3[13]*df_all_test[i-1,13] + dcoef_all$Foods_3_CA_3[14]*df_all_test[i-1,14] + dcoef_all$Foods_3_CA_3[15]*df_all_test[i-1,15] + dcoef_all$Foods_3_CA_3[16]*df_all_test[i-1,16] + dcoef_all$Foods_3_CA_3[17]*df_all_test[i-1,17] + dcoef_all$Foods_3_CA_3[18]*df_all_test[i-1,18] + dcoef_all$Foods_3_CA_3[19]
        
  }
}

  
colnames(df_all_test) = c('Hobbies_CA_1','Household_1_CA_1','Household_2_CA_1','Foods_1_CA_1','Foods_2_CA_1','Foods_3_CA_1'
                          ,'Hobbies_CA_2','Household_1_CA_2','Household_2_CA_2','Foods_1_CA_2','Foods_2_CA_2','Foods_3_CA_2'
                          ,'Hobbies_CA_3','Household_1_CA_3','Household_2_CA_3','Foods_1_CA_3','Foods_2_CA_3','Foods_3_CA_3'
                          ,'Hobbies_CA_1_pred','Household_1_CA_1_pred','Household_2_CA_1_pred','Foods_1_CA_1_pred','Foods_2_CA_1_pred','Foods_3_CA_1_pred'
                          ,'Hobbies_CA_2_pred','Household_1_CA_2_pred','Household_2_CA_2_pred','Foods_1_CA_2_pred','Foods_2_CA_2_pred','Foods_3_CA_2_pred'
                          ,'Hobbies_CA_3_pred','Household_1_CA_3_pred','Household_2_CA_3_pred','Foods_1_CA_3_pred','Foods_2_CA_3_pred','Foods_3_CA_3_pred'
                          )


forecasts_all_23 = df_all_test

# Save the RMSSE Results in a data frame
df_rmsse_CA_1_3yr[1, 3] = RMSSE(forecasts_all_23$Hobbies_CA_1, forecasts_all_23$Hobbies_CA_1_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_1_3yr[2, 3] = RMSSE(forecasts_all_23$Household_1_CA_1, forecasts_all_23$Household_1_CA_1_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_1_3yr[3, 3] = RMSSE(forecasts_all_23$Household_2_CA_1, forecasts_all_23$Household_2_CA_1_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_1_3yr[4, 3] = RMSSE(forecasts_all_23$Foods_1_CA_1, forecasts_all_23$Foods_1_CA_1_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_1_3yr[5, 3] = RMSSE(forecasts_all_23$Foods_2_CA_1, forecasts_all_23$Foods_2_CA_1_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_1_3yr[6, 3] = RMSSE(forecasts_all_23$Foods_3_CA_1, forecasts_all_23$Foods_3_CA_1_pred, scale = 1, na.rm = TRUE)

df_rmsse_CA_2_3yr[1, 3] = RMSSE(forecasts_all_23$Hobbies_CA_2, forecasts_all_23$Hobbies_CA_2_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_2_3yr[2, 3] = RMSSE(forecasts_all_23$Household_1_CA_2, forecasts_all_23$Household_1_CA_2_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_2_3yr[3, 3] = RMSSE(forecasts_all_23$Household_2_CA_2, forecasts_all_23$Household_2_CA_2_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_2_3yr[4, 3] = RMSSE(forecasts_all_23$Foods_1_CA_2, forecasts_all_23$Foods_1_CA_2_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_2_3yr[5, 3] = RMSSE(forecasts_all_23$Foods_2_CA_2, forecasts_all_23$Foods_2_CA_2_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_2_3yr[6, 3] = RMSSE(forecasts_all_23$Foods_3_CA_2, forecasts_all_23$Foods_3_CA_2_pred, scale = 1, na.rm = TRUE)

df_rmsse_CA_3_3yr[1, 3] = RMSSE(forecasts_all_23$Hobbies_CA_3, forecasts_all_23$Hobbies_CA_3_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_3_3yr[2, 3] = RMSSE(forecasts_all_23$Household_1_CA_3, forecasts_all_23$Household_1_CA_3_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_3_3yr[3, 3] = RMSSE(forecasts_all_23$Household_2_CA_3, forecasts_all_23$Household_2_CA_3_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_3_3yr[4, 3] = RMSSE(forecasts_all_23$Foods_1_CA_3, forecasts_all_23$Foods_1_CA_3_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_3_3yr[5, 3] = RMSSE(forecasts_all_23$Foods_2_CA_3, forecasts_all_23$Foods_2_CA_3_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_3_3yr[6, 3] = RMSSE(forecasts_all_23$Foods_3_CA_3, forecasts_all_23$Foods_3_CA_3_pred, scale = 1, na.rm = TRUE)

rownames(df_rmsse_CA_1_3yr) =  c("Hobbies","Household1","Household2","Foods1","Foods2","Foods3")
rownames(df_rmsse_CA_2_3yr) =  c("Hobbies","Household1","Household2","Foods1","Foods2","Foods3")
rownames(df_rmsse_CA_3_3yr) =  c("Hobbies","Household1","Household2","Foods1","Foods2","Foods3")

colnames(df_rmsse_CA_1_3yr) = c("var21","var22","var23")
colnames(df_rmsse_CA_2_3yr) = c("var21","var22","var23")
colnames(df_rmsse_CA_3_3yr) = c("var21","var22","var23")

```

```{r}

df_rmsse_CA_1_3yr
df_rmsse_CA_2_3yr
df_rmsse_CA_3_3yr

```

### Train-test split for data from 2011-2014 for training and 2015 for testing.

```{r, include=FALSE}

# Define the train-test split 703 is 2012-12-31 and 1068 for 2013-12-31
train_sample = 1433
test_sample = 1798

# Choose the columns for each store
# Extracting the columns of the CA_1 store and renaming them
df_all = df
df_all$date = NULL

df_all_train = head(df_all, train_sample)
df_all_test  = head(df_all, test_sample)
df_all_test  = tail(df_all_test, test_sample - train_sample)

var_all_train = VAR(df_all_train, p=1)

dcoef_all = coef(var_all_train)

# iterate the number of test samples to predict using the var coefficients

length_sample = test_sample - train_sample
for (i in 1:length_sample) {
 if (i==1) {
    df_all_test[i, 19] = dcoef_all$Hobbies_CA_1[1]*df_all_train[train_sample,1] + dcoef_all$Hobbies_CA_1[2]*df_all_train[train_sample,2] + dcoef_all$Hobbies_CA_1[3]*df_all_train[train_sample,3] + dcoef_all$Hobbies_CA_1[4]*df_all_train[train_sample,4] + dcoef_all$Hobbies_CA_1[5]*df_all_train[train_sample,5] + dcoef_all$Hobbies_CA_1[6]*df_all_train[train_sample,6] + dcoef_all$Hobbies_CA_1[7]*df_all_train[train_sample,7] + dcoef_all$Hobbies_CA_1[8]*df_all_train[train_sample,8] + dcoef_all$Hobbies_CA_1[9]*df_all_train[train_sample,9] + dcoef_all$Hobbies_CA_1[10]*df_all_train[train_sample,10] + dcoef_all$Hobbies_CA_1[11]*df_all_train[train_sample,11] + dcoef_all$Hobbies_CA_1[12]*df_all_train[train_sample,12] + dcoef_all$Hobbies_CA_1[13]*df_all_train[train_sample,13] + dcoef_all$Hobbies_CA_1[14]*df_all_train[train_sample,14] + dcoef_all$Hobbies_CA_1[15]*df_all_train[train_sample,15] + dcoef_all$Hobbies_CA_1[16]*df_all_train[train_sample,16] + dcoef_all$Hobbies_CA_1[17]*df_all_train[train_sample,17] + dcoef_all$Hobbies_CA_1[18]*df_all_train[train_sample,18] + dcoef_all$Hobbies_CA_1[19]
    df_all_test[i, 20] = dcoef_all$Household_1_CA_1[1]*df_all_train[train_sample,1] + dcoef_all$Household_1_CA_1[2]*df_all_train[train_sample,2] + dcoef_all$Household_1_CA_1[3]*df_all_train[train_sample,3] + dcoef_all$Household_1_CA_1[4]*df_all_train[train_sample,4] + dcoef_all$Household_1_CA_1[5]*df_all_train[train_sample,5] + dcoef_all$Household_1_CA_1[6]*df_all_train[train_sample,6] + dcoef_all$Household_1_CA_1[7]*df_all_train[train_sample,7] + dcoef_all$Household_1_CA_1[8]*df_all_train[train_sample,8] + dcoef_all$Household_1_CA_1[9]*df_all_train[train_sample,9] + dcoef_all$Household_1_CA_1[10]*df_all_train[train_sample,10] + dcoef_all$Household_1_CA_1[11]*df_all_train[train_sample,11] + dcoef_all$Household_1_CA_1[12]*df_all_train[train_sample,12] + dcoef_all$Household_1_CA_1[13]*df_all_train[train_sample,13] + dcoef_all$Household_1_CA_1[14]*df_all_train[train_sample,14] + dcoef_all$Household_1_CA_1[15]*df_all_train[train_sample,15] + dcoef_all$Household_1_CA_1[16]*df_all_train[train_sample,16] + dcoef_all$Household_1_CA_1[17]*df_all_train[train_sample,17] + dcoef_all$Household_1_CA_1[18]*df_all_train[train_sample,18] + dcoef_all$Household_1_CA_1[19]
    df_all_test[i, 21] = dcoef_all$Household_2_CA_1[1]*df_all_train[train_sample,1] + dcoef_all$Household_2_CA_1[2]*df_all_train[train_sample,2] + dcoef_all$Household_2_CA_1[3]*df_all_train[train_sample,3] + dcoef_all$Household_2_CA_1[4]*df_all_train[train_sample,4] + dcoef_all$Household_2_CA_1[5]*df_all_train[train_sample,5] + dcoef_all$Household_2_CA_1[6]*df_all_train[train_sample,6] + dcoef_all$Household_2_CA_1[7]*df_all_train[train_sample,7] + dcoef_all$Household_2_CA_1[8]*df_all_train[train_sample,8] + dcoef_all$Household_2_CA_1[9]*df_all_train[train_sample,9] + dcoef_all$Household_2_CA_1[10]*df_all_train[train_sample,10] + dcoef_all$Household_2_CA_1[11]*df_all_train[train_sample,11] + dcoef_all$Household_2_CA_1[12]*df_all_train[train_sample,12] + dcoef_all$Household_2_CA_1[13]*df_all_train[train_sample,13] + dcoef_all$Household_2_CA_1[14]*df_all_train[train_sample,14] + dcoef_all$Household_2_CA_1[15]*df_all_train[train_sample,15] + dcoef_all$Household_2_CA_1[16]*df_all_train[train_sample,16] + dcoef_all$Household_2_CA_1[17]*df_all_train[train_sample,17] + dcoef_all$Household_2_CA_1[18]*df_all_train[train_sample,18] + dcoef_all$Household_2_CA_1[19]
    df_all_test[i, 22] = dcoef_all$Foods_1_CA_1[1]*df_all_train[train_sample,1] + dcoef_all$Foods_1_CA_1[2]*df_all_train[train_sample,2] + dcoef_all$Foods_1_CA_1[3]*df_all_train[train_sample,3] + dcoef_all$Foods_1_CA_1[4]*df_all_train[train_sample,4] + dcoef_all$Foods_1_CA_1[5]*df_all_train[train_sample,5] + dcoef_all$Foods_1_CA_1[6]*df_all_train[train_sample,6] + dcoef_all$Foods_1_CA_1[7]*df_all_train[train_sample,7] + dcoef_all$Foods_1_CA_1[8]*df_all_train[train_sample,8] + dcoef_all$Foods_1_CA_1[9]*df_all_train[train_sample,9] + dcoef_all$Foods_1_CA_1[10]*df_all_train[train_sample,10] + dcoef_all$Foods_1_CA_1[11]*df_all_train[train_sample,11] + dcoef_all$Foods_1_CA_1[12]*df_all_train[train_sample,12] + dcoef_all$Foods_1_CA_1[13]*df_all_train[train_sample,13] + dcoef_all$Foods_1_CA_1[14]*df_all_train[train_sample,14] + dcoef_all$Foods_1_CA_1[15]*df_all_train[train_sample,15] + dcoef_all$Foods_1_CA_1[16]*df_all_train[train_sample,16] + dcoef_all$Foods_1_CA_1[17]*df_all_train[train_sample,17] + dcoef_all$Foods_1_CA_1[18]*df_all_train[train_sample,18] + dcoef_all$Foods_1_CA_1[19]
    df_all_test[i, 23] = dcoef_all$Foods_2_CA_1[1]*df_all_train[train_sample,1] + dcoef_all$Foods_2_CA_1[2]*df_all_train[train_sample,2] + dcoef_all$Foods_2_CA_1[3]*df_all_train[train_sample,3] + dcoef_all$Foods_2_CA_1[4]*df_all_train[train_sample,4] + dcoef_all$Foods_2_CA_1[5]*df_all_train[train_sample,5] + dcoef_all$Foods_2_CA_1[6]*df_all_train[train_sample,6] + dcoef_all$Foods_2_CA_1[7]*df_all_train[train_sample,7] + dcoef_all$Foods_2_CA_1[8]*df_all_train[train_sample,8] + dcoef_all$Foods_2_CA_1[9]*df_all_train[train_sample,9] + dcoef_all$Foods_2_CA_1[10]*df_all_train[train_sample,10] + dcoef_all$Foods_2_CA_1[11]*df_all_train[train_sample,11] + dcoef_all$Foods_2_CA_1[12]*df_all_train[train_sample,12] + dcoef_all$Foods_2_CA_1[13]*df_all_train[train_sample,13] + dcoef_all$Foods_2_CA_1[14]*df_all_train[train_sample,14] + dcoef_all$Foods_2_CA_1[15]*df_all_train[train_sample,15] + dcoef_all$Foods_2_CA_1[16]*df_all_train[train_sample,16] + dcoef_all$Foods_2_CA_1[17]*df_all_train[train_sample,17] + dcoef_all$Foods_2_CA_1[18]*df_all_train[train_sample,18] + dcoef_all$Foods_2_CA_1[19]
    df_all_test[i, 24] = dcoef_all$Foods_3_CA_1[1]*df_all_train[train_sample,1] + dcoef_all$Foods_3_CA_1[2]*df_all_train[train_sample,2] + dcoef_all$Foods_3_CA_1[3]*df_all_train[train_sample,3] + dcoef_all$Foods_3_CA_1[4]*df_all_train[train_sample,4] + dcoef_all$Foods_3_CA_1[5]*df_all_train[train_sample,5] + dcoef_all$Foods_3_CA_1[6]*df_all_train[train_sample,6] + dcoef_all$Foods_3_CA_1[7]*df_all_train[train_sample,7] + dcoef_all$Foods_3_CA_1[8]*df_all_train[train_sample,8] + dcoef_all$Foods_3_CA_1[9]*df_all_train[train_sample,9] + dcoef_all$Foods_3_CA_1[10]*df_all_train[train_sample,10] + dcoef_all$Foods_3_CA_1[11]*df_all_train[train_sample,11] + dcoef_all$Foods_3_CA_1[12]*df_all_train[train_sample,12] + dcoef_all$Foods_3_CA_1[13]*df_all_train[train_sample,13] + dcoef_all$Foods_3_CA_1[14]*df_all_train[train_sample,14] + dcoef_all$Foods_3_CA_1[15]*df_all_train[train_sample,15] + dcoef_all$Foods_3_CA_1[16]*df_all_train[train_sample,16] + dcoef_all$Foods_3_CA_1[17]*df_all_train[train_sample,17] + dcoef_all$Foods_3_CA_1[18]*df_all_train[train_sample,18] + dcoef_all$Foods_3_CA_1[19]
    df_all_test[i, 25] = dcoef_all$Hobbies_CA_2[1]*df_all_train[train_sample,1] + dcoef_all$Hobbies_CA_2[2]*df_all_train[train_sample,2] + dcoef_all$Hobbies_CA_2[3]*df_all_train[train_sample,3] + dcoef_all$Hobbies_CA_2[4]*df_all_train[train_sample,4] + dcoef_all$Hobbies_CA_2[5]*df_all_train[train_sample,5] + dcoef_all$Hobbies_CA_2[6]*df_all_train[train_sample,6] + dcoef_all$Hobbies_CA_2[7]*df_all_train[train_sample,7] + dcoef_all$Hobbies_CA_2[8]*df_all_train[train_sample,8] + dcoef_all$Hobbies_CA_2[9]*df_all_train[train_sample,9] + dcoef_all$Hobbies_CA_2[10]*df_all_train[train_sample,10] + dcoef_all$Hobbies_CA_2[11]*df_all_train[train_sample,11] + dcoef_all$Hobbies_CA_2[12]*df_all_train[train_sample,12] + dcoef_all$Hobbies_CA_2[13]*df_all_train[train_sample,13] + dcoef_all$Hobbies_CA_2[14]*df_all_train[train_sample,14] + dcoef_all$Hobbies_CA_2[15]*df_all_train[train_sample,15] + dcoef_all$Hobbies_CA_2[16]*df_all_train[train_sample,16] + dcoef_all$Hobbies_CA_2[17]*df_all_train[train_sample,17] + dcoef_all$Hobbies_CA_2[18]*df_all_train[train_sample,18] + dcoef_all$Hobbies_CA_2[19]
    df_all_test[i, 26] = dcoef_all$Household_1_CA_2[1]*df_all_train[train_sample,1] + dcoef_all$Household_1_CA_2[2]*df_all_train[train_sample,2] + dcoef_all$Household_1_CA_2[3]*df_all_train[train_sample,3] + dcoef_all$Household_1_CA_2[4]*df_all_train[train_sample,4] + dcoef_all$Household_1_CA_2[5]*df_all_train[train_sample,5] + dcoef_all$Household_1_CA_2[6]*df_all_train[train_sample,6] + dcoef_all$Household_1_CA_2[7]*df_all_train[train_sample,7] + dcoef_all$Household_1_CA_2[8]*df_all_train[train_sample,8] + dcoef_all$Household_1_CA_2[9]*df_all_train[train_sample,9] + dcoef_all$Household_1_CA_2[10]*df_all_train[train_sample,10] + dcoef_all$Household_1_CA_2[11]*df_all_train[train_sample,11] + dcoef_all$Household_1_CA_2[12]*df_all_train[train_sample,12] + dcoef_all$Household_1_CA_2[13]*df_all_train[train_sample,13] + dcoef_all$Household_1_CA_2[14]*df_all_train[train_sample,14] + dcoef_all$Household_1_CA_2[15]*df_all_train[train_sample,15] + dcoef_all$Household_1_CA_2[16]*df_all_train[train_sample,16] + dcoef_all$Household_1_CA_2[17]*df_all_train[train_sample,17] + dcoef_all$Household_1_CA_2[18]*df_all_train[train_sample,18] + dcoef_all$Household_1_CA_2[19]
    df_all_test[i, 27] = dcoef_all$Household_2_CA_2[1]*df_all_train[train_sample,1] + dcoef_all$Household_2_CA_2[2]*df_all_train[train_sample,2] + dcoef_all$Household_2_CA_2[3]*df_all_train[train_sample,3] + dcoef_all$Household_2_CA_2[4]*df_all_train[train_sample,4] + dcoef_all$Household_2_CA_2[5]*df_all_train[train_sample,5] + dcoef_all$Household_2_CA_2[6]*df_all_train[train_sample,6] + dcoef_all$Household_2_CA_2[7]*df_all_train[train_sample,7] + dcoef_all$Household_2_CA_2[8]*df_all_train[train_sample,8] + dcoef_all$Household_2_CA_2[9]*df_all_train[train_sample,9] + dcoef_all$Household_2_CA_2[10]*df_all_train[train_sample,10] + dcoef_all$Household_2_CA_2[11]*df_all_train[train_sample,11] + dcoef_all$Household_2_CA_2[12]*df_all_train[train_sample,12] + dcoef_all$Household_2_CA_2[13]*df_all_train[train_sample,13] + dcoef_all$Household_2_CA_2[14]*df_all_train[train_sample,14] + dcoef_all$Household_2_CA_2[15]*df_all_train[train_sample,15] + dcoef_all$Household_2_CA_2[16]*df_all_train[train_sample,16] + dcoef_all$Household_2_CA_2[17]*df_all_train[train_sample,17] + dcoef_all$Household_2_CA_2[18]*df_all_train[train_sample,18] + dcoef_all$Household_2_CA_2[19]
    df_all_test[i, 28] = dcoef_all$Foods_1_CA_2[1]*df_all_train[train_sample,1] + dcoef_all$Foods_1_CA_2[2]*df_all_train[train_sample,2] + dcoef_all$Foods_1_CA_2[3]*df_all_train[train_sample,3] + dcoef_all$Foods_1_CA_2[4]*df_all_train[train_sample,4] + dcoef_all$Foods_1_CA_2[5]*df_all_train[train_sample,5] + dcoef_all$Foods_1_CA_2[6]*df_all_train[train_sample,6] + dcoef_all$Foods_1_CA_2[7]*df_all_train[train_sample,7] + dcoef_all$Foods_1_CA_2[8]*df_all_train[train_sample,8] + dcoef_all$Foods_1_CA_2[9]*df_all_train[train_sample,9] + dcoef_all$Foods_1_CA_2[10]*df_all_train[train_sample,10] + dcoef_all$Foods_1_CA_2[11]*df_all_train[train_sample,11] + dcoef_all$Foods_1_CA_2[12]*df_all_train[train_sample,12] + dcoef_all$Foods_1_CA_2[13]*df_all_train[train_sample,13] + dcoef_all$Foods_1_CA_2[14]*df_all_train[train_sample,14] + dcoef_all$Foods_1_CA_2[15]*df_all_train[train_sample,15] + dcoef_all$Foods_1_CA_2[16]*df_all_train[train_sample,16] + dcoef_all$Foods_1_CA_2[17]*df_all_train[train_sample,17] + dcoef_all$Foods_1_CA_2[18]*df_all_train[train_sample,18] + dcoef_all$Foods_1_CA_2[19]
    df_all_test[i, 29] = dcoef_all$Foods_2_CA_2[1]*df_all_train[train_sample,1] + dcoef_all$Foods_2_CA_2[2]*df_all_train[train_sample,2] + dcoef_all$Foods_2_CA_2[3]*df_all_train[train_sample,3] + dcoef_all$Foods_2_CA_2[4]*df_all_train[train_sample,4] + dcoef_all$Foods_2_CA_2[5]*df_all_train[train_sample,5] + dcoef_all$Foods_2_CA_2[6]*df_all_train[train_sample,6] + dcoef_all$Foods_2_CA_2[7]*df_all_train[train_sample,7] + dcoef_all$Foods_2_CA_2[8]*df_all_train[train_sample,8] + dcoef_all$Foods_2_CA_2[9]*df_all_train[train_sample,9] + dcoef_all$Foods_2_CA_2[10]*df_all_train[train_sample,10] + dcoef_all$Foods_2_CA_2[11]*df_all_train[train_sample,11] + dcoef_all$Foods_2_CA_2[12]*df_all_train[train_sample,12] + dcoef_all$Foods_2_CA_2[13]*df_all_train[train_sample,13] + dcoef_all$Foods_2_CA_2[14]*df_all_train[train_sample,14] + dcoef_all$Foods_2_CA_2[15]*df_all_train[train_sample,15] + dcoef_all$Foods_2_CA_2[16]*df_all_train[train_sample,16] + dcoef_all$Foods_2_CA_2[17]*df_all_train[train_sample,17] + dcoef_all$Foods_2_CA_2[18]*df_all_train[train_sample,18] + dcoef_all$Foods_2_CA_2[19]
    df_all_test[i, 30] = dcoef_all$Foods_3_CA_2[1]*df_all_train[train_sample,1] + dcoef_all$Foods_3_CA_2[2]*df_all_train[train_sample,2] + dcoef_all$Foods_3_CA_2[3]*df_all_train[train_sample,3] + dcoef_all$Foods_3_CA_2[4]*df_all_train[train_sample,4] + dcoef_all$Foods_3_CA_2[5]*df_all_train[train_sample,5] + dcoef_all$Foods_3_CA_2[6]*df_all_train[train_sample,6] + dcoef_all$Foods_3_CA_2[7]*df_all_train[train_sample,7] + dcoef_all$Foods_3_CA_2[8]*df_all_train[train_sample,8] + dcoef_all$Foods_3_CA_2[9]*df_all_train[train_sample,9] + dcoef_all$Foods_3_CA_2[10]*df_all_train[train_sample,10] + dcoef_all$Foods_3_CA_2[11]*df_all_train[train_sample,11] + dcoef_all$Foods_3_CA_2[12]*df_all_train[train_sample,12] + dcoef_all$Foods_3_CA_2[13]*df_all_train[train_sample,13] + dcoef_all$Foods_3_CA_2[14]*df_all_train[train_sample,14] + dcoef_all$Foods_3_CA_2[15]*df_all_train[train_sample,15] + dcoef_all$Foods_3_CA_2[16]*df_all_train[train_sample,16] + dcoef_all$Foods_3_CA_2[17]*df_all_train[train_sample,17] + dcoef_all$Foods_3_CA_2[18]*df_all_train[train_sample,18] + dcoef_all$Foods_3_CA_2[19]
    df_all_test[i, 31] = dcoef_all$Hobbies_CA_3[1]*df_all_train[train_sample,1] + dcoef_all$Hobbies_CA_3[2]*df_all_train[train_sample,2] + dcoef_all$Hobbies_CA_3[3]*df_all_train[train_sample,3] + dcoef_all$Hobbies_CA_3[4]*df_all_train[train_sample,4] + dcoef_all$Hobbies_CA_3[5]*df_all_train[train_sample,5] + dcoef_all$Hobbies_CA_3[6]*df_all_train[train_sample,6] + dcoef_all$Hobbies_CA_3[7]*df_all_train[train_sample,7] + dcoef_all$Hobbies_CA_3[8]*df_all_train[train_sample,8] + dcoef_all$Hobbies_CA_3[9]*df_all_train[train_sample,9] + dcoef_all$Hobbies_CA_3[10]*df_all_train[train_sample,10] + dcoef_all$Hobbies_CA_3[11]*df_all_train[train_sample,11] + dcoef_all$Hobbies_CA_3[12]*df_all_train[train_sample,12] + dcoef_all$Hobbies_CA_3[13]*df_all_train[train_sample,13] + dcoef_all$Hobbies_CA_3[14]*df_all_train[train_sample,14] + dcoef_all$Hobbies_CA_3[15]*df_all_train[train_sample,15] + dcoef_all$Hobbies_CA_3[16]*df_all_train[train_sample,16] + dcoef_all$Hobbies_CA_3[17]*df_all_train[train_sample,17] + dcoef_all$Hobbies_CA_3[18]*df_all_train[train_sample,18] + dcoef_all$Hobbies_CA_3[19]
    df_all_test[i, 32] = dcoef_all$Household_1_CA_3[1]*df_all_train[train_sample,1] + dcoef_all$Household_1_CA_3[2]*df_all_train[train_sample,2] + dcoef_all$Household_1_CA_3[3]*df_all_train[train_sample,3] + dcoef_all$Household_1_CA_3[4]*df_all_train[train_sample,4] + dcoef_all$Household_1_CA_3[5]*df_all_train[train_sample,5] + dcoef_all$Household_1_CA_3[6]*df_all_train[train_sample,6] + dcoef_all$Household_1_CA_3[7]*df_all_train[train_sample,7] + dcoef_all$Household_1_CA_3[8]*df_all_train[train_sample,8] + dcoef_all$Household_1_CA_3[9]*df_all_train[train_sample,9] + dcoef_all$Household_1_CA_3[10]*df_all_train[train_sample,10] + dcoef_all$Household_1_CA_3[11]*df_all_train[train_sample,11] + dcoef_all$Household_1_CA_3[12]*df_all_train[train_sample,12] + dcoef_all$Household_1_CA_3[13]*df_all_train[train_sample,13] + dcoef_all$Household_1_CA_3[14]*df_all_train[train_sample,14] + dcoef_all$Household_1_CA_3[15]*df_all_train[train_sample,15] + dcoef_all$Household_1_CA_3[16]*df_all_train[train_sample,16] + dcoef_all$Household_1_CA_3[17]*df_all_train[train_sample,17] + dcoef_all$Household_1_CA_3[18]*df_all_train[train_sample,18] + dcoef_all$Household_1_CA_3[19]
    df_all_test[i, 33] = dcoef_all$Household_2_CA_3[1]*df_all_train[train_sample,1] + dcoef_all$Household_2_CA_3[2]*df_all_train[train_sample,2] + dcoef_all$Household_2_CA_3[3]*df_all_train[train_sample,3] + dcoef_all$Household_2_CA_3[4]*df_all_train[train_sample,4] + dcoef_all$Household_2_CA_3[5]*df_all_train[train_sample,5] + dcoef_all$Household_2_CA_3[6]*df_all_train[train_sample,6] + dcoef_all$Household_2_CA_3[7]*df_all_train[train_sample,7] + dcoef_all$Household_2_CA_3[8]*df_all_train[train_sample,8] + dcoef_all$Household_2_CA_3[9]*df_all_train[train_sample,9] + dcoef_all$Household_2_CA_3[10]*df_all_train[train_sample,10] + dcoef_all$Household_2_CA_3[11]*df_all_train[train_sample,11] + dcoef_all$Household_2_CA_3[12]*df_all_train[train_sample,12] + dcoef_all$Household_2_CA_3[13]*df_all_train[train_sample,13] + dcoef_all$Household_2_CA_3[14]*df_all_train[train_sample,14] + dcoef_all$Household_2_CA_3[15]*df_all_train[train_sample,15] + dcoef_all$Household_2_CA_3[16]*df_all_train[train_sample,16] + dcoef_all$Household_2_CA_3[17]*df_all_train[train_sample,17] + dcoef_all$Household_2_CA_3[18]*df_all_train[train_sample,18] + dcoef_all$Household_2_CA_3[19]
    df_all_test[i, 34] = dcoef_all$Foods_1_CA_3[1]*df_all_train[train_sample,1] + dcoef_all$Foods_1_CA_3[2]*df_all_train[train_sample,2] + dcoef_all$Foods_1_CA_3[3]*df_all_train[train_sample,3] + dcoef_all$Foods_1_CA_3[4]*df_all_train[train_sample,4] + dcoef_all$Foods_1_CA_3[5]*df_all_train[train_sample,5] + dcoef_all$Foods_1_CA_3[6]*df_all_train[train_sample,6] + dcoef_all$Foods_1_CA_3[7]*df_all_train[train_sample,7] + dcoef_all$Foods_1_CA_3[8]*df_all_train[train_sample,8] + dcoef_all$Foods_1_CA_3[9]*df_all_train[train_sample,9] + dcoef_all$Foods_1_CA_3[10]*df_all_train[train_sample,10] + dcoef_all$Foods_1_CA_3[11]*df_all_train[train_sample,11] + dcoef_all$Foods_1_CA_3[12]*df_all_train[train_sample,12] + dcoef_all$Foods_1_CA_3[13]*df_all_train[train_sample,13] + dcoef_all$Foods_1_CA_3[14]*df_all_train[train_sample,14] + dcoef_all$Foods_1_CA_3[15]*df_all_train[train_sample,15] + dcoef_all$Foods_1_CA_3[16]*df_all_train[train_sample,16] + dcoef_all$Foods_1_CA_3[17]*df_all_train[train_sample,17] + dcoef_all$Foods_1_CA_3[18]*df_all_train[train_sample,18] + dcoef_all$Foods_1_CA_3[19]
    df_all_test[i, 35] = dcoef_all$Foods_2_CA_3[1]*df_all_train[train_sample,1] + dcoef_all$Foods_2_CA_3[2]*df_all_train[train_sample,2] + dcoef_all$Foods_2_CA_3[3]*df_all_train[train_sample,3] + dcoef_all$Foods_2_CA_3[4]*df_all_train[train_sample,4] + dcoef_all$Foods_2_CA_3[5]*df_all_train[train_sample,5] + dcoef_all$Foods_2_CA_3[6]*df_all_train[train_sample,6] + dcoef_all$Foods_2_CA_3[7]*df_all_train[train_sample,7] + dcoef_all$Foods_2_CA_3[8]*df_all_train[train_sample,8] + dcoef_all$Foods_2_CA_3[9]*df_all_train[train_sample,9] + dcoef_all$Foods_2_CA_3[10]*df_all_train[train_sample,10] + dcoef_all$Foods_2_CA_3[11]*df_all_train[train_sample,11] + dcoef_all$Foods_2_CA_3[12]*df_all_train[train_sample,12] + dcoef_all$Foods_2_CA_3[13]*df_all_train[train_sample,13] + dcoef_all$Foods_2_CA_3[14]*df_all_train[train_sample,14] + dcoef_all$Foods_2_CA_3[15]*df_all_train[train_sample,15] + dcoef_all$Foods_2_CA_3[16]*df_all_train[train_sample,16] + dcoef_all$Foods_2_CA_3[17]*df_all_train[train_sample,17] + dcoef_all$Foods_2_CA_3[18]*df_all_train[train_sample,18] + dcoef_all$Foods_2_CA_3[19]
    df_all_test[i, 36] = dcoef_all$Foods_3_CA_3[1]*df_all_train[train_sample,1] + dcoef_all$Foods_3_CA_3[2]*df_all_train[train_sample,2] + dcoef_all$Foods_3_CA_3[3]*df_all_train[train_sample,3] + dcoef_all$Foods_3_CA_3[4]*df_all_train[train_sample,4] + dcoef_all$Foods_3_CA_3[5]*df_all_train[train_sample,5] + dcoef_all$Foods_3_CA_3[6]*df_all_train[train_sample,6] + dcoef_all$Foods_3_CA_3[7]*df_all_train[train_sample,7] + dcoef_all$Foods_3_CA_3[8]*df_all_train[train_sample,8] + dcoef_all$Foods_3_CA_3[9]*df_all_train[train_sample,9] + dcoef_all$Foods_3_CA_3[10]*df_all_train[train_sample,10] + dcoef_all$Foods_3_CA_3[11]*df_all_train[train_sample,11] + dcoef_all$Foods_3_CA_3[12]*df_all_train[train_sample,12] + dcoef_all$Foods_3_CA_3[13]*df_all_train[train_sample,13] + dcoef_all$Foods_3_CA_3[14]*df_all_train[train_sample,14] + dcoef_all$Foods_3_CA_3[15]*df_all_train[train_sample,15] + dcoef_all$Foods_3_CA_3[16]*df_all_train[train_sample,16] + dcoef_all$Foods_3_CA_3[17]*df_all_train[train_sample,17] + dcoef_all$Foods_3_CA_3[18]*df_all_train[train_sample,18] + dcoef_all$Foods_3_CA_3[19]
    
  }
  else {
    df_all_test[i, 19] = dcoef_all$Hobbies_CA_1[1]*df_all_test[i-1,1] + dcoef_all$Hobbies_CA_1[2]*df_all_test[i-1,2] + dcoef_all$Hobbies_CA_1[3]*df_all_test[i-1,3] + dcoef_all$Hobbies_CA_1[4]*df_all_test[i-1,4] + dcoef_all$Hobbies_CA_1[5]*df_all_test[i-1,5] + dcoef_all$Hobbies_CA_1[6]*df_all_test[i-1,6] + dcoef_all$Hobbies_CA_1[7]*df_all_test[i-1,7] + dcoef_all$Hobbies_CA_1[8]*df_all_test[i-1,8] + dcoef_all$Hobbies_CA_1[9]*df_all_test[i-1,9] + dcoef_all$Hobbies_CA_1[10]*df_all_test[i-1,10] + dcoef_all$Hobbies_CA_1[11]*df_all_test[i-1,11] + dcoef_all$Hobbies_CA_1[12]*df_all_test[i-1,12] + dcoef_all$Hobbies_CA_1[13]*df_all_test[i-1,13] + dcoef_all$Hobbies_CA_1[14]*df_all_test[i-1,14] + dcoef_all$Hobbies_CA_1[15]*df_all_test[i-1,15] + dcoef_all$Hobbies_CA_1[16]*df_all_test[i-1,16] + dcoef_all$Hobbies_CA_1[17]*df_all_test[i-1,17] + dcoef_all$Hobbies_CA_1[18]*df_all_test[i-1,18] + dcoef_all$Hobbies_CA_1[19]
    df_all_test[i, 20] = dcoef_all$Household_1_CA_1[1]*df_all_test[i-1,1] + dcoef_all$Household_1_CA_1[2]*df_all_test[i-1,2] + dcoef_all$Household_1_CA_1[3]*df_all_test[i-1,3] + dcoef_all$Household_1_CA_1[4]*df_all_test[i-1,4] + dcoef_all$Household_1_CA_1[5]*df_all_test[i-1,5] + dcoef_all$Household_1_CA_1[6]*df_all_test[i-1,6] + dcoef_all$Household_1_CA_1[7]*df_all_test[i-1,7] + dcoef_all$Household_1_CA_1[8]*df_all_test[i-1,8] + dcoef_all$Household_1_CA_1[9]*df_all_test[i-1,9] + dcoef_all$Household_1_CA_1[10]*df_all_test[i-1,10] + dcoef_all$Household_1_CA_1[11]*df_all_test[i-1,11] + dcoef_all$Household_1_CA_1[12]*df_all_test[i-1,12] + dcoef_all$Household_1_CA_1[13]*df_all_test[i-1,13] + dcoef_all$Household_1_CA_1[14]*df_all_test[i-1,14] + dcoef_all$Household_1_CA_1[15]*df_all_test[i-1,15] + dcoef_all$Household_1_CA_1[16]*df_all_test[i-1,16] + dcoef_all$Household_1_CA_1[17]*df_all_test[i-1,17] + dcoef_all$Household_1_CA_1[18]*df_all_test[i-1,18] + dcoef_all$Household_1_CA_1[19]
    df_all_test[i, 21] = dcoef_all$Household_2_CA_1[1]*df_all_test[i-1,1] + dcoef_all$Household_2_CA_1[2]*df_all_test[i-1,2] + dcoef_all$Household_2_CA_1[3]*df_all_test[i-1,3] + dcoef_all$Household_2_CA_1[4]*df_all_test[i-1,4] + dcoef_all$Household_2_CA_1[5]*df_all_test[i-1,5] + dcoef_all$Household_2_CA_1[6]*df_all_test[i-1,6] + dcoef_all$Household_2_CA_1[7]*df_all_test[i-1,7] + dcoef_all$Household_2_CA_1[8]*df_all_test[i-1,8] + dcoef_all$Household_2_CA_1[9]*df_all_test[i-1,9] + dcoef_all$Household_2_CA_1[10]*df_all_test[i-1,10] + dcoef_all$Household_2_CA_1[11]*df_all_test[i-1,11] + dcoef_all$Household_2_CA_1[12]*df_all_test[i-1,12] + dcoef_all$Household_2_CA_1[13]*df_all_test[i-1,13] + dcoef_all$Household_2_CA_1[14]*df_all_test[i-1,14] + dcoef_all$Household_2_CA_1[15]*df_all_test[i-1,15] + dcoef_all$Household_2_CA_1[16]*df_all_test[i-1,16] + dcoef_all$Household_2_CA_1[17]*df_all_test[i-1,17] + dcoef_all$Household_2_CA_1[18]*df_all_test[i-1,18] + dcoef_all$Household_2_CA_1[19]
    df_all_test[i, 22] = dcoef_all$Foods_1_CA_1[1]*df_all_test[i-1,1] + dcoef_all$Foods_1_CA_1[2]*df_all_test[i-1,2] + dcoef_all$Foods_1_CA_1[3]*df_all_test[i-1,3] + dcoef_all$Foods_1_CA_1[4]*df_all_test[i-1,4] + dcoef_all$Foods_1_CA_1[5]*df_all_test[i-1,5] + dcoef_all$Foods_1_CA_1[6]*df_all_test[i-1,6] + dcoef_all$Foods_1_CA_1[7]*df_all_test[i-1,7] + dcoef_all$Foods_1_CA_1[8]*df_all_test[i-1,8] + dcoef_all$Foods_1_CA_1[9]*df_all_test[i-1,9] + dcoef_all$Foods_1_CA_1[10]*df_all_test[i-1,10] + dcoef_all$Foods_1_CA_1[11]*df_all_test[i-1,11] + dcoef_all$Foods_1_CA_1[12]*df_all_test[i-1,12] + dcoef_all$Foods_1_CA_1[13]*df_all_test[i-1,13] + dcoef_all$Foods_1_CA_1[14]*df_all_test[i-1,14] + dcoef_all$Foods_1_CA_1[15]*df_all_test[i-1,15] + dcoef_all$Foods_1_CA_1[16]*df_all_test[i-1,16] + dcoef_all$Foods_1_CA_1[17]*df_all_test[i-1,17] + dcoef_all$Foods_1_CA_1[18]*df_all_test[i-1,18] + dcoef_all$Foods_1_CA_1[19]
    df_all_test[i, 23] = dcoef_all$Foods_2_CA_1[1]*df_all_test[i-1,1] + dcoef_all$Foods_2_CA_1[2]*df_all_test[i-1,2] + dcoef_all$Foods_2_CA_1[3]*df_all_test[i-1,3] + dcoef_all$Foods_2_CA_1[4]*df_all_test[i-1,4] + dcoef_all$Foods_2_CA_1[5]*df_all_test[i-1,5] + dcoef_all$Foods_2_CA_1[6]*df_all_test[i-1,6] + dcoef_all$Foods_2_CA_1[7]*df_all_test[i-1,7] + dcoef_all$Foods_2_CA_1[8]*df_all_test[i-1,8] + dcoef_all$Foods_2_CA_1[9]*df_all_test[i-1,9] + dcoef_all$Foods_2_CA_1[10]*df_all_test[i-1,10] + dcoef_all$Foods_2_CA_1[11]*df_all_test[i-1,11] + dcoef_all$Foods_2_CA_1[12]*df_all_test[i-1,12] + dcoef_all$Foods_2_CA_1[13]*df_all_test[i-1,13] + dcoef_all$Foods_2_CA_1[14]*df_all_test[i-1,14] + dcoef_all$Foods_2_CA_1[15]*df_all_test[i-1,15] + dcoef_all$Foods_2_CA_1[16]*df_all_test[i-1,16] + dcoef_all$Foods_2_CA_1[17]*df_all_test[i-1,17] + dcoef_all$Foods_2_CA_1[18]*df_all_test[i-1,18] + dcoef_all$Foods_2_CA_1[19]
    df_all_test[i, 24] = dcoef_all$Foods_3_CA_1[1]*df_all_test[i-1,1] + dcoef_all$Foods_3_CA_1[2]*df_all_test[i-1,2] + dcoef_all$Foods_3_CA_1[3]*df_all_test[i-1,3] + dcoef_all$Foods_3_CA_1[4]*df_all_test[i-1,4] + dcoef_all$Foods_3_CA_1[5]*df_all_test[i-1,5] + dcoef_all$Foods_3_CA_1[6]*df_all_test[i-1,6] + dcoef_all$Foods_3_CA_1[7]*df_all_test[i-1,7] + dcoef_all$Foods_3_CA_1[8]*df_all_test[i-1,8] + dcoef_all$Foods_3_CA_1[9]*df_all_test[i-1,9] + dcoef_all$Foods_3_CA_1[10]*df_all_test[i-1,10] + dcoef_all$Foods_3_CA_1[11]*df_all_test[i-1,11] + dcoef_all$Foods_3_CA_1[12]*df_all_test[i-1,12] + dcoef_all$Foods_3_CA_1[13]*df_all_test[i-1,13] + dcoef_all$Foods_3_CA_1[14]*df_all_test[i-1,14] + dcoef_all$Foods_3_CA_1[15]*df_all_test[i-1,15] + dcoef_all$Foods_3_CA_1[16]*df_all_test[i-1,16] + dcoef_all$Foods_3_CA_1[17]*df_all_test[i-1,17] + dcoef_all$Foods_3_CA_1[18]*df_all_test[i-1,18] + dcoef_all$Foods_3_CA_1[19]
    df_all_test[i, 25] = dcoef_all$Hobbies_CA_2[1]*df_all_test[i-1,1] + dcoef_all$Hobbies_CA_2[2]*df_all_test[i-1,2] + dcoef_all$Hobbies_CA_2[3]*df_all_test[i-1,3] + dcoef_all$Hobbies_CA_2[4]*df_all_test[i-1,4] + dcoef_all$Hobbies_CA_2[5]*df_all_test[i-1,5] + dcoef_all$Hobbies_CA_2[6]*df_all_test[i-1,6] + dcoef_all$Hobbies_CA_2[7]*df_all_test[i-1,7] + dcoef_all$Hobbies_CA_2[8]*df_all_test[i-1,8] + dcoef_all$Hobbies_CA_2[9]*df_all_test[i-1,9] + dcoef_all$Hobbies_CA_2[10]*df_all_test[i-1,10] + dcoef_all$Hobbies_CA_2[11]*df_all_test[i-1,11] + dcoef_all$Hobbies_CA_2[12]*df_all_test[i-1,12] + dcoef_all$Hobbies_CA_2[13]*df_all_test[i-1,13] + dcoef_all$Hobbies_CA_2[14]*df_all_test[i-1,14] + dcoef_all$Hobbies_CA_2[15]*df_all_test[i-1,15] + dcoef_all$Hobbies_CA_2[16]*df_all_test[i-1,16] + dcoef_all$Hobbies_CA_2[17]*df_all_test[i-1,17] + dcoef_all$Hobbies_CA_2[18]*df_all_test[i-1,18] + dcoef_all$Hobbies_CA_2[19]
    df_all_test[i, 26] = dcoef_all$Household_1_CA_2[1]*df_all_test[i-1,1] + dcoef_all$Household_1_CA_2[2]*df_all_test[i-1,2] + dcoef_all$Household_1_CA_2[3]*df_all_test[i-1,3] + dcoef_all$Household_1_CA_2[4]*df_all_test[i-1,4] + dcoef_all$Household_1_CA_2[5]*df_all_test[i-1,5] + dcoef_all$Household_1_CA_2[6]*df_all_test[i-1,6] + dcoef_all$Household_1_CA_2[7]*df_all_test[i-1,7] + dcoef_all$Household_1_CA_2[8]*df_all_test[i-1,8] + dcoef_all$Household_1_CA_2[9]*df_all_test[i-1,9] + dcoef_all$Household_1_CA_2[10]*df_all_test[i-1,10] + dcoef_all$Household_1_CA_2[11]*df_all_test[i-1,11] + dcoef_all$Household_1_CA_2[12]*df_all_test[i-1,12] + dcoef_all$Household_1_CA_2[13]*df_all_test[i-1,13] + dcoef_all$Household_1_CA_2[14]*df_all_test[i-1,14] + dcoef_all$Household_1_CA_2[15]*df_all_test[i-1,15] + dcoef_all$Household_1_CA_2[16]*df_all_test[i-1,16] + dcoef_all$Household_1_CA_2[17]*df_all_test[i-1,17] + dcoef_all$Household_1_CA_2[18]*df_all_test[i-1,18] + dcoef_all$Household_1_CA_2[19]
    df_all_test[i, 27] = dcoef_all$Household_2_CA_2[1]*df_all_test[i-1,1] + dcoef_all$Household_2_CA_2[2]*df_all_test[i-1,2] + dcoef_all$Household_2_CA_2[3]*df_all_test[i-1,3] + dcoef_all$Household_2_CA_2[4]*df_all_test[i-1,4] + dcoef_all$Household_2_CA_2[5]*df_all_test[i-1,5] + dcoef_all$Household_2_CA_2[6]*df_all_test[i-1,6] + dcoef_all$Household_2_CA_2[7]*df_all_test[i-1,7] + dcoef_all$Household_2_CA_2[8]*df_all_test[i-1,8] + dcoef_all$Household_2_CA_2[9]*df_all_test[i-1,9] + dcoef_all$Household_2_CA_2[10]*df_all_test[i-1,10] + dcoef_all$Household_2_CA_2[11]*df_all_test[i-1,11] + dcoef_all$Household_2_CA_2[12]*df_all_test[i-1,12] + dcoef_all$Household_2_CA_2[13]*df_all_test[i-1,13] + dcoef_all$Household_2_CA_2[14]*df_all_test[i-1,14] + dcoef_all$Household_2_CA_2[15]*df_all_test[i-1,15] + dcoef_all$Household_2_CA_2[16]*df_all_test[i-1,16] + dcoef_all$Household_2_CA_2[17]*df_all_test[i-1,17] + dcoef_all$Household_2_CA_2[18]*df_all_test[i-1,18] + dcoef_all$Household_2_CA_2[19]
    df_all_test[i, 28] = dcoef_all$Foods_1_CA_2[1]*df_all_test[i-1,1] + dcoef_all$Foods_1_CA_2[2]*df_all_test[i-1,2] + dcoef_all$Foods_1_CA_2[3]*df_all_test[i-1,3] + dcoef_all$Foods_1_CA_2[4]*df_all_test[i-1,4] + dcoef_all$Foods_1_CA_2[5]*df_all_test[i-1,5] + dcoef_all$Foods_1_CA_2[6]*df_all_test[i-1,6] + dcoef_all$Foods_1_CA_2[7]*df_all_test[i-1,7] + dcoef_all$Foods_1_CA_2[8]*df_all_test[i-1,8] + dcoef_all$Foods_1_CA_2[9]*df_all_test[i-1,9] + dcoef_all$Foods_1_CA_2[10]*df_all_test[i-1,10] + dcoef_all$Foods_1_CA_2[11]*df_all_test[i-1,11] + dcoef_all$Foods_1_CA_2[12]*df_all_test[i-1,12] + dcoef_all$Foods_1_CA_2[13]*df_all_test[i-1,13] + dcoef_all$Foods_1_CA_2[14]*df_all_test[i-1,14] + dcoef_all$Foods_1_CA_2[15]*df_all_test[i-1,15] + dcoef_all$Foods_1_CA_2[16]*df_all_test[i-1,16] + dcoef_all$Foods_1_CA_2[17]*df_all_test[i-1,17] + dcoef_all$Foods_1_CA_2[18]*df_all_test[i-1,18] + dcoef_all$Foods_1_CA_2[19]
    df_all_test[i, 29] = dcoef_all$Foods_2_CA_2[1]*df_all_test[i-1,1] + dcoef_all$Foods_2_CA_2[2]*df_all_test[i-1,2] + dcoef_all$Foods_2_CA_2[3]*df_all_test[i-1,3] + dcoef_all$Foods_2_CA_2[4]*df_all_test[i-1,4] + dcoef_all$Foods_2_CA_2[5]*df_all_test[i-1,5] + dcoef_all$Foods_2_CA_2[6]*df_all_test[i-1,6] + dcoef_all$Foods_2_CA_2[7]*df_all_test[i-1,7] + dcoef_all$Foods_2_CA_2[8]*df_all_test[i-1,8] + dcoef_all$Foods_2_CA_2[9]*df_all_test[i-1,9] + dcoef_all$Foods_2_CA_2[10]*df_all_test[i-1,10] + dcoef_all$Foods_2_CA_2[11]*df_all_test[i-1,11] + dcoef_all$Foods_2_CA_2[12]*df_all_test[i-1,12] + dcoef_all$Foods_2_CA_2[13]*df_all_test[i-1,13] + dcoef_all$Foods_2_CA_2[14]*df_all_test[i-1,14] + dcoef_all$Foods_2_CA_2[15]*df_all_test[i-1,15] + dcoef_all$Foods_2_CA_2[16]*df_all_test[i-1,16] + dcoef_all$Foods_2_CA_2[17]*df_all_test[i-1,17] + dcoef_all$Foods_2_CA_2[18]*df_all_test[i-1,18] + dcoef_all$Foods_2_CA_2[19]
    df_all_test[i, 30] = dcoef_all$Foods_3_CA_2[1]*df_all_test[i-1,1] + dcoef_all$Foods_3_CA_2[2]*df_all_test[i-1,2] + dcoef_all$Foods_3_CA_2[3]*df_all_test[i-1,3] + dcoef_all$Foods_3_CA_2[4]*df_all_test[i-1,4] + dcoef_all$Foods_3_CA_2[5]*df_all_test[i-1,5] + dcoef_all$Foods_3_CA_2[6]*df_all_test[i-1,6] + dcoef_all$Foods_3_CA_2[7]*df_all_test[i-1,7] + dcoef_all$Foods_3_CA_2[8]*df_all_test[i-1,8] + dcoef_all$Foods_3_CA_2[9]*df_all_test[i-1,9] + dcoef_all$Foods_3_CA_2[10]*df_all_test[i-1,10] + dcoef_all$Foods_3_CA_2[11]*df_all_test[i-1,11] + dcoef_all$Foods_3_CA_2[12]*df_all_test[i-1,12] + dcoef_all$Foods_3_CA_2[13]*df_all_test[i-1,13] + dcoef_all$Foods_3_CA_2[14]*df_all_test[i-1,14] + dcoef_all$Foods_3_CA_2[15]*df_all_test[i-1,15] + dcoef_all$Foods_3_CA_2[16]*df_all_test[i-1,16] + dcoef_all$Foods_3_CA_2[17]*df_all_test[i-1,17] + dcoef_all$Foods_3_CA_2[18]*df_all_test[i-1,18] + dcoef_all$Foods_3_CA_2[19]
    df_all_test[i, 31] = dcoef_all$Hobbies_CA_3[1]*df_all_test[i-1,1] + dcoef_all$Hobbies_CA_3[2]*df_all_test[i-1,2] + dcoef_all$Hobbies_CA_3[3]*df_all_test[i-1,3] + dcoef_all$Hobbies_CA_3[4]*df_all_test[i-1,4] + dcoef_all$Hobbies_CA_3[5]*df_all_test[i-1,5] + dcoef_all$Hobbies_CA_3[6]*df_all_test[i-1,6] + dcoef_all$Hobbies_CA_3[7]*df_all_test[i-1,7] + dcoef_all$Hobbies_CA_3[8]*df_all_test[i-1,8] + dcoef_all$Hobbies_CA_3[9]*df_all_test[i-1,9] + dcoef_all$Hobbies_CA_3[10]*df_all_test[i-1,10] + dcoef_all$Hobbies_CA_3[11]*df_all_test[i-1,11] + dcoef_all$Hobbies_CA_3[12]*df_all_test[i-1,12] + dcoef_all$Hobbies_CA_3[13]*df_all_test[i-1,13] + dcoef_all$Hobbies_CA_3[14]*df_all_test[i-1,14] + dcoef_all$Hobbies_CA_3[15]*df_all_test[i-1,15] + dcoef_all$Hobbies_CA_3[16]*df_all_test[i-1,16] + dcoef_all$Hobbies_CA_3[17]*df_all_test[i-1,17] + dcoef_all$Hobbies_CA_3[18]*df_all_test[i-1,18] + dcoef_all$Hobbies_CA_3[19]
    df_all_test[i, 32] = dcoef_all$Household_1_CA_3[1]*df_all_test[i-1,1] + dcoef_all$Household_1_CA_3[2]*df_all_test[i-1,2] + dcoef_all$Household_1_CA_3[3]*df_all_test[i-1,3] + dcoef_all$Household_1_CA_3[4]*df_all_test[i-1,4] + dcoef_all$Household_1_CA_3[5]*df_all_test[i-1,5] + dcoef_all$Household_1_CA_3[6]*df_all_test[i-1,6] + dcoef_all$Household_1_CA_3[7]*df_all_test[i-1,7] + dcoef_all$Household_1_CA_3[8]*df_all_test[i-1,8] + dcoef_all$Household_1_CA_3[9]*df_all_test[i-1,9] + dcoef_all$Household_1_CA_3[10]*df_all_test[i-1,10] + dcoef_all$Household_1_CA_3[11]*df_all_test[i-1,11] + dcoef_all$Household_1_CA_3[12]*df_all_test[i-1,12] + dcoef_all$Household_1_CA_3[13]*df_all_test[i-1,13] + dcoef_all$Household_1_CA_3[14]*df_all_test[i-1,14] + dcoef_all$Household_1_CA_3[15]*df_all_test[i-1,15] + dcoef_all$Household_1_CA_3[16]*df_all_test[i-1,16] + dcoef_all$Household_1_CA_3[17]*df_all_test[i-1,17] + dcoef_all$Household_1_CA_3[18]*df_all_test[i-1,18] + dcoef_all$Household_1_CA_3[19]
    df_all_test[i, 33] = dcoef_all$Household_2_CA_3[1]*df_all_test[i-1,1] + dcoef_all$Household_2_CA_3[2]*df_all_test[i-1,2] + dcoef_all$Household_2_CA_3[3]*df_all_test[i-1,3] + dcoef_all$Household_2_CA_3[4]*df_all_test[i-1,4] + dcoef_all$Household_2_CA_3[5]*df_all_test[i-1,5] + dcoef_all$Household_2_CA_3[6]*df_all_test[i-1,6] + dcoef_all$Household_2_CA_3[7]*df_all_test[i-1,7] + dcoef_all$Household_2_CA_3[8]*df_all_test[i-1,8] + dcoef_all$Household_2_CA_3[9]*df_all_test[i-1,9] + dcoef_all$Household_2_CA_3[10]*df_all_test[i-1,10] + dcoef_all$Household_2_CA_3[11]*df_all_test[i-1,11] + dcoef_all$Household_2_CA_3[12]*df_all_test[i-1,12] + dcoef_all$Household_2_CA_3[13]*df_all_test[i-1,13] + dcoef_all$Household_2_CA_3[14]*df_all_test[i-1,14] + dcoef_all$Household_2_CA_3[15]*df_all_test[i-1,15] + dcoef_all$Household_2_CA_3[16]*df_all_test[i-1,16] + dcoef_all$Household_2_CA_3[17]*df_all_test[i-1,17] + dcoef_all$Household_2_CA_3[18]*df_all_test[i-1,18] + dcoef_all$Household_2_CA_3[19]
    df_all_test[i, 34] = dcoef_all$Foods_1_CA_3[1]*df_all_test[i-1,1] + dcoef_all$Foods_1_CA_3[2]*df_all_test[i-1,2] + dcoef_all$Foods_1_CA_3[3]*df_all_test[i-1,3] + dcoef_all$Foods_1_CA_3[4]*df_all_test[i-1,4] + dcoef_all$Foods_1_CA_3[5]*df_all_test[i-1,5] + dcoef_all$Foods_1_CA_3[6]*df_all_test[i-1,6] + dcoef_all$Foods_1_CA_3[7]*df_all_test[i-1,7] + dcoef_all$Foods_1_CA_3[8]*df_all_test[i-1,8] + dcoef_all$Foods_1_CA_3[9]*df_all_test[i-1,9] + dcoef_all$Foods_1_CA_3[10]*df_all_test[i-1,10] + dcoef_all$Foods_1_CA_3[11]*df_all_test[i-1,11] + dcoef_all$Foods_1_CA_3[12]*df_all_test[i-1,12] + dcoef_all$Foods_1_CA_3[13]*df_all_test[i-1,13] + dcoef_all$Foods_1_CA_3[14]*df_all_test[i-1,14] + dcoef_all$Foods_1_CA_3[15]*df_all_test[i-1,15] + dcoef_all$Foods_1_CA_3[16]*df_all_test[i-1,16] + dcoef_all$Foods_1_CA_3[17]*df_all_test[i-1,17] + dcoef_all$Foods_1_CA_3[18]*df_all_test[i-1,18] + dcoef_all$Foods_1_CA_3[19]
    df_all_test[i, 35] = dcoef_all$Foods_2_CA_3[1]*df_all_test[i-1,1] + dcoef_all$Foods_2_CA_3[2]*df_all_test[i-1,2] + dcoef_all$Foods_2_CA_3[3]*df_all_test[i-1,3] + dcoef_all$Foods_2_CA_3[4]*df_all_test[i-1,4] + dcoef_all$Foods_2_CA_3[5]*df_all_test[i-1,5] + dcoef_all$Foods_2_CA_3[6]*df_all_test[i-1,6] + dcoef_all$Foods_2_CA_3[7]*df_all_test[i-1,7] + dcoef_all$Foods_2_CA_3[8]*df_all_test[i-1,8] + dcoef_all$Foods_2_CA_3[9]*df_all_test[i-1,9] + dcoef_all$Foods_2_CA_3[10]*df_all_test[i-1,10] + dcoef_all$Foods_2_CA_3[11]*df_all_test[i-1,11] + dcoef_all$Foods_2_CA_3[12]*df_all_test[i-1,12] + dcoef_all$Foods_2_CA_3[13]*df_all_test[i-1,13] + dcoef_all$Foods_2_CA_3[14]*df_all_test[i-1,14] + dcoef_all$Foods_2_CA_3[15]*df_all_test[i-1,15] + dcoef_all$Foods_2_CA_3[16]*df_all_test[i-1,16] + dcoef_all$Foods_2_CA_3[17]*df_all_test[i-1,17] + dcoef_all$Foods_2_CA_3[18]*df_all_test[i-1,18] + dcoef_all$Foods_2_CA_3[19]
    df_all_test[i, 36] = dcoef_all$Foods_3_CA_3[1]*df_all_test[i-1,1] + dcoef_all$Foods_3_CA_3[2]*df_all_test[i-1,2] + dcoef_all$Foods_3_CA_3[3]*df_all_test[i-1,3] + dcoef_all$Foods_3_CA_3[4]*df_all_test[i-1,4] + dcoef_all$Foods_3_CA_3[5]*df_all_test[i-1,5] + dcoef_all$Foods_3_CA_3[6]*df_all_test[i-1,6] + dcoef_all$Foods_3_CA_3[7]*df_all_test[i-1,7] + dcoef_all$Foods_3_CA_3[8]*df_all_test[i-1,8] + dcoef_all$Foods_3_CA_3[9]*df_all_test[i-1,9] + dcoef_all$Foods_3_CA_3[10]*df_all_test[i-1,10] + dcoef_all$Foods_3_CA_3[11]*df_all_test[i-1,11] + dcoef_all$Foods_3_CA_3[12]*df_all_test[i-1,12] + dcoef_all$Foods_3_CA_3[13]*df_all_test[i-1,13] + dcoef_all$Foods_3_CA_3[14]*df_all_test[i-1,14] + dcoef_all$Foods_3_CA_3[15]*df_all_test[i-1,15] + dcoef_all$Foods_3_CA_3[16]*df_all_test[i-1,16] + dcoef_all$Foods_3_CA_3[17]*df_all_test[i-1,17] + dcoef_all$Foods_3_CA_3[18]*df_all_test[i-1,18] + dcoef_all$Foods_3_CA_3[19]
        
  }
}

  
colnames(df_all_test) = c('Hobbies_CA_1','Household_1_CA_1','Household_2_CA_1','Foods_1_CA_1','Foods_2_CA_1','Foods_3_CA_1'
                          ,'Hobbies_CA_2','Household_1_CA_2','Household_2_CA_2','Foods_1_CA_2','Foods_2_CA_2','Foods_3_CA_2'
                          ,'Hobbies_CA_3','Household_1_CA_3','Household_2_CA_3','Foods_1_CA_3','Foods_2_CA_3','Foods_3_CA_3'
                          ,'Hobbies_CA_1_pred','Household_1_CA_1_pred','Household_2_CA_1_pred','Foods_1_CA_1_pred','Foods_2_CA_1_pred','Foods_3_CA_1_pred'
                          ,'Hobbies_CA_2_pred','Household_1_CA_2_pred','Household_2_CA_2_pred','Foods_1_CA_2_pred','Foods_2_CA_2_pred','Foods_3_CA_2_pred'
                          ,'Hobbies_CA_3_pred','Household_1_CA_3_pred','Household_2_CA_3_pred','Foods_1_CA_3_pred','Foods_2_CA_3_pred','Foods_3_CA_3_pred'
                          )


forecasts_all_23 = df_all_test

# Save the RMSSE Results in a data frame
df_rmsse_CA_1_4yr[1, 3] = RMSSE(forecasts_all_23$Hobbies_CA_1, forecasts_all_23$Hobbies_CA_1_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_1_4yr[2, 3] = RMSSE(forecasts_all_23$Household_1_CA_1, forecasts_all_23$Household_1_CA_1_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_1_4yr[3, 3] = RMSSE(forecasts_all_23$Household_2_CA_1, forecasts_all_23$Household_2_CA_1_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_1_4yr[4, 3] = RMSSE(forecasts_all_23$Foods_1_CA_1, forecasts_all_23$Foods_1_CA_1_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_1_4yr[5, 3] = RMSSE(forecasts_all_23$Foods_2_CA_1, forecasts_all_23$Foods_2_CA_1_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_1_4yr[6, 3] = RMSSE(forecasts_all_23$Foods_3_CA_1, forecasts_all_23$Foods_3_CA_1_pred, scale = 1, na.rm = TRUE)

df_rmsse_CA_2_4yr[1, 3] = RMSSE(forecasts_all_23$Hobbies_CA_2, forecasts_all_23$Hobbies_CA_2_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_2_4yr[2, 3] = RMSSE(forecasts_all_23$Household_1_CA_2, forecasts_all_23$Household_1_CA_2_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_2_4yr[3, 3] = RMSSE(forecasts_all_23$Household_2_CA_2, forecasts_all_23$Household_2_CA_2_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_2_4yr[4, 3] = RMSSE(forecasts_all_23$Foods_1_CA_2, forecasts_all_23$Foods_1_CA_2_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_2_4yr[5, 3] = RMSSE(forecasts_all_23$Foods_2_CA_2, forecasts_all_23$Foods_2_CA_2_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_2_4yr[6, 3] = RMSSE(forecasts_all_23$Foods_3_CA_2, forecasts_all_23$Foods_3_CA_2_pred, scale = 1, na.rm = TRUE)

df_rmsse_CA_3_4yr[1, 3] = RMSSE(forecasts_all_23$Hobbies_CA_3, forecasts_all_23$Hobbies_CA_3_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_3_4yr[2, 3] = RMSSE(forecasts_all_23$Household_1_CA_3, forecasts_all_23$Household_1_CA_3_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_3_4yr[3, 3] = RMSSE(forecasts_all_23$Household_2_CA_3, forecasts_all_23$Household_2_CA_3_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_3_4yr[4, 3] = RMSSE(forecasts_all_23$Foods_1_CA_3, forecasts_all_23$Foods_1_CA_3_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_3_4yr[5, 3] = RMSSE(forecasts_all_23$Foods_2_CA_3, forecasts_all_23$Foods_2_CA_3_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_3_4yr[6, 3] = RMSSE(forecasts_all_23$Foods_3_CA_3, forecasts_all_23$Foods_3_CA_3_pred, scale = 1, na.rm = TRUE)

rownames(df_rmsse_CA_1_4yr) =  c("Hobbies","Household1","Household2","Foods1","Foods2","Foods3")
rownames(df_rmsse_CA_2_4yr) =  c("Hobbies","Household1","Household2","Foods1","Foods2","Foods3")
rownames(df_rmsse_CA_3_4yr) =  c("Hobbies","Household1","Household2","Foods1","Foods2","Foods3")

colnames(df_rmsse_CA_1_4yr) = c("var21","var22","var23")
colnames(df_rmsse_CA_2_4yr) = c("var21","var22","var23")
colnames(df_rmsse_CA_3_4yr) = c("var21","var22","var23")

```

```{r}

df_rmsse_CA_1_4yr
df_rmsse_CA_2_4yr
df_rmsse_CA_3_4yr

```

### Train-test split for data from 2011-2015 for training and 2016 for testing.

```{r, include=FALSE}

# Define the train-test split 703 is 2012-12-31 and 1068 for 2013-12-31
train_sample = 1798
test_sample = 1969

# Choose the columns for each store
# Extracting the columns of the CA_1 store and renaming them
df_all = df
df_all$date = NULL

df_all_train = head(df_all, train_sample)
df_all_test  = head(df_all, test_sample)
df_all_test  = tail(df_all_test, test_sample - train_sample)

var_all_train = VAR(df_all_train, p=1)

dcoef_all = coef(var_all_train)

# iterate the number of test samples to predict using the var coefficients

length_sample = test_sample - train_sample
for (i in 1:length_sample) {
 if (i==1) {
    df_all_test[i, 19] = dcoef_all$Hobbies_CA_1[1]*df_all_train[train_sample,1] + dcoef_all$Hobbies_CA_1[2]*df_all_train[train_sample,2] + dcoef_all$Hobbies_CA_1[3]*df_all_train[train_sample,3] + dcoef_all$Hobbies_CA_1[4]*df_all_train[train_sample,4] + dcoef_all$Hobbies_CA_1[5]*df_all_train[train_sample,5] + dcoef_all$Hobbies_CA_1[6]*df_all_train[train_sample,6] + dcoef_all$Hobbies_CA_1[7]*df_all_train[train_sample,7] + dcoef_all$Hobbies_CA_1[8]*df_all_train[train_sample,8] + dcoef_all$Hobbies_CA_1[9]*df_all_train[train_sample,9] + dcoef_all$Hobbies_CA_1[10]*df_all_train[train_sample,10] + dcoef_all$Hobbies_CA_1[11]*df_all_train[train_sample,11] + dcoef_all$Hobbies_CA_1[12]*df_all_train[train_sample,12] + dcoef_all$Hobbies_CA_1[13]*df_all_train[train_sample,13] + dcoef_all$Hobbies_CA_1[14]*df_all_train[train_sample,14] + dcoef_all$Hobbies_CA_1[15]*df_all_train[train_sample,15] + dcoef_all$Hobbies_CA_1[16]*df_all_train[train_sample,16] + dcoef_all$Hobbies_CA_1[17]*df_all_train[train_sample,17] + dcoef_all$Hobbies_CA_1[18]*df_all_train[train_sample,18] + dcoef_all$Hobbies_CA_1[19]
    df_all_test[i, 20] = dcoef_all$Household_1_CA_1[1]*df_all_train[train_sample,1] + dcoef_all$Household_1_CA_1[2]*df_all_train[train_sample,2] + dcoef_all$Household_1_CA_1[3]*df_all_train[train_sample,3] + dcoef_all$Household_1_CA_1[4]*df_all_train[train_sample,4] + dcoef_all$Household_1_CA_1[5]*df_all_train[train_sample,5] + dcoef_all$Household_1_CA_1[6]*df_all_train[train_sample,6] + dcoef_all$Household_1_CA_1[7]*df_all_train[train_sample,7] + dcoef_all$Household_1_CA_1[8]*df_all_train[train_sample,8] + dcoef_all$Household_1_CA_1[9]*df_all_train[train_sample,9] + dcoef_all$Household_1_CA_1[10]*df_all_train[train_sample,10] + dcoef_all$Household_1_CA_1[11]*df_all_train[train_sample,11] + dcoef_all$Household_1_CA_1[12]*df_all_train[train_sample,12] + dcoef_all$Household_1_CA_1[13]*df_all_train[train_sample,13] + dcoef_all$Household_1_CA_1[14]*df_all_train[train_sample,14] + dcoef_all$Household_1_CA_1[15]*df_all_train[train_sample,15] + dcoef_all$Household_1_CA_1[16]*df_all_train[train_sample,16] + dcoef_all$Household_1_CA_1[17]*df_all_train[train_sample,17] + dcoef_all$Household_1_CA_1[18]*df_all_train[train_sample,18] + dcoef_all$Household_1_CA_1[19]
    df_all_test[i, 21] = dcoef_all$Household_2_CA_1[1]*df_all_train[train_sample,1] + dcoef_all$Household_2_CA_1[2]*df_all_train[train_sample,2] + dcoef_all$Household_2_CA_1[3]*df_all_train[train_sample,3] + dcoef_all$Household_2_CA_1[4]*df_all_train[train_sample,4] + dcoef_all$Household_2_CA_1[5]*df_all_train[train_sample,5] + dcoef_all$Household_2_CA_1[6]*df_all_train[train_sample,6] + dcoef_all$Household_2_CA_1[7]*df_all_train[train_sample,7] + dcoef_all$Household_2_CA_1[8]*df_all_train[train_sample,8] + dcoef_all$Household_2_CA_1[9]*df_all_train[train_sample,9] + dcoef_all$Household_2_CA_1[10]*df_all_train[train_sample,10] + dcoef_all$Household_2_CA_1[11]*df_all_train[train_sample,11] + dcoef_all$Household_2_CA_1[12]*df_all_train[train_sample,12] + dcoef_all$Household_2_CA_1[13]*df_all_train[train_sample,13] + dcoef_all$Household_2_CA_1[14]*df_all_train[train_sample,14] + dcoef_all$Household_2_CA_1[15]*df_all_train[train_sample,15] + dcoef_all$Household_2_CA_1[16]*df_all_train[train_sample,16] + dcoef_all$Household_2_CA_1[17]*df_all_train[train_sample,17] + dcoef_all$Household_2_CA_1[18]*df_all_train[train_sample,18] + dcoef_all$Household_2_CA_1[19]
    df_all_test[i, 22] = dcoef_all$Foods_1_CA_1[1]*df_all_train[train_sample,1] + dcoef_all$Foods_1_CA_1[2]*df_all_train[train_sample,2] + dcoef_all$Foods_1_CA_1[3]*df_all_train[train_sample,3] + dcoef_all$Foods_1_CA_1[4]*df_all_train[train_sample,4] + dcoef_all$Foods_1_CA_1[5]*df_all_train[train_sample,5] + dcoef_all$Foods_1_CA_1[6]*df_all_train[train_sample,6] + dcoef_all$Foods_1_CA_1[7]*df_all_train[train_sample,7] + dcoef_all$Foods_1_CA_1[8]*df_all_train[train_sample,8] + dcoef_all$Foods_1_CA_1[9]*df_all_train[train_sample,9] + dcoef_all$Foods_1_CA_1[10]*df_all_train[train_sample,10] + dcoef_all$Foods_1_CA_1[11]*df_all_train[train_sample,11] + dcoef_all$Foods_1_CA_1[12]*df_all_train[train_sample,12] + dcoef_all$Foods_1_CA_1[13]*df_all_train[train_sample,13] + dcoef_all$Foods_1_CA_1[14]*df_all_train[train_sample,14] + dcoef_all$Foods_1_CA_1[15]*df_all_train[train_sample,15] + dcoef_all$Foods_1_CA_1[16]*df_all_train[train_sample,16] + dcoef_all$Foods_1_CA_1[17]*df_all_train[train_sample,17] + dcoef_all$Foods_1_CA_1[18]*df_all_train[train_sample,18] + dcoef_all$Foods_1_CA_1[19]
    df_all_test[i, 23] = dcoef_all$Foods_2_CA_1[1]*df_all_train[train_sample,1] + dcoef_all$Foods_2_CA_1[2]*df_all_train[train_sample,2] + dcoef_all$Foods_2_CA_1[3]*df_all_train[train_sample,3] + dcoef_all$Foods_2_CA_1[4]*df_all_train[train_sample,4] + dcoef_all$Foods_2_CA_1[5]*df_all_train[train_sample,5] + dcoef_all$Foods_2_CA_1[6]*df_all_train[train_sample,6] + dcoef_all$Foods_2_CA_1[7]*df_all_train[train_sample,7] + dcoef_all$Foods_2_CA_1[8]*df_all_train[train_sample,8] + dcoef_all$Foods_2_CA_1[9]*df_all_train[train_sample,9] + dcoef_all$Foods_2_CA_1[10]*df_all_train[train_sample,10] + dcoef_all$Foods_2_CA_1[11]*df_all_train[train_sample,11] + dcoef_all$Foods_2_CA_1[12]*df_all_train[train_sample,12] + dcoef_all$Foods_2_CA_1[13]*df_all_train[train_sample,13] + dcoef_all$Foods_2_CA_1[14]*df_all_train[train_sample,14] + dcoef_all$Foods_2_CA_1[15]*df_all_train[train_sample,15] + dcoef_all$Foods_2_CA_1[16]*df_all_train[train_sample,16] + dcoef_all$Foods_2_CA_1[17]*df_all_train[train_sample,17] + dcoef_all$Foods_2_CA_1[18]*df_all_train[train_sample,18] + dcoef_all$Foods_2_CA_1[19]
    df_all_test[i, 24] = dcoef_all$Foods_3_CA_1[1]*df_all_train[train_sample,1] + dcoef_all$Foods_3_CA_1[2]*df_all_train[train_sample,2] + dcoef_all$Foods_3_CA_1[3]*df_all_train[train_sample,3] + dcoef_all$Foods_3_CA_1[4]*df_all_train[train_sample,4] + dcoef_all$Foods_3_CA_1[5]*df_all_train[train_sample,5] + dcoef_all$Foods_3_CA_1[6]*df_all_train[train_sample,6] + dcoef_all$Foods_3_CA_1[7]*df_all_train[train_sample,7] + dcoef_all$Foods_3_CA_1[8]*df_all_train[train_sample,8] + dcoef_all$Foods_3_CA_1[9]*df_all_train[train_sample,9] + dcoef_all$Foods_3_CA_1[10]*df_all_train[train_sample,10] + dcoef_all$Foods_3_CA_1[11]*df_all_train[train_sample,11] + dcoef_all$Foods_3_CA_1[12]*df_all_train[train_sample,12] + dcoef_all$Foods_3_CA_1[13]*df_all_train[train_sample,13] + dcoef_all$Foods_3_CA_1[14]*df_all_train[train_sample,14] + dcoef_all$Foods_3_CA_1[15]*df_all_train[train_sample,15] + dcoef_all$Foods_3_CA_1[16]*df_all_train[train_sample,16] + dcoef_all$Foods_3_CA_1[17]*df_all_train[train_sample,17] + dcoef_all$Foods_3_CA_1[18]*df_all_train[train_sample,18] + dcoef_all$Foods_3_CA_1[19]
    df_all_test[i, 25] = dcoef_all$Hobbies_CA_2[1]*df_all_train[train_sample,1] + dcoef_all$Hobbies_CA_2[2]*df_all_train[train_sample,2] + dcoef_all$Hobbies_CA_2[3]*df_all_train[train_sample,3] + dcoef_all$Hobbies_CA_2[4]*df_all_train[train_sample,4] + dcoef_all$Hobbies_CA_2[5]*df_all_train[train_sample,5] + dcoef_all$Hobbies_CA_2[6]*df_all_train[train_sample,6] + dcoef_all$Hobbies_CA_2[7]*df_all_train[train_sample,7] + dcoef_all$Hobbies_CA_2[8]*df_all_train[train_sample,8] + dcoef_all$Hobbies_CA_2[9]*df_all_train[train_sample,9] + dcoef_all$Hobbies_CA_2[10]*df_all_train[train_sample,10] + dcoef_all$Hobbies_CA_2[11]*df_all_train[train_sample,11] + dcoef_all$Hobbies_CA_2[12]*df_all_train[train_sample,12] + dcoef_all$Hobbies_CA_2[13]*df_all_train[train_sample,13] + dcoef_all$Hobbies_CA_2[14]*df_all_train[train_sample,14] + dcoef_all$Hobbies_CA_2[15]*df_all_train[train_sample,15] + dcoef_all$Hobbies_CA_2[16]*df_all_train[train_sample,16] + dcoef_all$Hobbies_CA_2[17]*df_all_train[train_sample,17] + dcoef_all$Hobbies_CA_2[18]*df_all_train[train_sample,18] + dcoef_all$Hobbies_CA_2[19]
    df_all_test[i, 26] = dcoef_all$Household_1_CA_2[1]*df_all_train[train_sample,1] + dcoef_all$Household_1_CA_2[2]*df_all_train[train_sample,2] + dcoef_all$Household_1_CA_2[3]*df_all_train[train_sample,3] + dcoef_all$Household_1_CA_2[4]*df_all_train[train_sample,4] + dcoef_all$Household_1_CA_2[5]*df_all_train[train_sample,5] + dcoef_all$Household_1_CA_2[6]*df_all_train[train_sample,6] + dcoef_all$Household_1_CA_2[7]*df_all_train[train_sample,7] + dcoef_all$Household_1_CA_2[8]*df_all_train[train_sample,8] + dcoef_all$Household_1_CA_2[9]*df_all_train[train_sample,9] + dcoef_all$Household_1_CA_2[10]*df_all_train[train_sample,10] + dcoef_all$Household_1_CA_2[11]*df_all_train[train_sample,11] + dcoef_all$Household_1_CA_2[12]*df_all_train[train_sample,12] + dcoef_all$Household_1_CA_2[13]*df_all_train[train_sample,13] + dcoef_all$Household_1_CA_2[14]*df_all_train[train_sample,14] + dcoef_all$Household_1_CA_2[15]*df_all_train[train_sample,15] + dcoef_all$Household_1_CA_2[16]*df_all_train[train_sample,16] + dcoef_all$Household_1_CA_2[17]*df_all_train[train_sample,17] + dcoef_all$Household_1_CA_2[18]*df_all_train[train_sample,18] + dcoef_all$Household_1_CA_2[19]
    df_all_test[i, 27] = dcoef_all$Household_2_CA_2[1]*df_all_train[train_sample,1] + dcoef_all$Household_2_CA_2[2]*df_all_train[train_sample,2] + dcoef_all$Household_2_CA_2[3]*df_all_train[train_sample,3] + dcoef_all$Household_2_CA_2[4]*df_all_train[train_sample,4] + dcoef_all$Household_2_CA_2[5]*df_all_train[train_sample,5] + dcoef_all$Household_2_CA_2[6]*df_all_train[train_sample,6] + dcoef_all$Household_2_CA_2[7]*df_all_train[train_sample,7] + dcoef_all$Household_2_CA_2[8]*df_all_train[train_sample,8] + dcoef_all$Household_2_CA_2[9]*df_all_train[train_sample,9] + dcoef_all$Household_2_CA_2[10]*df_all_train[train_sample,10] + dcoef_all$Household_2_CA_2[11]*df_all_train[train_sample,11] + dcoef_all$Household_2_CA_2[12]*df_all_train[train_sample,12] + dcoef_all$Household_2_CA_2[13]*df_all_train[train_sample,13] + dcoef_all$Household_2_CA_2[14]*df_all_train[train_sample,14] + dcoef_all$Household_2_CA_2[15]*df_all_train[train_sample,15] + dcoef_all$Household_2_CA_2[16]*df_all_train[train_sample,16] + dcoef_all$Household_2_CA_2[17]*df_all_train[train_sample,17] + dcoef_all$Household_2_CA_2[18]*df_all_train[train_sample,18] + dcoef_all$Household_2_CA_2[19]
    df_all_test[i, 28] = dcoef_all$Foods_1_CA_2[1]*df_all_train[train_sample,1] + dcoef_all$Foods_1_CA_2[2]*df_all_train[train_sample,2] + dcoef_all$Foods_1_CA_2[3]*df_all_train[train_sample,3] + dcoef_all$Foods_1_CA_2[4]*df_all_train[train_sample,4] + dcoef_all$Foods_1_CA_2[5]*df_all_train[train_sample,5] + dcoef_all$Foods_1_CA_2[6]*df_all_train[train_sample,6] + dcoef_all$Foods_1_CA_2[7]*df_all_train[train_sample,7] + dcoef_all$Foods_1_CA_2[8]*df_all_train[train_sample,8] + dcoef_all$Foods_1_CA_2[9]*df_all_train[train_sample,9] + dcoef_all$Foods_1_CA_2[10]*df_all_train[train_sample,10] + dcoef_all$Foods_1_CA_2[11]*df_all_train[train_sample,11] + dcoef_all$Foods_1_CA_2[12]*df_all_train[train_sample,12] + dcoef_all$Foods_1_CA_2[13]*df_all_train[train_sample,13] + dcoef_all$Foods_1_CA_2[14]*df_all_train[train_sample,14] + dcoef_all$Foods_1_CA_2[15]*df_all_train[train_sample,15] + dcoef_all$Foods_1_CA_2[16]*df_all_train[train_sample,16] + dcoef_all$Foods_1_CA_2[17]*df_all_train[train_sample,17] + dcoef_all$Foods_1_CA_2[18]*df_all_train[train_sample,18] + dcoef_all$Foods_1_CA_2[19]
    df_all_test[i, 29] = dcoef_all$Foods_2_CA_2[1]*df_all_train[train_sample,1] + dcoef_all$Foods_2_CA_2[2]*df_all_train[train_sample,2] + dcoef_all$Foods_2_CA_2[3]*df_all_train[train_sample,3] + dcoef_all$Foods_2_CA_2[4]*df_all_train[train_sample,4] + dcoef_all$Foods_2_CA_2[5]*df_all_train[train_sample,5] + dcoef_all$Foods_2_CA_2[6]*df_all_train[train_sample,6] + dcoef_all$Foods_2_CA_2[7]*df_all_train[train_sample,7] + dcoef_all$Foods_2_CA_2[8]*df_all_train[train_sample,8] + dcoef_all$Foods_2_CA_2[9]*df_all_train[train_sample,9] + dcoef_all$Foods_2_CA_2[10]*df_all_train[train_sample,10] + dcoef_all$Foods_2_CA_2[11]*df_all_train[train_sample,11] + dcoef_all$Foods_2_CA_2[12]*df_all_train[train_sample,12] + dcoef_all$Foods_2_CA_2[13]*df_all_train[train_sample,13] + dcoef_all$Foods_2_CA_2[14]*df_all_train[train_sample,14] + dcoef_all$Foods_2_CA_2[15]*df_all_train[train_sample,15] + dcoef_all$Foods_2_CA_2[16]*df_all_train[train_sample,16] + dcoef_all$Foods_2_CA_2[17]*df_all_train[train_sample,17] + dcoef_all$Foods_2_CA_2[18]*df_all_train[train_sample,18] + dcoef_all$Foods_2_CA_2[19]
    df_all_test[i, 30] = dcoef_all$Foods_3_CA_2[1]*df_all_train[train_sample,1] + dcoef_all$Foods_3_CA_2[2]*df_all_train[train_sample,2] + dcoef_all$Foods_3_CA_2[3]*df_all_train[train_sample,3] + dcoef_all$Foods_3_CA_2[4]*df_all_train[train_sample,4] + dcoef_all$Foods_3_CA_2[5]*df_all_train[train_sample,5] + dcoef_all$Foods_3_CA_2[6]*df_all_train[train_sample,6] + dcoef_all$Foods_3_CA_2[7]*df_all_train[train_sample,7] + dcoef_all$Foods_3_CA_2[8]*df_all_train[train_sample,8] + dcoef_all$Foods_3_CA_2[9]*df_all_train[train_sample,9] + dcoef_all$Foods_3_CA_2[10]*df_all_train[train_sample,10] + dcoef_all$Foods_3_CA_2[11]*df_all_train[train_sample,11] + dcoef_all$Foods_3_CA_2[12]*df_all_train[train_sample,12] + dcoef_all$Foods_3_CA_2[13]*df_all_train[train_sample,13] + dcoef_all$Foods_3_CA_2[14]*df_all_train[train_sample,14] + dcoef_all$Foods_3_CA_2[15]*df_all_train[train_sample,15] + dcoef_all$Foods_3_CA_2[16]*df_all_train[train_sample,16] + dcoef_all$Foods_3_CA_2[17]*df_all_train[train_sample,17] + dcoef_all$Foods_3_CA_2[18]*df_all_train[train_sample,18] + dcoef_all$Foods_3_CA_2[19]
    df_all_test[i, 31] = dcoef_all$Hobbies_CA_3[1]*df_all_train[train_sample,1] + dcoef_all$Hobbies_CA_3[2]*df_all_train[train_sample,2] + dcoef_all$Hobbies_CA_3[3]*df_all_train[train_sample,3] + dcoef_all$Hobbies_CA_3[4]*df_all_train[train_sample,4] + dcoef_all$Hobbies_CA_3[5]*df_all_train[train_sample,5] + dcoef_all$Hobbies_CA_3[6]*df_all_train[train_sample,6] + dcoef_all$Hobbies_CA_3[7]*df_all_train[train_sample,7] + dcoef_all$Hobbies_CA_3[8]*df_all_train[train_sample,8] + dcoef_all$Hobbies_CA_3[9]*df_all_train[train_sample,9] + dcoef_all$Hobbies_CA_3[10]*df_all_train[train_sample,10] + dcoef_all$Hobbies_CA_3[11]*df_all_train[train_sample,11] + dcoef_all$Hobbies_CA_3[12]*df_all_train[train_sample,12] + dcoef_all$Hobbies_CA_3[13]*df_all_train[train_sample,13] + dcoef_all$Hobbies_CA_3[14]*df_all_train[train_sample,14] + dcoef_all$Hobbies_CA_3[15]*df_all_train[train_sample,15] + dcoef_all$Hobbies_CA_3[16]*df_all_train[train_sample,16] + dcoef_all$Hobbies_CA_3[17]*df_all_train[train_sample,17] + dcoef_all$Hobbies_CA_3[18]*df_all_train[train_sample,18] + dcoef_all$Hobbies_CA_3[19]
    df_all_test[i, 32] = dcoef_all$Household_1_CA_3[1]*df_all_train[train_sample,1] + dcoef_all$Household_1_CA_3[2]*df_all_train[train_sample,2] + dcoef_all$Household_1_CA_3[3]*df_all_train[train_sample,3] + dcoef_all$Household_1_CA_3[4]*df_all_train[train_sample,4] + dcoef_all$Household_1_CA_3[5]*df_all_train[train_sample,5] + dcoef_all$Household_1_CA_3[6]*df_all_train[train_sample,6] + dcoef_all$Household_1_CA_3[7]*df_all_train[train_sample,7] + dcoef_all$Household_1_CA_3[8]*df_all_train[train_sample,8] + dcoef_all$Household_1_CA_3[9]*df_all_train[train_sample,9] + dcoef_all$Household_1_CA_3[10]*df_all_train[train_sample,10] + dcoef_all$Household_1_CA_3[11]*df_all_train[train_sample,11] + dcoef_all$Household_1_CA_3[12]*df_all_train[train_sample,12] + dcoef_all$Household_1_CA_3[13]*df_all_train[train_sample,13] + dcoef_all$Household_1_CA_3[14]*df_all_train[train_sample,14] + dcoef_all$Household_1_CA_3[15]*df_all_train[train_sample,15] + dcoef_all$Household_1_CA_3[16]*df_all_train[train_sample,16] + dcoef_all$Household_1_CA_3[17]*df_all_train[train_sample,17] + dcoef_all$Household_1_CA_3[18]*df_all_train[train_sample,18] + dcoef_all$Household_1_CA_3[19]
    df_all_test[i, 33] = dcoef_all$Household_2_CA_3[1]*df_all_train[train_sample,1] + dcoef_all$Household_2_CA_3[2]*df_all_train[train_sample,2] + dcoef_all$Household_2_CA_3[3]*df_all_train[train_sample,3] + dcoef_all$Household_2_CA_3[4]*df_all_train[train_sample,4] + dcoef_all$Household_2_CA_3[5]*df_all_train[train_sample,5] + dcoef_all$Household_2_CA_3[6]*df_all_train[train_sample,6] + dcoef_all$Household_2_CA_3[7]*df_all_train[train_sample,7] + dcoef_all$Household_2_CA_3[8]*df_all_train[train_sample,8] + dcoef_all$Household_2_CA_3[9]*df_all_train[train_sample,9] + dcoef_all$Household_2_CA_3[10]*df_all_train[train_sample,10] + dcoef_all$Household_2_CA_3[11]*df_all_train[train_sample,11] + dcoef_all$Household_2_CA_3[12]*df_all_train[train_sample,12] + dcoef_all$Household_2_CA_3[13]*df_all_train[train_sample,13] + dcoef_all$Household_2_CA_3[14]*df_all_train[train_sample,14] + dcoef_all$Household_2_CA_3[15]*df_all_train[train_sample,15] + dcoef_all$Household_2_CA_3[16]*df_all_train[train_sample,16] + dcoef_all$Household_2_CA_3[17]*df_all_train[train_sample,17] + dcoef_all$Household_2_CA_3[18]*df_all_train[train_sample,18] + dcoef_all$Household_2_CA_3[19]
    df_all_test[i, 34] = dcoef_all$Foods_1_CA_3[1]*df_all_train[train_sample,1] + dcoef_all$Foods_1_CA_3[2]*df_all_train[train_sample,2] + dcoef_all$Foods_1_CA_3[3]*df_all_train[train_sample,3] + dcoef_all$Foods_1_CA_3[4]*df_all_train[train_sample,4] + dcoef_all$Foods_1_CA_3[5]*df_all_train[train_sample,5] + dcoef_all$Foods_1_CA_3[6]*df_all_train[train_sample,6] + dcoef_all$Foods_1_CA_3[7]*df_all_train[train_sample,7] + dcoef_all$Foods_1_CA_3[8]*df_all_train[train_sample,8] + dcoef_all$Foods_1_CA_3[9]*df_all_train[train_sample,9] + dcoef_all$Foods_1_CA_3[10]*df_all_train[train_sample,10] + dcoef_all$Foods_1_CA_3[11]*df_all_train[train_sample,11] + dcoef_all$Foods_1_CA_3[12]*df_all_train[train_sample,12] + dcoef_all$Foods_1_CA_3[13]*df_all_train[train_sample,13] + dcoef_all$Foods_1_CA_3[14]*df_all_train[train_sample,14] + dcoef_all$Foods_1_CA_3[15]*df_all_train[train_sample,15] + dcoef_all$Foods_1_CA_3[16]*df_all_train[train_sample,16] + dcoef_all$Foods_1_CA_3[17]*df_all_train[train_sample,17] + dcoef_all$Foods_1_CA_3[18]*df_all_train[train_sample,18] + dcoef_all$Foods_1_CA_3[19]
    df_all_test[i, 35] = dcoef_all$Foods_2_CA_3[1]*df_all_train[train_sample,1] + dcoef_all$Foods_2_CA_3[2]*df_all_train[train_sample,2] + dcoef_all$Foods_2_CA_3[3]*df_all_train[train_sample,3] + dcoef_all$Foods_2_CA_3[4]*df_all_train[train_sample,4] + dcoef_all$Foods_2_CA_3[5]*df_all_train[train_sample,5] + dcoef_all$Foods_2_CA_3[6]*df_all_train[train_sample,6] + dcoef_all$Foods_2_CA_3[7]*df_all_train[train_sample,7] + dcoef_all$Foods_2_CA_3[8]*df_all_train[train_sample,8] + dcoef_all$Foods_2_CA_3[9]*df_all_train[train_sample,9] + dcoef_all$Foods_2_CA_3[10]*df_all_train[train_sample,10] + dcoef_all$Foods_2_CA_3[11]*df_all_train[train_sample,11] + dcoef_all$Foods_2_CA_3[12]*df_all_train[train_sample,12] + dcoef_all$Foods_2_CA_3[13]*df_all_train[train_sample,13] + dcoef_all$Foods_2_CA_3[14]*df_all_train[train_sample,14] + dcoef_all$Foods_2_CA_3[15]*df_all_train[train_sample,15] + dcoef_all$Foods_2_CA_3[16]*df_all_train[train_sample,16] + dcoef_all$Foods_2_CA_3[17]*df_all_train[train_sample,17] + dcoef_all$Foods_2_CA_3[18]*df_all_train[train_sample,18] + dcoef_all$Foods_2_CA_3[19]
    df_all_test[i, 36] = dcoef_all$Foods_3_CA_3[1]*df_all_train[train_sample,1] + dcoef_all$Foods_3_CA_3[2]*df_all_train[train_sample,2] + dcoef_all$Foods_3_CA_3[3]*df_all_train[train_sample,3] + dcoef_all$Foods_3_CA_3[4]*df_all_train[train_sample,4] + dcoef_all$Foods_3_CA_3[5]*df_all_train[train_sample,5] + dcoef_all$Foods_3_CA_3[6]*df_all_train[train_sample,6] + dcoef_all$Foods_3_CA_3[7]*df_all_train[train_sample,7] + dcoef_all$Foods_3_CA_3[8]*df_all_train[train_sample,8] + dcoef_all$Foods_3_CA_3[9]*df_all_train[train_sample,9] + dcoef_all$Foods_3_CA_3[10]*df_all_train[train_sample,10] + dcoef_all$Foods_3_CA_3[11]*df_all_train[train_sample,11] + dcoef_all$Foods_3_CA_3[12]*df_all_train[train_sample,12] + dcoef_all$Foods_3_CA_3[13]*df_all_train[train_sample,13] + dcoef_all$Foods_3_CA_3[14]*df_all_train[train_sample,14] + dcoef_all$Foods_3_CA_3[15]*df_all_train[train_sample,15] + dcoef_all$Foods_3_CA_3[16]*df_all_train[train_sample,16] + dcoef_all$Foods_3_CA_3[17]*df_all_train[train_sample,17] + dcoef_all$Foods_3_CA_3[18]*df_all_train[train_sample,18] + dcoef_all$Foods_3_CA_3[19]
    
  }
  else {
    df_all_test[i, 19] = dcoef_all$Hobbies_CA_1[1]*df_all_test[i-1,1] + dcoef_all$Hobbies_CA_1[2]*df_all_test[i-1,2] + dcoef_all$Hobbies_CA_1[3]*df_all_test[i-1,3] + dcoef_all$Hobbies_CA_1[4]*df_all_test[i-1,4] + dcoef_all$Hobbies_CA_1[5]*df_all_test[i-1,5] + dcoef_all$Hobbies_CA_1[6]*df_all_test[i-1,6] + dcoef_all$Hobbies_CA_1[7]*df_all_test[i-1,7] + dcoef_all$Hobbies_CA_1[8]*df_all_test[i-1,8] + dcoef_all$Hobbies_CA_1[9]*df_all_test[i-1,9] + dcoef_all$Hobbies_CA_1[10]*df_all_test[i-1,10] + dcoef_all$Hobbies_CA_1[11]*df_all_test[i-1,11] + dcoef_all$Hobbies_CA_1[12]*df_all_test[i-1,12] + dcoef_all$Hobbies_CA_1[13]*df_all_test[i-1,13] + dcoef_all$Hobbies_CA_1[14]*df_all_test[i-1,14] + dcoef_all$Hobbies_CA_1[15]*df_all_test[i-1,15] + dcoef_all$Hobbies_CA_1[16]*df_all_test[i-1,16] + dcoef_all$Hobbies_CA_1[17]*df_all_test[i-1,17] + dcoef_all$Hobbies_CA_1[18]*df_all_test[i-1,18] + dcoef_all$Hobbies_CA_1[19]
    df_all_test[i, 20] = dcoef_all$Household_1_CA_1[1]*df_all_test[i-1,1] + dcoef_all$Household_1_CA_1[2]*df_all_test[i-1,2] + dcoef_all$Household_1_CA_1[3]*df_all_test[i-1,3] + dcoef_all$Household_1_CA_1[4]*df_all_test[i-1,4] + dcoef_all$Household_1_CA_1[5]*df_all_test[i-1,5] + dcoef_all$Household_1_CA_1[6]*df_all_test[i-1,6] + dcoef_all$Household_1_CA_1[7]*df_all_test[i-1,7] + dcoef_all$Household_1_CA_1[8]*df_all_test[i-1,8] + dcoef_all$Household_1_CA_1[9]*df_all_test[i-1,9] + dcoef_all$Household_1_CA_1[10]*df_all_test[i-1,10] + dcoef_all$Household_1_CA_1[11]*df_all_test[i-1,11] + dcoef_all$Household_1_CA_1[12]*df_all_test[i-1,12] + dcoef_all$Household_1_CA_1[13]*df_all_test[i-1,13] + dcoef_all$Household_1_CA_1[14]*df_all_test[i-1,14] + dcoef_all$Household_1_CA_1[15]*df_all_test[i-1,15] + dcoef_all$Household_1_CA_1[16]*df_all_test[i-1,16] + dcoef_all$Household_1_CA_1[17]*df_all_test[i-1,17] + dcoef_all$Household_1_CA_1[18]*df_all_test[i-1,18] + dcoef_all$Household_1_CA_1[19]
    df_all_test[i, 21] = dcoef_all$Household_2_CA_1[1]*df_all_test[i-1,1] + dcoef_all$Household_2_CA_1[2]*df_all_test[i-1,2] + dcoef_all$Household_2_CA_1[3]*df_all_test[i-1,3] + dcoef_all$Household_2_CA_1[4]*df_all_test[i-1,4] + dcoef_all$Household_2_CA_1[5]*df_all_test[i-1,5] + dcoef_all$Household_2_CA_1[6]*df_all_test[i-1,6] + dcoef_all$Household_2_CA_1[7]*df_all_test[i-1,7] + dcoef_all$Household_2_CA_1[8]*df_all_test[i-1,8] + dcoef_all$Household_2_CA_1[9]*df_all_test[i-1,9] + dcoef_all$Household_2_CA_1[10]*df_all_test[i-1,10] + dcoef_all$Household_2_CA_1[11]*df_all_test[i-1,11] + dcoef_all$Household_2_CA_1[12]*df_all_test[i-1,12] + dcoef_all$Household_2_CA_1[13]*df_all_test[i-1,13] + dcoef_all$Household_2_CA_1[14]*df_all_test[i-1,14] + dcoef_all$Household_2_CA_1[15]*df_all_test[i-1,15] + dcoef_all$Household_2_CA_1[16]*df_all_test[i-1,16] + dcoef_all$Household_2_CA_1[17]*df_all_test[i-1,17] + dcoef_all$Household_2_CA_1[18]*df_all_test[i-1,18] + dcoef_all$Household_2_CA_1[19]
    df_all_test[i, 22] = dcoef_all$Foods_1_CA_1[1]*df_all_test[i-1,1] + dcoef_all$Foods_1_CA_1[2]*df_all_test[i-1,2] + dcoef_all$Foods_1_CA_1[3]*df_all_test[i-1,3] + dcoef_all$Foods_1_CA_1[4]*df_all_test[i-1,4] + dcoef_all$Foods_1_CA_1[5]*df_all_test[i-1,5] + dcoef_all$Foods_1_CA_1[6]*df_all_test[i-1,6] + dcoef_all$Foods_1_CA_1[7]*df_all_test[i-1,7] + dcoef_all$Foods_1_CA_1[8]*df_all_test[i-1,8] + dcoef_all$Foods_1_CA_1[9]*df_all_test[i-1,9] + dcoef_all$Foods_1_CA_1[10]*df_all_test[i-1,10] + dcoef_all$Foods_1_CA_1[11]*df_all_test[i-1,11] + dcoef_all$Foods_1_CA_1[12]*df_all_test[i-1,12] + dcoef_all$Foods_1_CA_1[13]*df_all_test[i-1,13] + dcoef_all$Foods_1_CA_1[14]*df_all_test[i-1,14] + dcoef_all$Foods_1_CA_1[15]*df_all_test[i-1,15] + dcoef_all$Foods_1_CA_1[16]*df_all_test[i-1,16] + dcoef_all$Foods_1_CA_1[17]*df_all_test[i-1,17] + dcoef_all$Foods_1_CA_1[18]*df_all_test[i-1,18] + dcoef_all$Foods_1_CA_1[19]
    df_all_test[i, 23] = dcoef_all$Foods_2_CA_1[1]*df_all_test[i-1,1] + dcoef_all$Foods_2_CA_1[2]*df_all_test[i-1,2] + dcoef_all$Foods_2_CA_1[3]*df_all_test[i-1,3] + dcoef_all$Foods_2_CA_1[4]*df_all_test[i-1,4] + dcoef_all$Foods_2_CA_1[5]*df_all_test[i-1,5] + dcoef_all$Foods_2_CA_1[6]*df_all_test[i-1,6] + dcoef_all$Foods_2_CA_1[7]*df_all_test[i-1,7] + dcoef_all$Foods_2_CA_1[8]*df_all_test[i-1,8] + dcoef_all$Foods_2_CA_1[9]*df_all_test[i-1,9] + dcoef_all$Foods_2_CA_1[10]*df_all_test[i-1,10] + dcoef_all$Foods_2_CA_1[11]*df_all_test[i-1,11] + dcoef_all$Foods_2_CA_1[12]*df_all_test[i-1,12] + dcoef_all$Foods_2_CA_1[13]*df_all_test[i-1,13] + dcoef_all$Foods_2_CA_1[14]*df_all_test[i-1,14] + dcoef_all$Foods_2_CA_1[15]*df_all_test[i-1,15] + dcoef_all$Foods_2_CA_1[16]*df_all_test[i-1,16] + dcoef_all$Foods_2_CA_1[17]*df_all_test[i-1,17] + dcoef_all$Foods_2_CA_1[18]*df_all_test[i-1,18] + dcoef_all$Foods_2_CA_1[19]
    df_all_test[i, 24] = dcoef_all$Foods_3_CA_1[1]*df_all_test[i-1,1] + dcoef_all$Foods_3_CA_1[2]*df_all_test[i-1,2] + dcoef_all$Foods_3_CA_1[3]*df_all_test[i-1,3] + dcoef_all$Foods_3_CA_1[4]*df_all_test[i-1,4] + dcoef_all$Foods_3_CA_1[5]*df_all_test[i-1,5] + dcoef_all$Foods_3_CA_1[6]*df_all_test[i-1,6] + dcoef_all$Foods_3_CA_1[7]*df_all_test[i-1,7] + dcoef_all$Foods_3_CA_1[8]*df_all_test[i-1,8] + dcoef_all$Foods_3_CA_1[9]*df_all_test[i-1,9] + dcoef_all$Foods_3_CA_1[10]*df_all_test[i-1,10] + dcoef_all$Foods_3_CA_1[11]*df_all_test[i-1,11] + dcoef_all$Foods_3_CA_1[12]*df_all_test[i-1,12] + dcoef_all$Foods_3_CA_1[13]*df_all_test[i-1,13] + dcoef_all$Foods_3_CA_1[14]*df_all_test[i-1,14] + dcoef_all$Foods_3_CA_1[15]*df_all_test[i-1,15] + dcoef_all$Foods_3_CA_1[16]*df_all_test[i-1,16] + dcoef_all$Foods_3_CA_1[17]*df_all_test[i-1,17] + dcoef_all$Foods_3_CA_1[18]*df_all_test[i-1,18] + dcoef_all$Foods_3_CA_1[19]
    df_all_test[i, 25] = dcoef_all$Hobbies_CA_2[1]*df_all_test[i-1,1] + dcoef_all$Hobbies_CA_2[2]*df_all_test[i-1,2] + dcoef_all$Hobbies_CA_2[3]*df_all_test[i-1,3] + dcoef_all$Hobbies_CA_2[4]*df_all_test[i-1,4] + dcoef_all$Hobbies_CA_2[5]*df_all_test[i-1,5] + dcoef_all$Hobbies_CA_2[6]*df_all_test[i-1,6] + dcoef_all$Hobbies_CA_2[7]*df_all_test[i-1,7] + dcoef_all$Hobbies_CA_2[8]*df_all_test[i-1,8] + dcoef_all$Hobbies_CA_2[9]*df_all_test[i-1,9] + dcoef_all$Hobbies_CA_2[10]*df_all_test[i-1,10] + dcoef_all$Hobbies_CA_2[11]*df_all_test[i-1,11] + dcoef_all$Hobbies_CA_2[12]*df_all_test[i-1,12] + dcoef_all$Hobbies_CA_2[13]*df_all_test[i-1,13] + dcoef_all$Hobbies_CA_2[14]*df_all_test[i-1,14] + dcoef_all$Hobbies_CA_2[15]*df_all_test[i-1,15] + dcoef_all$Hobbies_CA_2[16]*df_all_test[i-1,16] + dcoef_all$Hobbies_CA_2[17]*df_all_test[i-1,17] + dcoef_all$Hobbies_CA_2[18]*df_all_test[i-1,18] + dcoef_all$Hobbies_CA_2[19]
    df_all_test[i, 26] = dcoef_all$Household_1_CA_2[1]*df_all_test[i-1,1] + dcoef_all$Household_1_CA_2[2]*df_all_test[i-1,2] + dcoef_all$Household_1_CA_2[3]*df_all_test[i-1,3] + dcoef_all$Household_1_CA_2[4]*df_all_test[i-1,4] + dcoef_all$Household_1_CA_2[5]*df_all_test[i-1,5] + dcoef_all$Household_1_CA_2[6]*df_all_test[i-1,6] + dcoef_all$Household_1_CA_2[7]*df_all_test[i-1,7] + dcoef_all$Household_1_CA_2[8]*df_all_test[i-1,8] + dcoef_all$Household_1_CA_2[9]*df_all_test[i-1,9] + dcoef_all$Household_1_CA_2[10]*df_all_test[i-1,10] + dcoef_all$Household_1_CA_2[11]*df_all_test[i-1,11] + dcoef_all$Household_1_CA_2[12]*df_all_test[i-1,12] + dcoef_all$Household_1_CA_2[13]*df_all_test[i-1,13] + dcoef_all$Household_1_CA_2[14]*df_all_test[i-1,14] + dcoef_all$Household_1_CA_2[15]*df_all_test[i-1,15] + dcoef_all$Household_1_CA_2[16]*df_all_test[i-1,16] + dcoef_all$Household_1_CA_2[17]*df_all_test[i-1,17] + dcoef_all$Household_1_CA_2[18]*df_all_test[i-1,18] + dcoef_all$Household_1_CA_2[19]
    df_all_test[i, 27] = dcoef_all$Household_2_CA_2[1]*df_all_test[i-1,1] + dcoef_all$Household_2_CA_2[2]*df_all_test[i-1,2] + dcoef_all$Household_2_CA_2[3]*df_all_test[i-1,3] + dcoef_all$Household_2_CA_2[4]*df_all_test[i-1,4] + dcoef_all$Household_2_CA_2[5]*df_all_test[i-1,5] + dcoef_all$Household_2_CA_2[6]*df_all_test[i-1,6] + dcoef_all$Household_2_CA_2[7]*df_all_test[i-1,7] + dcoef_all$Household_2_CA_2[8]*df_all_test[i-1,8] + dcoef_all$Household_2_CA_2[9]*df_all_test[i-1,9] + dcoef_all$Household_2_CA_2[10]*df_all_test[i-1,10] + dcoef_all$Household_2_CA_2[11]*df_all_test[i-1,11] + dcoef_all$Household_2_CA_2[12]*df_all_test[i-1,12] + dcoef_all$Household_2_CA_2[13]*df_all_test[i-1,13] + dcoef_all$Household_2_CA_2[14]*df_all_test[i-1,14] + dcoef_all$Household_2_CA_2[15]*df_all_test[i-1,15] + dcoef_all$Household_2_CA_2[16]*df_all_test[i-1,16] + dcoef_all$Household_2_CA_2[17]*df_all_test[i-1,17] + dcoef_all$Household_2_CA_2[18]*df_all_test[i-1,18] + dcoef_all$Household_2_CA_2[19]
    df_all_test[i, 28] = dcoef_all$Foods_1_CA_2[1]*df_all_test[i-1,1] + dcoef_all$Foods_1_CA_2[2]*df_all_test[i-1,2] + dcoef_all$Foods_1_CA_2[3]*df_all_test[i-1,3] + dcoef_all$Foods_1_CA_2[4]*df_all_test[i-1,4] + dcoef_all$Foods_1_CA_2[5]*df_all_test[i-1,5] + dcoef_all$Foods_1_CA_2[6]*df_all_test[i-1,6] + dcoef_all$Foods_1_CA_2[7]*df_all_test[i-1,7] + dcoef_all$Foods_1_CA_2[8]*df_all_test[i-1,8] + dcoef_all$Foods_1_CA_2[9]*df_all_test[i-1,9] + dcoef_all$Foods_1_CA_2[10]*df_all_test[i-1,10] + dcoef_all$Foods_1_CA_2[11]*df_all_test[i-1,11] + dcoef_all$Foods_1_CA_2[12]*df_all_test[i-1,12] + dcoef_all$Foods_1_CA_2[13]*df_all_test[i-1,13] + dcoef_all$Foods_1_CA_2[14]*df_all_test[i-1,14] + dcoef_all$Foods_1_CA_2[15]*df_all_test[i-1,15] + dcoef_all$Foods_1_CA_2[16]*df_all_test[i-1,16] + dcoef_all$Foods_1_CA_2[17]*df_all_test[i-1,17] + dcoef_all$Foods_1_CA_2[18]*df_all_test[i-1,18] + dcoef_all$Foods_1_CA_2[19]
    df_all_test[i, 29] = dcoef_all$Foods_2_CA_2[1]*df_all_test[i-1,1] + dcoef_all$Foods_2_CA_2[2]*df_all_test[i-1,2] + dcoef_all$Foods_2_CA_2[3]*df_all_test[i-1,3] + dcoef_all$Foods_2_CA_2[4]*df_all_test[i-1,4] + dcoef_all$Foods_2_CA_2[5]*df_all_test[i-1,5] + dcoef_all$Foods_2_CA_2[6]*df_all_test[i-1,6] + dcoef_all$Foods_2_CA_2[7]*df_all_test[i-1,7] + dcoef_all$Foods_2_CA_2[8]*df_all_test[i-1,8] + dcoef_all$Foods_2_CA_2[9]*df_all_test[i-1,9] + dcoef_all$Foods_2_CA_2[10]*df_all_test[i-1,10] + dcoef_all$Foods_2_CA_2[11]*df_all_test[i-1,11] + dcoef_all$Foods_2_CA_2[12]*df_all_test[i-1,12] + dcoef_all$Foods_2_CA_2[13]*df_all_test[i-1,13] + dcoef_all$Foods_2_CA_2[14]*df_all_test[i-1,14] + dcoef_all$Foods_2_CA_2[15]*df_all_test[i-1,15] + dcoef_all$Foods_2_CA_2[16]*df_all_test[i-1,16] + dcoef_all$Foods_2_CA_2[17]*df_all_test[i-1,17] + dcoef_all$Foods_2_CA_2[18]*df_all_test[i-1,18] + dcoef_all$Foods_2_CA_2[19]
    df_all_test[i, 30] = dcoef_all$Foods_3_CA_2[1]*df_all_test[i-1,1] + dcoef_all$Foods_3_CA_2[2]*df_all_test[i-1,2] + dcoef_all$Foods_3_CA_2[3]*df_all_test[i-1,3] + dcoef_all$Foods_3_CA_2[4]*df_all_test[i-1,4] + dcoef_all$Foods_3_CA_2[5]*df_all_test[i-1,5] + dcoef_all$Foods_3_CA_2[6]*df_all_test[i-1,6] + dcoef_all$Foods_3_CA_2[7]*df_all_test[i-1,7] + dcoef_all$Foods_3_CA_2[8]*df_all_test[i-1,8] + dcoef_all$Foods_3_CA_2[9]*df_all_test[i-1,9] + dcoef_all$Foods_3_CA_2[10]*df_all_test[i-1,10] + dcoef_all$Foods_3_CA_2[11]*df_all_test[i-1,11] + dcoef_all$Foods_3_CA_2[12]*df_all_test[i-1,12] + dcoef_all$Foods_3_CA_2[13]*df_all_test[i-1,13] + dcoef_all$Foods_3_CA_2[14]*df_all_test[i-1,14] + dcoef_all$Foods_3_CA_2[15]*df_all_test[i-1,15] + dcoef_all$Foods_3_CA_2[16]*df_all_test[i-1,16] + dcoef_all$Foods_3_CA_2[17]*df_all_test[i-1,17] + dcoef_all$Foods_3_CA_2[18]*df_all_test[i-1,18] + dcoef_all$Foods_3_CA_2[19]
    df_all_test[i, 31] = dcoef_all$Hobbies_CA_3[1]*df_all_test[i-1,1] + dcoef_all$Hobbies_CA_3[2]*df_all_test[i-1,2] + dcoef_all$Hobbies_CA_3[3]*df_all_test[i-1,3] + dcoef_all$Hobbies_CA_3[4]*df_all_test[i-1,4] + dcoef_all$Hobbies_CA_3[5]*df_all_test[i-1,5] + dcoef_all$Hobbies_CA_3[6]*df_all_test[i-1,6] + dcoef_all$Hobbies_CA_3[7]*df_all_test[i-1,7] + dcoef_all$Hobbies_CA_3[8]*df_all_test[i-1,8] + dcoef_all$Hobbies_CA_3[9]*df_all_test[i-1,9] + dcoef_all$Hobbies_CA_3[10]*df_all_test[i-1,10] + dcoef_all$Hobbies_CA_3[11]*df_all_test[i-1,11] + dcoef_all$Hobbies_CA_3[12]*df_all_test[i-1,12] + dcoef_all$Hobbies_CA_3[13]*df_all_test[i-1,13] + dcoef_all$Hobbies_CA_3[14]*df_all_test[i-1,14] + dcoef_all$Hobbies_CA_3[15]*df_all_test[i-1,15] + dcoef_all$Hobbies_CA_3[16]*df_all_test[i-1,16] + dcoef_all$Hobbies_CA_3[17]*df_all_test[i-1,17] + dcoef_all$Hobbies_CA_3[18]*df_all_test[i-1,18] + dcoef_all$Hobbies_CA_3[19]
    df_all_test[i, 32] = dcoef_all$Household_1_CA_3[1]*df_all_test[i-1,1] + dcoef_all$Household_1_CA_3[2]*df_all_test[i-1,2] + dcoef_all$Household_1_CA_3[3]*df_all_test[i-1,3] + dcoef_all$Household_1_CA_3[4]*df_all_test[i-1,4] + dcoef_all$Household_1_CA_3[5]*df_all_test[i-1,5] + dcoef_all$Household_1_CA_3[6]*df_all_test[i-1,6] + dcoef_all$Household_1_CA_3[7]*df_all_test[i-1,7] + dcoef_all$Household_1_CA_3[8]*df_all_test[i-1,8] + dcoef_all$Household_1_CA_3[9]*df_all_test[i-1,9] + dcoef_all$Household_1_CA_3[10]*df_all_test[i-1,10] + dcoef_all$Household_1_CA_3[11]*df_all_test[i-1,11] + dcoef_all$Household_1_CA_3[12]*df_all_test[i-1,12] + dcoef_all$Household_1_CA_3[13]*df_all_test[i-1,13] + dcoef_all$Household_1_CA_3[14]*df_all_test[i-1,14] + dcoef_all$Household_1_CA_3[15]*df_all_test[i-1,15] + dcoef_all$Household_1_CA_3[16]*df_all_test[i-1,16] + dcoef_all$Household_1_CA_3[17]*df_all_test[i-1,17] + dcoef_all$Household_1_CA_3[18]*df_all_test[i-1,18] + dcoef_all$Household_1_CA_3[19]
    df_all_test[i, 33] = dcoef_all$Household_2_CA_3[1]*df_all_test[i-1,1] + dcoef_all$Household_2_CA_3[2]*df_all_test[i-1,2] + dcoef_all$Household_2_CA_3[3]*df_all_test[i-1,3] + dcoef_all$Household_2_CA_3[4]*df_all_test[i-1,4] + dcoef_all$Household_2_CA_3[5]*df_all_test[i-1,5] + dcoef_all$Household_2_CA_3[6]*df_all_test[i-1,6] + dcoef_all$Household_2_CA_3[7]*df_all_test[i-1,7] + dcoef_all$Household_2_CA_3[8]*df_all_test[i-1,8] + dcoef_all$Household_2_CA_3[9]*df_all_test[i-1,9] + dcoef_all$Household_2_CA_3[10]*df_all_test[i-1,10] + dcoef_all$Household_2_CA_3[11]*df_all_test[i-1,11] + dcoef_all$Household_2_CA_3[12]*df_all_test[i-1,12] + dcoef_all$Household_2_CA_3[13]*df_all_test[i-1,13] + dcoef_all$Household_2_CA_3[14]*df_all_test[i-1,14] + dcoef_all$Household_2_CA_3[15]*df_all_test[i-1,15] + dcoef_all$Household_2_CA_3[16]*df_all_test[i-1,16] + dcoef_all$Household_2_CA_3[17]*df_all_test[i-1,17] + dcoef_all$Household_2_CA_3[18]*df_all_test[i-1,18] + dcoef_all$Household_2_CA_3[19]
    df_all_test[i, 34] = dcoef_all$Foods_1_CA_3[1]*df_all_test[i-1,1] + dcoef_all$Foods_1_CA_3[2]*df_all_test[i-1,2] + dcoef_all$Foods_1_CA_3[3]*df_all_test[i-1,3] + dcoef_all$Foods_1_CA_3[4]*df_all_test[i-1,4] + dcoef_all$Foods_1_CA_3[5]*df_all_test[i-1,5] + dcoef_all$Foods_1_CA_3[6]*df_all_test[i-1,6] + dcoef_all$Foods_1_CA_3[7]*df_all_test[i-1,7] + dcoef_all$Foods_1_CA_3[8]*df_all_test[i-1,8] + dcoef_all$Foods_1_CA_3[9]*df_all_test[i-1,9] + dcoef_all$Foods_1_CA_3[10]*df_all_test[i-1,10] + dcoef_all$Foods_1_CA_3[11]*df_all_test[i-1,11] + dcoef_all$Foods_1_CA_3[12]*df_all_test[i-1,12] + dcoef_all$Foods_1_CA_3[13]*df_all_test[i-1,13] + dcoef_all$Foods_1_CA_3[14]*df_all_test[i-1,14] + dcoef_all$Foods_1_CA_3[15]*df_all_test[i-1,15] + dcoef_all$Foods_1_CA_3[16]*df_all_test[i-1,16] + dcoef_all$Foods_1_CA_3[17]*df_all_test[i-1,17] + dcoef_all$Foods_1_CA_3[18]*df_all_test[i-1,18] + dcoef_all$Foods_1_CA_3[19]
    df_all_test[i, 35] = dcoef_all$Foods_2_CA_3[1]*df_all_test[i-1,1] + dcoef_all$Foods_2_CA_3[2]*df_all_test[i-1,2] + dcoef_all$Foods_2_CA_3[3]*df_all_test[i-1,3] + dcoef_all$Foods_2_CA_3[4]*df_all_test[i-1,4] + dcoef_all$Foods_2_CA_3[5]*df_all_test[i-1,5] + dcoef_all$Foods_2_CA_3[6]*df_all_test[i-1,6] + dcoef_all$Foods_2_CA_3[7]*df_all_test[i-1,7] + dcoef_all$Foods_2_CA_3[8]*df_all_test[i-1,8] + dcoef_all$Foods_2_CA_3[9]*df_all_test[i-1,9] + dcoef_all$Foods_2_CA_3[10]*df_all_test[i-1,10] + dcoef_all$Foods_2_CA_3[11]*df_all_test[i-1,11] + dcoef_all$Foods_2_CA_3[12]*df_all_test[i-1,12] + dcoef_all$Foods_2_CA_3[13]*df_all_test[i-1,13] + dcoef_all$Foods_2_CA_3[14]*df_all_test[i-1,14] + dcoef_all$Foods_2_CA_3[15]*df_all_test[i-1,15] + dcoef_all$Foods_2_CA_3[16]*df_all_test[i-1,16] + dcoef_all$Foods_2_CA_3[17]*df_all_test[i-1,17] + dcoef_all$Foods_2_CA_3[18]*df_all_test[i-1,18] + dcoef_all$Foods_2_CA_3[19]
    df_all_test[i, 36] = dcoef_all$Foods_3_CA_3[1]*df_all_test[i-1,1] + dcoef_all$Foods_3_CA_3[2]*df_all_test[i-1,2] + dcoef_all$Foods_3_CA_3[3]*df_all_test[i-1,3] + dcoef_all$Foods_3_CA_3[4]*df_all_test[i-1,4] + dcoef_all$Foods_3_CA_3[5]*df_all_test[i-1,5] + dcoef_all$Foods_3_CA_3[6]*df_all_test[i-1,6] + dcoef_all$Foods_3_CA_3[7]*df_all_test[i-1,7] + dcoef_all$Foods_3_CA_3[8]*df_all_test[i-1,8] + dcoef_all$Foods_3_CA_3[9]*df_all_test[i-1,9] + dcoef_all$Foods_3_CA_3[10]*df_all_test[i-1,10] + dcoef_all$Foods_3_CA_3[11]*df_all_test[i-1,11] + dcoef_all$Foods_3_CA_3[12]*df_all_test[i-1,12] + dcoef_all$Foods_3_CA_3[13]*df_all_test[i-1,13] + dcoef_all$Foods_3_CA_3[14]*df_all_test[i-1,14] + dcoef_all$Foods_3_CA_3[15]*df_all_test[i-1,15] + dcoef_all$Foods_3_CA_3[16]*df_all_test[i-1,16] + dcoef_all$Foods_3_CA_3[17]*df_all_test[i-1,17] + dcoef_all$Foods_3_CA_3[18]*df_all_test[i-1,18] + dcoef_all$Foods_3_CA_3[19]
        
  }
}

  
colnames(df_all_test) = c('Hobbies_CA_1','Household_1_CA_1','Household_2_CA_1','Foods_1_CA_1','Foods_2_CA_1','Foods_3_CA_1'
                          ,'Hobbies_CA_2','Household_1_CA_2','Household_2_CA_2','Foods_1_CA_2','Foods_2_CA_2','Foods_3_CA_2'
                          ,'Hobbies_CA_3','Household_1_CA_3','Household_2_CA_3','Foods_1_CA_3','Foods_2_CA_3','Foods_3_CA_3'
                          ,'Hobbies_CA_1_pred','Household_1_CA_1_pred','Household_2_CA_1_pred','Foods_1_CA_1_pred','Foods_2_CA_1_pred','Foods_3_CA_1_pred'
                          ,'Hobbies_CA_2_pred','Household_1_CA_2_pred','Household_2_CA_2_pred','Foods_1_CA_2_pred','Foods_2_CA_2_pred','Foods_3_CA_2_pred'
                          ,'Hobbies_CA_3_pred','Household_1_CA_3_pred','Household_2_CA_3_pred','Foods_1_CA_3_pred','Foods_2_CA_3_pred','Foods_3_CA_3_pred'
                          )


forecasts_all_23 = df_all_test

# Save the RMSSE Results in a data frame
df_rmsse_CA_1_5yr[1, 3] = RMSSE(forecasts_all_23$Hobbies_CA_1, forecasts_all_23$Hobbies_CA_1_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_1_5yr[2, 3] = RMSSE(forecasts_all_23$Household_1_CA_1, forecasts_all_23$Household_1_CA_1_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_1_5yr[3, 3] = RMSSE(forecasts_all_23$Household_2_CA_1, forecasts_all_23$Household_2_CA_1_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_1_5yr[4, 3] = RMSSE(forecasts_all_23$Foods_1_CA_1, forecasts_all_23$Foods_1_CA_1_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_1_5yr[5, 3] = RMSSE(forecasts_all_23$Foods_2_CA_1, forecasts_all_23$Foods_2_CA_1_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_1_5yr[6, 3] = RMSSE(forecasts_all_23$Foods_3_CA_1, forecasts_all_23$Foods_3_CA_1_pred, scale = 1, na.rm = TRUE)

df_rmsse_CA_2_5yr[1, 3] = RMSSE(forecasts_all_23$Hobbies_CA_2, forecasts_all_23$Hobbies_CA_2_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_2_5yr[2, 3] = RMSSE(forecasts_all_23$Household_1_CA_2, forecasts_all_23$Household_1_CA_2_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_2_5yr[3, 3] = RMSSE(forecasts_all_23$Household_2_CA_2, forecasts_all_23$Household_2_CA_2_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_2_5yr[4, 3] = RMSSE(forecasts_all_23$Foods_1_CA_2, forecasts_all_23$Foods_1_CA_2_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_2_5yr[5, 3] = RMSSE(forecasts_all_23$Foods_2_CA_2, forecasts_all_23$Foods_2_CA_2_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_2_5yr[6, 3] = RMSSE(forecasts_all_23$Foods_3_CA_2, forecasts_all_23$Foods_3_CA_2_pred, scale = 1, na.rm = TRUE)

df_rmsse_CA_3_5yr[1, 3] = RMSSE(forecasts_all_23$Hobbies_CA_3, forecasts_all_23$Hobbies_CA_3_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_3_5yr[2, 3] = RMSSE(forecasts_all_23$Household_1_CA_3, forecasts_all_23$Household_1_CA_3_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_3_5yr[3, 3] = RMSSE(forecasts_all_23$Household_2_CA_3, forecasts_all_23$Household_2_CA_3_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_3_5yr[4, 3] = RMSSE(forecasts_all_23$Foods_1_CA_3, forecasts_all_23$Foods_1_CA_3_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_3_5yr[5, 3] = RMSSE(forecasts_all_23$Foods_2_CA_3, forecasts_all_23$Foods_2_CA_3_pred, scale = 1, na.rm = TRUE)
df_rmsse_CA_3_5yr[6, 3] = RMSSE(forecasts_all_23$Foods_3_CA_3, forecasts_all_23$Foods_3_CA_3_pred, scale = 1, na.rm = TRUE)

rownames(df_rmsse_CA_1_5yr) =  c("Hobbies","Household1","Household2","Foods1","Foods2","Foods3")
rownames(df_rmsse_CA_2_5yr) =  c("Hobbies","Household1","Household2","Foods1","Foods2","Foods3")
rownames(df_rmsse_CA_3_5yr) =  c("Hobbies","Household1","Household2","Foods1","Foods2","Foods3")

colnames(df_rmsse_CA_1_5yr) = c("var21","var22","var23")
colnames(df_rmsse_CA_2_5yr) = c("var21","var22","var23")
colnames(df_rmsse_CA_3_5yr) = c("var21","var22","var23")

```

```{r}

df_rmsse_CA_1_5yr
df_rmsse_CA_2_5yr
df_rmsse_CA_3_5yr

```


## Final results

Also, we will compute the average of the RMSSE for the four splits in the second VAR:

```{r, echo=FALSE}

df_rmsse_CA_1_avg_3 = data.frame()
df_rmsse_CA_2_avg_3 = data.frame()
df_rmsse_CA_3_avg_3 = data.frame()

# Save the RMSSE Results in a data frame
df_rmsse_CA_1_avg_3[1, 1] = df_rmsse_CA_1_2yr[1, 3]
df_rmsse_CA_1_avg_3[2, 1] = df_rmsse_CA_1_2yr[2, 3]
df_rmsse_CA_1_avg_3[3, 1] = df_rmsse_CA_1_2yr[3, 3]
df_rmsse_CA_1_avg_3[4, 1] = df_rmsse_CA_1_2yr[4, 3]
df_rmsse_CA_1_avg_3[5, 1] = df_rmsse_CA_1_2yr[5, 3]
df_rmsse_CA_1_avg_3[6, 1] = df_rmsse_CA_1_2yr[6, 3]

df_rmsse_CA_1_avg_3[1, 2] = df_rmsse_CA_1_3yr[1, 3]
df_rmsse_CA_1_avg_3[2, 2] = df_rmsse_CA_1_3yr[2, 3]
df_rmsse_CA_1_avg_3[3, 2] = df_rmsse_CA_1_3yr[3, 3]
df_rmsse_CA_1_avg_3[4, 2] = df_rmsse_CA_1_3yr[4, 3]
df_rmsse_CA_1_avg_3[5, 2] = df_rmsse_CA_1_3yr[5, 3]
df_rmsse_CA_1_avg_3[6, 2] = df_rmsse_CA_1_3yr[6, 3]

df_rmsse_CA_1_avg_3[1, 3] = df_rmsse_CA_1_4yr[1, 3]
df_rmsse_CA_1_avg_3[2, 3] = df_rmsse_CA_1_4yr[2, 3]
df_rmsse_CA_1_avg_3[3, 3] = df_rmsse_CA_1_4yr[3, 3]
df_rmsse_CA_1_avg_3[4, 3] = df_rmsse_CA_1_4yr[4, 3]
df_rmsse_CA_1_avg_3[5, 3] = df_rmsse_CA_1_4yr[5, 3]
df_rmsse_CA_1_avg_3[6, 3] = df_rmsse_CA_1_4yr[6, 3]

df_rmsse_CA_1_avg_3[1, 4] = df_rmsse_CA_1_5yr[1, 3]
df_rmsse_CA_1_avg_3[2, 4] = df_rmsse_CA_1_5yr[2, 3]
df_rmsse_CA_1_avg_3[3, 4] = df_rmsse_CA_1_5yr[3, 3]
df_rmsse_CA_1_avg_3[4, 4] = df_rmsse_CA_1_5yr[4, 3]
df_rmsse_CA_1_avg_3[5, 4] = df_rmsse_CA_1_5yr[5, 3]
df_rmsse_CA_1_avg_3[6, 4] = df_rmsse_CA_1_5yr[6, 3]

df_rmsse_CA_1_avg_3[1, 5] = (df_rmsse_CA_1_avg_3[1, 1] + df_rmsse_CA_1_avg_3[1, 2] + df_rmsse_CA_1_avg_3[1, 3] + df_rmsse_CA_1_avg_3[1, 4])/4 
df_rmsse_CA_1_avg_3[2, 5] = (df_rmsse_CA_1_avg_3[2, 1] + df_rmsse_CA_1_avg_3[2, 2] + df_rmsse_CA_1_avg_3[2, 3] + df_rmsse_CA_1_avg_3[2, 4])/4
df_rmsse_CA_1_avg_3[3, 5] = (df_rmsse_CA_1_avg_3[3, 1] + df_rmsse_CA_1_avg_3[3, 2] + df_rmsse_CA_1_avg_3[3, 3] + df_rmsse_CA_1_avg_3[3, 4])/4
df_rmsse_CA_1_avg_3[4, 5] = (df_rmsse_CA_1_avg_3[4, 1] + df_rmsse_CA_1_avg_3[4, 2] + df_rmsse_CA_1_avg_3[4, 3] + df_rmsse_CA_1_avg_3[4, 4])/4
df_rmsse_CA_1_avg_3[5, 5] = (df_rmsse_CA_1_avg_3[5, 1] + df_rmsse_CA_1_avg_3[5, 2] + df_rmsse_CA_1_avg_3[5, 3] + df_rmsse_CA_1_avg_3[5, 4])/4
df_rmsse_CA_1_avg_3[6, 5] = (df_rmsse_CA_1_avg_3[6, 1] + df_rmsse_CA_1_avg_3[6, 2] + df_rmsse_CA_1_avg_3[6, 3] + df_rmsse_CA_1_avg_3[6, 4])/4

colnames(df_rmsse_CA_1_avg_3) = c("split2yr","split3yr","split4yr","split5yr","avg")
rownames(df_rmsse_CA_1_avg_3) =  c("Hobbies","Household1","Household2","Foods1","Foods2","Foods3")


df_rmsse_CA_1_avg_3


```

Store 2:

```{r, echo=FALSE}


# Save the RMSSE Results in a data frame
df_rmsse_CA_2_avg_3[1, 1] = df_rmsse_CA_2_2yr[1, 3]
df_rmsse_CA_2_avg_3[2, 1] = df_rmsse_CA_2_2yr[2, 3]
df_rmsse_CA_2_avg_3[3, 1] = df_rmsse_CA_2_2yr[3, 3]
df_rmsse_CA_2_avg_3[4, 1] = df_rmsse_CA_2_2yr[4, 3]
df_rmsse_CA_2_avg_3[5, 1] = df_rmsse_CA_2_2yr[5, 3]
df_rmsse_CA_2_avg_3[6, 1] = df_rmsse_CA_2_2yr[6, 3]

df_rmsse_CA_2_avg_3[1, 2] = df_rmsse_CA_2_3yr[1, 3]
df_rmsse_CA_2_avg_3[2, 2] = df_rmsse_CA_2_3yr[2, 3]
df_rmsse_CA_2_avg_3[3, 2] = df_rmsse_CA_2_3yr[3, 3]
df_rmsse_CA_2_avg_3[4, 2] = df_rmsse_CA_2_3yr[4, 3]
df_rmsse_CA_2_avg_3[5, 2] = df_rmsse_CA_2_3yr[5, 3]
df_rmsse_CA_2_avg_3[6, 2] = df_rmsse_CA_2_3yr[6, 3]

df_rmsse_CA_2_avg_3[1, 3] = df_rmsse_CA_2_4yr[1, 3]
df_rmsse_CA_2_avg_3[2, 3] = df_rmsse_CA_2_4yr[2, 3]
df_rmsse_CA_2_avg_3[3, 3] = df_rmsse_CA_2_4yr[3, 3]
df_rmsse_CA_2_avg_3[4, 3] = df_rmsse_CA_2_4yr[4, 3]
df_rmsse_CA_2_avg_3[5, 3] = df_rmsse_CA_2_4yr[5, 3]
df_rmsse_CA_2_avg_3[6, 3] = df_rmsse_CA_2_4yr[6, 3]

df_rmsse_CA_2_avg_3[1, 4] = df_rmsse_CA_2_5yr[1, 3]
df_rmsse_CA_2_avg_3[2, 4] = df_rmsse_CA_2_5yr[2, 3]
df_rmsse_CA_2_avg_3[3, 4] = df_rmsse_CA_2_5yr[3, 3]
df_rmsse_CA_2_avg_3[4, 4] = df_rmsse_CA_2_5yr[4, 3]
df_rmsse_CA_2_avg_3[5, 4] = df_rmsse_CA_2_5yr[5, 3]
df_rmsse_CA_2_avg_3[6, 4] = df_rmsse_CA_2_5yr[6, 3]

df_rmsse_CA_2_avg_3[1, 5] = (df_rmsse_CA_2_avg_3[1, 1] + df_rmsse_CA_2_avg_3[1, 2] + df_rmsse_CA_2_avg_3[1, 3] + df_rmsse_CA_2_avg_3[1, 4])/4 
df_rmsse_CA_2_avg_3[2, 5] = (df_rmsse_CA_2_avg_3[2, 1] + df_rmsse_CA_2_avg_3[2, 2] + df_rmsse_CA_2_avg_3[2, 3] + df_rmsse_CA_2_avg_3[2, 4])/4
df_rmsse_CA_2_avg_3[3, 5] = (df_rmsse_CA_2_avg_3[3, 1] + df_rmsse_CA_2_avg_3[3, 2] + df_rmsse_CA_2_avg_3[3, 3] + df_rmsse_CA_2_avg_3[3, 4])/4
df_rmsse_CA_2_avg_3[4, 5] = (df_rmsse_CA_2_avg_3[4, 1] + df_rmsse_CA_2_avg_3[4, 2] + df_rmsse_CA_2_avg_3[4, 3] + df_rmsse_CA_2_avg_3[4, 4])/4
df_rmsse_CA_2_avg_3[5, 5] = (df_rmsse_CA_2_avg_3[5, 1] + df_rmsse_CA_2_avg_3[5, 2] + df_rmsse_CA_2_avg_3[5, 3] + df_rmsse_CA_2_avg_3[5, 4])/4
df_rmsse_CA_2_avg_3[6, 5] = (df_rmsse_CA_2_avg_3[6, 1] + df_rmsse_CA_2_avg_3[6, 2] + df_rmsse_CA_2_avg_3[6, 3] + df_rmsse_CA_2_avg_3[6, 4])/4

colnames(df_rmsse_CA_2_avg_3) = c("split2yr","split3yr","split4yr","split5yr","avg")
rownames(df_rmsse_CA_2_avg_3) =  c("Hobbies","Household1","Household2","Foods1","Foods2","Foods3")


df_rmsse_CA_2_avg_3


```

Store 3:

```{r, echo=FALSE}


# Save the RMSSE Results in a data frame
df_rmsse_CA_3_avg_3[1, 1] = df_rmsse_CA_3_2yr[1, 3]
df_rmsse_CA_3_avg_3[2, 1] = df_rmsse_CA_3_2yr[2, 3]
df_rmsse_CA_3_avg_3[3, 1] = df_rmsse_CA_3_2yr[3, 3]
df_rmsse_CA_3_avg_3[4, 1] = df_rmsse_CA_3_2yr[4, 3]
df_rmsse_CA_3_avg_3[5, 1] = df_rmsse_CA_3_2yr[5, 3]
df_rmsse_CA_3_avg_3[6, 1] = df_rmsse_CA_3_2yr[6, 3]

df_rmsse_CA_3_avg_3[1, 2] = df_rmsse_CA_3_3yr[1, 3]
df_rmsse_CA_3_avg_3[2, 2] = df_rmsse_CA_3_3yr[2, 3]
df_rmsse_CA_3_avg_3[3, 2] = df_rmsse_CA_3_3yr[3, 3]
df_rmsse_CA_3_avg_3[4, 2] = df_rmsse_CA_3_3yr[4, 3]
df_rmsse_CA_3_avg_3[5, 2] = df_rmsse_CA_3_3yr[5, 3]
df_rmsse_CA_3_avg_3[6, 2] = df_rmsse_CA_3_3yr[6, 3]

df_rmsse_CA_3_avg_3[1, 3] = df_rmsse_CA_3_4yr[1, 3]
df_rmsse_CA_3_avg_3[2, 3] = df_rmsse_CA_3_4yr[2, 3]
df_rmsse_CA_3_avg_3[3, 3] = df_rmsse_CA_3_4yr[3, 3]
df_rmsse_CA_3_avg_3[4, 3] = df_rmsse_CA_3_4yr[4, 3]
df_rmsse_CA_3_avg_3[5, 3] = df_rmsse_CA_3_4yr[5, 3]
df_rmsse_CA_3_avg_3[6, 3] = df_rmsse_CA_3_4yr[6, 3]

df_rmsse_CA_3_avg_3[1, 4] = df_rmsse_CA_3_5yr[1, 3]
df_rmsse_CA_3_avg_3[2, 4] = df_rmsse_CA_3_5yr[2, 3]
df_rmsse_CA_3_avg_3[3, 4] = df_rmsse_CA_3_5yr[3, 3]
df_rmsse_CA_3_avg_3[4, 4] = df_rmsse_CA_3_5yr[4, 3]
df_rmsse_CA_3_avg_3[5, 4] = df_rmsse_CA_3_5yr[5, 3]
df_rmsse_CA_3_avg_3[6, 4] = df_rmsse_CA_3_5yr[6, 3]

df_rmsse_CA_3_avg_3[1, 5] = (df_rmsse_CA_3_avg_3[1, 1] + df_rmsse_CA_3_avg_3[1, 2] + df_rmsse_CA_3_avg_3[1, 3] + df_rmsse_CA_3_avg_3[1, 4])/4 
df_rmsse_CA_3_avg_3[2, 5] = (df_rmsse_CA_3_avg_3[2, 1] + df_rmsse_CA_3_avg_3[2, 2] + df_rmsse_CA_3_avg_3[2, 3] + df_rmsse_CA_3_avg_3[2, 4])/4
df_rmsse_CA_3_avg_3[3, 5] = (df_rmsse_CA_3_avg_3[3, 1] + df_rmsse_CA_3_avg_3[3, 2] + df_rmsse_CA_3_avg_3[3, 3] + df_rmsse_CA_3_avg_3[3, 4])/4
df_rmsse_CA_3_avg_3[4, 5] = (df_rmsse_CA_3_avg_3[4, 1] + df_rmsse_CA_3_avg_3[4, 2] + df_rmsse_CA_3_avg_3[4, 3] + df_rmsse_CA_3_avg_3[4, 4])/4
df_rmsse_CA_3_avg_3[5, 5] = (df_rmsse_CA_3_avg_3[5, 1] + df_rmsse_CA_3_avg_3[5, 2] + df_rmsse_CA_3_avg_3[5, 3] + df_rmsse_CA_3_avg_3[5, 4])/4
df_rmsse_CA_3_avg_3[6, 5] = (df_rmsse_CA_3_avg_3[6, 1] + df_rmsse_CA_3_avg_3[6, 2] + df_rmsse_CA_3_avg_3[6, 3] + df_rmsse_CA_3_avg_3[6, 4])/4

colnames(df_rmsse_CA_3_avg_3) = c("split2yr","split3yr","split4yr","split5yr","avg")
rownames(df_rmsse_CA_3_avg_3) =  c("Hobbies","Household1","Household2","Foods1","Foods2","Foods3")


df_rmsse_CA_3_avg_3


```

## Results from Store VAR and Product VAR compared

```{r }

df_avg_rmsse_CA1[1,3] = df_rmsse_CA_1_avg_3[1,5]
df_avg_rmsse_CA1[2,3] = df_rmsse_CA_1_avg_3[2,5]
df_avg_rmsse_CA1[3,3] = df_rmsse_CA_1_avg_3[3,5]
df_avg_rmsse_CA1[4,3] = df_rmsse_CA_1_avg_3[4,5]
df_avg_rmsse_CA1[5,3] = df_rmsse_CA_1_avg_3[5,5]
df_avg_rmsse_CA1[6,3] = df_rmsse_CA_1_avg_3[6,5]

df_avg_rmsse_CA2[1,3] = df_rmsse_CA_2_avg_3[1,5]
df_avg_rmsse_CA2[2,3] = df_rmsse_CA_2_avg_3[2,5]
df_avg_rmsse_CA2[3,3] = df_rmsse_CA_2_avg_3[3,5]
df_avg_rmsse_CA2[4,3] = df_rmsse_CA_2_avg_3[4,5]
df_avg_rmsse_CA2[5,3] = df_rmsse_CA_2_avg_3[5,5]
df_avg_rmsse_CA2[6,3] = df_rmsse_CA_2_avg_3[6,5]

df_avg_rmsse_CA3[1,3] = df_rmsse_CA_3_avg_3[1,5]
df_avg_rmsse_CA3[2,3] = df_rmsse_CA_3_avg_3[2,5]
df_avg_rmsse_CA3[3,3] = df_rmsse_CA_3_avg_3[3,5]
df_avg_rmsse_CA3[4,3] = df_rmsse_CA_3_avg_3[4,5]
df_avg_rmsse_CA3[5,3] = df_rmsse_CA_3_avg_3[5,5]
df_avg_rmsse_CA3[6,3] = df_rmsse_CA_3_avg_3[6,5]

colnames(df_avg_rmsse_CA1) = c("avg_rmsse_21","avg_rmsse_22","avg_rmsse_23")
rownames(df_avg_rmsse_CA1) =  c("Hobbies","Household1","Household2","Foods1","Foods2","Foods3")

colnames(df_avg_rmsse_CA2) = c("avg_rmsse_21","avg_rmsse_22","avg_rmsse_23")
rownames(df_avg_rmsse_CA2) =  c("Hobbies","Household1","Household2","Foods1","Foods2","Foods3")

colnames(df_avg_rmsse_CA3) = c("avg_rmsse_21","avg_rmsse_22","avg_rmsse_23")
rownames(df_avg_rmsse_CA3) =  c("Hobbies","Household1","Household2","Foods1","Foods2","Foods3")

df_avg_rmsse_CA1

df_avg_rmsse_CA2

df_avg_rmsse_CA3

```

## Comparison three VAR (2.1-Store, 2.2-Product, 2.3-All Variables) 

Using the same for splits for every VAR methodology, We can see that for Store 1 the VAR that perform best (with minimum RMSSE) are:

- 5 products with Store-VAR
- 1 product with Product-VAR


For Store 2 the VAR that perform best are:

- 3 products with Product-VAR
- 3 products with All-Variables-VAR


For Store 3 the VAR that perform best are:

- 2 products with Store-VAR
- 3 products with Product-VAR
- 1 product with All-Variables-VAR

In general terms, 
- 7 products performed better with Store-VAR, 7 products perform better with Product-VAR and 4 products perform better with All-Variables-VAR.

The total RMSSE for each one of the methods is:

```{r }


RMSSE_21 = sum(df_avg_rmsse_CA1$avg_rmsse_21) + sum(df_avg_rmsse_CA2$avg_rmsse_21) + sum(df_avg_rmsse_CA3$avg_rmsse_21)
RMSSE_22 = sum(df_avg_rmsse_CA1$avg_rmsse_22) + sum(df_avg_rmsse_CA2$avg_rmsse_22) + sum(df_avg_rmsse_CA3$avg_rmsse_22)
RMSSE_23 = sum(df_avg_rmsse_CA1$avg_rmsse_23) + sum(df_avg_rmsse_CA2$avg_rmsse_23) + sum(df_avg_rmsse_CA3$avg_rmsse_23)

RMSSE_21
RMSSE_22
RMSSE_23


```

As the smallest RMSSE is the one of Product-VARS, this method would be preferred to do 1-step forecasts with this data.

